(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define([], factory);
	else if(typeof exports === 'object')
		exports["COS"] = factory();
	else
		root["COS"] = factory();
})(window, function() {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/dist/";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./index.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./index.js":
/*!******************!*\
  !*** ./index.js ***!
  \******************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var COS = __webpack_require__(/*! ./src/cos */ "./src/cos.js");

module.exports = COS;

/***/ }),

/***/ "./lib/beacon.min.js":
/*!***************************!*\
  !*** ./lib/beacon.min.js ***!
  \***************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(global) {var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;var _typeof = __webpack_require__(/*! @babel/runtime/helpers/typeof */ "./node_modules/@babel/runtime/helpers/typeof.js");

!function (t, e) {
  "object" == ( false ? undefined : _typeof(exports)) && "undefined" != typeof module ? module.exports = e() :  true ? !(__WEBPACK_AMD_DEFINE_FACTORY__ = (e),
				__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
				(__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) :
				__WEBPACK_AMD_DEFINE_FACTORY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)) : undefined;
}(this, function () {
  "use strict";

  var _t = function t(e, r) {
    return (_t = Object.setPrototypeOf || {
      __proto__: []
    } instanceof Array && function (t, e) {
      t.__proto__ = e;
    } || function (t, e) {
      for (var r in e) {
        Object.prototype.hasOwnProperty.call(e, r) && (t[r] = e[r]);
      }
    })(e, r);
  };

  var _e = function e() {
    return (_e = Object.assign || function (t) {
      for (var e, r = 1, n = arguments.length; r < n; r++) {
        for (var o in e = arguments[r]) {
          Object.prototype.hasOwnProperty.call(e, o) && (t[o] = e[o]);
        }
      }

      return t;
    }).apply(this, arguments);
  };

  function r(t, e, r, n) {
    return new (r || (r = Promise))(function (o, i) {
      function a(t) {
        try {
          c(n.next(t));
        } catch (t) {
          i(t);
        }
      }

      function s(t) {
        try {
          c(n.throw(t));
        } catch (t) {
          i(t);
        }
      }

      function c(t) {
        var e;
        t.done ? o(t.value) : (e = t.value, e instanceof r ? e : new r(function (t) {
          t(e);
        })).then(a, s);
      }

      c((n = n.apply(t, e || [])).next());
    });
  }

  function n(t, e) {
    var r,
        n,
        o,
        i,
        a = {
      label: 0,
      sent: function sent() {
        if (1 & o[0]) throw o[1];
        return o[1];
      },
      trys: [],
      ops: []
    };
    return i = {
      next: s(0),
      throw: s(1),
      return: s(2)
    }, "function" == typeof Symbol && (i[Symbol.iterator] = function () {
      return this;
    }), i;

    function s(i) {
      return function (s) {
        return function (i) {
          if (r) throw new TypeError("Generator is already executing.");

          for (; a;) {
            try {
              if (r = 1, n && (o = 2 & i[0] ? n.return : i[0] ? n.throw || ((o = n.return) && o.call(n), 0) : n.next) && !(o = o.call(n, i[1])).done) return o;

              switch (n = 0, o && (i = [2 & i[0], o.value]), i[0]) {
                case 0:
                case 1:
                  o = i;
                  break;

                case 4:
                  return a.label++, {
                    value: i[1],
                    done: !1
                  };

                case 5:
                  a.label++, n = i[1], i = [0];
                  continue;

                case 7:
                  i = a.ops.pop(), a.trys.pop();
                  continue;

                default:
                  if (!(o = a.trys, (o = o.length > 0 && o[o.length - 1]) || 6 !== i[0] && 2 !== i[0])) {
                    a = 0;
                    continue;
                  }

                  if (3 === i[0] && (!o || i[1] > o[0] && i[1] < o[3])) {
                    a.label = i[1];
                    break;
                  }

                  if (6 === i[0] && a.label < o[1]) {
                    a.label = o[1], o = i;
                    break;
                  }

                  if (o && a.label < o[2]) {
                    a.label = o[2], a.ops.push(i);
                    break;
                  }

                  o[2] && a.ops.pop(), a.trys.pop();
                  continue;
              }

              i = e.call(t, a);
            } catch (t) {
              i = [6, t], n = 0;
            } finally {
              r = o = 0;
            }
          }

          if (5 & i[0]) throw i[1];
          return {
            value: i[0] ? i[1] : void 0,
            done: !0
          };
        }([i, s]);
      };
    }
  }

  var o = "__BEACON_",
      i = "__BEACON_deviceId",
      a = "last_report_time",
      s = "sending_event_ids",
      c = "beacon_config",
      u = "beacon_config_request_time",
      l = function () {
    function t() {
      var t = this;
      this.emit = function (e, r) {
        if (t) {
          var n,
              o = t.__EventsList[e];

          if (null == o ? void 0 : o.length) {
            o = o.slice();

            for (var i = 0; i < o.length; i++) {
              n = o[i];

              try {
                var a = n.callback.apply(t, [r]);
                if (1 === n.type && t.remove(e, n.callback), !1 === a) break;
              } catch (t) {
                throw t;
              }
            }
          }

          return t;
        }
      }, this.__EventsList = {};
    }

    return t.prototype.indexOf = function (t, e) {
      for (var r = 0; r < t.length; r++) {
        if (t[r].callback === e) return r;
      }

      return -1;
    }, t.prototype.on = function (t, e, r) {
      if (void 0 === r && (r = 0), this) {
        var n = this.__EventsList[t];

        if (n || (n = this.__EventsList[t] = []), -1 === this.indexOf(n, e)) {
          var o = {
            name: t,
            type: r || 0,
            callback: e
          };
          return n.push(o), this;
        }

        return this;
      }
    }, t.prototype.one = function (t, e) {
      this.on(t, e, 1);
    }, t.prototype.remove = function (t, e) {
      if (this) {
        var r = this.__EventsList[t];
        if (!r) return null;

        if (!e) {
          try {
            delete this.__EventsList[t];
          } catch (t) {}

          return null;
        }

        if (r.length) {
          var n = this.indexOf(r, e);
          r.splice(n, 1);
        }

        return this;
      }
    }, t;
  }();

  function h(t, e) {
    for (var r = {}, n = 0, o = Object.keys(t); n < o.length; n++) {
      var i = o[n],
          a = t[i];
      if ("string" == typeof a) r[f(i)] = f(a);else {
        if (e) throw new Error("value mast be string  !!!!");
        r[f(String(i))] = f(String(a));
      }
    }

    return r;
  }

  function f(t) {
    if ("string" != typeof t) return t;

    try {
      return t.replace(new RegExp("\\|", "g"), "%7C").replace(new RegExp("\\&", "g"), "%26").replace(new RegExp("\\=", "g"), "%3D").replace(new RegExp("\\+", "g"), "%2B");
    } catch (t) {
      return "";
    }
  }

  function p(t) {
    return String(t.A99) + String(t.A100);
  }

  var d = function d() {};

  var v = function () {
    function t(t) {
      var r = this;
      this.lifeCycle = new l(), this.uploadJobQueue = [], this.additionalParams = {}, this.delayTime = 0, this._normalLogPipeline = function (t) {
        if (!t || !t.reduce || !t.length) throw new TypeError("createPipeline 方法需要传入至少有一个 pipe 的数组");
        return 1 === t.length ? function (e, r) {
          t[0](e, r || d);
        } : t.reduce(function (t, e) {
          return function (r, n) {
            return void 0 === n && (n = d), t(r, function (t) {
              return null == e ? void 0 : e(t, n);
            });
          };
        });
      }([function (t) {
        r.send({
          url: r.strategy.getUploadUrl(),
          data: t,
          method: "post",
          contentType: "application/json;charset=UTF-8"
        }, function () {
          var e = r.config.onReportSuccess;
          "function" == typeof e && e(JSON.stringify(t.events));
        }, function () {
          var e = r.config.onReportFail;
          "function" == typeof e && e(JSON.stringify(t.events));
        });
      }]), function (t, e) {
        if (!t) throw e instanceof Error ? e : new Error(e);
      }(Boolean(t.appkey), "appkey must be initial"), this.config = _e({}, t);
    }

    return t.prototype.onUserAction = function (t, e) {
      this.preReport(t, e, !1);
    }, t.prototype.onDirectUserAction = function (t, e) {
      this.preReport(t, e, !0);
    }, t.prototype.preReport = function (t, e, r) {
      t ? this.strategy.isEventUpOnOff() && (this.strategy.isBlackEvent(t) || this.strategy.isSampleEvent(t) || this.onReport(t, e, r)) : this.errorReport.reportError("602", " no eventCode");
    }, t.prototype.addAdditionalParams = function (t) {
      for (var e = 0, r = Object.keys(t); e < r.length; e++) {
        var n = r[e];
        this.additionalParams[n] = t[n];
      }
    }, t.prototype.setChannelId = function (t) {
      this.commonInfo.channelID = String(t);
    }, t.prototype.setOpenId = function (t) {
      this.commonInfo.openid = String(t);
    }, t.prototype.setUnionid = function (t) {
      this.commonInfo.unid = String(t);
    }, t.prototype.getDeviceId = function () {
      return this.commonInfo.deviceId;
    }, t.prototype.getCommonInfo = function () {
      return this.commonInfo;
    }, t.prototype.removeSendingId = function (t) {
      try {
        var e = JSON.parse(this.storage.getItem(s)),
            r = e.indexOf(t);
        -1 != r && (e.splice(r, 1), this.storage.setItem(s, JSON.stringify(e)));
      } catch (t) {}
    }, t;
  }(),
      y = function () {
    function t(t, e, r, n) {
      this.requestParams = {}, this.network = n, this.requestParams.attaid = "00400014144", this.requestParams.token = "6478159937", this.requestParams.product_id = t.appkey, this.requestParams.platform = r, this.requestParams.uin = e.deviceId, this.requestParams.model = "", this.requestParams.os = r, this.requestParams.app_version = t.appVersion, this.requestParams.sdk_version = e.sdkVersion, this.requestParams.error_stack = "", this.uploadUrl = t.isOversea ? "https://htrace.wetvinfo.com/kv" : "https://h.trace.qq.com/kv";
    }

    return t.prototype.reportError = function (t, e) {
      this.requestParams._dc = Math.random(), this.requestParams.error_msg = e, this.requestParams.error_code = t, this.network.get(this.uploadUrl, {
        params: this.requestParams
      }).catch(function (t) {});
    }, t;
  }(),
      g = function () {
    function t(t, e, r, n) {
      this.strategy = {
        isEventUpOnOff: !0,
        httpsUploadUrl: "https://otheve.beacon.qq.com/analytics/v2_upload",
        requestInterval: 30,
        blacklist: [],
        samplelist: []
      }, this.realSample = {}, this.appkey = "", this.appkey = t.appkey, this.storage = r;

      try {
        var o = JSON.parse(this.storage.getItem(c));
        o && this.processData(o);
      } catch (t) {}

      t.isOversea && (this.strategy.httpsUploadUrl = "https://svibeacon.onezapp.com/analytics/v2_upload"), !t.isOversea && this.needRequestConfig() && this.requestConfig(t.appVersion, e, n);
    }

    return t.prototype.requestConfig = function (t, e, r) {
      var n = this;
      this.storage.setItem(u, Date.now().toString()), r.post("https://oth.str.beacon.qq.com/trpc.beacon.configserver.BeaconConfigService/QueryConfig", {
        platformId: "undefined" == typeof wx ? "3" : "4",
        mainAppKey: this.appkey,
        appVersion: t,
        sdkVersion: e.sdkVersion,
        osVersion: e.userAgent,
        model: "",
        packageName: "",
        params: {
          A3: e.deviceId
        }
      }).then(function (t) {
        if (0 == t.data.ret) try {
          var e = JSON.parse(t.data.beaconConfig);
          e && (n.processData(e), n.storage.setItem(c, t.data.beaconConfig));
        } catch (t) {} else n.processData(null), n.storage.setItem(c, "");
      }).catch(function (t) {});
    }, t.prototype.processData = function (t) {
      var e, r, n, o, i;
      this.strategy.isEventUpOnOff = null !== (e = null == t ? void 0 : t.isEventUpOnOff) && void 0 !== e ? e : this.strategy.isEventUpOnOff, this.strategy.httpsUploadUrl = null !== (r = null == t ? void 0 : t.httpsUploadUrl) && void 0 !== r ? r : this.strategy.httpsUploadUrl, this.strategy.requestInterval = null !== (n = null == t ? void 0 : t.requestInterval) && void 0 !== n ? n : this.strategy.requestInterval, this.strategy.blacklist = null !== (o = null == t ? void 0 : t.blacklist) && void 0 !== o ? o : this.strategy.blacklist, this.strategy.samplelist = null !== (i = null == t ? void 0 : t.samplelist) && void 0 !== i ? i : this.strategy.samplelist;

      for (var a = 0, s = this.strategy.samplelist; a < s.length; a++) {
        var c = s[a].split(",");
        2 == c.length && (this.realSample[c[0]] = c[1]);
      }
    }, t.prototype.needRequestConfig = function () {
      var t = Number(this.storage.getItem(u));
      return Date.now() - t > 60 * this.strategy.requestInterval * 1e3;
    }, t.prototype.getUploadUrl = function () {
      return this.strategy.httpsUploadUrl + "?appkey=" + this.appkey;
    }, t.prototype.isBlackEvent = function (t) {
      return -1 != this.strategy.blacklist.indexOf(t);
    }, t.prototype.isEventUpOnOff = function () {
      return this.strategy.isEventUpOnOff;
    }, t.prototype.isSampleEvent = function (t) {
      return !!Object.prototype.hasOwnProperty.call(this.realSample, t) && this.realSample[t] < Math.floor(Math.random() * Math.floor(1e4));
    }, t;
  }(),
      m = "session_storage_key",
      w = function () {
    function t(t, e, r) {
      this.beacon = r, this.storage = t, this.duration = e, this.appkey = r.config.appkey;
    }

    return t.prototype.getSession = function () {
      var t = this.storage.getItem(m);
      if (!t) return this.createSession();
      var e = "",
          r = 0;

      try {
        var n = JSON.parse(t) || {
          sessionId: void 0,
          sessionStart: void 0
        };
        if (!n.sessionId || !n.sessionStart) return this.createSession();
        var o = Number(this.storage.getItem(a));
        if (Date.now() - o > this.duration) return this.createSession();
        e = n.sessionId, r = n.sessionStart;
      } catch (t) {}

      return {
        sessionId: e,
        sessionStart: r
      };
    }, t.prototype.createSession = function () {
      var t = Date.now(),
          e = {
        sessionId: this.appkey + "_" + t.toString(),
        sessionStart: t
      };
      this.storage.setItem(m, JSON.stringify(e)), this.storage.setItem(a, t.toString());
      var r = "is_new_user",
          n = this.storage.getItem(r);
      return this.beacon.onDirectUserAction("rqd_applaunched", {
        A21: n ? "N" : "Y"
      }), this.storage.setItem(r, JSON.stringify(!1)), e;
    }, t;
  }();

  function b() {
    var t = navigator.userAgent,
        e = t.indexOf("compatible") > -1 && t.indexOf("MSIE") > -1,
        r = t.indexOf("Edge") > -1 && !e,
        n = t.indexOf("Trident") > -1 && t.indexOf("rv:11.0") > -1;

    if (e) {
      new RegExp("MSIE (\\d+\\.\\d+);").test(t);
      var o = parseFloat(RegExp.$1);
      return 7 == o ? 7 : 8 == o ? 8 : 9 == o ? 9 : 10 == o ? 10 : 6;
    }

    return r ? -2 : n ? 11 : -1;
  }

  var _S = function S() {
    return (_S = Object.assign || function (t) {
      for (var e, r = 1, n = arguments.length; r < n; r++) {
        for (var o in e = arguments[r]) {
          Object.prototype.hasOwnProperty.call(e, o) && (t[o] = e[o]);
        }
      }

      return t;
    }).apply(this, arguments);
  };

  var E,
      I = function () {
    function t(t, e) {
      void 0 === e && (e = {}), this.reportOptions = {}, this.config = t, this.reportOptions = e;
    }

    return t.canUseDB = function () {
      return !!(null === window || void 0 === window ? void 0 : window.indexedDB);
    }, t.prototype.openDB = function () {
      var e = this;
      return new Promise(function (r, n) {
        if (!t.canUseDB()) return n({
          message: "当前不支持 indexeddb"
        });
        var o = e.config,
            i = o.name,
            a = o.version,
            s = o.stores,
            c = indexedDB.open(i, a);
        c.onsuccess = function () {
          e.db = c.result, r(), _S({
            result: 1,
            func: "open",
            params: JSON.stringify(e.config)
          }, e.reportOptions);
        }, c.onerror = function (t) {
          var r, o;
          n(t), _S({
            result: 0,
            func: "open",
            params: JSON.stringify(e.config),
            error_msg: null === (o = null === (r = t.target) || void 0 === r ? void 0 : r.error) || void 0 === o ? void 0 : o.message
          }, e.reportOptions);
        }, c.onupgradeneeded = function () {
          e.db = c.result;

          try {
            null == s || s.forEach(function (t) {
              e.createStore(t);
            });
          } catch (t) {
            _S({
              result: 0,
              func: "open",
              params: JSON.stringify(e.config),
              error_msg: t.message
            }, e.reportOptions), n(t);
          }
        };
      });
    }, t.prototype.useStore = function (t) {
      return this.storeName = t, this;
    }, t.prototype.deleteDB = function () {
      var t = this;
      return this.closeDB(), new Promise(function (e, r) {
        var n = indexedDB.deleteDatabase(t.config.name);
        n.onsuccess = function () {
          return e();
        }, n.onerror = r;
      });
    }, t.prototype.closeDB = function () {
      var t;
      null === (t = this.db) || void 0 === t || t.close(), this.db = null;
    }, t.prototype.getStoreCount = function () {
      var t = this;
      return new Promise(function (e, r) {
        var n = t.getStore("readonly").count();
        n.onsuccess = function () {
          return e(n.result);
        }, n.onerror = r;
      });
    }, t.prototype.clearStore = function () {
      var t = this;
      return new Promise(function (e, r) {
        var n = t.getStore("readwrite").clear();
        n.onsuccess = function () {
          return e();
        }, n.onerror = r;
      });
    }, t.prototype.add = function (t, e) {
      var r = this;
      return new Promise(function (n, o) {
        var i = r.getStore("readwrite").add(t, e);
        i.onsuccess = function () {
          n(i.result);
        }, i.onerror = o;
      });
    }, t.prototype.put = function (t, e) {
      var r = this;
      return new Promise(function (n, o) {
        var i = r.getStore("readwrite").put(t, e);
        i.onsuccess = function () {
          n(i.result);
        }, i.onerror = o;
      });
    }, t.prototype.getStoreAllData = function () {
      var t = this;
      return new Promise(function (e, r) {
        var n = t.getStore("readonly").openCursor(),
            o = [];
        n.onsuccess = function () {
          var t;

          if (null === (t = n.result) || void 0 === t ? void 0 : t.value) {
            var r = n.result.value;
            o.push(r), n.result.continue();
          } else e(o);
        }, n.onerror = r;
      });
    }, t.prototype.getDataRangeByIndex = function (t, e, r, n, o) {
      var i = this;
      return new Promise(function (a, s) {
        var c = i.getStore().index(t),
            u = IDBKeyRange.bound(e, r, n, o),
            l = [],
            h = c.openCursor(u);
        h.onsuccess = function () {
          var t;
          (null === (t = null == h ? void 0 : h.result) || void 0 === t ? void 0 : t.value) ? (l.push(null == h ? void 0 : h.result.value), null == h || h.result.continue()) : a(l);
        }, h.onerror = s;
      });
    }, t.prototype.removeDataByIndex = function (t, e, r, n, o) {
      var i = this;
      return new Promise(function (a, s) {
        var c = i.getStore("readwrite").index(t),
            u = IDBKeyRange.bound(e, r, n, o),
            l = c.openCursor(u),
            h = 0;
        l.onsuccess = function (t) {
          var e = t.target.result;
          e ? (h += 1, e.delete(), e.continue()) : a(h);
        }, l.onerror = s;
      });
    }, t.prototype.createStore = function (t) {
      var e = t.name,
          r = t.indexes,
          n = void 0 === r ? [] : r,
          o = t.options;

      if (this.db) {
        this.db.objectStoreNames.contains(e) && this.db.deleteObjectStore(e);
        var i = this.db.createObjectStore(e, o);
        n.forEach(function (t) {
          i.createIndex(t.indexName, t.keyPath, t.options);
        });
      }
    }, t.prototype.getStore = function (t) {
      var e;
      return void 0 === t && (t = "readonly"), null === (e = this.db) || void 0 === e ? void 0 : e.transaction(this.storeName, t).objectStore(this.storeName);
    }, t;
  }(),
      O = "event_table_v3",
      k = "eventId",
      x = function () {
    function t(t) {
      this.isReady = !1, this.taskQueue = Promise.resolve(), this.db = new I({
        name: "Beacon_" + t + "_V3",
        version: 1,
        stores: [{
          name: O,
          options: {
            keyPath: k
          },
          indexes: [{
            indexName: k,
            keyPath: k,
            options: {
              unique: !0
            }
          }]
        }]
      }), this.open();
    }

    return t.prototype.getCount = function () {
      var t = this;
      return this.readyExec(function () {
        return t.db.getStoreCount();
      });
    }, t.prototype.setItem = function (t, e) {
      var r = this;
      return this.readyExec(function () {
        return r.db.add({
          eventId: t,
          value: e
        });
      });
    }, t.prototype.getItem = function (t) {
      return r(this, void 0, void 0, function () {
        var e = this;
        return n(this, function (r) {
          return [2, this.readyExec(function () {
            return e.db.getDataRangeByIndex(k, t, t);
          })];
        });
      });
    }, t.prototype.removeItem = function (t) {
      var e = this;
      return this.readyExec(function () {
        return e.db.removeDataByIndex(k, t, t);
      });
    }, t.prototype.updateItem = function (t, e) {
      var r = this;
      return this.readyExec(function () {
        return r.db.put({
          eventId: t,
          value: e
        });
      });
    }, t.prototype.iterate = function (t) {
      var e = this;
      return this.readyExec(function () {
        return e.db.getStoreAllData().then(function (e) {
          e.forEach(function (e) {
            t(e.value);
          });
        });
      });
    }, t.prototype.open = function () {
      return r(this, void 0, void 0, function () {
        var t = this;
        return n(this, function (e) {
          switch (e.label) {
            case 0:
              return this.taskQueue = this.taskQueue.then(function () {
                return t.db.openDB();
              }), [4, this.taskQueue];

            case 1:
              return e.sent(), this.isReady = !0, this.db.useStore(O), [2];
          }
        });
      });
    }, t.prototype.readyExec = function (t) {
      return this.isReady ? t() : (this.taskQueue = this.taskQueue.then(function () {
        return t();
      }), this.taskQueue);
    }, t;
  }(),
      C = function () {
    function t(t) {
      this.keyObject = {}, this.storage = t;
    }

    return t.prototype.getCount = function () {
      return this.storage.getStoreCount();
    }, t.prototype.removeItem = function (t) {
      this.storage.removeItem(t), delete this.keyObject[t];
    }, t.prototype.setItem = function (t, e) {
      var r = JSON.stringify(e);
      this.storage.setItem(t, r), this.keyObject[t] = e;
    }, t.prototype.iterate = function (t) {
      for (var e = Object.keys(this.keyObject), r = 0; r < e.length; r++) {
        var n = this.storage.getItem(e[r]);
        t(JSON.parse(n));
      }
    }, t;
  }(),
      _ = function () {
    function t(t, e) {
      var r = this;
      this.dbEventCount = 0, b() > 0 || !window.indexedDB || /X5Lite/.test(navigator.userAgent) ? (this.store = new C(e), this.dbEventCount = this.store.getCount()) : (this.store = new x(t), this.getCount().then(function (t) {
        r.dbEventCount = t;
      }));
    }

    return t.prototype.getCount = function () {
      return r(this, void 0, void 0, function () {
        return n(this, function (t) {
          switch (t.label) {
            case 0:
              return t.trys.push([0, 2,, 3]), [4, this.store.getCount()];

            case 1:
              return [2, t.sent()];

            case 2:
              return t.sent(), [2, Promise.reject()];

            case 3:
              return [2];
          }
        });
      });
    }, t.prototype.insertEvent = function (t, e) {
      return r(this, void 0, void 0, function () {
        var r, o;
        return n(this, function (n) {
          switch (n.label) {
            case 0:
              if (this.dbEventCount >= 1e4) return [2, Promise.reject()];
              r = p(t.mapValue), n.label = 1;

            case 1:
              return n.trys.push([1, 3,, 4]), this.dbEventCount++, [4, this.store.setItem(r, t)];

            case 2:
              return [2, n.sent()];

            case 3:
              return o = n.sent(), e && e(o, t), this.dbEventCount--, [2, Promise.reject()];

            case 4:
              return [2];
          }
        });
      });
    }, t.prototype.getEvents = function () {
      return r(this, void 0, void 0, function () {
        var t;
        return n(this, function (e) {
          switch (e.label) {
            case 0:
              t = [], e.label = 1;

            case 1:
              return e.trys.push([1, 3,, 4]), [4, this.store.iterate(function (e) {
                t.push(e);
              })];

            case 2:
              return e.sent(), [2, Promise.all(t)];

            case 3:
              return e.sent(), [2, Promise.all(t)];

            case 4:
              return [2];
          }
        });
      });
    }, t.prototype.removeEvent = function (t) {
      return r(this, void 0, void 0, function () {
        var e;
        return n(this, function (r) {
          switch (r.label) {
            case 0:
              e = p(t.mapValue), r.label = 1;

            case 1:
              return r.trys.push([1, 3,, 4]), this.dbEventCount--, [4, this.store.removeItem(e)];

            case 2:
              return [2, r.sent()];

            case 3:
              return r.sent(), this.dbEventCount++, [2, Promise.reject()];

            case 4:
              return [2];
          }
        });
      });
    }, t;
  }(),
      _A = function A() {
    return (_A = Object.assign || function (t) {
      for (var e, r = 1, n = arguments.length; r < n; r++) {
        for (var o in e = arguments[r]) {
          Object.prototype.hasOwnProperty.call(e, o) && (t[o] = e[o]);
        }
      }

      return t;
    }).apply(this, arguments);
  };

  function P(t) {
    try {
      return decodeURIComponent(t.replace(/\+/g, " "));
    } catch (t) {
      return null;
    }
  }

  function j(t, e) {
    var r = [null, void 0, "", NaN].includes(t);
    if (e.isSkipEmpty && r) return null;
    var n = !e.isSkipEmpty && r ? "" : t;

    try {
      return e.encode ? encodeURIComponent(n) : n;
    } catch (t) {
      return null;
    }
  }

  function D(t) {
    var e = t.split("#"),
        r = e[0],
        n = e[1],
        o = void 0 === n ? "" : n,
        i = r.split("?"),
        a = i[0],
        s = i[1],
        c = void 0 === s ? "" : s,
        u = P(o),
        l = Object.create(null);
    return c.split("&").forEach(function (t) {
      var e = t.split("="),
          r = e[0],
          n = e[1],
          o = void 0 === n ? "" : n,
          i = P(r),
          a = P(o);
      null === i || null === a || "" === i && "" === a || l[i] || (l[i] = a);
    }), {
      url: a,
      query: l,
      hash: u
    };
  }

  function T(t, e) {
    void 0 === e && (e = {
      encode: !0,
      isSkipEmpty: !1
    });

    var r = t.url,
        n = t.query,
        o = void 0 === n ? {} : n,
        i = t.hash,
        a = r.split("#"),
        s = a[0],
        c = a[1],
        u = void 0 === c ? "" : c,
        l = s.split("?")[0],
        h = [],
        f = j(i || u, e),
        p = _A(_A({}, D(r).query), o);

    return Object.keys(p).forEach(function (t) {
      var r = j(t, e),
          n = j(p[t], e);
      null !== r && null !== n && h.push(r + "=" + n);
    }), l + (h.length ? "?" + h.join("&") : "") + (f ? "#" + f : "");
  }

  function N(t, e) {
    return new Promise(function (r, n) {
      if (e && document.querySelectorAll("script[data-tag=" + e + "]").length) return r();

      var o = document.createElement("script"),
          i = _A({
        type: "text/javascript",
        charset: "utf-8"
      }, t);

      Object.keys(i).forEach(function (t) {
        return function (t, e, r) {
          if (t) return void 0 === r ? t.getAttribute(e) : t.setAttribute(e, r);
        }(o, t, i[t]);
      }), e && (o.dataset.tag = e), o.onload = function () {
        return r();
      }, o.onreadystatechange = function () {
        var t = o.readyState;
        ["complete", "loaded"].includes(t) && (o.onreadystatechange = null, r());
      }, o.onerror = n, document.body.appendChild(o);
    });
  }

  !function (t) {
    t[t.equal = 0] = "equal", t[t.low = -1] = "low", t[t.high = 1] = "high";
  }(E || (E = {}));

  var _U = function U() {
    return (_U = Object.assign || function (t) {
      for (var e, r = 1, n = arguments.length; r < n; r++) {
        for (var o in e = arguments[r]) {
          Object.prototype.hasOwnProperty.call(e, o) && (t[o] = e[o]);
        }
      }

      return t;
    }).apply(this, arguments);
  };

  function q(t, e, r, n) {
    return new (r || (r = Promise))(function (o, i) {
      function a(t) {
        try {
          c(n.next(t));
        } catch (t) {
          i(t);
        }
      }

      function s(t) {
        try {
          c(n.throw(t));
        } catch (t) {
          i(t);
        }
      }

      function c(t) {
        var e;
        t.done ? o(t.value) : (e = t.value, e instanceof r ? e : new r(function (t) {
          t(e);
        })).then(a, s);
      }

      c((n = n.apply(t, e || [])).next());
    });
  }

  function R(t, e) {
    var r,
        n,
        o,
        i,
        a = {
      label: 0,
      sent: function sent() {
        if (1 & o[0]) throw o[1];
        return o[1];
      },
      trys: [],
      ops: []
    };
    return i = {
      next: s(0),
      throw: s(1),
      return: s(2)
    }, "function" == typeof Symbol && (i[Symbol.iterator] = function () {
      return this;
    }), i;

    function s(i) {
      return function (s) {
        return function (i) {
          if (r) throw new TypeError("Generator is already executing.");

          for (; a;) {
            try {
              if (r = 1, n && (o = 2 & i[0] ? n.return : i[0] ? n.throw || ((o = n.return) && o.call(n), 0) : n.next) && !(o = o.call(n, i[1])).done) return o;

              switch (n = 0, o && (i = [2 & i[0], o.value]), i[0]) {
                case 0:
                case 1:
                  o = i;
                  break;

                case 4:
                  return a.label++, {
                    value: i[1],
                    done: !1
                  };

                case 5:
                  a.label++, n = i[1], i = [0];
                  continue;

                case 7:
                  i = a.ops.pop(), a.trys.pop();
                  continue;

                default:
                  if (!((o = (o = a.trys).length > 0 && o[o.length - 1]) || 6 !== i[0] && 2 !== i[0])) {
                    a = 0;
                    continue;
                  }

                  if (3 === i[0] && (!o || i[1] > o[0] && i[1] < o[3])) {
                    a.label = i[1];
                    break;
                  }

                  if (6 === i[0] && a.label < o[1]) {
                    a.label = o[1], o = i;
                    break;
                  }

                  if (o && a.label < o[2]) {
                    a.label = o[2], a.ops.push(i);
                    break;
                  }

                  o[2] && a.ops.pop(), a.trys.pop();
                  continue;
              }

              i = e.call(t, a);
            } catch (t) {
              i = [6, t], n = 0;
            } finally {
              r = o = 0;
            }
          }

          if (5 & i[0]) throw i[1];
          return {
            value: i[0] ? i[1] : void 0,
            done: !0
          };
        }([i, s]);
      };
    }
  }

  var L = function () {
    function t() {
      this.interceptors = [];
    }

    return t.prototype.use = function (t, e) {
      return this.interceptors.push({
        resolved: t,
        rejected: e
      }), this.interceptors.length - 1;
    }, t.prototype.traverse = function (t, e) {
      void 0 === e && (e = !1);
      var r = Promise.resolve(t);
      return (e ? Array.prototype.reduceRight : Array.prototype.reduce).call(this.interceptors, function (t, e) {
        if (e) {
          var n = e.resolved,
              o = e.rejected;
          r = r.then(n, o);
        }

        return t;
      }, ""), r;
    }, t.prototype.eject = function (t) {
      this.interceptors[t] && (this.interceptors[t] = null);
    }, t;
  }(),
      B = {
    defaults: {
      timeout: 0,
      method: "GET",
      mode: "cors",
      redirect: "follow",
      credentials: "same-origin"
    },
    headers: {
      common: {
        Accept: "application/json, text/plain, */*"
      },
      POST: {
        "Content-Type": "application/x-www-form-urlencoded"
      },
      PUT: {
        "Content-Type": "application/x-www-form-urlencoded"
      },
      PATCH: {
        "Content-Type": "application/x-www-form-urlencoded"
      }
    },
    baseURL: "",
    polyfillUrl: "https://vm.gtimg.cn/comps/script/fetch.min.js",
    interceptors: {
      request: new L(),
      response: new L()
    }
  },
      J = /^([a-z][a-z\d+\-.]*:)?\/\//i,
      M = Object.prototype.toString;

  function V(t) {
    return q(this, void 0, void 0, function () {
      var e;
      return R(this, function (r) {
        switch (r.label) {
          case 0:
            if (window.fetch) return [2];
            r.label = 1;

          case 1:
            return r.trys.push([1, 3,, 4]), [4, N({
              src: t
            })];

          case 2:
            return r.sent(), [3, 4];

          case 3:
            throw e = r.sent(), function (t) {
              if ("undefined" != typeof Image) {
                var e = new Image(1, 1),
                    r = _U({
                  attaid: "0f400053130",
                  token: "6552374442",
                  comps: "@tencent/ovb-request",
                  version: "1.1.18",
                  ua: navigator.userAgent,
                  url: location.href,
                  _dc: Math.random()
                }, t),
                    n = Object.keys(r).map(function (t) {
                  return t + "=" + encodeURIComponent(r[t]);
                }).join("&");

                e.src = "https://h.trace.qq.com/kv?" + n;
              }
            }({
              func: "loadPolyfill",
              result: 0,
              params: t,
              error_msg: e.message
            }), new Error("加载 polyfill " + t + " 失败: " + e.message);

          case 4:
            return [2];
        }
      });
    });
  }

  function G(t) {
    return ["Accept", "Content-Type"].forEach(function (e) {
      return r = e, void ((n = t.headers) && Object.keys(n).forEach(function (t) {
        t !== r && t.toUpperCase() === r.toUpperCase() && (n[r] = n[t], delete n[t]);
      }));
      var r, n;
    }), function (t) {
      if ("[object Object]" !== M.call(t)) return !1;
      var e = Object.getPrototypeOf(t);
      return null === e || e === Object.prototype;
    }(t.body) && (t.body = JSON.stringify(t.body), t.headers && (t.headers["Content-Type"] = "application/json;charset=utf-8")), t;
  }

  function F(t) {
    return q(this, void 0, void 0, function () {
      var e, r, n, o, i, a, s, c, u, l, h, f, p, d, v, y, g;
      return R(this, function (m) {
        switch (m.label) {
          case 0:
            return e = B.baseURL, r = B.defaults, n = B.interceptors, [4, V(B.polyfillUrl)];

          case 1:
            return m.sent(), (o = _U(_U({}, r), t)).headers || (o.headers = function (t) {
              void 0 === t && (t = "GET");
              var e = B.headers[t] || {};
              return _U(_U({}, B.headers.common), e);
            }(o.method)), G(o), [4, n.request.traverse(o, !0)];

          case 2:
            if ((i = m.sent()) instanceof Error) throw i;
            return i.url = function (t, e) {
              return !t || J.test(e) ? e : t.replace(/\/+$/, "") + "/" + e.replace(/^\/+/, "");
            }(e, i.url), a = i.url, s = i.timeout, c = i.params, u = i.method, l = ["GET", "DELETE", "OPTIONS", "HEAD"].includes(void 0 === u ? "GET" : u) && !!c, h = l ? T({
              url: a,
              query: c
            }) : a, f = [], s && !i.signal && (v = new Promise(function (t) {
              p = setTimeout(function () {
                t(new Error("timeout"));
              }, s);
            }), f.push(v), d = new AbortController(), i.signal = d.signal), f.push(fetch(h, i).catch(function (t) {
              return t;
            })), [4, Promise.race(f)];

          case 3:
            return y = m.sent(), p && clearTimeout(p), [4, n.response.traverse(y)];

          case 4:
            if ((g = m.sent()) instanceof Error) throw null == d || d.abort(), g;
            return [2, g];
        }
      });
    });
  }

  var Q = function () {
    function t(t) {
      B.interceptors.request.use(function (r) {
        var n = r.url,
            o = r.method,
            i = r.body,
            a = i;

        if (t.onReportBeforeSend) {
          var s = t.onReportBeforeSend({
            url: n,
            method: o,
            data: i ? JSON.parse(i) : null
          });
          a = (null == s ? void 0 : s.data) ? JSON.stringify(s.data) : null;
        }

        if ("GET" !== o && !a) throw new Error("No data for sdk, cancel.");
        return _e(_e({}, r), {
          body: a
        });
      });
    }

    return t.prototype.get = function (t, o) {
      return r(this, void 0, void 0, function () {
        var r, i;
        return n(this, function (n) {
          switch (n.label) {
            case 0:
              return [4, F(_e({
                url: t
              }, o))];

            case 1:
              return [4, (r = n.sent()).json()];

            case 2:
              return i = n.sent(), [2, Promise.resolve({
                data: i,
                status: r.status,
                statusText: r.statusText,
                headers: r.headers
              })];
          }
        });
      });
    }, t.prototype.post = function (t, o, i) {
      return r(this, void 0, void 0, function () {
        var r, a;
        return n(this, function (n) {
          switch (n.label) {
            case 0:
              return [4, F(_e({
                url: t,
                body: o,
                method: "POST"
              }, i))];

            case 1:
              return [4, (r = n.sent()).json()];

            case 2:
              return a = n.sent(), [2, Promise.resolve({
                data: a,
                status: r.status,
                statusText: r.statusText,
                headers: r.headers
              })];
          }
        });
      });
    }, t;
  }(),
      K = function () {
    function t(t) {
      this.appkey = t;
    }

    return t.prototype.getItem = function (t) {
      try {
        return window.localStorage.getItem(this.getStoreKey(t));
      } catch (t) {
        return "";
      }
    }, t.prototype.removeItem = function (t) {
      try {
        window.localStorage.removeItem(this.getStoreKey(t));
      } catch (t) {}
    }, t.prototype.setItem = function (t, e) {
      try {
        window.localStorage.setItem(this.getStoreKey(t), e);
      } catch (t) {}
    }, t.prototype.setSessionItem = function (t, e) {
      try {
        window.sessionStorage.setItem(this.getStoreKey(t), e);
      } catch (t) {}
    }, t.prototype.getSessionItem = function (t) {
      try {
        return window.sessionStorage.getItem(this.getStoreKey(t));
      } catch (t) {
        return "";
      }
    }, t.prototype.getStoreKey = function (t) {
      return o + this.appkey + "_" + t;
    }, t.prototype.createDeviceId = function () {
      try {
        var t = window.localStorage.getItem(i);
        return t || (t = function (t) {
          for (var e = "ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz0123456789", r = "", n = 0; n < t; n++) {
            r += e.charAt(Math.floor(Math.random() * e.length));
          }

          return r;
        }(32), window.localStorage.setItem(i, t)), t;
      } catch (t) {
        return "";
      }
    }, t.prototype.clear = function () {
      try {
        for (var t = window.localStorage.length, e = 0; e < t; e++) {
          var r = window.localStorage.key(e);
          (null == r ? void 0 : r.substr(0, 9)) == o && window.localStorage.removeItem(r);
        }
      } catch (t) {}
    }, t.prototype.getStoreCount = function () {
      var t = 0;

      try {
        t = window.localStorage.length;
      } catch (t) {}

      return t;
    }, t;
  }();

  "undefined" != typeof globalThis ? globalThis : "undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self && self;

  var W = function (t) {
    var e = {
      exports: {}
    };
    return t(e, e.exports), e.exports;
  }(function (t, e) {
    t.exports = function () {
      function t(t, e, r, n, o, i, a) {
        try {
          var s = t[i](a),
              c = s.value;
        } catch (t) {
          return void r(t);
        }

        s.done ? e(c) : Promise.resolve(c).then(n, o);
      }

      function e(t, e) {
        for (var r = 0; r < e.length; r++) {
          var n = e[r];
          n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
        }
      }

      var r,
          n = (function (t) {
        t = function (t) {
          var e,
              r = Object.prototype,
              n = r.hasOwnProperty,
              o = "function" == typeof Symbol ? Symbol : {},
              i = o.iterator || "@@iterator",
              a = o.asyncIterator || "@@asyncIterator",
              s = o.toStringTag || "@@toStringTag";

          function c(t, e, r) {
            return Object.defineProperty(t, e, {
              value: r,
              enumerable: !0,
              configurable: !0,
              writable: !0
            }), t[e];
          }

          try {
            c({}, "");
          } catch (r) {
            c = function c(t, e, r) {
              return t[e] = r;
            };
          }

          function u(t, r, n, o) {
            var i, a, s, c;
            return r = r && r.prototype instanceof y ? r : y, r = Object.create(r.prototype), o = new k(o || []), r._invoke = (i = t, a = n, s = o, c = h, function (t, r) {
              if (c === p) throw new Error("Generator is already running");

              if (c === d) {
                if ("throw" === t) throw r;
                return C();
              }

              for (s.method = t, s.arg = r;;) {
                var n = s.delegate;

                if (n) {
                  var o = function t(r, n) {
                    var o;

                    if ((o = r.iterator[n.method]) === e) {
                      if (n.delegate = null, "throw" === n.method) {
                        if (r.iterator.return && (n.method = "return", n.arg = e, t(r, n), "throw" === n.method)) return v;
                        n.method = "throw", n.arg = new TypeError("The iterator does not provide a 'throw' method");
                      }

                      return v;
                    }

                    return "throw" === (o = l(o, r.iterator, n.arg)).type ? (n.method = "throw", n.arg = o.arg, n.delegate = null, v) : (o = o.arg) ? o.done ? (n[r.resultName] = o.value, n.next = r.nextLoc, "return" !== n.method && (n.method = "next", n.arg = e), n.delegate = null, v) : o : (n.method = "throw", n.arg = new TypeError("iterator result is not an object"), n.delegate = null, v);
                  }(n, s);

                  if (o) {
                    if (o === v) continue;
                    return o;
                  }
                }

                if ("next" === s.method) s.sent = s._sent = s.arg;else if ("throw" === s.method) {
                  if (c === h) throw c = d, s.arg;
                  s.dispatchException(s.arg);
                } else "return" === s.method && s.abrupt("return", s.arg);

                if (c = p, "normal" === (o = l(i, a, s)).type) {
                  if (c = s.done ? d : f, o.arg !== v) return {
                    value: o.arg,
                    done: s.done
                  };
                } else "throw" === o.type && (c = d, s.method = "throw", s.arg = o.arg);
              }
            }), r;
          }

          function l(t, e, r) {
            try {
              return {
                type: "normal",
                arg: t.call(e, r)
              };
            } catch (t) {
              return {
                type: "throw",
                arg: t
              };
            }
          }

          t.wrap = u;
          var h = "suspendedStart",
              f = "suspendedYield",
              p = "executing",
              d = "completed",
              v = {};

          function y() {}

          function g() {}

          function m() {}

          var w = {};
          w[i] = function () {
            return this;
          }, (o = (o = Object.getPrototypeOf) && o(o(x([])))) && o !== r && n.call(o, i) && (w = o);
          var b = m.prototype = y.prototype = Object.create(w);

          function S(t) {
            ["next", "throw", "return"].forEach(function (e) {
              c(t, e, function (t) {
                return this._invoke(e, t);
              });
            });
          }

          function E(t, e) {
            var r;

            this._invoke = function (o, i) {
              function a() {
                return new e(function (r, a) {
                  !function r(o, i, a, s) {
                    if ("throw" !== (o = l(t[o], t, i)).type) {
                      var c = o.arg;
                      return (i = c.value) && "object" == _typeof(i) && n.call(i, "__await") ? e.resolve(i.__await).then(function (t) {
                        r("next", t, a, s);
                      }, function (t) {
                        r("throw", t, a, s);
                      }) : e.resolve(i).then(function (t) {
                        c.value = t, a(c);
                      }, function (t) {
                        return r("throw", t, a, s);
                      });
                    }

                    s(o.arg);
                  }(o, i, r, a);
                });
              }

              return r = r ? r.then(a, a) : a();
            };
          }

          function I(t) {
            var e = {
              tryLoc: t[0]
            };
            1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e);
          }

          function O(t) {
            var e = t.completion || {};
            e.type = "normal", delete e.arg, t.completion = e;
          }

          function k(t) {
            this.tryEntries = [{
              tryLoc: "root"
            }], t.forEach(I, this), this.reset(!0);
          }

          function x(t) {
            if (t) {
              if (r = t[i]) return r.call(t);
              if ("function" == typeof t.next) return t;

              if (!isNaN(t.length)) {
                var r,
                    o = -1;
                return (r = function r() {
                  for (; ++o < t.length;) {
                    if (n.call(t, o)) return r.value = t[o], r.done = !1, r;
                  }

                  return r.value = e, r.done = !0, r;
                }).next = r;
              }
            }

            return {
              next: C
            };
          }

          function C() {
            return {
              value: e,
              done: !0
            };
          }

          return ((g.prototype = b.constructor = m).constructor = g).displayName = c(m, s, "GeneratorFunction"), t.isGeneratorFunction = function (t) {
            return !!(t = "function" == typeof t && t.constructor) && (t === g || "GeneratorFunction" === (t.displayName || t.name));
          }, t.mark = function (t) {
            return Object.setPrototypeOf ? Object.setPrototypeOf(t, m) : (t.__proto__ = m, c(t, s, "GeneratorFunction")), t.prototype = Object.create(b), t;
          }, t.awrap = function (t) {
            return {
              __await: t
            };
          }, S(E.prototype), E.prototype[a] = function () {
            return this;
          }, t.AsyncIterator = E, t.async = function (e, r, n, o, i) {
            void 0 === i && (i = Promise);
            var a = new E(u(e, r, n, o), i);
            return t.isGeneratorFunction(r) ? a : a.next().then(function (t) {
              return t.done ? t.value : a.next();
            });
          }, S(b), c(b, s, "Generator"), b[i] = function () {
            return this;
          }, b.toString = function () {
            return "[object Generator]";
          }, t.keys = function (t) {
            var e,
                r = [];

            for (e in t) {
              r.push(e);
            }

            return r.reverse(), function e() {
              for (; r.length;) {
                var n = r.pop();
                if (n in t) return e.value = n, e.done = !1, e;
              }

              return e.done = !0, e;
            };
          }, t.values = x, k.prototype = {
            constructor: k,
            reset: function reset(t) {
              if (this.prev = 0, this.next = 0, this.sent = this._sent = e, this.done = !1, this.delegate = null, this.method = "next", this.arg = e, this.tryEntries.forEach(O), !t) for (var r in this) {
                "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = e);
              }
            },
            stop: function stop() {
              this.done = !0;
              var t = this.tryEntries[0].completion;
              if ("throw" === t.type) throw t.arg;
              return this.rval;
            },
            dispatchException: function dispatchException(t) {
              if (this.done) throw t;
              var r = this;

              function o(n, o) {
                return s.type = "throw", s.arg = t, r.next = n, o && (r.method = "next", r.arg = e), !!o;
              }

              for (var i = this.tryEntries.length - 1; 0 <= i; --i) {
                var a = this.tryEntries[i],
                    s = a.completion;
                if ("root" === a.tryLoc) return o("end");

                if (a.tryLoc <= this.prev) {
                  var c = n.call(a, "catchLoc"),
                      u = n.call(a, "finallyLoc");

                  if (c && u) {
                    if (this.prev < a.catchLoc) return o(a.catchLoc, !0);
                    if (this.prev < a.finallyLoc) return o(a.finallyLoc);
                  } else if (c) {
                    if (this.prev < a.catchLoc) return o(a.catchLoc, !0);
                  } else {
                    if (!u) throw new Error("try statement without catch or finally");
                    if (this.prev < a.finallyLoc) return o(a.finallyLoc);
                  }
                }
              }
            },
            abrupt: function abrupt(t, e) {
              for (var r = this.tryEntries.length - 1; 0 <= r; --r) {
                var o = this.tryEntries[r];

                if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) {
                  var i = o;
                  break;
                }
              }

              var a = (i = i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc ? null : i) ? i.completion : {};
              return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, v) : this.complete(a);
            },
            complete: function complete(t, e) {
              if ("throw" === t.type) throw t.arg;
              return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), v;
            },
            finish: function finish(t) {
              for (var e = this.tryEntries.length - 1; 0 <= e; --e) {
                var r = this.tryEntries[e];
                if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), O(r), v;
              }
            },
            catch: function _catch(t) {
              for (var e = this.tryEntries.length - 1; 0 <= e; --e) {
                var r = this.tryEntries[e];

                if (r.tryLoc === t) {
                  var n,
                      o = r.completion;
                  return "throw" === o.type && (n = o.arg, O(r)), n;
                }
              }

              throw new Error("illegal catch attempt");
            },
            delegateYield: function delegateYield(t, r, n) {
              return this.delegate = {
                iterator: x(t),
                resultName: r,
                nextLoc: n
              }, "next" === this.method && (this.arg = e), v;
            }
          }, t;
        }(t.exports);

        try {
          regeneratorRuntime = t;
        } catch (e) {
          Function("r", "regeneratorRuntime = r")(t);
        }
      }(r = {
        exports: {}
      }), r.exports);
      return function () {
        function r(t) {
          !function (t, e) {
            if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
          }(this, r), this.version = "1.0.0";
          var e = Array.prototype.map,
              n = Array.prototype.forEach;
          t && (this.hasher = t), this.each = function (t, e, r) {
            if (null != t) if (n && t.forEach === n) t.forEach(e, r);else if (t.length === +t.length) {
              for (var o = 0, i = t.length; o < i; o++) {
                if (e.call(r, t[o], o, t) === {}) return;
              }
            } else for (var a in t) {
              if (t.hasOwnProperty(a) && e.call(r, t[a], a, t) === {}) return;
            }
          }, this.map = function (t, r, n) {
            var o = [];
            return null == t ? o : e && t.map === e ? t.map(r, n) : (this.each(t, function (t, e, i) {
              o[o.length] = r.call(n, t, e, i);
            }), o);
          };
        }

        var o, i, a, s;
        return o = r, (i = [{
          key: "getQimei36",
          value: function value(t, e) {
            var r = this;
            this.getHid().then(function (n) {
              var o = "3BJr" + t.substring(0, 2) + (n && n.substring(3, 7)),
                  i = new XMLHttpRequest();
              i.open("POST", "https://snowflake.qq.com/ola/h5", !0), i.setRequestHeader("Content-Type", "application/json"), i.onreadystatechange = function () {
                if (i.readyState == XMLHttpRequest.DONE && 200 == i.status) try {
                  e && e(JSON.parse(i.responseText));
                } catch (t) {
                  e(null);
                }
              }, i.send(JSON.stringify({
                appKey: t,
                hid: n,
                sign: o,
                version: r.version
              }));
            });
          }
        }, {
          key: "getHid",
          value: (a = n.mark(function t() {
            var e, r;
            return n.wrap(function (t) {
              for (;;) {
                switch (t.prev = t.next) {
                  case 0:
                    return (e = []).push((n = void 0, (n = [Math.floor(window.screen.width * window.devicePixelRatio), Math.floor(window.screen.height * window.devicePixelRatio)]).sort().reverse(), n.join("x"))), e.push((n = void 0, (n = [Math.floor(window.screen.availWidth * window.devicePixelRatio), Math.floor(window.screen.availHeight * window.devicePixelRatio)]).sort().reverse(), n.join("x"))), e.push(navigator.deviceMemory), e.push(!!window.sessionStorage), e.push(!!window.indexedDB), e.push(navigator.productSub), e.push(navigator.hardwareConcurrency), e.push(this.getWebglVendorAndRenderer()), e.push(new Date().getTimezoneOffset()), t.next = 12, this.getFactor();

                  case 12:
                    if (r = t.sent, e.push(r), this.hasher) return t.abrupt("return", this.hasher(e.join("###"), 31));
                    t.next = 18;
                    break;

                  case 18:
                    return t.abrupt("return", this.x64hash128(e.join("###"), 31));

                  case 19:
                  case "end":
                    return t.stop();
                }
              }

              var n;
            }, t, this);
          }), s = function s() {
            var e = this,
                r = arguments;
            return new Promise(function (n, o) {
              var i = a.apply(e, r);

              function s(e) {
                t(i, n, o, s, c, "next", e);
              }

              function c(e) {
                t(i, n, o, s, c, "throw", e);
              }

              s(void 0);
            });
          }, function () {
            return s.apply(this, arguments);
          })
        }, {
          key: "getUserAgent",
          value: function value() {
            return navigator.userAgent;
          }
        }, {
          key: "getNative",
          value: function value() {
            var t = this;
            this.getHid().then(function (e) {
              JSInterface.callback(t.version, e, t.getUserAgent());
            });
          }
        }, {
          key: "getWebglVendorAndRenderer",
          value: function value() {
            try {
              var t = function () {
                var t = document.createElement("canvas"),
                    e = null;

                try {
                  e = t.getContext("webgl") || t.getContext("experimental-webgl");
                } catch (t) {}

                return e || null;
              }(),
                  e = t.getExtension("WEBGL_debug_renderer_info"),
                  r = [t.getParameter(e.UNMASKED_VENDOR_WEBGL), t.getParameter(e.UNMASKED_RENDERER_WEBGL)].join("~"),
                  n = t.getExtension("WEBGL_lose_context");

              return null != n && n.loseContext(), r;
            } catch (t) {
              return null;
            }
          }
        }, {
          key: "getFactor",
          value: function value() {
            return new Promise(function (t, e) {
              var r = window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection;
              r ? function () {
                var e = new r({
                  iceServers: []
                });
                e.createDataChannel("", {
                  reliable: !1
                }), e.onicecandidate = function (t) {
                  t.candidate && i("a=".concat(t.candidate.candidate));
                }, e.createOffer(function (t) {
                  i(t.sdp), e.setLocalDescription(t);
                }, function (t) {});
                var n = Object.create(null);

                function o(e) {
                  if (!(e in n)) {
                    n[e] = !0;

                    for (var r = Object.keys(n).filter(function (t) {
                      return n[t];
                    }), o = 0; o < r.length; o++) {
                      16 < r[o].length && (r.splice(o, 1), o--);
                    }

                    t(r[0]);
                  }
                }

                function i(t) {
                  (0 < arguments.length && void 0 !== t ? t : "").split("\r\n").forEach(function (t, e, r) {
                    var n, i;
                    ~t.indexOf("a=candidate") ? (i = (n = t.split(" "))[4], "host" === n[7] && o(i)) : ~t.indexOf("c=") && o(t.split(" ")[2]);
                  });
                }

                n["0.0.0.0"] = !1;
              }() : t(null);
            });
          }
        }, {
          key: "x64hash128",
          value: function value(t, e) {
            for (var r = function r(t, e) {
              t = [t[0] >>> 16, 65535 & t[0], t[1] >>> 16, 65535 & t[1]], e = [e[0] >>> 16, 65535 & e[0], e[1] >>> 16, 65535 & e[1]];
              var r = [0, 0, 0, 0];
              return r[3] += t[3] + e[3], r[2] += r[3] >>> 16, r[3] &= 65535, r[2] += t[2] + e[2], r[1] += r[2] >>> 16, r[2] &= 65535, r[1] += t[1] + e[1], r[0] += r[1] >>> 16, r[1] &= 65535, r[0] += t[0] + e[0], r[0] &= 65535, [r[0] << 16 | r[1], r[2] << 16 | r[3]];
            }, n = function n(t, e) {
              t = [t[0] >>> 16, 65535 & t[0], t[1] >>> 16, 65535 & t[1]], e = [e[0] >>> 16, 65535 & e[0], e[1] >>> 16, 65535 & e[1]];
              var r = [0, 0, 0, 0];
              return r[3] += t[3] * e[3], r[2] += r[3] >>> 16, r[3] &= 65535, r[2] += t[2] * e[3], r[1] += r[2] >>> 16, r[2] &= 65535, r[2] += t[3] * e[2], r[1] += r[2] >>> 16, r[2] &= 65535, r[1] += t[1] * e[3], r[0] += r[1] >>> 16, r[1] &= 65535, r[1] += t[2] * e[2], r[0] += r[1] >>> 16, r[1] &= 65535, r[1] += t[3] * e[1], r[0] += r[1] >>> 16, r[1] &= 65535, r[0] += t[0] * e[3] + t[1] * e[2] + t[2] * e[1] + t[3] * e[0], r[0] &= 65535, [r[0] << 16 | r[1], r[2] << 16 | r[3]];
            }, o = function o(t, e) {
              return 32 == (e %= 64) ? [t[1], t[0]] : e < 32 ? [t[0] << e | t[1] >>> 32 - e, t[1] << e | t[0] >>> 32 - e] : [t[1] << (e -= 32) | t[0] >>> 32 - e, t[0] << e | t[1] >>> 32 - e];
            }, i = function i(t, e) {
              return 0 == (e %= 64) ? t : e < 32 ? [t[0] << e | t[1] >>> 32 - e, t[1] << e] : [t[1] << e - 32, 0];
            }, a = function a(t, e) {
              return [t[0] ^ e[0], t[1] ^ e[1]];
            }, s = function s(t) {
              return t = a(t, [0, t[0] >>> 1]), t = n(t, [4283543511, 3981806797]), t = a(t, [0, t[0] >>> 1]), t = n(t, [3301882366, 444984403]), a(t, [0, t[0] >>> 1]);
            }, c = (t = t || "").length % 16, u = t.length - c, l = [0, e = e || 0], h = [0, e], f = [0, 0], p = [0, 0], d = [2277735313, 289559509], v = [1291169091, 658871167], y = 0; y < u; y += 16) {
              f = [255 & t.charCodeAt(y + 4) | (255 & t.charCodeAt(y + 5)) << 8 | (255 & t.charCodeAt(y + 6)) << 16 | (255 & t.charCodeAt(y + 7)) << 24, 255 & t.charCodeAt(y) | (255 & t.charCodeAt(y + 1)) << 8 | (255 & t.charCodeAt(y + 2)) << 16 | (255 & t.charCodeAt(y + 3)) << 24], p = [255 & t.charCodeAt(y + 12) | (255 & t.charCodeAt(y + 13)) << 8 | (255 & t.charCodeAt(y + 14)) << 16 | (255 & t.charCodeAt(y + 15)) << 24, 255 & t.charCodeAt(y + 8) | (255 & t.charCodeAt(y + 9)) << 8 | (255 & t.charCodeAt(y + 10)) << 16 | (255 & t.charCodeAt(y + 11)) << 24], f = o(f = n(f, d), 31), f = n(f, v), l = r(l = o(l = a(l, f), 27), h), l = r(n(l, [0, 5]), [0, 1390208809]), p = o(p = n(p, v), 33), p = n(p, d), h = r(h = o(h = a(h, p), 31), l), h = r(n(h, [0, 5]), [0, 944331445]);
            }

            switch (f = [0, 0], p = [0, 0], c) {
              case 15:
                p = a(p, i([0, t.charCodeAt(y + 14)], 48));

              case 14:
                p = a(p, i([0, t.charCodeAt(y + 13)], 40));

              case 13:
                p = a(p, i([0, t.charCodeAt(y + 12)], 32));

              case 12:
                p = a(p, i([0, t.charCodeAt(y + 11)], 24));

              case 11:
                p = a(p, i([0, t.charCodeAt(y + 10)], 16));

              case 10:
                p = a(p, i([0, t.charCodeAt(y + 9)], 8));

              case 9:
                p = a(p, [0, t.charCodeAt(y + 8)]), p = o(p = n(p, v), 33), p = n(p, d), h = a(h, p);

              case 8:
                f = a(f, i([0, t.charCodeAt(y + 7)], 56));

              case 7:
                f = a(f, i([0, t.charCodeAt(y + 6)], 48));

              case 6:
                f = a(f, i([0, t.charCodeAt(y + 5)], 40));

              case 5:
                f = a(f, i([0, t.charCodeAt(y + 4)], 32));

              case 4:
                f = a(f, i([0, t.charCodeAt(y + 3)], 24));

              case 3:
                f = a(f, i([0, t.charCodeAt(y + 2)], 16));

              case 2:
                f = a(f, i([0, t.charCodeAt(y + 1)], 8));

              case 1:
                f = a(f, [t.charCodeAt(y)]), f = o(f = n(f, d), 31), f = n(f, v), l = a(l, f);
            }

            return l = a(l, [0, t.length]), h = r(h = a(h, [0, t.length]), l = r(l, h)), l = s(l), h = r(h = s(h), l = r(l, h)), ("00000000" + (l[0] >>> 0).toString(16)).slice(-8) + ("00000000" + (l[1] >>> 0).toString(16)).slice(-8) + ("00000000" + (h[0] >>> 0).toString(16)).slice(-8) + ("00000000" + (h[1] >>> 0).toString(16)).slice(-8);
          }
        }]) && e(o.prototype, i), r;
      }();
    }();
  }),
      H = "logid_start",
      z = "4.5.6-web";

  return function (r) {
    function n(t) {
      var e = r.call(this, t) || this;
      e.qimei36 = "", e.uselessCycleTaskNum = 0, e.underWeakNet = !1, e.send = function (t, r, n) {
        e.storage.setItem(a, Date.now().toString()), e.network.post(e.uploadUrl || e.strategy.getUploadUrl(), t.data).then(function (n) {
          var o;
          100 == (null === (o = null == n ? void 0 : n.data) || void 0 === o ? void 0 : o.result) ? e.delayTime = 1e3 * n.data.delayTime : e.delayTime = 0, r && r(t.data), t.data.events.forEach(function (t) {
            e.store.removeEvent(t).then(function () {
              e.removeSendingId(p(t.mapValue));
            });
          }), e.doCustomCycleTask();
        }).catch(function (r) {
          var o = t.data.events;
          e.errorReport.reportError(r.code ? r.code.toString() : "600", r.message), n && n(t.data);
          var i = JSON.parse(e.storage.getItem(s));
          o.forEach(function (t) {
            i && -1 != i.indexOf(p(t)) && e.store.insertEvent(t, function (t, r) {
              t && e.errorReport.reportError("604", "insertEvent fail!");
            }), e.removeSendingId(p(t));
          }), e.monitorUploadFailed();
        });
      };
      var n,
          o,
          i = b();
      return e.isUnderIE8 = i > 0 && i < 8, e.isUnderIE8 || (e.isUnderIE = i > 0, t.needInitQimei && e.initQimei(t.appkey), e.network = new Q(t), e.storage = new K(t.appkey), e.initCommonInfo(t), e.store = new _(t.appkey, e.storage), e.errorReport = new y(e.config, e.commonInfo, "web", e.network), e.strategy = new g(e.config, e.commonInfo, e.storage, e.network), e.logidStartTime = e.storage.getItem(H), e.logidStartTime || (e.logidStartTime = Date.now().toString(), e.storage.setItem(H, e.logidStartTime)), n = e.logidStartTime, o = Date.now() - Number.parseFloat(n), Math.floor(o / 864e5) >= 365 && e.storage.clear(), e.initSession(t), e.onDirectUserAction("rqd_js_init", {}), setTimeout(function () {
        return e.lifeCycle.emit("init");
      }, 0), e.initDelayTime = t.delay ? t.delay : 1e3, e.cycleTask(e.initDelayTime)), e;
    }

    return function (e, r) {
      if ("function" != typeof r && null !== r) throw new TypeError("Class extends value " + String(r) + " is not a constructor or null");

      function n() {
        this.constructor = e;
      }

      _t(e, r), e.prototype = null === r ? Object.create(r) : (n.prototype = r.prototype, new n());
    }(n, r), n.prototype.initQimei = function (t) {
      var e = this;
      new W().getQimei36(t, function (t) {
        e.qimei36 = t.q36;
      });
    }, n.prototype.initSession = function (t) {
      var e = 18e5;
      t.sessionDuration && t.sessionDuration > 3e4 && (e = t.sessionDuration), this.beaconSession = new w(this.storage, e, this);
    }, n.prototype.initCommonInfo = function (t) {
      var e = Number(this.storage.getItem(a));

      try {
        var r = JSON.parse(this.storage.getItem(s));
        (Date.now() - e > 3e4 || !r) && this.storage.setItem(s, JSON.stringify([]));
      } catch (t) {}

      t.uploadUrl && (this.uploadUrl = t.uploadUrl + "?appkey=" + t.appkey);
      var n = [window.screen.width, window.screen.height];
      window.devicePixelRatio && n.push(window.devicePixelRatio), this.commonInfo = {
        deviceId: this.storage.createDeviceId(),
        language: navigator && navigator.language || "zh_CN",
        query: window.location.search,
        userAgent: navigator.userAgent,
        pixel: n.join("*"),
        channelID: t.channelID ? String(t.channelID) : "",
        openid: t.openid ? String(t.openid) : "",
        unid: t.unionid ? String(t.unionid) : "",
        sdkVersion: z
      }, this.config.appVersion = t.versionCode ? String(t.versionCode) : "", this.config.strictMode = t.strictMode;
    }, n.prototype.cycleTask = function (t) {
      var e = this;
      this.intervalID = window.setInterval(function () {
        e.store.getEvents().then(function (t) {
          var r = [],
              n = JSON.parse(e.storage.getItem(s));
          n || (n = []), t && t.forEach(function (t) {
            var e = p(t.mapValue);
            -1 == n.indexOf(e) && (r.push(t), n.push(e));
          }), 0 != r.length && (e.storage.setItem(s, JSON.stringify(n)), e._normalLogPipeline(e.assembleData(r)));
        }).catch(function (t) {});
      }, t);
    }, n.prototype.onReport = function (t, e, r) {
      var n = this;
      if (this.isUnderIE8) this.errorReport.reportError("601", "UnderIE8");else {
        var o = this.generateData(t, e, r);
        if (r && 0 == this.delayTime && !this.underWeakNet) this._normalLogPipeline(this.assembleData(o));else {
          var i = o.shift();
          i && this.store.insertEvent(i, function (t) {
            t && n.errorReport.reportError("604", "insertEvent fail!");
          }).catch(function (t) {
            n._normalLogPipeline(n.assembleData(o));
          });
        }
      }
    }, n.prototype.onSendBeacon = function (t, e) {
      if (this.isUnderIE) this.errorReport.reportError("605", "UnderIE");else {
        var r = this.assembleData(this.generateData(t, e, !0));
        "function" == typeof navigator.sendBeacon && navigator.sendBeacon(this.uploadUrl || this.strategy.getUploadUrl(), JSON.stringify(r));
      }
    }, n.prototype.generateData = function (t, r, n) {
      var o = [],
          i = "4.5.6-web_" + (n ? "direct_log_id" : "normal_log_id"),
          a = Number(this.storage.getItem(i));
      return a = a || 1, r = _e(_e({}, r), {
        A99: n ? "Y" : "N",
        A100: a.toString(),
        A72: z,
        A88: this.logidStartTime
      }), a++, this.storage.setItem(i, a.toString()), o.push({
        eventCode: t,
        eventTime: Date.now().toString(),
        mapValue: h(r, this.config.strictMode)
      }), o;
    }, n.prototype.assembleData = function (t) {
      var r = this.beaconSession.getSession();
      return {
        appVersion: this.config.appVersion ? f(this.config.appVersion) : "",
        sdkId: "js",
        sdkVersion: z,
        mainAppKey: this.config.appkey,
        platformId: 3,
        common: h(_e(_e({}, this.additionalParams), {
          A2: this.commonInfo.deviceId,
          A8: this.commonInfo.openid,
          A12: this.commonInfo.language,
          A17: this.commonInfo.pixel,
          A23: this.commonInfo.channelID,
          A50: this.commonInfo.unid,
          A76: r.sessionId,
          A101: this.commonInfo.userAgent,
          A102: window.location.href,
          A104: document.referrer,
          A119: this.commonInfo.query,
          A153: this.qimei36
        }), !1),
        events: t
      };
    }, n.prototype.monitorUploadFailed = function () {
      this.uselessCycleTaskNum++, this.uselessCycleTaskNum >= 5 && (window.clearInterval(this.intervalID), this.cycleTask(6e4), this.underWeakNet = !0);
    }, n.prototype.doCustomCycleTask = function () {
      this.uselessCycleTaskNum >= 5 && (window.clearInterval(this.intervalID), this.cycleTask(this.initDelayTime)), this.uselessCycleTaskNum = 0, this.underWeakNet = !1;
    }, n;
  }(v);
});
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../node_modules/webpack/buildin/global.js */ "./node_modules/webpack/buildin/global.js")))

/***/ }),

/***/ "./lib/crypto.js":
/*!***********************!*\
  !*** ./lib/crypto.js ***!
  \***********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(module) {var _typeof = __webpack_require__(/*! @babel/runtime/helpers/typeof */ "./node_modules/@babel/runtime/helpers/typeof.js");

/*
 CryptoJS v3.1.2
 code.google.com/p/crypto-js
 (c) 2009-2013 by Jeff Mott. All rights reserved.
 code.google.com/p/crypto-js/wiki/License
 */
var CryptoJS = CryptoJS || function (g, l) {
  var e = {},
      d = e.lib = {},
      m = function m() {},
      k = d.Base = {
    extend: function extend(a) {
      m.prototype = this;
      var c = new m();
      a && c.mixIn(a);
      c.hasOwnProperty("init") || (c.init = function () {
        c.$super.init.apply(this, arguments);
      });
      c.init.prototype = c;
      c.$super = this;
      return c;
    },
    create: function create() {
      var a = this.extend();
      a.init.apply(a, arguments);
      return a;
    },
    init: function init() {},
    mixIn: function mixIn(a) {
      for (var c in a) {
        a.hasOwnProperty(c) && (this[c] = a[c]);
      }

      a.hasOwnProperty("toString") && (this.toString = a.toString);
    },
    clone: function clone() {
      return this.init.prototype.extend(this);
    }
  },
      p = d.WordArray = k.extend({
    init: function init(a, c) {
      a = this.words = a || [];
      this.sigBytes = c != l ? c : 4 * a.length;
    },
    toString: function toString(a) {
      return (a || n).stringify(this);
    },
    concat: function concat(a) {
      var c = this.words,
          q = a.words,
          f = this.sigBytes;
      a = a.sigBytes;
      this.clamp();
      if (f % 4) for (var b = 0; b < a; b++) {
        c[f + b >>> 2] |= (q[b >>> 2] >>> 24 - 8 * (b % 4) & 255) << 24 - 8 * ((f + b) % 4);
      } else if (65535 < q.length) for (b = 0; b < a; b += 4) {
        c[f + b >>> 2] = q[b >>> 2];
      } else c.push.apply(c, q);
      this.sigBytes += a;
      return this;
    },
    clamp: function clamp() {
      var a = this.words,
          c = this.sigBytes;
      a[c >>> 2] &= 4294967295 << 32 - 8 * (c % 4);
      a.length = g.ceil(c / 4);
    },
    clone: function clone() {
      var a = k.clone.call(this);
      a.words = this.words.slice(0);
      return a;
    },
    random: function random(a) {
      for (var c = [], b = 0; b < a; b += 4) {
        c.push(4294967296 * g.random() | 0);
      }

      return new p.init(c, a);
    }
  }),
      b = e.enc = {},
      n = b.Hex = {
    stringify: function stringify(a) {
      var c = a.words;
      a = a.sigBytes;

      for (var b = [], f = 0; f < a; f++) {
        var d = c[f >>> 2] >>> 24 - 8 * (f % 4) & 255;
        b.push((d >>> 4).toString(16));
        b.push((d & 15).toString(16));
      }

      return b.join("");
    },
    parse: function parse(a) {
      for (var c = a.length, b = [], f = 0; f < c; f += 2) {
        b[f >>> 3] |= parseInt(a.substr(f, 2), 16) << 24 - 4 * (f % 8);
      }

      return new p.init(b, c / 2);
    }
  },
      j = b.Latin1 = {
    stringify: function stringify(a) {
      var c = a.words;
      a = a.sigBytes;

      for (var b = [], f = 0; f < a; f++) {
        b.push(String.fromCharCode(c[f >>> 2] >>> 24 - 8 * (f % 4) & 255));
      }

      return b.join("");
    },
    parse: function parse(a) {
      for (var c = a.length, b = [], f = 0; f < c; f++) {
        b[f >>> 2] |= (a.charCodeAt(f) & 255) << 24 - 8 * (f % 4);
      }

      return new p.init(b, c);
    }
  },
      h = b.Utf8 = {
    stringify: function stringify(a) {
      try {
        return decodeURIComponent(escape(j.stringify(a)));
      } catch (c) {
        throw Error("Malformed UTF-8 data");
      }
    },
    parse: function parse(a) {
      return j.parse(unescape(encodeURIComponent(a)));
    }
  },
      r = d.BufferedBlockAlgorithm = k.extend({
    reset: function reset() {
      this._data = new p.init();
      this._nDataBytes = 0;
    },
    _append: function _append(a) {
      "string" == typeof a && (a = h.parse(a));

      this._data.concat(a);

      this._nDataBytes += a.sigBytes;
    },
    _process: function _process(a) {
      var c = this._data,
          b = c.words,
          f = c.sigBytes,
          d = this.blockSize,
          e = f / (4 * d),
          e = a ? g.ceil(e) : g.max((e | 0) - this._minBufferSize, 0);
      a = e * d;
      f = g.min(4 * a, f);

      if (a) {
        for (var k = 0; k < a; k += d) {
          this._doProcessBlock(b, k);
        }

        k = b.splice(0, a);
        c.sigBytes -= f;
      }

      return new p.init(k, f);
    },
    clone: function clone() {
      var a = k.clone.call(this);
      a._data = this._data.clone();
      return a;
    },
    _minBufferSize: 0
  });

  d.Hasher = r.extend({
    cfg: k.extend(),
    init: function init(a) {
      this.cfg = this.cfg.extend(a);
      this.reset();
    },
    reset: function reset() {
      r.reset.call(this);

      this._doReset();
    },
    update: function update(a) {
      this._append(a);

      this._process();

      return this;
    },
    finalize: function finalize(a) {
      a && this._append(a);
      return this._doFinalize();
    },
    blockSize: 16,
    _createHelper: function _createHelper(a) {
      return function (b, d) {
        return new a.init(d).finalize(b);
      };
    },
    _createHmacHelper: function _createHmacHelper(a) {
      return function (b, d) {
        return new s.HMAC.init(a, d).finalize(b);
      };
    }
  });
  var s = e.algo = {};
  return e;
}(Math);

(function () {
  var g = CryptoJS,
      l = g.lib,
      e = l.WordArray,
      d = l.Hasher,
      m = [],
      l = g.algo.SHA1 = d.extend({
    _doReset: function _doReset() {
      this._hash = new e.init([1732584193, 4023233417, 2562383102, 271733878, 3285377520]);
    },
    _doProcessBlock: function _doProcessBlock(d, e) {
      for (var b = this._hash.words, n = b[0], j = b[1], h = b[2], g = b[3], l = b[4], a = 0; 80 > a; a++) {
        if (16 > a) m[a] = d[e + a] | 0;else {
          var c = m[a - 3] ^ m[a - 8] ^ m[a - 14] ^ m[a - 16];
          m[a] = c << 1 | c >>> 31;
        }
        c = (n << 5 | n >>> 27) + l + m[a];
        c = 20 > a ? c + ((j & h | ~j & g) + 1518500249) : 40 > a ? c + ((j ^ h ^ g) + 1859775393) : 60 > a ? c + ((j & h | j & g | h & g) - 1894007588) : c + ((j ^ h ^ g) - 899497514);
        l = g;
        g = h;
        h = j << 30 | j >>> 2;
        j = n;
        n = c;
      }

      b[0] = b[0] + n | 0;
      b[1] = b[1] + j | 0;
      b[2] = b[2] + h | 0;
      b[3] = b[3] + g | 0;
      b[4] = b[4] + l | 0;
    },
    _doFinalize: function _doFinalize() {
      var d = this._data,
          e = d.words,
          b = 8 * this._nDataBytes,
          g = 8 * d.sigBytes;
      e[g >>> 5] |= 128 << 24 - g % 32;
      e[(g + 64 >>> 9 << 4) + 14] = Math.floor(b / 4294967296);
      e[(g + 64 >>> 9 << 4) + 15] = b;
      d.sigBytes = 4 * e.length;

      this._process();

      return this._hash;
    },
    clone: function clone() {
      var e = d.clone.call(this);
      e._hash = this._hash.clone();
      return e;
    }
  });
  g.SHA1 = d._createHelper(l);
  g.HmacSHA1 = d._createHmacHelper(l);
})();

(function () {
  var g = CryptoJS,
      l = g.enc.Utf8;
  g.algo.HMAC = g.lib.Base.extend({
    init: function init(e, d) {
      e = this._hasher = new e.init();
      "string" == typeof d && (d = l.parse(d));
      var g = e.blockSize,
          k = 4 * g;
      d.sigBytes > k && (d = e.finalize(d));
      d.clamp();

      for (var p = this._oKey = d.clone(), b = this._iKey = d.clone(), n = p.words, j = b.words, h = 0; h < g; h++) {
        n[h] ^= 1549556828, j[h] ^= 909522486;
      }

      p.sigBytes = b.sigBytes = k;
      this.reset();
    },
    reset: function reset() {
      var e = this._hasher;
      e.reset();
      e.update(this._iKey);
    },
    update: function update(e) {
      this._hasher.update(e);

      return this;
    },
    finalize: function finalize(e) {
      var d = this._hasher;
      e = d.finalize(e);
      d.reset();
      return d.finalize(this._oKey.clone().concat(e));
    }
  });
})();

(function () {
  // Shortcuts
  var C = CryptoJS;
  var C_lib = C.lib;
  var WordArray = C_lib.WordArray;
  var C_enc = C.enc;
  /**
   * Base64 encoding strategy.
   */

  var Base64 = C_enc.Base64 = {
    /**
     * Converts a word array to a Base64 string.
     *
     * @param {WordArray} wordArray The word array.
     *
     * @return {string} The Base64 string.
     *
     * @static
     *
     * @example
     *
     *     var base64String = CryptoJS.enc.Base64.stringify(wordArray);
     */
    stringify: function stringify(wordArray) {
      // Shortcuts
      var words = wordArray.words;
      var sigBytes = wordArray.sigBytes;
      var map = this._map; // Clamp excess bits

      wordArray.clamp(); // Convert

      var base64Chars = [];

      for (var i = 0; i < sigBytes; i += 3) {
        var byte1 = words[i >>> 2] >>> 24 - i % 4 * 8 & 0xff;
        var byte2 = words[i + 1 >>> 2] >>> 24 - (i + 1) % 4 * 8 & 0xff;
        var byte3 = words[i + 2 >>> 2] >>> 24 - (i + 2) % 4 * 8 & 0xff;
        var triplet = byte1 << 16 | byte2 << 8 | byte3;

        for (var j = 0; j < 4 && i + j * 0.75 < sigBytes; j++) {
          base64Chars.push(map.charAt(triplet >>> 6 * (3 - j) & 0x3f));
        }
      } // Add padding


      var paddingChar = map.charAt(64);

      if (paddingChar) {
        while (base64Chars.length % 4) {
          base64Chars.push(paddingChar);
        }
      }

      return base64Chars.join('');
    },

    /**
     * Converts a Base64 string to a word array.
     *
     * @param {string} base64Str The Base64 string.
     *
     * @return {WordArray} The word array.
     *
     * @static
     *
     * @example
     *
     *     var wordArray = CryptoJS.enc.Base64.parse(base64String);
     */
    parse: function parse(base64Str) {
      // Shortcuts
      var base64StrLength = base64Str.length;
      var map = this._map; // Ignore padding

      var paddingChar = map.charAt(64);

      if (paddingChar) {
        var paddingIndex = base64Str.indexOf(paddingChar);

        if (paddingIndex != -1) {
          base64StrLength = paddingIndex;
        }
      } // Convert


      var words = [];
      var nBytes = 0;

      for (var i = 0; i < base64StrLength; i++) {
        if (i % 4) {
          var bits1 = map.indexOf(base64Str.charAt(i - 1)) << i % 4 * 2;
          var bits2 = map.indexOf(base64Str.charAt(i)) >>> 6 - i % 4 * 2;
          words[nBytes >>> 2] |= (bits1 | bits2) << 24 - nBytes % 4 * 8;
          nBytes++;
        }
      }

      return WordArray.create(words, nBytes);
    },
    _map: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='
  };
})();

if (( false ? undefined : _typeof(module)) === 'object') {
  module.exports = CryptoJS;
} else {
  window.CryptoJS = CryptoJS;
}
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../node_modules/webpack/buildin/module.js */ "./node_modules/webpack/buildin/module.js")(module)))

/***/ }),

/***/ "./lib/json2xml.js":
/*!*************************!*\
  !*** ./lib/json2xml.js ***!
  \*************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var _typeof = __webpack_require__(/*! @babel/runtime/helpers/typeof */ "./node_modules/@babel/runtime/helpers/typeof.js");

//copyright Ryan Day 2010 <http://ryanday.org>, Joscha Feth 2013 <http://www.feth.com> [MIT Licensed]
var element_start_char = "a-zA-Z_\xC0-\xD6\xD8-\xF6\xF8-\xFF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FFF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD";
var element_non_start_char = "-.0-9\xB7\u0300-\u036F\u203F\u2040";
var element_replace = new RegExp("^([^" + element_start_char + "])|^((x|X)(m|M)(l|L))|([^" + element_start_char + element_non_start_char + "])", "g");
var not_safe_in_xml = /[^\x09\x0A\x0D\x20-\xFF\x85\xA0-\uD7FF\uE000-\uFDCF\uFDE0-\uFFFD]/gm;

var objKeys = function objKeys(obj) {
  var l = [];

  if (obj instanceof Object) {
    for (var k in obj) {
      if (obj.hasOwnProperty(k)) {
        l.push(k);
      }
    }
  }

  return l;
};

var process_to_xml = function process_to_xml(node_data, options) {
  var makeNode = function makeNode(name, content, attributes, level, hasSubNodes) {
    var indent_value = options.indent !== undefined ? options.indent : "\t";
    var indent = options.prettyPrint ? '\n' + new Array(level).join(indent_value) : '';

    if (options.removeIllegalNameCharacters) {
      name = name.replace(element_replace, '_');
    }

    var node = [indent, '<', name, attributes || ''];

    if (content && content.length > 0) {
      node.push('>');
      node.push(content);
      hasSubNodes && node.push(indent);
      node.push('</');
      node.push(name);
      node.push('>');
    } else {
      node.push('/>');
    }

    return node.join('');
  };

  return function fn(node_data, node_descriptor, level) {
    var type = _typeof(node_data);

    if (Array.isArray ? Array.isArray(node_data) : node_data instanceof Array) {
      type = 'array';
    } else if (node_data instanceof Date) {
      type = 'date';
    }

    switch (type) {
      //if value is an array create child nodes from values
      case 'array':
        var ret = [];
        node_data.map(function (v) {
          ret.push(fn(v, 1, level + 1)); //entries that are values of an array are the only ones that can be special node descriptors
        });
        options.prettyPrint && ret.push('\n');
        return ret.join('');
        break;

      case 'date':
        // cast dates to ISO 8601 date (soap likes it)
        return node_data.toJSON ? node_data.toJSON() : node_data + '';
        break;

      case 'object':
        var nodes = [];

        for (var name in node_data) {
          if (node_data.hasOwnProperty(name)) {
            if (node_data[name] instanceof Array) {
              for (var j = 0; j < node_data[name].length; j++) {
                if (node_data[name].hasOwnProperty(j)) {
                  nodes.push(makeNode(name, fn(node_data[name][j], 0, level + 1), null, level + 1, objKeys(node_data[name][j]).length));
                }
              }
            } else {
              nodes.push(makeNode(name, fn(node_data[name], 0, level + 1), null, level + 1));
            }
          }
        }

        options.prettyPrint && nodes.length > 0 && nodes.push('\n');
        return nodes.join('');
        break;

      case 'function':
        return node_data();
        break;

      default:
        return options.escape ? esc(node_data) : '' + node_data;
    }
  }(node_data, 0, 0);
};

var xml_header = function xml_header(standalone) {
  var ret = ['<?xml version="1.0" encoding="UTF-8"'];

  if (standalone) {
    ret.push(' standalone="yes"');
  }

  ret.push('?>');
  return ret.join('');
};

function esc(str) {
  return ('' + str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/'/g, '&apos;').replace(/"/g, '&quot;').replace(not_safe_in_xml, '');
}

module.exports = function (obj, options) {
  if (!options) {
    options = {
      xmlHeader: {
        standalone: true
      },
      prettyPrint: true,
      indent: "  ",
      escape: true
    };
  }

  if (typeof obj == 'string') {
    try {
      obj = JSON.parse(obj.toString());
    } catch (e) {
      return false;
    }
  }

  var xmlheader = '';
  var docType = '';

  if (options) {
    if (_typeof(options) == 'object') {
      // our config is an object
      if (options.xmlHeader) {
        // the user wants an xml header
        xmlheader = xml_header(!!options.xmlHeader.standalone);
      }

      if (typeof options.docType != 'undefined') {
        docType = '<!DOCTYPE ' + options.docType + '>';
      }
    } else {
      // our config is a boolean value, so just add xml header
      xmlheader = xml_header();
    }
  }

  options = options || {};
  var ret = [xmlheader, options.prettyPrint && docType ? '\n' : '', docType, process_to_xml(obj, options)];
  return ret.join('').replace(/\n{2,}/g, '\n').replace(/\s+$/g, '');
};

/***/ }),

/***/ "./lib/md5.js":
/*!********************!*\
  !*** ./lib/md5.js ***!
  \********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(process, global, module) {var __WEBPACK_AMD_DEFINE_RESULT__;var _typeof = __webpack_require__(/*! @babel/runtime/helpers/typeof */ "./node_modules/@babel/runtime/helpers/typeof.js");

/* https://github.com/emn178/js-md5 */
(function () {
  'use strict';

  var ERROR = 'input is invalid type';
  var WINDOW = (typeof window === "undefined" ? "undefined" : _typeof(window)) === 'object';
  var root = WINDOW ? window : {};

  if (root.JS_MD5_NO_WINDOW) {
    WINDOW = false;
  }

  var WEB_WORKER = !WINDOW && (typeof self === "undefined" ? "undefined" : _typeof(self)) === 'object';
  var NODE_JS = !root.JS_MD5_NO_NODE_JS && (typeof process === "undefined" ? "undefined" : _typeof(process)) === 'object' && process.versions && process.versions.node;

  if (NODE_JS) {
    root = global;
  } else if (WEB_WORKER) {
    root = self;
  }

  var COMMON_JS = !root.JS_MD5_NO_COMMON_JS && ( false ? undefined : _typeof(module)) === 'object' && module.exports;
  var AMD =  true && __webpack_require__(/*! !webpack amd options */ "./node_modules/webpack/buildin/amd-options.js");
  var ARRAY_BUFFER = !root.JS_MD5_NO_ARRAY_BUFFER && typeof ArrayBuffer !== 'undefined';
  var HEX_CHARS = '0123456789abcdef'.split('');
  var EXTRA = [128, 32768, 8388608, -2147483648];
  var SHIFT = [0, 8, 16, 24];
  var OUTPUT_TYPES = ['hex', 'array', 'digest', 'buffer', 'arrayBuffer', 'base64'];
  var BASE64_ENCODE_CHAR = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'.split('');
  var blocks = [],
      buffer8;

  if (ARRAY_BUFFER) {
    var buffer = new ArrayBuffer(68);
    buffer8 = new Uint8Array(buffer);
    blocks = new Uint32Array(buffer);
  }

  if (root.JS_MD5_NO_NODE_JS || !Array.isArray) {
    Array.isArray = function (obj) {
      return Object.prototype.toString.call(obj) === '[object Array]';
    };
  }

  if (ARRAY_BUFFER && (root.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW || !ArrayBuffer.isView)) {
    ArrayBuffer.isView = function (obj) {
      return _typeof(obj) === 'object' && obj.buffer && obj.buffer.constructor === ArrayBuffer;
    };
  }
  /**
   * @method hex
   * @memberof md5
   * @description Output hash as hex string
   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
   * @returns {String} Hex string
   * @example
   * md5.hex('The quick brown fox jumps over the lazy dog');
   * // equal to
   * md5('The quick brown fox jumps over the lazy dog');
   */

  /**
   * @method digest
   * @memberof md5
   * @description Output hash as bytes array
   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
   * @returns {Array} Bytes array
   * @example
   * md5.digest('The quick brown fox jumps over the lazy dog');
   */

  /**
   * @method array
   * @memberof md5
   * @description Output hash as bytes array
   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
   * @returns {Array} Bytes array
   * @example
   * md5.array('The quick brown fox jumps over the lazy dog');
   */

  /**
   * @method arrayBuffer
   * @memberof md5
   * @description Output hash as ArrayBuffer
   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
   * @returns {ArrayBuffer} ArrayBuffer
   * @example
   * md5.arrayBuffer('The quick brown fox jumps over the lazy dog');
   */

  /**
   * @method buffer
   * @deprecated This maybe confuse with Buffer in node.js. Please use arrayBuffer instead.
   * @memberof md5
   * @description Output hash as ArrayBuffer
   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
   * @returns {ArrayBuffer} ArrayBuffer
   * @example
   * md5.buffer('The quick brown fox jumps over the lazy dog');
   */

  /**
   * @method base64
   * @memberof md5
   * @description Output hash as base64 string
   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
   * @returns {String} base64 string
   * @example
   * md5.base64('The quick brown fox jumps over the lazy dog');
   */


  var createOutputMethod = function createOutputMethod(outputType) {
    return function (message, isBinStr) {
      return new Md5(true).update(message, isBinStr)[outputType]();
    };
  };
  /**
   * @method create
   * @memberof md5
   * @description Create Md5 object
   * @returns {Md5} Md5 object.
   * @example
   * var hash = md5.create();
   */

  /**
   * @method update
   * @memberof md5
   * @description Create and update Md5 object
   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
   * @returns {Md5} Md5 object.
   * @example
   * var hash = md5.update('The quick brown fox jumps over the lazy dog');
   * // equal to
   * var hash = md5.create();
   * hash.update('The quick brown fox jumps over the lazy dog');
   */


  var createMethod = function createMethod() {
    var method = createOutputMethod('hex');

    if (NODE_JS) {
      method = nodeWrap(method);
    }

    method.getCtx = method.create = function () {
      return new Md5();
    };

    method.update = function (message) {
      return method.create().update(message);
    };

    for (var i = 0; i < OUTPUT_TYPES.length; ++i) {
      var type = OUTPUT_TYPES[i];
      method[type] = createOutputMethod(type);
    }

    return method;
  };

  var nodeWrap = function nodeWrap(method) {
    var crypto = eval("require('crypto')");
    var Buffer = eval("require('buffer').Buffer");

    var nodeMethod = function nodeMethod(message) {
      if (typeof message === 'string') {
        return crypto.createHash('md5').update(message, 'utf8').digest('hex');
      } else {
        if (message === null || message === undefined) {
          throw ERROR;
        } else if (message.constructor === ArrayBuffer) {
          message = new Uint8Array(message);
        }
      }

      if (Array.isArray(message) || ArrayBuffer.isView(message) || message.constructor === Buffer) {
        return crypto.createHash('md5').update(new Buffer(message)).digest('hex');
      } else {
        return method(message);
      }
    };

    return nodeMethod;
  };
  /**
   * Md5 class
   * @class Md5
   * @description This is internal class.
   * @see {@link md5.create}
   */


  function Md5(sharedMemory) {
    if (sharedMemory) {
      blocks[0] = blocks[16] = blocks[1] = blocks[2] = blocks[3] = blocks[4] = blocks[5] = blocks[6] = blocks[7] = blocks[8] = blocks[9] = blocks[10] = blocks[11] = blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;
      this.blocks = blocks;
      this.buffer8 = buffer8;
    } else {
      if (ARRAY_BUFFER) {
        var buffer = new ArrayBuffer(68);
        this.buffer8 = new Uint8Array(buffer);
        this.blocks = new Uint32Array(buffer);
      } else {
        this.blocks = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
      }
    }

    this.h0 = this.h1 = this.h2 = this.h3 = this.start = this.bytes = this.hBytes = 0;
    this.finalized = this.hashed = false;
    this.first = true;
  }
  /**
   * @method update
   * @memberof Md5
   * @instance
   * @description Update hash
   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
   * @returns {Md5} Md5 object.
   * @see {@link md5.update}
   */


  Md5.prototype.update = function (message, isBinStr) {
    if (this.finalized) {
      return;
    }

    var code,
        index = 0,
        i,
        length = message.length,
        blocks = this.blocks;
    var buffer8 = this.buffer8;

    while (index < length) {
      if (this.hashed) {
        this.hashed = false;
        blocks[0] = blocks[16];
        blocks[16] = blocks[1] = blocks[2] = blocks[3] = blocks[4] = blocks[5] = blocks[6] = blocks[7] = blocks[8] = blocks[9] = blocks[10] = blocks[11] = blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;
      }

      if (ARRAY_BUFFER) {
        for (i = this.start; index < length && i < 64; ++index) {
          code = message.charCodeAt(index);

          if (isBinStr || code < 0x80) {
            buffer8[i++] = code;
          } else if (code < 0x800) {
            buffer8[i++] = 0xc0 | code >> 6;
            buffer8[i++] = 0x80 | code & 0x3f;
          } else if (code < 0xd800 || code >= 0xe000) {
            buffer8[i++] = 0xe0 | code >> 12;
            buffer8[i++] = 0x80 | code >> 6 & 0x3f;
            buffer8[i++] = 0x80 | code & 0x3f;
          } else {
            code = 0x10000 + ((code & 0x3ff) << 10 | message.charCodeAt(++index) & 0x3ff);
            buffer8[i++] = 0xf0 | code >> 18;
            buffer8[i++] = 0x80 | code >> 12 & 0x3f;
            buffer8[i++] = 0x80 | code >> 6 & 0x3f;
            buffer8[i++] = 0x80 | code & 0x3f;
          }
        }
      } else {
        for (i = this.start; index < length && i < 64; ++index) {
          code = message.charCodeAt(index);

          if (isBinStr || code < 0x80) {
            blocks[i >> 2] |= code << SHIFT[i++ & 3];
          } else if (code < 0x800) {
            blocks[i >> 2] |= (0xc0 | code >> 6) << SHIFT[i++ & 3];
            blocks[i >> 2] |= (0x80 | code & 0x3f) << SHIFT[i++ & 3];
          } else if (code < 0xd800 || code >= 0xe000) {
            blocks[i >> 2] |= (0xe0 | code >> 12) << SHIFT[i++ & 3];
            blocks[i >> 2] |= (0x80 | code >> 6 & 0x3f) << SHIFT[i++ & 3];
            blocks[i >> 2] |= (0x80 | code & 0x3f) << SHIFT[i++ & 3];
          } else {
            code = 0x10000 + ((code & 0x3ff) << 10 | message.charCodeAt(++index) & 0x3ff);
            blocks[i >> 2] |= (0xf0 | code >> 18) << SHIFT[i++ & 3];
            blocks[i >> 2] |= (0x80 | code >> 12 & 0x3f) << SHIFT[i++ & 3];
            blocks[i >> 2] |= (0x80 | code >> 6 & 0x3f) << SHIFT[i++ & 3];
            blocks[i >> 2] |= (0x80 | code & 0x3f) << SHIFT[i++ & 3];
          }
        }
      }

      this.lastByteIndex = i;
      this.bytes += i - this.start;

      if (i >= 64) {
        this.start = i - 64;
        this.hash();
        this.hashed = true;
      } else {
        this.start = i;
      }
    }

    if (this.bytes > 4294967295) {
      this.hBytes += this.bytes / 4294967296 << 0;
      this.bytes = this.bytes % 4294967296;
    }

    return this;
  };

  Md5.prototype.finalize = function () {
    if (this.finalized) {
      return;
    }

    this.finalized = true;
    var blocks = this.blocks,
        i = this.lastByteIndex;
    blocks[i >> 2] |= EXTRA[i & 3];

    if (i >= 56) {
      if (!this.hashed) {
        this.hash();
      }

      blocks[0] = blocks[16];
      blocks[16] = blocks[1] = blocks[2] = blocks[3] = blocks[4] = blocks[5] = blocks[6] = blocks[7] = blocks[8] = blocks[9] = blocks[10] = blocks[11] = blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;
    }

    blocks[14] = this.bytes << 3;
    blocks[15] = this.hBytes << 3 | this.bytes >>> 29;
    this.hash();
  };

  Md5.prototype.hash = function () {
    var a,
        b,
        c,
        d,
        bc,
        da,
        blocks = this.blocks;

    if (this.first) {
      a = blocks[0] - 680876937;
      a = (a << 7 | a >>> 25) - 271733879 << 0;
      d = (-1732584194 ^ a & 2004318071) + blocks[1] - 117830708;
      d = (d << 12 | d >>> 20) + a << 0;
      c = (-271733879 ^ d & (a ^ -271733879)) + blocks[2] - 1126478375;
      c = (c << 17 | c >>> 15) + d << 0;
      b = (a ^ c & (d ^ a)) + blocks[3] - 1316259209;
      b = (b << 22 | b >>> 10) + c << 0;
    } else {
      a = this.h0;
      b = this.h1;
      c = this.h2;
      d = this.h3;
      a += (d ^ b & (c ^ d)) + blocks[0] - 680876936;
      a = (a << 7 | a >>> 25) + b << 0;
      d += (c ^ a & (b ^ c)) + blocks[1] - 389564586;
      d = (d << 12 | d >>> 20) + a << 0;
      c += (b ^ d & (a ^ b)) + blocks[2] + 606105819;
      c = (c << 17 | c >>> 15) + d << 0;
      b += (a ^ c & (d ^ a)) + blocks[3] - 1044525330;
      b = (b << 22 | b >>> 10) + c << 0;
    }

    a += (d ^ b & (c ^ d)) + blocks[4] - 176418897;
    a = (a << 7 | a >>> 25) + b << 0;
    d += (c ^ a & (b ^ c)) + blocks[5] + 1200080426;
    d = (d << 12 | d >>> 20) + a << 0;
    c += (b ^ d & (a ^ b)) + blocks[6] - 1473231341;
    c = (c << 17 | c >>> 15) + d << 0;
    b += (a ^ c & (d ^ a)) + blocks[7] - 45705983;
    b = (b << 22 | b >>> 10) + c << 0;
    a += (d ^ b & (c ^ d)) + blocks[8] + 1770035416;
    a = (a << 7 | a >>> 25) + b << 0;
    d += (c ^ a & (b ^ c)) + blocks[9] - 1958414417;
    d = (d << 12 | d >>> 20) + a << 0;
    c += (b ^ d & (a ^ b)) + blocks[10] - 42063;
    c = (c << 17 | c >>> 15) + d << 0;
    b += (a ^ c & (d ^ a)) + blocks[11] - 1990404162;
    b = (b << 22 | b >>> 10) + c << 0;
    a += (d ^ b & (c ^ d)) + blocks[12] + 1804603682;
    a = (a << 7 | a >>> 25) + b << 0;
    d += (c ^ a & (b ^ c)) + blocks[13] - 40341101;
    d = (d << 12 | d >>> 20) + a << 0;
    c += (b ^ d & (a ^ b)) + blocks[14] - 1502002290;
    c = (c << 17 | c >>> 15) + d << 0;
    b += (a ^ c & (d ^ a)) + blocks[15] + 1236535329;
    b = (b << 22 | b >>> 10) + c << 0;
    a += (c ^ d & (b ^ c)) + blocks[1] - 165796510;
    a = (a << 5 | a >>> 27) + b << 0;
    d += (b ^ c & (a ^ b)) + blocks[6] - 1069501632;
    d = (d << 9 | d >>> 23) + a << 0;
    c += (a ^ b & (d ^ a)) + blocks[11] + 643717713;
    c = (c << 14 | c >>> 18) + d << 0;
    b += (d ^ a & (c ^ d)) + blocks[0] - 373897302;
    b = (b << 20 | b >>> 12) + c << 0;
    a += (c ^ d & (b ^ c)) + blocks[5] - 701558691;
    a = (a << 5 | a >>> 27) + b << 0;
    d += (b ^ c & (a ^ b)) + blocks[10] + 38016083;
    d = (d << 9 | d >>> 23) + a << 0;
    c += (a ^ b & (d ^ a)) + blocks[15] - 660478335;
    c = (c << 14 | c >>> 18) + d << 0;
    b += (d ^ a & (c ^ d)) + blocks[4] - 405537848;
    b = (b << 20 | b >>> 12) + c << 0;
    a += (c ^ d & (b ^ c)) + blocks[9] + 568446438;
    a = (a << 5 | a >>> 27) + b << 0;
    d += (b ^ c & (a ^ b)) + blocks[14] - 1019803690;
    d = (d << 9 | d >>> 23) + a << 0;
    c += (a ^ b & (d ^ a)) + blocks[3] - 187363961;
    c = (c << 14 | c >>> 18) + d << 0;
    b += (d ^ a & (c ^ d)) + blocks[8] + 1163531501;
    b = (b << 20 | b >>> 12) + c << 0;
    a += (c ^ d & (b ^ c)) + blocks[13] - 1444681467;
    a = (a << 5 | a >>> 27) + b << 0;
    d += (b ^ c & (a ^ b)) + blocks[2] - 51403784;
    d = (d << 9 | d >>> 23) + a << 0;
    c += (a ^ b & (d ^ a)) + blocks[7] + 1735328473;
    c = (c << 14 | c >>> 18) + d << 0;
    b += (d ^ a & (c ^ d)) + blocks[12] - 1926607734;
    b = (b << 20 | b >>> 12) + c << 0;
    bc = b ^ c;
    a += (bc ^ d) + blocks[5] - 378558;
    a = (a << 4 | a >>> 28) + b << 0;
    d += (bc ^ a) + blocks[8] - 2022574463;
    d = (d << 11 | d >>> 21) + a << 0;
    da = d ^ a;
    c += (da ^ b) + blocks[11] + 1839030562;
    c = (c << 16 | c >>> 16) + d << 0;
    b += (da ^ c) + blocks[14] - 35309556;
    b = (b << 23 | b >>> 9) + c << 0;
    bc = b ^ c;
    a += (bc ^ d) + blocks[1] - 1530992060;
    a = (a << 4 | a >>> 28) + b << 0;
    d += (bc ^ a) + blocks[4] + 1272893353;
    d = (d << 11 | d >>> 21) + a << 0;
    da = d ^ a;
    c += (da ^ b) + blocks[7] - 155497632;
    c = (c << 16 | c >>> 16) + d << 0;
    b += (da ^ c) + blocks[10] - 1094730640;
    b = (b << 23 | b >>> 9) + c << 0;
    bc = b ^ c;
    a += (bc ^ d) + blocks[13] + 681279174;
    a = (a << 4 | a >>> 28) + b << 0;
    d += (bc ^ a) + blocks[0] - 358537222;
    d = (d << 11 | d >>> 21) + a << 0;
    da = d ^ a;
    c += (da ^ b) + blocks[3] - 722521979;
    c = (c << 16 | c >>> 16) + d << 0;
    b += (da ^ c) + blocks[6] + 76029189;
    b = (b << 23 | b >>> 9) + c << 0;
    bc = b ^ c;
    a += (bc ^ d) + blocks[9] - 640364487;
    a = (a << 4 | a >>> 28) + b << 0;
    d += (bc ^ a) + blocks[12] - 421815835;
    d = (d << 11 | d >>> 21) + a << 0;
    da = d ^ a;
    c += (da ^ b) + blocks[15] + 530742520;
    c = (c << 16 | c >>> 16) + d << 0;
    b += (da ^ c) + blocks[2] - 995338651;
    b = (b << 23 | b >>> 9) + c << 0;
    a += (c ^ (b | ~d)) + blocks[0] - 198630844;
    a = (a << 6 | a >>> 26) + b << 0;
    d += (b ^ (a | ~c)) + blocks[7] + 1126891415;
    d = (d << 10 | d >>> 22) + a << 0;
    c += (a ^ (d | ~b)) + blocks[14] - 1416354905;
    c = (c << 15 | c >>> 17) + d << 0;
    b += (d ^ (c | ~a)) + blocks[5] - 57434055;
    b = (b << 21 | b >>> 11) + c << 0;
    a += (c ^ (b | ~d)) + blocks[12] + 1700485571;
    a = (a << 6 | a >>> 26) + b << 0;
    d += (b ^ (a | ~c)) + blocks[3] - 1894986606;
    d = (d << 10 | d >>> 22) + a << 0;
    c += (a ^ (d | ~b)) + blocks[10] - 1051523;
    c = (c << 15 | c >>> 17) + d << 0;
    b += (d ^ (c | ~a)) + blocks[1] - 2054922799;
    b = (b << 21 | b >>> 11) + c << 0;
    a += (c ^ (b | ~d)) + blocks[8] + 1873313359;
    a = (a << 6 | a >>> 26) + b << 0;
    d += (b ^ (a | ~c)) + blocks[15] - 30611744;
    d = (d << 10 | d >>> 22) + a << 0;
    c += (a ^ (d | ~b)) + blocks[6] - 1560198380;
    c = (c << 15 | c >>> 17) + d << 0;
    b += (d ^ (c | ~a)) + blocks[13] + 1309151649;
    b = (b << 21 | b >>> 11) + c << 0;
    a += (c ^ (b | ~d)) + blocks[4] - 145523070;
    a = (a << 6 | a >>> 26) + b << 0;
    d += (b ^ (a | ~c)) + blocks[11] - 1120210379;
    d = (d << 10 | d >>> 22) + a << 0;
    c += (a ^ (d | ~b)) + blocks[2] + 718787259;
    c = (c << 15 | c >>> 17) + d << 0;
    b += (d ^ (c | ~a)) + blocks[9] - 343485551;
    b = (b << 21 | b >>> 11) + c << 0;

    if (this.first) {
      this.h0 = a + 1732584193 << 0;
      this.h1 = b - 271733879 << 0;
      this.h2 = c - 1732584194 << 0;
      this.h3 = d + 271733878 << 0;
      this.first = false;
    } else {
      this.h0 = this.h0 + a << 0;
      this.h1 = this.h1 + b << 0;
      this.h2 = this.h2 + c << 0;
      this.h3 = this.h3 + d << 0;
    }
  };
  /**
   * @method hex
   * @memberof Md5
   * @instance
   * @description Output hash as hex string
   * @returns {String} Hex string
   * @see {@link md5.hex}
   * @example
   * hash.hex();
   */


  Md5.prototype.hex = function () {
    this.finalize();
    var h0 = this.h0,
        h1 = this.h1,
        h2 = this.h2,
        h3 = this.h3;
    return HEX_CHARS[h0 >> 4 & 0x0F] + HEX_CHARS[h0 & 0x0F] + HEX_CHARS[h0 >> 12 & 0x0F] + HEX_CHARS[h0 >> 8 & 0x0F] + HEX_CHARS[h0 >> 20 & 0x0F] + HEX_CHARS[h0 >> 16 & 0x0F] + HEX_CHARS[h0 >> 28 & 0x0F] + HEX_CHARS[h0 >> 24 & 0x0F] + HEX_CHARS[h1 >> 4 & 0x0F] + HEX_CHARS[h1 & 0x0F] + HEX_CHARS[h1 >> 12 & 0x0F] + HEX_CHARS[h1 >> 8 & 0x0F] + HEX_CHARS[h1 >> 20 & 0x0F] + HEX_CHARS[h1 >> 16 & 0x0F] + HEX_CHARS[h1 >> 28 & 0x0F] + HEX_CHARS[h1 >> 24 & 0x0F] + HEX_CHARS[h2 >> 4 & 0x0F] + HEX_CHARS[h2 & 0x0F] + HEX_CHARS[h2 >> 12 & 0x0F] + HEX_CHARS[h2 >> 8 & 0x0F] + HEX_CHARS[h2 >> 20 & 0x0F] + HEX_CHARS[h2 >> 16 & 0x0F] + HEX_CHARS[h2 >> 28 & 0x0F] + HEX_CHARS[h2 >> 24 & 0x0F] + HEX_CHARS[h3 >> 4 & 0x0F] + HEX_CHARS[h3 & 0x0F] + HEX_CHARS[h3 >> 12 & 0x0F] + HEX_CHARS[h3 >> 8 & 0x0F] + HEX_CHARS[h3 >> 20 & 0x0F] + HEX_CHARS[h3 >> 16 & 0x0F] + HEX_CHARS[h3 >> 28 & 0x0F] + HEX_CHARS[h3 >> 24 & 0x0F];
  };
  /**
   * @method toString
   * @memberof Md5
   * @instance
   * @description Output hash as hex string
   * @returns {String} Hex string
   * @see {@link md5.hex}
   * @example
   * hash.toString();
   */


  Md5.prototype.toString = Md5.prototype.hex;
  /**
   * @method digest
   * @memberof Md5
   * @instance
   * @description Output hash as bytes array
   * @returns {Array} Bytes array
   * @see {@link md5.digest}
   * @example
   * hash.digest();
   */

  Md5.prototype.digest = function (format) {
    if (format === 'hex') return this.hex();
    this.finalize();
    var h0 = this.h0,
        h1 = this.h1,
        h2 = this.h2,
        h3 = this.h3;
    var res = [h0 & 0xFF, h0 >> 8 & 0xFF, h0 >> 16 & 0xFF, h0 >> 24 & 0xFF, h1 & 0xFF, h1 >> 8 & 0xFF, h1 >> 16 & 0xFF, h1 >> 24 & 0xFF, h2 & 0xFF, h2 >> 8 & 0xFF, h2 >> 16 & 0xFF, h2 >> 24 & 0xFF, h3 & 0xFF, h3 >> 8 & 0xFF, h3 >> 16 & 0xFF, h3 >> 24 & 0xFF];
    return res;
  };
  /**
   * @method array
   * @memberof Md5
   * @instance
   * @description Output hash as bytes array
   * @returns {Array} Bytes array
   * @see {@link md5.array}
   * @example
   * hash.array();
   */


  Md5.prototype.array = Md5.prototype.digest;
  /**
   * @method arrayBuffer
   * @memberof Md5
   * @instance
   * @description Output hash as ArrayBuffer
   * @returns {ArrayBuffer} ArrayBuffer
   * @see {@link md5.arrayBuffer}
   * @example
   * hash.arrayBuffer();
   */

  Md5.prototype.arrayBuffer = function () {
    this.finalize();
    var buffer = new ArrayBuffer(16);
    var blocks = new Uint32Array(buffer);
    blocks[0] = this.h0;
    blocks[1] = this.h1;
    blocks[2] = this.h2;
    blocks[3] = this.h3;
    return buffer;
  };
  /**
   * @method buffer
   * @deprecated This maybe confuse with Buffer in node.js. Please use arrayBuffer instead.
   * @memberof Md5
   * @instance
   * @description Output hash as ArrayBuffer
   * @returns {ArrayBuffer} ArrayBuffer
   * @see {@link md5.buffer}
   * @example
   * hash.buffer();
   */


  Md5.prototype.buffer = Md5.prototype.arrayBuffer;
  /**
   * @method base64
   * @memberof Md5
   * @instance
   * @description Output hash as base64 string
   * @returns {String} base64 string
   * @see {@link md5.base64}
   * @example
   * hash.base64();
   */

  Md5.prototype.base64 = function () {
    var v1,
        v2,
        v3,
        base64Str = '',
        bytes = this.array();

    for (var i = 0; i < 15;) {
      v1 = bytes[i++];
      v2 = bytes[i++];
      v3 = bytes[i++];
      base64Str += BASE64_ENCODE_CHAR[v1 >>> 2] + BASE64_ENCODE_CHAR[(v1 << 4 | v2 >>> 4) & 63] + BASE64_ENCODE_CHAR[(v2 << 2 | v3 >>> 6) & 63] + BASE64_ENCODE_CHAR[v3 & 63];
    }

    v1 = bytes[i];
    base64Str += BASE64_ENCODE_CHAR[v1 >>> 2] + BASE64_ENCODE_CHAR[v1 << 4 & 63] + '==';
    return base64Str;
  };

  var exports = createMethod();

  if (COMMON_JS) {
    module.exports = exports;
  } else {
    /**
     * @method md5
     * @description Md5 hash function, export to global in browsers.
     * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
     * @returns {String} md5 hashes
     * @example
     * md5(''); // d41d8cd98f00b204e9800998ecf8427e
     * md5('The quick brown fox jumps over the lazy dog'); // 9e107d9d372bb6826bd81d3542a419d6
     * md5('The quick brown fox jumps over the lazy dog.'); // e4d909c290d0fb1ca068ffaddf22cbd0
     *
     * // It also supports UTF-8 encoding
     * md5('中文'); // a7bac2239fcdcb3a067903d8077c4a07
     *
     * // It also supports byte `Array`, `Uint8Array`, `ArrayBuffer`
     * md5([]); // d41d8cd98f00b204e9800998ecf8427e
     * md5(new Uint8Array([])); // d41d8cd98f00b204e9800998ecf8427e
     */
    root.md5 = exports;

    if (AMD) {
      !(__WEBPACK_AMD_DEFINE_RESULT__ = (function () {
        return exports;
      }).call(exports, __webpack_require__, exports, module),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
    }
  }
})();
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../node_modules/process/browser.js */ "./node_modules/process/browser.js"), __webpack_require__(/*! ./../node_modules/webpack/buildin/global.js */ "./node_modules/webpack/buildin/global.js"), __webpack_require__(/*! ./../node_modules/webpack/buildin/module.js */ "./node_modules/webpack/buildin/module.js")(module)))

/***/ }),

/***/ "./lib/request.js":
/*!************************!*\
  !*** ./lib/request.js ***!
  \************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var _typeof = __webpack_require__(/*! @babel/runtime/helpers/typeof */ "./node_modules/@babel/runtime/helpers/typeof.js");

var stringifyPrimitive = function stringifyPrimitive(v) {
  switch (_typeof(v)) {
    case 'string':
      return v;

    case 'boolean':
      return v ? 'true' : 'false';

    case 'number':
      return isFinite(v) ? v : '';

    default:
      return '';
  }
};

var queryStringify = function queryStringify(obj, sep, eq, name) {
  sep = sep || '&';
  eq = eq || '=';

  if (obj === null) {
    obj = undefined;
  }

  if (_typeof(obj) === 'object') {
    return Object.keys(obj).map(function (k) {
      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;

      if (Array.isArray(obj[k])) {
        return obj[k].map(function (v) {
          return ks + encodeURIComponent(stringifyPrimitive(v));
        }).join(sep);
      } else {
        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));
      }
    }).filter(Boolean).join(sep);
  }

  if (!name) return '';
  return encodeURIComponent(stringifyPrimitive(name)) + eq + encodeURIComponent(stringifyPrimitive(obj));
};

var xhrRes = function xhrRes(err, xhr, body) {
  var headers = {};
  xhr.getAllResponseHeaders().trim().split('\n').forEach(function (item) {
    if (item) {
      var index = item.indexOf(':');
      var key = item.substr(0, index).trim().toLowerCase();
      var val = item.substr(index + 1).trim();
      headers[key] = val;
    }
  });
  return {
    error: err,
    statusCode: xhr.status,
    statusMessage: xhr.statusText,
    headers: headers,
    body: body
  };
};

var xhrBody = function xhrBody(xhr, dataType) {
  return !dataType && dataType === 'text' ? xhr.responseText : xhr.response;
};

var request = function request(opt, callback) {
  // method
  var method = (opt.method || 'GET').toUpperCase(); // url、qs

  var url = opt.url;

  if (opt.qs) {
    var qsStr = queryStringify(opt.qs);

    if (qsStr) {
      url += (url.indexOf('?') === -1 ? '?' : '&') + qsStr;
    }
  } // 创建 ajax 实例


  var xhr = new XMLHttpRequest();
  xhr.open(method, url, true);
  xhr.responseType = opt.dataType || 'text'; // 处理 xhrFields 属性

  if (opt.xhrFields) {
    for (var xhrField in opt.xhrFields) {
      xhr[xhrField] = opt.xhrFields[xhrField];
    }
  } // 处理 headers


  var headers = opt.headers;

  if (headers) {
    for (var key in headers) {
      if (headers.hasOwnProperty(key) && key.toLowerCase() !== 'content-length' && key.toLowerCase() !== 'user-agent' && key.toLowerCase() !== 'origin' && key.toLowerCase() !== 'host') {
        xhr.setRequestHeader(key, headers[key]);
      }
    }
  } // onprogress


  if (opt.onProgress && xhr.upload) xhr.upload.onprogress = opt.onProgress;
  if (opt.onDownloadProgress) xhr.onprogress = opt.onDownloadProgress; // timeout

  if (opt.timeout) xhr.timeout = opt.timeout;

  xhr.ontimeout = function (event) {
    var error = new Error('timeout');
    callback(xhrRes(error, xhr));
  }; // success 2xx/3xx/4xx


  xhr.onload = function () {
    callback(xhrRes(null, xhr, xhrBody(xhr, opt.dataType)));
  }; // error 5xx/0 (网络错误、跨域报错、Https connect-src 限制的报错时 statusCode 为 0)


  xhr.onerror = function (err) {
    var body = xhrBody(xhr, opt.dataType);

    if (body) {
      // 5xx
      callback(xhrRes(null, xhr, body));
    } else {
      // 0
      var error = xhr.statusText;
      if (!error && xhr.status === 0) error = new Error('CORS blocked or network error');
      callback(xhrRes(error, xhr, body));
    }
  }; // send


  xhr.send(opt.body || ''); // 返回 ajax 实例，用于外部调用 xhr.abort

  return xhr;
};

module.exports = request;

/***/ }),

/***/ "./lib/xml2json.js":
/*!*************************!*\
  !*** ./lib/xml2json.js ***!
  \*************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* Copyright 2015 William Summers, MetaTribal LLC
 * adapted from https://developer.mozilla.org/en-US/docs/JXON
 *
 * Licensed under the MIT License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     https://opensource.org/licenses/MIT
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * @author William Summers
 * https://github.com/metatribal/xmlToJSON
 */
var DOMParser = __webpack_require__(/*! @xmldom/xmldom */ "./node_modules/@xmldom/xmldom/lib/index.js").DOMParser;

var xmlToJSON = function () {
  this.version = "1.3.5";
  var options = {
    // set up the default options
    mergeCDATA: true,
    // extract cdata and merge with text
    normalize: true,
    // collapse multiple spaces to single space
    stripElemPrefix: true // for elements of same name in diff namespaces, you can enable namespaces and access the nskey property

  };
  var prefixMatch = new RegExp(/(?!xmlns)^.*:/);
  var trimMatch = new RegExp(/^\s+|\s+$/g);

  this.grokType = function (sValue) {
    if (/^\s*$/.test(sValue)) {
      return null;
    }

    if (/^(?:true|false)$/i.test(sValue)) {
      return sValue.toLowerCase() === "true";
    }

    if (isFinite(sValue)) {
      return parseFloat(sValue);
    }

    return sValue;
  };

  this.parseString = function (xmlString, opt) {
    if (xmlString) {
      var xml = this.stringToXML(xmlString);

      if (xml.getElementsByTagName('parsererror').length) {
        return null;
      } else {
        return this.parseXML(xml, opt);
      }
    } else {
      return null;
    }
  };

  this.parseXML = function (oXMLParent, opt) {
    // initialize options
    for (var key in opt) {
      options[key] = opt[key];
    }

    var vResult = {},
        nLength = 0,
        sCollectedTxt = ""; // iterate over the children

    var childNum = oXMLParent.childNodes.length;

    if (childNum) {
      for (var oNode, sProp, vContent, nItem = 0; nItem < oXMLParent.childNodes.length; nItem++) {
        oNode = oXMLParent.childNodes.item(nItem);

        if (oNode.nodeType === 4) {
          if (options.mergeCDATA) {
            sCollectedTxt += oNode.nodeValue;
          }
        }
        /* nodeType is "CDATASection" (4) */
        else if (oNode.nodeType === 3) {
          sCollectedTxt += oNode.nodeValue;
        }
        /* nodeType is "Text" (3) */
        else if (oNode.nodeType === 1) {
          /* nodeType is "Element" (1) */
          if (nLength === 0) {
            vResult = {};
          } // using nodeName to support browser (IE) implementation with no 'localName' property


          if (options.stripElemPrefix) {
            sProp = oNode.nodeName.replace(prefixMatch, '');
          } else {
            sProp = oNode.nodeName;
          }

          vContent = xmlToJSON.parseXML(oNode);

          if (vResult.hasOwnProperty(sProp)) {
            if (vResult[sProp].constructor !== Array) {
              vResult[sProp] = [vResult[sProp]];
            }

            vResult[sProp].push(vContent);
          } else {
            vResult[sProp] = vContent;
            nLength++;
          }
        }
      }
    }

    if (!Object.keys(vResult).length) {
      // vResult = sCollectedTxt.replace(trimMatch, '') || ''; // by carsonxu 修复 getBucket返回的 Key 是 " /" 这种场景
      vResult = sCollectedTxt || '';
    }

    return vResult;
  }; // Convert xmlDocument to a string
  // Returns null on failure


  this.xmlToString = function (xmlDoc) {
    try {
      var xmlString = xmlDoc.xml ? xmlDoc.xml : new XMLSerializer().serializeToString(xmlDoc);
      return xmlString;
    } catch (err) {
      return null;
    }
  }; // Convert a string to XML Node Structure
  // Returns null on failure


  this.stringToXML = function (xmlString) {
    try {
      var xmlDoc = null;

      if (window.DOMParser) {
        var parser = new DOMParser();
        xmlDoc = parser.parseFromString(xmlString, "text/xml");
        return xmlDoc;
      } else {
        xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
        xmlDoc.async = false;
        xmlDoc.loadXML(xmlString);
        return xmlDoc;
      }
    } catch (e) {
      return null;
    }
  };

  return this;
}.call({});

var xml2json = function xml2json(xmlString) {
  return xmlToJSON.parseString(xmlString);
};

module.exports = xml2json;

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/classCallCheck.js":
/*!***************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/classCallCheck.js ***!
  \***************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

function _classCallCheck(instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
}

module.exports = _classCallCheck, module.exports.__esModule = true, module.exports["default"] = module.exports;

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/createClass.js":
/*!************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/createClass.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

function _defineProperties(target, props) {
  for (var i = 0; i < props.length; i++) {
    var descriptor = props[i];
    descriptor.enumerable = descriptor.enumerable || false;
    descriptor.configurable = true;
    if ("value" in descriptor) descriptor.writable = true;
    Object.defineProperty(target, descriptor.key, descriptor);
  }
}

function _createClass(Constructor, protoProps, staticProps) {
  if (protoProps) _defineProperties(Constructor.prototype, protoProps);
  if (staticProps) _defineProperties(Constructor, staticProps);
  Object.defineProperty(Constructor, "prototype", {
    writable: false
  });
  return Constructor;
}

module.exports = _createClass, module.exports.__esModule = true, module.exports["default"] = module.exports;

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/typeof.js":
/*!*******************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/typeof.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

function _typeof(obj) {
  "@babel/helpers - typeof";

  return (module.exports = _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {
    return typeof obj;
  } : function (obj) {
    return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
  }, module.exports.__esModule = true, module.exports["default"] = module.exports), _typeof(obj);
}

module.exports = _typeof, module.exports.__esModule = true, module.exports["default"] = module.exports;

/***/ }),

/***/ "./node_modules/@xmldom/xmldom/lib/conventions.js":
/*!********************************************************!*\
  !*** ./node_modules/@xmldom/xmldom/lib/conventions.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * "Shallow freezes" an object to render it immutable.
 * Uses `Object.freeze` if available,
 * otherwise the immutability is only in the type.
 *
 * Is used to create "enum like" objects.
 *
 * @template T
 * @param {T} object the object to freeze
 * @param {Pick<ObjectConstructor, 'freeze'> = Object} oc `Object` by default,
 * 				allows to inject custom object constructor for tests
 * @returns {Readonly<T>}
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze
 */
function freeze(object, oc) {
	if (oc === undefined) {
		oc = Object
	}
	return oc && typeof oc.freeze === 'function' ? oc.freeze(object) : object
}

/**
 * Since we can not rely on `Object.assign` we provide a simplified version
 * that is sufficient for our needs.
 *
 * @param {Object} target
 * @param {Object | null | undefined} source
 *
 * @returns {Object} target
 * @throws TypeError if target is not an object
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign
 * @see https://tc39.es/ecma262/multipage/fundamental-objects.html#sec-object.assign
 */
function assign(target, source) {
	if (target === null || typeof target !== 'object') {
		throw new TypeError('target is not an object')
	}
	for (var key in source) {
		if (Object.prototype.hasOwnProperty.call(source, key)) {
			target[key] = source[key]
		}
	}
	return target
}

/**
 * All mime types that are allowed as input to `DOMParser.parseFromString`
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMParser/parseFromString#Argument02 MDN
 * @see https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#domparsersupportedtype WHATWG HTML Spec
 * @see DOMParser.prototype.parseFromString
 */
var MIME_TYPE = freeze({
	/**
	 * `text/html`, the only mime type that triggers treating an XML document as HTML.
	 *
	 * @see DOMParser.SupportedType.isHTML
	 * @see https://www.iana.org/assignments/media-types/text/html IANA MimeType registration
	 * @see https://en.wikipedia.org/wiki/HTML Wikipedia
	 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMParser/parseFromString MDN
	 * @see https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-domparser-parsefromstring WHATWG HTML Spec
	 */
	HTML: 'text/html',

	/**
	 * Helper method to check a mime type if it indicates an HTML document
	 *
	 * @param {string} [value]
	 * @returns {boolean}
	 *
	 * @see https://www.iana.org/assignments/media-types/text/html IANA MimeType registration
	 * @see https://en.wikipedia.org/wiki/HTML Wikipedia
	 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMParser/parseFromString MDN
	 * @see https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-domparser-parsefromstring 	 */
	isHTML: function (value) {
		return value === MIME_TYPE.HTML
	},

	/**
	 * `application/xml`, the standard mime type for XML documents.
	 *
	 * @see https://www.iana.org/assignments/media-types/application/xml IANA MimeType registration
	 * @see https://tools.ietf.org/html/rfc7303#section-9.1 RFC 7303
	 * @see https://en.wikipedia.org/wiki/XML_and_MIME Wikipedia
	 */
	XML_APPLICATION: 'application/xml',

	/**
	 * `text/html`, an alias for `application/xml`.
	 *
	 * @see https://tools.ietf.org/html/rfc7303#section-9.2 RFC 7303
	 * @see https://www.iana.org/assignments/media-types/text/xml IANA MimeType registration
	 * @see https://en.wikipedia.org/wiki/XML_and_MIME Wikipedia
	 */
	XML_TEXT: 'text/xml',

	/**
	 * `application/xhtml+xml`, indicates an XML document that has the default HTML namespace,
	 * but is parsed as an XML document.
	 *
	 * @see https://www.iana.org/assignments/media-types/application/xhtml+xml IANA MimeType registration
	 * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocument WHATWG DOM Spec
	 * @see https://en.wikipedia.org/wiki/XHTML Wikipedia
	 */
	XML_XHTML_APPLICATION: 'application/xhtml+xml',

	/**
	 * `image/svg+xml`,
	 *
	 * @see https://www.iana.org/assignments/media-types/image/svg+xml IANA MimeType registration
	 * @see https://www.w3.org/TR/SVG11/ W3C SVG 1.1
	 * @see https://en.wikipedia.org/wiki/Scalable_Vector_Graphics Wikipedia
	 */
	XML_SVG_IMAGE: 'image/svg+xml',
})

/**
 * Namespaces that are used in this code base.
 *
 * @see http://www.w3.org/TR/REC-xml-names
 */
var NAMESPACE = freeze({
	/**
	 * The XHTML namespace.
	 *
	 * @see http://www.w3.org/1999/xhtml
	 */
	HTML: 'http://www.w3.org/1999/xhtml',

	/**
	 * Checks if `uri` equals `NAMESPACE.HTML`.
	 *
	 * @param {string} [uri]
	 *
	 * @see NAMESPACE.HTML
	 */
	isHTML: function (uri) {
		return uri === NAMESPACE.HTML
	},

	/**
	 * The SVG namespace.
	 *
	 * @see http://www.w3.org/2000/svg
	 */
	SVG: 'http://www.w3.org/2000/svg',

	/**
	 * The `xml:` namespace.
	 *
	 * @see http://www.w3.org/XML/1998/namespace
	 */
	XML: 'http://www.w3.org/XML/1998/namespace',

	/**
	 * The `xmlns:` namespace
	 *
	 * @see https://www.w3.org/2000/xmlns/
	 */
	XMLNS: 'http://www.w3.org/2000/xmlns/',
})

exports.assign = assign;
exports.freeze = freeze;
exports.MIME_TYPE = MIME_TYPE;
exports.NAMESPACE = NAMESPACE;


/***/ }),

/***/ "./node_modules/@xmldom/xmldom/lib/dom-parser.js":
/*!*******************************************************!*\
  !*** ./node_modules/@xmldom/xmldom/lib/dom-parser.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var conventions = __webpack_require__(/*! ./conventions */ "./node_modules/@xmldom/xmldom/lib/conventions.js");
var dom = __webpack_require__(/*! ./dom */ "./node_modules/@xmldom/xmldom/lib/dom.js")
var entities = __webpack_require__(/*! ./entities */ "./node_modules/@xmldom/xmldom/lib/entities.js");
var sax = __webpack_require__(/*! ./sax */ "./node_modules/@xmldom/xmldom/lib/sax.js");

var DOMImplementation = dom.DOMImplementation;

var NAMESPACE = conventions.NAMESPACE;

var ParseError = sax.ParseError;
var XMLReader = sax.XMLReader;

/**
 * Normalizes line ending according to https://www.w3.org/TR/xml11/#sec-line-ends:
 *
 * > XML parsed entities are often stored in computer files which,
 * > for editing convenience, are organized into lines.
 * > These lines are typically separated by some combination
 * > of the characters CARRIAGE RETURN (#xD) and LINE FEED (#xA).
 * >
 * > To simplify the tasks of applications, the XML processor must behave
 * > as if it normalized all line breaks in external parsed entities (including the document entity)
 * > on input, before parsing, by translating all of the following to a single #xA character:
 * >
 * > 1. the two-character sequence #xD #xA
 * > 2. the two-character sequence #xD #x85
 * > 3. the single character #x85
 * > 4. the single character #x2028
 * > 5. any #xD character that is not immediately followed by #xA or #x85.
 *
 * @param {string} input
 * @returns {string}
 */
function normalizeLineEndings(input) {
	return input
		.replace(/\r[\n\u0085]/g, '\n')
		.replace(/[\r\u0085\u2028]/g, '\n')
}

/**
 * @typedef Locator
 * @property {number} [columnNumber]
 * @property {number} [lineNumber]
 */

/**
 * @typedef DOMParserOptions
 * @property {DOMHandler} [domBuilder]
 * @property {Function} [errorHandler]
 * @property {(string) => string} [normalizeLineEndings] used to replace line endings before parsing
 * 						defaults to `normalizeLineEndings`
 * @property {Locator} [locator]
 * @property {Record<string, string>} [xmlns]
 *
 * @see normalizeLineEndings
 */

/**
 * The DOMParser interface provides the ability to parse XML or HTML source code
 * from a string into a DOM `Document`.
 *
 * _xmldom is different from the spec in that it allows an `options` parameter,
 * to override the default behavior._
 *
 * @param {DOMParserOptions} [options]
 * @constructor
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMParser
 * @see https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-parsing-and-serialization
 */
function DOMParser(options){
	this.options = options ||{locator:{}};
}

DOMParser.prototype.parseFromString = function(source,mimeType){
	var options = this.options;
	var sax =  new XMLReader();
	var domBuilder = options.domBuilder || new DOMHandler();//contentHandler and LexicalHandler
	var errorHandler = options.errorHandler;
	var locator = options.locator;
	var defaultNSMap = options.xmlns||{};
	var isHTML = /\/x?html?$/.test(mimeType);//mimeType.toLowerCase().indexOf('html') > -1;
  	var entityMap = isHTML ? entities.HTML_ENTITIES : entities.XML_ENTITIES;
	if(locator){
		domBuilder.setDocumentLocator(locator)
	}

	sax.errorHandler = buildErrorHandler(errorHandler,domBuilder,locator);
	sax.domBuilder = options.domBuilder || domBuilder;
	if(isHTML){
		defaultNSMap[''] = NAMESPACE.HTML;
	}
	defaultNSMap.xml = defaultNSMap.xml || NAMESPACE.XML;
	var normalize = options.normalizeLineEndings || normalizeLineEndings;
	if (source && typeof source === 'string') {
		sax.parse(
			normalize(source),
			defaultNSMap,
			entityMap
		)
	} else {
		sax.errorHandler.error('invalid doc source')
	}
	return domBuilder.doc;
}
function buildErrorHandler(errorImpl,domBuilder,locator){
	if(!errorImpl){
		if(domBuilder instanceof DOMHandler){
			return domBuilder;
		}
		errorImpl = domBuilder ;
	}
	var errorHandler = {}
	var isCallback = errorImpl instanceof Function;
	locator = locator||{}
	function build(key){
		var fn = errorImpl[key];
		if(!fn && isCallback){
			fn = errorImpl.length == 2?function(msg){errorImpl(key,msg)}:errorImpl;
		}
		errorHandler[key] = fn && function(msg){
			fn('[xmldom '+key+']\t'+msg+_locator(locator));
		}||function(){};
	}
	build('warning');
	build('error');
	build('fatalError');
	return errorHandler;
}

//console.log('#\n\n\n\n\n\n\n####')
/**
 * +ContentHandler+ErrorHandler
 * +LexicalHandler+EntityResolver2
 * -DeclHandler-DTDHandler
 *
 * DefaultHandler:EntityResolver, DTDHandler, ContentHandler, ErrorHandler
 * DefaultHandler2:DefaultHandler,LexicalHandler, DeclHandler, EntityResolver2
 * @link http://www.saxproject.org/apidoc/org/xml/sax/helpers/DefaultHandler.html
 */
function DOMHandler() {
    this.cdata = false;
}
function position(locator,node){
	node.lineNumber = locator.lineNumber;
	node.columnNumber = locator.columnNumber;
}
/**
 * @see org.xml.sax.ContentHandler#startDocument
 * @link http://www.saxproject.org/apidoc/org/xml/sax/ContentHandler.html
 */
DOMHandler.prototype = {
	startDocument : function() {
    	this.doc = new DOMImplementation().createDocument(null, null, null);
    	if (this.locator) {
        	this.doc.documentURI = this.locator.systemId;
    	}
	},
	startElement:function(namespaceURI, localName, qName, attrs) {
		var doc = this.doc;
	    var el = doc.createElementNS(namespaceURI, qName||localName);
	    var len = attrs.length;
	    appendElement(this, el);
	    this.currentElement = el;

		this.locator && position(this.locator,el)
	    for (var i = 0 ; i < len; i++) {
	        var namespaceURI = attrs.getURI(i);
	        var value = attrs.getValue(i);
	        var qName = attrs.getQName(i);
			var attr = doc.createAttributeNS(namespaceURI, qName);
			this.locator &&position(attrs.getLocator(i),attr);
			attr.value = attr.nodeValue = value;
			el.setAttributeNode(attr)
	    }
	},
	endElement:function(namespaceURI, localName, qName) {
		var current = this.currentElement
		var tagName = current.tagName;
		this.currentElement = current.parentNode;
	},
	startPrefixMapping:function(prefix, uri) {
	},
	endPrefixMapping:function(prefix) {
	},
	processingInstruction:function(target, data) {
	    var ins = this.doc.createProcessingInstruction(target, data);
	    this.locator && position(this.locator,ins)
	    appendElement(this, ins);
	},
	ignorableWhitespace:function(ch, start, length) {
	},
	characters:function(chars, start, length) {
		chars = _toString.apply(this,arguments)
		//console.log(chars)
		if(chars){
			if (this.cdata) {
				var charNode = this.doc.createCDATASection(chars);
			} else {
				var charNode = this.doc.createTextNode(chars);
			}
			if(this.currentElement){
				this.currentElement.appendChild(charNode);
			}else if(/^\s*$/.test(chars)){
				this.doc.appendChild(charNode);
				//process xml
			}
			this.locator && position(this.locator,charNode)
		}
	},
	skippedEntity:function(name) {
	},
	endDocument:function() {
		this.doc.normalize();
	},
	setDocumentLocator:function (locator) {
	    if(this.locator = locator){// && !('lineNumber' in locator)){
	    	locator.lineNumber = 0;
	    }
	},
	//LexicalHandler
	comment:function(chars, start, length) {
		chars = _toString.apply(this,arguments)
	    var comm = this.doc.createComment(chars);
	    this.locator && position(this.locator,comm)
	    appendElement(this, comm);
	},

	startCDATA:function() {
	    //used in characters() methods
	    this.cdata = true;
	},
	endCDATA:function() {
	    this.cdata = false;
	},

	startDTD:function(name, publicId, systemId) {
		var impl = this.doc.implementation;
	    if (impl && impl.createDocumentType) {
	        var dt = impl.createDocumentType(name, publicId, systemId);
	        this.locator && position(this.locator,dt)
	        appendElement(this, dt);
					this.doc.doctype = dt;
	    }
	},
	/**
	 * @see org.xml.sax.ErrorHandler
	 * @link http://www.saxproject.org/apidoc/org/xml/sax/ErrorHandler.html
	 */
	warning:function(error) {
		console.warn('[xmldom warning]\t'+error,_locator(this.locator));
	},
	error:function(error) {
		console.error('[xmldom error]\t'+error,_locator(this.locator));
	},
	fatalError:function(error) {
		throw new ParseError(error, this.locator);
	}
}
function _locator(l){
	if(l){
		return '\n@'+(l.systemId ||'')+'#[line:'+l.lineNumber+',col:'+l.columnNumber+']'
	}
}
function _toString(chars,start,length){
	if(typeof chars == 'string'){
		return chars.substr(start,length)
	}else{//java sax connect width xmldom on rhino(what about: "? && !(chars instanceof String)")
		if(chars.length >= start+length || start){
			return new java.lang.String(chars,start,length)+'';
		}
		return chars;
	}
}

/*
 * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/LexicalHandler.html
 * used method of org.xml.sax.ext.LexicalHandler:
 *  #comment(chars, start, length)
 *  #startCDATA()
 *  #endCDATA()
 *  #startDTD(name, publicId, systemId)
 *
 *
 * IGNORED method of org.xml.sax.ext.LexicalHandler:
 *  #endDTD()
 *  #startEntity(name)
 *  #endEntity(name)
 *
 *
 * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/DeclHandler.html
 * IGNORED method of org.xml.sax.ext.DeclHandler
 * 	#attributeDecl(eName, aName, type, mode, value)
 *  #elementDecl(name, model)
 *  #externalEntityDecl(name, publicId, systemId)
 *  #internalEntityDecl(name, value)
 * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/EntityResolver2.html
 * IGNORED method of org.xml.sax.EntityResolver2
 *  #resolveEntity(String name,String publicId,String baseURI,String systemId)
 *  #resolveEntity(publicId, systemId)
 *  #getExternalSubset(name, baseURI)
 * @link http://www.saxproject.org/apidoc/org/xml/sax/DTDHandler.html
 * IGNORED method of org.xml.sax.DTDHandler
 *  #notationDecl(name, publicId, systemId) {};
 *  #unparsedEntityDecl(name, publicId, systemId, notationName) {};
 */
"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(key){
	DOMHandler.prototype[key] = function(){return null}
})

/* Private static helpers treated below as private instance methods, so don't need to add these to the public API; we might use a Relator to also get rid of non-standard public properties */
function appendElement (hander,node) {
    if (!hander.currentElement) {
        hander.doc.appendChild(node);
    } else {
        hander.currentElement.appendChild(node);
    }
}//appendChild and setAttributeNS are preformance key

exports.__DOMHandler = DOMHandler;
exports.normalizeLineEndings = normalizeLineEndings;
exports.DOMParser = DOMParser;


/***/ }),

/***/ "./node_modules/@xmldom/xmldom/lib/dom.js":
/*!************************************************!*\
  !*** ./node_modules/@xmldom/xmldom/lib/dom.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var conventions = __webpack_require__(/*! ./conventions */ "./node_modules/@xmldom/xmldom/lib/conventions.js");

var NAMESPACE = conventions.NAMESPACE;

/**
 * A prerequisite for `[].filter`, to drop elements that are empty
 * @param {string} input
 * @returns {boolean}
 */
function notEmptyString (input) {
	return input !== ''
}
/**
 * @see https://infra.spec.whatwg.org/#split-on-ascii-whitespace
 * @see https://infra.spec.whatwg.org/#ascii-whitespace
 *
 * @param {string} input
 * @returns {string[]} (can be empty)
 */
function splitOnASCIIWhitespace(input) {
	// U+0009 TAB, U+000A LF, U+000C FF, U+000D CR, U+0020 SPACE
	return input ? input.split(/[\t\n\f\r ]+/).filter(notEmptyString) : []
}

/**
 * Adds element as a key to current if it is not already present.
 *
 * @param {Record<string, boolean | undefined>} current
 * @param {string} element
 * @returns {Record<string, boolean | undefined>}
 */
function orderedSetReducer (current, element) {
	if (!current.hasOwnProperty(element)) {
		current[element] = true;
	}
	return current;
}

/**
 * @see https://infra.spec.whatwg.org/#ordered-set
 * @param {string} input
 * @returns {string[]}
 */
function toOrderedSet(input) {
	if (!input) return [];
	var list = splitOnASCIIWhitespace(input);
	return Object.keys(list.reduce(orderedSetReducer, {}))
}

/**
 * Uses `list.indexOf` to implement something like `Array.prototype.includes`,
 * which we can not rely on being available.
 *
 * @param {any[]} list
 * @returns {function(any): boolean}
 */
function arrayIncludes (list) {
	return function(element) {
		return list && list.indexOf(element) !== -1;
	}
}

function copy(src,dest){
	for(var p in src){
		dest[p] = src[p];
	}
}

/**
^\w+\.prototype\.([_\w]+)\s*=\s*((?:.*\{\s*?[\r\n][\s\S]*?^})|\S.*?(?=[;\r\n]));?
^\w+\.prototype\.([_\w]+)\s*=\s*(\S.*?(?=[;\r\n]));?
 */
function _extends(Class,Super){
	var pt = Class.prototype;
	if(!(pt instanceof Super)){
		function t(){};
		t.prototype = Super.prototype;
		t = new t();
		copy(pt,t);
		Class.prototype = pt = t;
	}
	if(pt.constructor != Class){
		if(typeof Class != 'function'){
			console.error("unknown Class:"+Class)
		}
		pt.constructor = Class
	}
}

// Node Types
var NodeType = {}
var ELEMENT_NODE                = NodeType.ELEMENT_NODE                = 1;
var ATTRIBUTE_NODE              = NodeType.ATTRIBUTE_NODE              = 2;
var TEXT_NODE                   = NodeType.TEXT_NODE                   = 3;
var CDATA_SECTION_NODE          = NodeType.CDATA_SECTION_NODE          = 4;
var ENTITY_REFERENCE_NODE       = NodeType.ENTITY_REFERENCE_NODE       = 5;
var ENTITY_NODE                 = NodeType.ENTITY_NODE                 = 6;
var PROCESSING_INSTRUCTION_NODE = NodeType.PROCESSING_INSTRUCTION_NODE = 7;
var COMMENT_NODE                = NodeType.COMMENT_NODE                = 8;
var DOCUMENT_NODE               = NodeType.DOCUMENT_NODE               = 9;
var DOCUMENT_TYPE_NODE          = NodeType.DOCUMENT_TYPE_NODE          = 10;
var DOCUMENT_FRAGMENT_NODE      = NodeType.DOCUMENT_FRAGMENT_NODE      = 11;
var NOTATION_NODE               = NodeType.NOTATION_NODE               = 12;

// ExceptionCode
var ExceptionCode = {}
var ExceptionMessage = {};
var INDEX_SIZE_ERR              = ExceptionCode.INDEX_SIZE_ERR              = ((ExceptionMessage[1]="Index size error"),1);
var DOMSTRING_SIZE_ERR          = ExceptionCode.DOMSTRING_SIZE_ERR          = ((ExceptionMessage[2]="DOMString size error"),2);
var HIERARCHY_REQUEST_ERR       = ExceptionCode.HIERARCHY_REQUEST_ERR       = ((ExceptionMessage[3]="Hierarchy request error"),3);
var WRONG_DOCUMENT_ERR          = ExceptionCode.WRONG_DOCUMENT_ERR          = ((ExceptionMessage[4]="Wrong document"),4);
var INVALID_CHARACTER_ERR       = ExceptionCode.INVALID_CHARACTER_ERR       = ((ExceptionMessage[5]="Invalid character"),5);
var NO_DATA_ALLOWED_ERR         = ExceptionCode.NO_DATA_ALLOWED_ERR         = ((ExceptionMessage[6]="No data allowed"),6);
var NO_MODIFICATION_ALLOWED_ERR = ExceptionCode.NO_MODIFICATION_ALLOWED_ERR = ((ExceptionMessage[7]="No modification allowed"),7);
var NOT_FOUND_ERR               = ExceptionCode.NOT_FOUND_ERR               = ((ExceptionMessage[8]="Not found"),8);
var NOT_SUPPORTED_ERR           = ExceptionCode.NOT_SUPPORTED_ERR           = ((ExceptionMessage[9]="Not supported"),9);
var INUSE_ATTRIBUTE_ERR         = ExceptionCode.INUSE_ATTRIBUTE_ERR         = ((ExceptionMessage[10]="Attribute in use"),10);
//level2
var INVALID_STATE_ERR        	= ExceptionCode.INVALID_STATE_ERR        	= ((ExceptionMessage[11]="Invalid state"),11);
var SYNTAX_ERR               	= ExceptionCode.SYNTAX_ERR               	= ((ExceptionMessage[12]="Syntax error"),12);
var INVALID_MODIFICATION_ERR 	= ExceptionCode.INVALID_MODIFICATION_ERR 	= ((ExceptionMessage[13]="Invalid modification"),13);
var NAMESPACE_ERR            	= ExceptionCode.NAMESPACE_ERR           	= ((ExceptionMessage[14]="Invalid namespace"),14);
var INVALID_ACCESS_ERR       	= ExceptionCode.INVALID_ACCESS_ERR      	= ((ExceptionMessage[15]="Invalid access"),15);

/**
 * DOM Level 2
 * Object DOMException
 * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/ecma-script-binding.html
 * @see http://www.w3.org/TR/REC-DOM-Level-1/ecma-script-language-binding.html
 */
function DOMException(code, message) {
	if(message instanceof Error){
		var error = message;
	}else{
		error = this;
		Error.call(this, ExceptionMessage[code]);
		this.message = ExceptionMessage[code];
		if(Error.captureStackTrace) Error.captureStackTrace(this, DOMException);
	}
	error.code = code;
	if(message) this.message = this.message + ": " + message;
	return error;
};
DOMException.prototype = Error.prototype;
copy(ExceptionCode,DOMException)

/**
 * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-536297177
 * The NodeList interface provides the abstraction of an ordered collection of nodes, without defining or constraining how this collection is implemented. NodeList objects in the DOM are live.
 * The items in the NodeList are accessible via an integral index, starting from 0.
 */
function NodeList() {
};
NodeList.prototype = {
	/**
	 * The number of nodes in the list. The range of valid child node indices is 0 to length-1 inclusive.
	 * @standard level1
	 */
	length:0, 
	/**
	 * Returns the indexth item in the collection. If index is greater than or equal to the number of nodes in the list, this returns null.
	 * @standard level1
	 * @param index  unsigned long 
	 *   Index into the collection.
	 * @return Node
	 * 	The node at the indexth position in the NodeList, or null if that is not a valid index. 
	 */
	item: function(index) {
		return this[index] || null;
	},
	toString:function(isHTML,nodeFilter){
		for(var buf = [], i = 0;i<this.length;i++){
			serializeToString(this[i],buf,isHTML,nodeFilter);
		}
		return buf.join('');
	}
};

function LiveNodeList(node,refresh){
	this._node = node;
	this._refresh = refresh
	_updateLiveList(this);
}
function _updateLiveList(list){
	var inc = list._node._inc || list._node.ownerDocument._inc;
	if(list._inc != inc){
		var ls = list._refresh(list._node);
		//console.log(ls.length)
		__set__(list,'length',ls.length);
		copy(ls,list);
		list._inc = inc;
	}
}
LiveNodeList.prototype.item = function(i){
	_updateLiveList(this);
	return this[i];
}

_extends(LiveNodeList,NodeList);

/**
 * Objects implementing the NamedNodeMap interface are used
 * to represent collections of nodes that can be accessed by name.
 * Note that NamedNodeMap does not inherit from NodeList;
 * NamedNodeMaps are not maintained in any particular order.
 * Objects contained in an object implementing NamedNodeMap may also be accessed by an ordinal index,
 * but this is simply to allow convenient enumeration of the contents of a NamedNodeMap,
 * and does not imply that the DOM specifies an order to these Nodes.
 * NamedNodeMap objects in the DOM are live.
 * used for attributes or DocumentType entities 
 */
function NamedNodeMap() {
};

function _findNodeIndex(list,node){
	var i = list.length;
	while(i--){
		if(list[i] === node){return i}
	}
}

function _addNamedNode(el,list,newAttr,oldAttr){
	if(oldAttr){
		list[_findNodeIndex(list,oldAttr)] = newAttr;
	}else{
		list[list.length++] = newAttr;
	}
	if(el){
		newAttr.ownerElement = el;
		var doc = el.ownerDocument;
		if(doc){
			oldAttr && _onRemoveAttribute(doc,el,oldAttr);
			_onAddAttribute(doc,el,newAttr);
		}
	}
}
function _removeNamedNode(el,list,attr){
	//console.log('remove attr:'+attr)
	var i = _findNodeIndex(list,attr);
	if(i>=0){
		var lastIndex = list.length-1
		while(i<lastIndex){
			list[i] = list[++i]
		}
		list.length = lastIndex;
		if(el){
			var doc = el.ownerDocument;
			if(doc){
				_onRemoveAttribute(doc,el,attr);
				attr.ownerElement = null;
			}
		}
	}else{
		throw DOMException(NOT_FOUND_ERR,new Error(el.tagName+'@'+attr))
	}
}
NamedNodeMap.prototype = {
	length:0,
	item:NodeList.prototype.item,
	getNamedItem: function(key) {
//		if(key.indexOf(':')>0 || key == 'xmlns'){
//			return null;
//		}
		//console.log()
		var i = this.length;
		while(i--){
			var attr = this[i];
			//console.log(attr.nodeName,key)
			if(attr.nodeName == key){
				return attr;
			}
		}
	},
	setNamedItem: function(attr) {
		var el = attr.ownerElement;
		if(el && el!=this._ownerElement){
			throw new DOMException(INUSE_ATTRIBUTE_ERR);
		}
		var oldAttr = this.getNamedItem(attr.nodeName);
		_addNamedNode(this._ownerElement,this,attr,oldAttr);
		return oldAttr;
	},
	/* returns Node */
	setNamedItemNS: function(attr) {// raises: WRONG_DOCUMENT_ERR,NO_MODIFICATION_ALLOWED_ERR,INUSE_ATTRIBUTE_ERR
		var el = attr.ownerElement, oldAttr;
		if(el && el!=this._ownerElement){
			throw new DOMException(INUSE_ATTRIBUTE_ERR);
		}
		oldAttr = this.getNamedItemNS(attr.namespaceURI,attr.localName);
		_addNamedNode(this._ownerElement,this,attr,oldAttr);
		return oldAttr;
	},

	/* returns Node */
	removeNamedItem: function(key) {
		var attr = this.getNamedItem(key);
		_removeNamedNode(this._ownerElement,this,attr);
		return attr;
		
		
	},// raises: NOT_FOUND_ERR,NO_MODIFICATION_ALLOWED_ERR
	
	//for level2
	removeNamedItemNS:function(namespaceURI,localName){
		var attr = this.getNamedItemNS(namespaceURI,localName);
		_removeNamedNode(this._ownerElement,this,attr);
		return attr;
	},
	getNamedItemNS: function(namespaceURI, localName) {
		var i = this.length;
		while(i--){
			var node = this[i];
			if(node.localName == localName && node.namespaceURI == namespaceURI){
				return node;
			}
		}
		return null;
	}
};

/**
 * The DOMImplementation interface represents an object providing methods
 * which are not dependent on any particular document.
 * Such an object is returned by the `Document.implementation` property.
 *
 * __The individual methods describe the differences compared to the specs.__
 *
 * @constructor
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation MDN
 * @see https://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-102161490 DOM Level 1 Core (Initial)
 * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#ID-102161490 DOM Level 2 Core
 * @see https://www.w3.org/TR/DOM-Level-3-Core/core.html#ID-102161490 DOM Level 3 Core
 * @see https://dom.spec.whatwg.org/#domimplementation DOM Living Standard
 */
function DOMImplementation() {
}

DOMImplementation.prototype = {
	/**
	 * The DOMImplementation.hasFeature() method returns a Boolean flag indicating if a given feature is supported.
	 * The different implementations fairly diverged in what kind of features were reported.
	 * The latest version of the spec settled to force this method to always return true, where the functionality was accurate and in use.
	 *
	 * @deprecated It is deprecated and modern browsers return true in all cases.
	 *
	 * @param {string} feature
	 * @param {string} [version]
	 * @returns {boolean} always true
	 *
	 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/hasFeature MDN
	 * @see https://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-5CED94D7 DOM Level 1 Core
	 * @see https://dom.spec.whatwg.org/#dom-domimplementation-hasfeature DOM Living Standard
	 */
	hasFeature: function(feature, version) {
			return true;
	},
	/**
	 * Creates an XML Document object of the specified type with its document element.
	 *
	 * __It behaves slightly different from the description in the living standard__:
	 * - There is no interface/class `XMLDocument`, it returns a `Document` instance.
	 * - `contentType`, `encoding`, `mode`, `origin`, `url` fields are currently not declared.
	 * - this implementation is not validating names or qualified names
	 *   (when parsing XML strings, the SAX parser takes care of that)
	 *
	 * @param {string|null} namespaceURI
	 * @param {string} qualifiedName
	 * @param {DocumentType=null} doctype
	 * @returns {Document}
	 *
	 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/createDocument MDN
	 * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#Level-2-Core-DOM-createDocument DOM Level 2 Core (initial)
	 * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocument  DOM Level 2 Core
	 *
	 * @see https://dom.spec.whatwg.org/#validate-and-extract DOM: Validate and extract
	 * @see https://www.w3.org/TR/xml/#NT-NameStartChar XML Spec: Names
	 * @see https://www.w3.org/TR/xml-names/#ns-qualnames XML Namespaces: Qualified names
	 */
	createDocument: function(namespaceURI,  qualifiedName, doctype){
		var doc = new Document();
		doc.implementation = this;
		doc.childNodes = new NodeList();
		doc.doctype = doctype || null;
		if (doctype){
			doc.appendChild(doctype);
		}
		if (qualifiedName){
			var root = doc.createElementNS(namespaceURI, qualifiedName);
			doc.appendChild(root);
		}
		return doc;
	},
	/**
	 * Returns a doctype, with the given `qualifiedName`, `publicId`, and `systemId`.
	 *
	 * __This behavior is slightly different from the in the specs__:
	 * - this implementation is not validating names or qualified names
	 *   (when parsing XML strings, the SAX parser takes care of that)
	 *
	 * @param {string} qualifiedName
	 * @param {string} [publicId]
	 * @param {string} [systemId]
	 * @returns {DocumentType} which can either be used with `DOMImplementation.createDocument` upon document creation
	 * 				  or can be put into the document via methods like `Node.insertBefore()` or `Node.replaceChild()`
	 *
	 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/createDocumentType MDN
	 * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#Level-2-Core-DOM-createDocType DOM Level 2 Core
	 * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocumenttype DOM Living Standard
	 *
	 * @see https://dom.spec.whatwg.org/#validate-and-extract DOM: Validate and extract
	 * @see https://www.w3.org/TR/xml/#NT-NameStartChar XML Spec: Names
	 * @see https://www.w3.org/TR/xml-names/#ns-qualnames XML Namespaces: Qualified names
	 */
	createDocumentType: function(qualifiedName, publicId, systemId){
		var node = new DocumentType();
		node.name = qualifiedName;
		node.nodeName = qualifiedName;
		node.publicId = publicId || '';
		node.systemId = systemId || '';

		return node;
	}
};


/**
 * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-1950641247
 */

function Node() {
};

Node.prototype = {
	firstChild : null,
	lastChild : null,
	previousSibling : null,
	nextSibling : null,
	attributes : null,
	parentNode : null,
	childNodes : null,
	ownerDocument : null,
	nodeValue : null,
	namespaceURI : null,
	prefix : null,
	localName : null,
	// Modified in DOM Level 2:
	insertBefore:function(newChild, refChild){//raises 
		return _insertBefore(this,newChild,refChild);
	},
	replaceChild:function(newChild, oldChild){//raises 
		this.insertBefore(newChild,oldChild);
		if(oldChild){
			this.removeChild(oldChild);
		}
	},
	removeChild:function(oldChild){
		return _removeChild(this,oldChild);
	},
	appendChild:function(newChild){
		return this.insertBefore(newChild,null);
	},
	hasChildNodes:function(){
		return this.firstChild != null;
	},
	cloneNode:function(deep){
		return cloneNode(this.ownerDocument||this,this,deep);
	},
	// Modified in DOM Level 2:
	normalize:function(){
		var child = this.firstChild;
		while(child){
			var next = child.nextSibling;
			if(next && next.nodeType == TEXT_NODE && child.nodeType == TEXT_NODE){
				this.removeChild(next);
				child.appendData(next.data);
			}else{
				child.normalize();
				child = next;
			}
		}
	},
  	// Introduced in DOM Level 2:
	isSupported:function(feature, version){
		return this.ownerDocument.implementation.hasFeature(feature,version);
	},
    // Introduced in DOM Level 2:
    hasAttributes:function(){
    	return this.attributes.length>0;
    },
	/**
	 * Look up the prefix associated to the given namespace URI, starting from this node.
	 * **The default namespace declarations are ignored by this method.**
	 * See Namespace Prefix Lookup for details on the algorithm used by this method.
	 *
	 * _Note: The implementation seems to be incomplete when compared to the algorithm described in the specs._
	 *
	 * @param {string | null} namespaceURI
	 * @returns {string | null}
	 * @see https://www.w3.org/TR/DOM-Level-3-Core/core.html#Node3-lookupNamespacePrefix
	 * @see https://www.w3.org/TR/DOM-Level-3-Core/namespaces-algorithms.html#lookupNamespacePrefixAlgo
	 * @see https://dom.spec.whatwg.org/#dom-node-lookupprefix
	 * @see https://github.com/xmldom/xmldom/issues/322
	 */
    lookupPrefix:function(namespaceURI){
    	var el = this;
    	while(el){
    		var map = el._nsMap;
    		//console.dir(map)
    		if(map){
    			for(var n in map){
    				if(map[n] == namespaceURI){
    					return n;
    				}
    			}
    		}
    		el = el.nodeType == ATTRIBUTE_NODE?el.ownerDocument : el.parentNode;
    	}
    	return null;
    },
    // Introduced in DOM Level 3:
    lookupNamespaceURI:function(prefix){
    	var el = this;
    	while(el){
    		var map = el._nsMap;
    		//console.dir(map)
    		if(map){
    			if(prefix in map){
    				return map[prefix] ;
    			}
    		}
    		el = el.nodeType == ATTRIBUTE_NODE?el.ownerDocument : el.parentNode;
    	}
    	return null;
    },
    // Introduced in DOM Level 3:
    isDefaultNamespace:function(namespaceURI){
    	var prefix = this.lookupPrefix(namespaceURI);
    	return prefix == null;
    }
};


function _xmlEncoder(c){
	return c == '<' && '&lt;' ||
         c == '>' && '&gt;' ||
         c == '&' && '&amp;' ||
         c == '"' && '&quot;' ||
         '&#'+c.charCodeAt()+';'
}


copy(NodeType,Node);
copy(NodeType,Node.prototype);

/**
 * @param callback return true for continue,false for break
 * @return boolean true: break visit;
 */
function _visitNode(node,callback){
	if(callback(node)){
		return true;
	}
	if(node = node.firstChild){
		do{
			if(_visitNode(node,callback)){return true}
        }while(node=node.nextSibling)
    }
}



function Document(){
}

function _onAddAttribute(doc,el,newAttr){
	doc && doc._inc++;
	var ns = newAttr.namespaceURI ;
	if(ns === NAMESPACE.XMLNS){
		//update namespace
		el._nsMap[newAttr.prefix?newAttr.localName:''] = newAttr.value
	}
}

function _onRemoveAttribute(doc,el,newAttr,remove){
	doc && doc._inc++;
	var ns = newAttr.namespaceURI ;
	if(ns === NAMESPACE.XMLNS){
		//update namespace
		delete el._nsMap[newAttr.prefix?newAttr.localName:'']
	}
}

/**
 * Updates `el.childNodes`, updating the indexed items and it's `length`.
 * Passing `newChild` means it will be appended.
 * Otherwise it's assumed that an item has been removed,
 * and `el.firstNode` and it's `.nextSibling` are used
 * to walk the current list of child nodes.
 *
 * @param {Document} doc
 * @param {Node} el
 * @param {Node} [newChild]
 * @private
 */
function _onUpdateChild (doc, el, newChild) {
	if(doc && doc._inc){
		doc._inc++;
		//update childNodes
		var cs = el.childNodes;
		if (newChild) {
			cs[cs.length++] = newChild;
		} else {
			var child = el.firstChild;
			var i = 0;
			while (child) {
				cs[i++] = child;
				child = child.nextSibling;
			}
			cs.length = i;
			delete cs[cs.length];
		}
	}
}

/**
 * Removes the connections between `parentNode` and `child`
 * and any existing `child.previousSibling` or `child.nextSibling`.
 *
 * @see https://github.com/xmldom/xmldom/issues/135
 * @see https://github.com/xmldom/xmldom/issues/145
 *
 * @param {Node} parentNode
 * @param {Node} child
 * @returns {Node} the child that was removed.
 * @private
 */
function _removeChild (parentNode, child) {
	var previous = child.previousSibling;
	var next = child.nextSibling;
	if (previous) {
		previous.nextSibling = next;
	} else {
		parentNode.firstChild = next;
	}
	if (next) {
		next.previousSibling = previous;
	} else {
		parentNode.lastChild = previous;
	}
	child.parentNode = null;
	child.previousSibling = null;
	child.nextSibling = null;
	_onUpdateChild(parentNode.ownerDocument, parentNode);
	return child;
}
/**
 * preformance key(refChild == null)
 */
function _insertBefore(parentNode,newChild,nextChild){
	var cp = newChild.parentNode;
	if(cp){
		cp.removeChild(newChild);//remove and update
	}
	if(newChild.nodeType === DOCUMENT_FRAGMENT_NODE){
		var newFirst = newChild.firstChild;
		if (newFirst == null) {
			return newChild;
		}
		var newLast = newChild.lastChild;
	}else{
		newFirst = newLast = newChild;
	}
	var pre = nextChild ? nextChild.previousSibling : parentNode.lastChild;

	newFirst.previousSibling = pre;
	newLast.nextSibling = nextChild;
	
	
	if(pre){
		pre.nextSibling = newFirst;
	}else{
		parentNode.firstChild = newFirst;
	}
	if(nextChild == null){
		parentNode.lastChild = newLast;
	}else{
		nextChild.previousSibling = newLast;
	}
	do{
		newFirst.parentNode = parentNode;
	}while(newFirst !== newLast && (newFirst= newFirst.nextSibling))
	_onUpdateChild(parentNode.ownerDocument||parentNode,parentNode);
	//console.log(parentNode.lastChild.nextSibling == null)
	if (newChild.nodeType == DOCUMENT_FRAGMENT_NODE) {
		newChild.firstChild = newChild.lastChild = null;
	}
	return newChild;
}

/**
 * Appends `newChild` to `parentNode`.
 * If `newChild` is already connected to a `parentNode` it is first removed from it.
 *
 * @see https://github.com/xmldom/xmldom/issues/135
 * @see https://github.com/xmldom/xmldom/issues/145
 * @param {Node} parentNode
 * @param {Node} newChild
 * @returns {Node}
 * @private
 */
function _appendSingleChild (parentNode, newChild) {
	if (newChild.parentNode) {
		newChild.parentNode.removeChild(newChild);
	}
	newChild.parentNode = parentNode;
	newChild.previousSibling = parentNode.lastChild;
	newChild.nextSibling = null;
	if (newChild.previousSibling) {
		newChild.previousSibling.nextSibling = newChild;
	} else {
		parentNode.firstChild = newChild;
	}
	parentNode.lastChild = newChild;
	_onUpdateChild(parentNode.ownerDocument, parentNode, newChild);
	return newChild;
}

Document.prototype = {
	//implementation : null,
	nodeName :  '#document',
	nodeType :  DOCUMENT_NODE,
	/**
	 * The DocumentType node of the document.
	 *
	 * @readonly
	 * @type DocumentType
	 */
	doctype :  null,
	documentElement :  null,
	_inc : 1,

	insertBefore :  function(newChild, refChild){//raises
		if(newChild.nodeType == DOCUMENT_FRAGMENT_NODE){
			var child = newChild.firstChild;
			while(child){
				var next = child.nextSibling;
				this.insertBefore(child,refChild);
				child = next;
			}
			return newChild;
		}
		if(this.documentElement == null && newChild.nodeType == ELEMENT_NODE){
			this.documentElement = newChild;
		}

		return _insertBefore(this,newChild,refChild),(newChild.ownerDocument = this),newChild;
	},
	removeChild :  function(oldChild){
		if(this.documentElement == oldChild){
			this.documentElement = null;
		}
		return _removeChild(this,oldChild);
	},
	// Introduced in DOM Level 2:
	importNode : function(importedNode,deep){
		return importNode(this,importedNode,deep);
	},
	// Introduced in DOM Level 2:
	getElementById :	function(id){
		var rtv = null;
		_visitNode(this.documentElement,function(node){
			if(node.nodeType == ELEMENT_NODE){
				if(node.getAttribute('id') == id){
					rtv = node;
					return true;
				}
			}
		})
		return rtv;
	},

	/**
	 * The `getElementsByClassName` method of `Document` interface returns an array-like object
	 * of all child elements which have **all** of the given class name(s).
	 *
	 * Returns an empty list if `classeNames` is an empty string or only contains HTML white space characters.
	 *
	 *
	 * Warning: This is a live LiveNodeList.
	 * Changes in the DOM will reflect in the array as the changes occur.
	 * If an element selected by this array no longer qualifies for the selector,
	 * it will automatically be removed. Be aware of this for iteration purposes.
	 *
	 * @param {string} classNames is a string representing the class name(s) to match; multiple class names are separated by (ASCII-)whitespace
	 *
	 * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementsByClassName
	 * @see https://dom.spec.whatwg.org/#concept-getelementsbyclassname
	 */
	getElementsByClassName: function(classNames) {
		var classNamesSet = toOrderedSet(classNames)
		return new LiveNodeList(this, function(base) {
			var ls = [];
			if (classNamesSet.length > 0) {
				_visitNode(base.documentElement, function(node) {
					if(node !== base && node.nodeType === ELEMENT_NODE) {
						var nodeClassNames = node.getAttribute('class')
						// can be null if the attribute does not exist
						if (nodeClassNames) {
							// before splitting and iterating just compare them for the most common case
							var matches = classNames === nodeClassNames;
							if (!matches) {
								var nodeClassNamesSet = toOrderedSet(nodeClassNames)
								matches = classNamesSet.every(arrayIncludes(nodeClassNamesSet))
							}
							if(matches) {
								ls.push(node);
							}
						}
					}
				});
			}
			return ls;
		});
	},

	//document factory method:
	createElement :	function(tagName){
		var node = new Element();
		node.ownerDocument = this;
		node.nodeName = tagName;
		node.tagName = tagName;
		node.localName = tagName;
		node.childNodes = new NodeList();
		var attrs	= node.attributes = new NamedNodeMap();
		attrs._ownerElement = node;
		return node;
	},
	createDocumentFragment :	function(){
		var node = new DocumentFragment();
		node.ownerDocument = this;
		node.childNodes = new NodeList();
		return node;
	},
	createTextNode :	function(data){
		var node = new Text();
		node.ownerDocument = this;
		node.appendData(data)
		return node;
	},
	createComment :	function(data){
		var node = new Comment();
		node.ownerDocument = this;
		node.appendData(data)
		return node;
	},
	createCDATASection :	function(data){
		var node = new CDATASection();
		node.ownerDocument = this;
		node.appendData(data)
		return node;
	},
	createProcessingInstruction :	function(target,data){
		var node = new ProcessingInstruction();
		node.ownerDocument = this;
		node.tagName = node.target = target;
		node.nodeValue= node.data = data;
		return node;
	},
	createAttribute :	function(name){
		var node = new Attr();
		node.ownerDocument	= this;
		node.name = name;
		node.nodeName	= name;
		node.localName = name;
		node.specified = true;
		return node;
	},
	createEntityReference :	function(name){
		var node = new EntityReference();
		node.ownerDocument	= this;
		node.nodeName	= name;
		return node;
	},
	// Introduced in DOM Level 2:
	createElementNS :	function(namespaceURI,qualifiedName){
		var node = new Element();
		var pl = qualifiedName.split(':');
		var attrs	= node.attributes = new NamedNodeMap();
		node.childNodes = new NodeList();
		node.ownerDocument = this;
		node.nodeName = qualifiedName;
		node.tagName = qualifiedName;
		node.namespaceURI = namespaceURI;
		if(pl.length == 2){
			node.prefix = pl[0];
			node.localName = pl[1];
		}else{
			//el.prefix = null;
			node.localName = qualifiedName;
		}
		attrs._ownerElement = node;
		return node;
	},
	// Introduced in DOM Level 2:
	createAttributeNS :	function(namespaceURI,qualifiedName){
		var node = new Attr();
		var pl = qualifiedName.split(':');
		node.ownerDocument = this;
		node.nodeName = qualifiedName;
		node.name = qualifiedName;
		node.namespaceURI = namespaceURI;
		node.specified = true;
		if(pl.length == 2){
			node.prefix = pl[0];
			node.localName = pl[1];
		}else{
			//el.prefix = null;
			node.localName = qualifiedName;
		}
		return node;
	}
};
_extends(Document,Node);


function Element() {
	this._nsMap = {};
};
Element.prototype = {
	nodeType : ELEMENT_NODE,
	hasAttribute : function(name){
		return this.getAttributeNode(name)!=null;
	},
	getAttribute : function(name){
		var attr = this.getAttributeNode(name);
		return attr && attr.value || '';
	},
	getAttributeNode : function(name){
		return this.attributes.getNamedItem(name);
	},
	setAttribute : function(name, value){
		var attr = this.ownerDocument.createAttribute(name);
		attr.value = attr.nodeValue = "" + value;
		this.setAttributeNode(attr)
	},
	removeAttribute : function(name){
		var attr = this.getAttributeNode(name)
		attr && this.removeAttributeNode(attr);
	},
	
	//four real opeartion method
	appendChild:function(newChild){
		if(newChild.nodeType === DOCUMENT_FRAGMENT_NODE){
			return this.insertBefore(newChild,null);
		}else{
			return _appendSingleChild(this,newChild);
		}
	},
	setAttributeNode : function(newAttr){
		return this.attributes.setNamedItem(newAttr);
	},
	setAttributeNodeNS : function(newAttr){
		return this.attributes.setNamedItemNS(newAttr);
	},
	removeAttributeNode : function(oldAttr){
		//console.log(this == oldAttr.ownerElement)
		return this.attributes.removeNamedItem(oldAttr.nodeName);
	},
	//get real attribute name,and remove it by removeAttributeNode
	removeAttributeNS : function(namespaceURI, localName){
		var old = this.getAttributeNodeNS(namespaceURI, localName);
		old && this.removeAttributeNode(old);
	},
	
	hasAttributeNS : function(namespaceURI, localName){
		return this.getAttributeNodeNS(namespaceURI, localName)!=null;
	},
	getAttributeNS : function(namespaceURI, localName){
		var attr = this.getAttributeNodeNS(namespaceURI, localName);
		return attr && attr.value || '';
	},
	setAttributeNS : function(namespaceURI, qualifiedName, value){
		var attr = this.ownerDocument.createAttributeNS(namespaceURI, qualifiedName);
		attr.value = attr.nodeValue = "" + value;
		this.setAttributeNode(attr)
	},
	getAttributeNodeNS : function(namespaceURI, localName){
		return this.attributes.getNamedItemNS(namespaceURI, localName);
	},
	
	getElementsByTagName : function(tagName){
		return new LiveNodeList(this,function(base){
			var ls = [];
			_visitNode(base,function(node){
				if(node !== base && node.nodeType == ELEMENT_NODE && (tagName === '*' || node.tagName == tagName)){
					ls.push(node);
				}
			});
			return ls;
		});
	},
	getElementsByTagNameNS : function(namespaceURI, localName){
		return new LiveNodeList(this,function(base){
			var ls = [];
			_visitNode(base,function(node){
				if(node !== base && node.nodeType === ELEMENT_NODE && (namespaceURI === '*' || node.namespaceURI === namespaceURI) && (localName === '*' || node.localName == localName)){
					ls.push(node);
				}
			});
			return ls;
			
		});
	}
};
Document.prototype.getElementsByTagName = Element.prototype.getElementsByTagName;
Document.prototype.getElementsByTagNameNS = Element.prototype.getElementsByTagNameNS;


_extends(Element,Node);
function Attr() {
};
Attr.prototype.nodeType = ATTRIBUTE_NODE;
_extends(Attr,Node);


function CharacterData() {
};
CharacterData.prototype = {
	data : '',
	substringData : function(offset, count) {
		return this.data.substring(offset, offset+count);
	},
	appendData: function(text) {
		text = this.data+text;
		this.nodeValue = this.data = text;
		this.length = text.length;
	},
	insertData: function(offset,text) {
		this.replaceData(offset,0,text);
	
	},
	appendChild:function(newChild){
		throw new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR])
	},
	deleteData: function(offset, count) {
		this.replaceData(offset,count,"");
	},
	replaceData: function(offset, count, text) {
		var start = this.data.substring(0,offset);
		var end = this.data.substring(offset+count);
		text = start + text + end;
		this.nodeValue = this.data = text;
		this.length = text.length;
	}
}
_extends(CharacterData,Node);
function Text() {
};
Text.prototype = {
	nodeName : "#text",
	nodeType : TEXT_NODE,
	splitText : function(offset) {
		var text = this.data;
		var newText = text.substring(offset);
		text = text.substring(0, offset);
		this.data = this.nodeValue = text;
		this.length = text.length;
		var newNode = this.ownerDocument.createTextNode(newText);
		if(this.parentNode){
			this.parentNode.insertBefore(newNode, this.nextSibling);
		}
		return newNode;
	}
}
_extends(Text,CharacterData);
function Comment() {
};
Comment.prototype = {
	nodeName : "#comment",
	nodeType : COMMENT_NODE
}
_extends(Comment,CharacterData);

function CDATASection() {
};
CDATASection.prototype = {
	nodeName : "#cdata-section",
	nodeType : CDATA_SECTION_NODE
}
_extends(CDATASection,CharacterData);


function DocumentType() {
};
DocumentType.prototype.nodeType = DOCUMENT_TYPE_NODE;
_extends(DocumentType,Node);

function Notation() {
};
Notation.prototype.nodeType = NOTATION_NODE;
_extends(Notation,Node);

function Entity() {
};
Entity.prototype.nodeType = ENTITY_NODE;
_extends(Entity,Node);

function EntityReference() {
};
EntityReference.prototype.nodeType = ENTITY_REFERENCE_NODE;
_extends(EntityReference,Node);

function DocumentFragment() {
};
DocumentFragment.prototype.nodeName =	"#document-fragment";
DocumentFragment.prototype.nodeType =	DOCUMENT_FRAGMENT_NODE;
_extends(DocumentFragment,Node);


function ProcessingInstruction() {
}
ProcessingInstruction.prototype.nodeType = PROCESSING_INSTRUCTION_NODE;
_extends(ProcessingInstruction,Node);
function XMLSerializer(){}
XMLSerializer.prototype.serializeToString = function(node,isHtml,nodeFilter){
	return nodeSerializeToString.call(node,isHtml,nodeFilter);
}
Node.prototype.toString = nodeSerializeToString;
function nodeSerializeToString(isHtml,nodeFilter){
	var buf = [];
	var refNode = this.nodeType == 9 && this.documentElement || this;
	var prefix = refNode.prefix;
	var uri = refNode.namespaceURI;
	
	if(uri && prefix == null){
		//console.log(prefix)
		var prefix = refNode.lookupPrefix(uri);
		if(prefix == null){
			//isHTML = true;
			var visibleNamespaces=[
			{namespace:uri,prefix:null}
			//{namespace:uri,prefix:''}
			]
		}
	}
	serializeToString(this,buf,isHtml,nodeFilter,visibleNamespaces);
	//console.log('###',this.nodeType,uri,prefix,buf.join(''))
	return buf.join('');
}

function needNamespaceDefine(node, isHTML, visibleNamespaces) {
	var prefix = node.prefix || '';
	var uri = node.namespaceURI;
	// According to [Namespaces in XML 1.0](https://www.w3.org/TR/REC-xml-names/#ns-using) ,
	// and more specifically https://www.w3.org/TR/REC-xml-names/#nsc-NoPrefixUndecl :
	// > In a namespace declaration for a prefix [...], the attribute value MUST NOT be empty.
	// in a similar manner [Namespaces in XML 1.1](https://www.w3.org/TR/xml-names11/#ns-using)
	// and more specifically https://www.w3.org/TR/xml-names11/#nsc-NSDeclared :
	// > [...] Furthermore, the attribute value [...] must not be an empty string.
	// so serializing empty namespace value like xmlns:ds="" would produce an invalid XML document.
	if (!uri) {
		return false;
	}
	if (prefix === "xml" && uri === NAMESPACE.XML || uri === NAMESPACE.XMLNS) {
		return false;
	}
	
	var i = visibleNamespaces.length 
	while (i--) {
		var ns = visibleNamespaces[i];
		// get namespace prefix
		if (ns.prefix === prefix) {
			return ns.namespace !== uri;
		}
	}
	return true;
}
/**
 * Well-formed constraint: No < in Attribute Values
 * > The replacement text of any entity referred to directly or indirectly
 * > in an attribute value must not contain a <.
 * @see https://www.w3.org/TR/xml11/#CleanAttrVals
 * @see https://www.w3.org/TR/xml11/#NT-AttValue
 *
 * Literal whitespace other than space that appear in attribute values
 * are serialized as their entity references, so they will be preserved.
 * (In contrast to whitespace literals in the input which are normalized to spaces)
 * @see https://www.w3.org/TR/xml11/#AVNormalize
 * @see https://w3c.github.io/DOM-Parsing/#serializing-an-element-s-attributes
 */
function addSerializedAttribute(buf, qualifiedName, value) {
	buf.push(' ', qualifiedName, '="', value.replace(/[<>&"\t\n\r]/g, _xmlEncoder), '"')
}

function serializeToString(node,buf,isHTML,nodeFilter,visibleNamespaces){
	if (!visibleNamespaces) {
		visibleNamespaces = [];
	}

	if(nodeFilter){
		node = nodeFilter(node);
		if(node){
			if(typeof node == 'string'){
				buf.push(node);
				return;
			}
		}else{
			return;
		}
		//buf.sort.apply(attrs, attributeSorter);
	}

	switch(node.nodeType){
	case ELEMENT_NODE:
		var attrs = node.attributes;
		var len = attrs.length;
		var child = node.firstChild;
		var nodeName = node.tagName;
		
		isHTML = NAMESPACE.isHTML(node.namespaceURI) || isHTML

		var prefixedNodeName = nodeName
		if (!isHTML && !node.prefix && node.namespaceURI) {
			var defaultNS
			// lookup current default ns from `xmlns` attribute
			for (var ai = 0; ai < attrs.length; ai++) {
				if (attrs.item(ai).name === 'xmlns') {
					defaultNS = attrs.item(ai).value
					break
				}
			}
			if (!defaultNS) {
				// lookup current default ns in visibleNamespaces
				for (var nsi = visibleNamespaces.length - 1; nsi >= 0; nsi--) {
					var namespace = visibleNamespaces[nsi]
					if (namespace.prefix === '' && namespace.namespace === node.namespaceURI) {
						defaultNS = namespace.namespace
						break
					}
				}
			}
			if (defaultNS !== node.namespaceURI) {
				for (var nsi = visibleNamespaces.length - 1; nsi >= 0; nsi--) {
					var namespace = visibleNamespaces[nsi]
					if (namespace.namespace === node.namespaceURI) {
						if (namespace.prefix) {
							prefixedNodeName = namespace.prefix + ':' + nodeName
						}
						break
					}
				}
			}
		}

		buf.push('<', prefixedNodeName);

		for(var i=0;i<len;i++){
			// add namespaces for attributes
			var attr = attrs.item(i);
			if (attr.prefix == 'xmlns') {
				visibleNamespaces.push({ prefix: attr.localName, namespace: attr.value });
			}else if(attr.nodeName == 'xmlns'){
				visibleNamespaces.push({ prefix: '', namespace: attr.value });
			}
		}

		for(var i=0;i<len;i++){
			var attr = attrs.item(i);
			if (needNamespaceDefine(attr,isHTML, visibleNamespaces)) {
				var prefix = attr.prefix||'';
				var uri = attr.namespaceURI;
				addSerializedAttribute(buf, prefix ? 'xmlns:' + prefix : "xmlns", uri);
				visibleNamespaces.push({ prefix: prefix, namespace:uri });
			}
			serializeToString(attr,buf,isHTML,nodeFilter,visibleNamespaces);
		}

		// add namespace for current node		
		if (nodeName === prefixedNodeName && needNamespaceDefine(node, isHTML, visibleNamespaces)) {
			var prefix = node.prefix||'';
			var uri = node.namespaceURI;
			addSerializedAttribute(buf, prefix ? 'xmlns:' + prefix : "xmlns", uri);
			visibleNamespaces.push({ prefix: prefix, namespace:uri });
		}
		
		if(child || isHTML && !/^(?:meta|link|img|br|hr|input)$/i.test(nodeName)){
			buf.push('>');
			//if is cdata child node
			if(isHTML && /^script$/i.test(nodeName)){
				while(child){
					if(child.data){
						buf.push(child.data);
					}else{
						serializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());
					}
					child = child.nextSibling;
				}
			}else
			{
				while(child){
					serializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());
					child = child.nextSibling;
				}
			}
			buf.push('</',prefixedNodeName,'>');
		}else{
			buf.push('/>');
		}
		// remove added visible namespaces
		//visibleNamespaces.length = startVisibleNamespaces;
		return;
	case DOCUMENT_NODE:
	case DOCUMENT_FRAGMENT_NODE:
		var child = node.firstChild;
		while(child){
			serializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());
			child = child.nextSibling;
		}
		return;
	case ATTRIBUTE_NODE:
		return addSerializedAttribute(buf, node.name, node.value);
	case TEXT_NODE:
		/**
		 * The ampersand character (&) and the left angle bracket (<) must not appear in their literal form,
		 * except when used as markup delimiters, or within a comment, a processing instruction, or a CDATA section.
		 * If they are needed elsewhere, they must be escaped using either numeric character references or the strings
		 * `&amp;` and `&lt;` respectively.
		 * The right angle bracket (>) may be represented using the string " &gt; ", and must, for compatibility,
		 * be escaped using either `&gt;` or a character reference when it appears in the string `]]>` in content,
		 * when that string is not marking the end of a CDATA section.
		 *
		 * In the content of elements, character data is any string of characters
		 * which does not contain the start-delimiter of any markup
		 * and does not include the CDATA-section-close delimiter, `]]>`.
		 *
		 * @see https://www.w3.org/TR/xml/#NT-CharData
		 * @see https://w3c.github.io/DOM-Parsing/#xml-serializing-a-text-node
		 */
		return buf.push(node.data
			.replace(/[<&>]/g,_xmlEncoder)
		);
	case CDATA_SECTION_NODE:
		return buf.push( '<![CDATA[',node.data,']]>');
	case COMMENT_NODE:
		return buf.push( "<!--",node.data,"-->");
	case DOCUMENT_TYPE_NODE:
		var pubid = node.publicId;
		var sysid = node.systemId;
		buf.push('<!DOCTYPE ',node.name);
		if(pubid){
			buf.push(' PUBLIC ', pubid);
			if (sysid && sysid!='.') {
				buf.push(' ', sysid);
			}
			buf.push('>');
		}else if(sysid && sysid!='.'){
			buf.push(' SYSTEM ', sysid, '>');
		}else{
			var sub = node.internalSubset;
			if(sub){
				buf.push(" [",sub,"]");
			}
			buf.push(">");
		}
		return;
	case PROCESSING_INSTRUCTION_NODE:
		return buf.push( "<?",node.target," ",node.data,"?>");
	case ENTITY_REFERENCE_NODE:
		return buf.push( '&',node.nodeName,';');
	//case ENTITY_NODE:
	//case NOTATION_NODE:
	default:
		buf.push('??',node.nodeName);
	}
}
function importNode(doc,node,deep){
	var node2;
	switch (node.nodeType) {
	case ELEMENT_NODE:
		node2 = node.cloneNode(false);
		node2.ownerDocument = doc;
		//var attrs = node2.attributes;
		//var len = attrs.length;
		//for(var i=0;i<len;i++){
			//node2.setAttributeNodeNS(importNode(doc,attrs.item(i),deep));
		//}
	case DOCUMENT_FRAGMENT_NODE:
		break;
	case ATTRIBUTE_NODE:
		deep = true;
		break;
	//case ENTITY_REFERENCE_NODE:
	//case PROCESSING_INSTRUCTION_NODE:
	////case TEXT_NODE:
	//case CDATA_SECTION_NODE:
	//case COMMENT_NODE:
	//	deep = false;
	//	break;
	//case DOCUMENT_NODE:
	//case DOCUMENT_TYPE_NODE:
	//cannot be imported.
	//case ENTITY_NODE:
	//case NOTATION_NODE：
	//can not hit in level3
	//default:throw e;
	}
	if(!node2){
		node2 = node.cloneNode(false);//false
	}
	node2.ownerDocument = doc;
	node2.parentNode = null;
	if(deep){
		var child = node.firstChild;
		while(child){
			node2.appendChild(importNode(doc,child,deep));
			child = child.nextSibling;
		}
	}
	return node2;
}
//
//var _relationMap = {firstChild:1,lastChild:1,previousSibling:1,nextSibling:1,
//					attributes:1,childNodes:1,parentNode:1,documentElement:1,doctype,};
function cloneNode(doc,node,deep){
	var node2 = new node.constructor();
	for(var n in node){
		var v = node[n];
		if(typeof v != 'object' ){
			if(v != node2[n]){
				node2[n] = v;
			}
		}
	}
	if(node.childNodes){
		node2.childNodes = new NodeList();
	}
	node2.ownerDocument = doc;
	switch (node2.nodeType) {
	case ELEMENT_NODE:
		var attrs	= node.attributes;
		var attrs2	= node2.attributes = new NamedNodeMap();
		var len = attrs.length
		attrs2._ownerElement = node2;
		for(var i=0;i<len;i++){
			node2.setAttributeNode(cloneNode(doc,attrs.item(i),true));
		}
		break;;
	case ATTRIBUTE_NODE:
		deep = true;
	}
	if(deep){
		var child = node.firstChild;
		while(child){
			node2.appendChild(cloneNode(doc,child,deep));
			child = child.nextSibling;
		}
	}
	return node2;
}

function __set__(object,key,value){
	object[key] = value
}
//do dynamic
try{
	if(Object.defineProperty){
		Object.defineProperty(LiveNodeList.prototype,'length',{
			get:function(){
				_updateLiveList(this);
				return this.$$length;
			}
		});

		Object.defineProperty(Node.prototype,'textContent',{
			get:function(){
				return getTextContent(this);
			},

			set:function(data){
				switch(this.nodeType){
				case ELEMENT_NODE:
				case DOCUMENT_FRAGMENT_NODE:
					while(this.firstChild){
						this.removeChild(this.firstChild);
					}
					if(data || String(data)){
						this.appendChild(this.ownerDocument.createTextNode(data));
					}
					break;

				default:
					this.data = data;
					this.value = data;
					this.nodeValue = data;
				}
			}
		})
		
		function getTextContent(node){
			switch(node.nodeType){
			case ELEMENT_NODE:
			case DOCUMENT_FRAGMENT_NODE:
				var buf = [];
				node = node.firstChild;
				while(node){
					if(node.nodeType!==7 && node.nodeType !==8){
						buf.push(getTextContent(node));
					}
					node = node.nextSibling;
				}
				return buf.join('');
			default:
				return node.nodeValue;
			}
		}

		__set__ = function(object,key,value){
			//console.log(value)
			object['$$'+key] = value
		}
	}
}catch(e){//ie8
}

//if(typeof require == 'function'){
	exports.DocumentType = DocumentType;
	exports.DOMException = DOMException;
	exports.DOMImplementation = DOMImplementation;
	exports.Element = Element;
	exports.Node = Node;
	exports.NodeList = NodeList;
	exports.XMLSerializer = XMLSerializer;
//}


/***/ }),

/***/ "./node_modules/@xmldom/xmldom/lib/entities.js":
/*!*****************************************************!*\
  !*** ./node_modules/@xmldom/xmldom/lib/entities.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var freeze = __webpack_require__(/*! ./conventions */ "./node_modules/@xmldom/xmldom/lib/conventions.js").freeze;

/**
 * The entities that are predefined in every XML document.
 *
 * @see https://www.w3.org/TR/2006/REC-xml11-20060816/#sec-predefined-ent W3C XML 1.1
 * @see https://www.w3.org/TR/2008/REC-xml-20081126/#sec-predefined-ent W3C XML 1.0
 * @see https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references#Predefined_entities_in_XML Wikipedia
 */
exports.XML_ENTITIES = freeze({amp:'&', apos:"'", gt:'>', lt:'<', quot:'"'})

/**
 * A map of currently 241 entities that are detected in an HTML document.
 * They contain all entries from `XML_ENTITIES`.
 *
 * @see XML_ENTITIES
 * @see DOMParser.parseFromString
 * @see DOMImplementation.prototype.createHTMLDocument
 * @see https://html.spec.whatwg.org/#named-character-references WHATWG HTML(5) Spec
 * @see https://www.w3.org/TR/xml-entity-names/ W3C XML Entity Names
 * @see https://www.w3.org/TR/html4/sgml/entities.html W3C HTML4/SGML
 * @see https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references#Character_entity_references_in_HTML Wikipedia (HTML)
 * @see https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references#Entities_representing_special_characters_in_XHTML Wikpedia (XHTML)
 */
exports.HTML_ENTITIES = freeze({
       lt: '<',
       gt: '>',
       amp: '&',
       quot: '"',
       apos: "'",
       Agrave: "À",
       Aacute: "Á",
       Acirc: "Â",
       Atilde: "Ã",
       Auml: "Ä",
       Aring: "Å",
       AElig: "Æ",
       Ccedil: "Ç",
       Egrave: "È",
       Eacute: "É",
       Ecirc: "Ê",
       Euml: "Ë",
       Igrave: "Ì",
       Iacute: "Í",
       Icirc: "Î",
       Iuml: "Ï",
       ETH: "Ð",
       Ntilde: "Ñ",
       Ograve: "Ò",
       Oacute: "Ó",
       Ocirc: "Ô",
       Otilde: "Õ",
       Ouml: "Ö",
       Oslash: "Ø",
       Ugrave: "Ù",
       Uacute: "Ú",
       Ucirc: "Û",
       Uuml: "Ü",
       Yacute: "Ý",
       THORN: "Þ",
       szlig: "ß",
       agrave: "à",
       aacute: "á",
       acirc: "â",
       atilde: "ã",
       auml: "ä",
       aring: "å",
       aelig: "æ",
       ccedil: "ç",
       egrave: "è",
       eacute: "é",
       ecirc: "ê",
       euml: "ë",
       igrave: "ì",
       iacute: "í",
       icirc: "î",
       iuml: "ï",
       eth: "ð",
       ntilde: "ñ",
       ograve: "ò",
       oacute: "ó",
       ocirc: "ô",
       otilde: "õ",
       ouml: "ö",
       oslash: "ø",
       ugrave: "ù",
       uacute: "ú",
       ucirc: "û",
       uuml: "ü",
       yacute: "ý",
       thorn: "þ",
       yuml: "ÿ",
       nbsp: "\u00a0",
       iexcl: "¡",
       cent: "¢",
       pound: "£",
       curren: "¤",
       yen: "¥",
       brvbar: "¦",
       sect: "§",
       uml: "¨",
       copy: "©",
       ordf: "ª",
       laquo: "«",
       not: "¬",
       shy: "­­",
       reg: "®",
       macr: "¯",
       deg: "°",
       plusmn: "±",
       sup2: "²",
       sup3: "³",
       acute: "´",
       micro: "µ",
       para: "¶",
       middot: "·",
       cedil: "¸",
       sup1: "¹",
       ordm: "º",
       raquo: "»",
       frac14: "¼",
       frac12: "½",
       frac34: "¾",
       iquest: "¿",
       times: "×",
       divide: "÷",
       forall: "∀",
       part: "∂",
       exist: "∃",
       empty: "∅",
       nabla: "∇",
       isin: "∈",
       notin: "∉",
       ni: "∋",
       prod: "∏",
       sum: "∑",
       minus: "−",
       lowast: "∗",
       radic: "√",
       prop: "∝",
       infin: "∞",
       ang: "∠",
       and: "∧",
       or: "∨",
       cap: "∩",
       cup: "∪",
       'int': "∫",
       there4: "∴",
       sim: "∼",
       cong: "≅",
       asymp: "≈",
       ne: "≠",
       equiv: "≡",
       le: "≤",
       ge: "≥",
       sub: "⊂",
       sup: "⊃",
       nsub: "⊄",
       sube: "⊆",
       supe: "⊇",
       oplus: "⊕",
       otimes: "⊗",
       perp: "⊥",
       sdot: "⋅",
       Alpha: "Α",
       Beta: "Β",
       Gamma: "Γ",
       Delta: "Δ",
       Epsilon: "Ε",
       Zeta: "Ζ",
       Eta: "Η",
       Theta: "Θ",
       Iota: "Ι",
       Kappa: "Κ",
       Lambda: "Λ",
       Mu: "Μ",
       Nu: "Ν",
       Xi: "Ξ",
       Omicron: "Ο",
       Pi: "Π",
       Rho: "Ρ",
       Sigma: "Σ",
       Tau: "Τ",
       Upsilon: "Υ",
       Phi: "Φ",
       Chi: "Χ",
       Psi: "Ψ",
       Omega: "Ω",
       alpha: "α",
       beta: "β",
       gamma: "γ",
       delta: "δ",
       epsilon: "ε",
       zeta: "ζ",
       eta: "η",
       theta: "θ",
       iota: "ι",
       kappa: "κ",
       lambda: "λ",
       mu: "μ",
       nu: "ν",
       xi: "ξ",
       omicron: "ο",
       pi: "π",
       rho: "ρ",
       sigmaf: "ς",
       sigma: "σ",
       tau: "τ",
       upsilon: "υ",
       phi: "φ",
       chi: "χ",
       psi: "ψ",
       omega: "ω",
       thetasym: "ϑ",
       upsih: "ϒ",
       piv: "ϖ",
       OElig: "Œ",
       oelig: "œ",
       Scaron: "Š",
       scaron: "š",
       Yuml: "Ÿ",
       fnof: "ƒ",
       circ: "ˆ",
       tilde: "˜",
       ensp: " ",
       emsp: " ",
       thinsp: " ",
       zwnj: "‌",
       zwj: "‍",
       lrm: "‎",
       rlm: "‏",
       ndash: "–",
       mdash: "—",
       lsquo: "‘",
       rsquo: "’",
       sbquo: "‚",
       ldquo: "“",
       rdquo: "”",
       bdquo: "„",
       dagger: "†",
       Dagger: "‡",
       bull: "•",
       hellip: "…",
       permil: "‰",
       prime: "′",
       Prime: "″",
       lsaquo: "‹",
       rsaquo: "›",
       oline: "‾",
       euro: "€",
       trade: "™",
       larr: "←",
       uarr: "↑",
       rarr: "→",
       darr: "↓",
       harr: "↔",
       crarr: "↵",
       lceil: "⌈",
       rceil: "⌉",
       lfloor: "⌊",
       rfloor: "⌋",
       loz: "◊",
       spades: "♠",
       clubs: "♣",
       hearts: "♥",
       diams: "♦"
});

/**
 * @deprecated use `HTML_ENTITIES` instead
 * @see HTML_ENTITIES
 */
exports.entityMap = exports.HTML_ENTITIES


/***/ }),

/***/ "./node_modules/@xmldom/xmldom/lib/index.js":
/*!**************************************************!*\
  !*** ./node_modules/@xmldom/xmldom/lib/index.js ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var dom = __webpack_require__(/*! ./dom */ "./node_modules/@xmldom/xmldom/lib/dom.js")
exports.DOMImplementation = dom.DOMImplementation
exports.XMLSerializer = dom.XMLSerializer
exports.DOMParser = __webpack_require__(/*! ./dom-parser */ "./node_modules/@xmldom/xmldom/lib/dom-parser.js").DOMParser


/***/ }),

/***/ "./node_modules/@xmldom/xmldom/lib/sax.js":
/*!************************************************!*\
  !*** ./node_modules/@xmldom/xmldom/lib/sax.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var NAMESPACE = __webpack_require__(/*! ./conventions */ "./node_modules/@xmldom/xmldom/lib/conventions.js").NAMESPACE;

//[4]   	NameStartChar	   ::=   	":" | [A-Z] | "_" | [a-z] | [#xC0-#xD6] | [#xD8-#xF6] | [#xF8-#x2FF] | [#x370-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x2070-#x218F] | [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF]
//[4a]   	NameChar	   ::=   	NameStartChar | "-" | "." | [0-9] | #xB7 | [#x0300-#x036F] | [#x203F-#x2040]
//[5]   	Name	   ::=   	NameStartChar (NameChar)*
var nameStartChar = /[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]///\u10000-\uEFFFF
var nameChar = new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]");
var tagNamePattern = new RegExp('^'+nameStartChar.source+nameChar.source+'*(?:\:'+nameStartChar.source+nameChar.source+'*)?$');
//var tagNamePattern = /^[a-zA-Z_][\w\-\.]*(?:\:[a-zA-Z_][\w\-\.]*)?$/
//var handlers = 'resolveEntity,getExternalSubset,characters,endDocument,endElement,endPrefixMapping,ignorableWhitespace,processingInstruction,setDocumentLocator,skippedEntity,startDocument,startElement,startPrefixMapping,notationDecl,unparsedEntityDecl,error,fatalError,warning,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,comment,endCDATA,endDTD,endEntity,startCDATA,startDTD,startEntity'.split(',')

//S_TAG,	S_ATTR,	S_EQ,	S_ATTR_NOQUOT_VALUE
//S_ATTR_SPACE,	S_ATTR_END,	S_TAG_SPACE, S_TAG_CLOSE
var S_TAG = 0;//tag name offerring
var S_ATTR = 1;//attr name offerring
var S_ATTR_SPACE=2;//attr name end and space offer
var S_EQ = 3;//=space?
var S_ATTR_NOQUOT_VALUE = 4;//attr value(no quot value only)
var S_ATTR_END = 5;//attr value end and no space(quot end)
var S_TAG_SPACE = 6;//(attr value end || tag end ) && (space offer)
var S_TAG_CLOSE = 7;//closed el<el />

/**
 * Creates an error that will not be caught by XMLReader aka the SAX parser.
 *
 * @param {string} message
 * @param {any?} locator Optional, can provide details about the location in the source
 * @constructor
 */
function ParseError(message, locator) {
	this.message = message
	this.locator = locator
	if(Error.captureStackTrace) Error.captureStackTrace(this, ParseError);
}
ParseError.prototype = new Error();
ParseError.prototype.name = ParseError.name

function XMLReader(){

}

XMLReader.prototype = {
	parse:function(source,defaultNSMap,entityMap){
		var domBuilder = this.domBuilder;
		domBuilder.startDocument();
		_copy(defaultNSMap ,defaultNSMap = {})
		parse(source,defaultNSMap,entityMap,
				domBuilder,this.errorHandler);
		domBuilder.endDocument();
	}
}
function parse(source,defaultNSMapCopy,entityMap,domBuilder,errorHandler){
	function fixedFromCharCode(code) {
		// String.prototype.fromCharCode does not supports
		// > 2 bytes unicode chars directly
		if (code > 0xffff) {
			code -= 0x10000;
			var surrogate1 = 0xd800 + (code >> 10)
				, surrogate2 = 0xdc00 + (code & 0x3ff);

			return String.fromCharCode(surrogate1, surrogate2);
		} else {
			return String.fromCharCode(code);
		}
	}
	function entityReplacer(a){
		var k = a.slice(1,-1);
		if (Object.hasOwnProperty.call(entityMap, k)) {
			return entityMap[k];
		}else if(k.charAt(0) === '#'){
			return fixedFromCharCode(parseInt(k.substr(1).replace('x','0x')))
		}else{
			errorHandler.error('entity not found:'+a);
			return a;
		}
	}
	function appendText(end){//has some bugs
		if(end>start){
			var xt = source.substring(start,end).replace(/&#?\w+;/g,entityReplacer);
			locator&&position(start);
			domBuilder.characters(xt,0,end-start);
			start = end
		}
	}
	function position(p,m){
		while(p>=lineEnd && (m = linePattern.exec(source))){
			lineStart = m.index;
			lineEnd = lineStart + m[0].length;
			locator.lineNumber++;
			//console.log('line++:',locator,startPos,endPos)
		}
		locator.columnNumber = p-lineStart+1;
	}
	var lineStart = 0;
	var lineEnd = 0;
	var linePattern = /.*(?:\r\n?|\n)|.*$/g
	var locator = domBuilder.locator;

	var parseStack = [{currentNSMap:defaultNSMapCopy}]
	var closeMap = {};
	var start = 0;
	while(true){
		try{
			var tagStart = source.indexOf('<',start);
			if(tagStart<0){
				if(!source.substr(start).match(/^\s*$/)){
					var doc = domBuilder.doc;
	    			var text = doc.createTextNode(source.substr(start));
	    			doc.appendChild(text);
	    			domBuilder.currentElement = text;
				}
				return;
			}
			if(tagStart>start){
				appendText(tagStart);
			}
			switch(source.charAt(tagStart+1)){
			case '/':
				var end = source.indexOf('>',tagStart+3);
				var tagName = source.substring(tagStart + 2, end).replace(/[ \t\n\r]+$/g, '');
				var config = parseStack.pop();
				if(end<0){

	        		tagName = source.substring(tagStart+2).replace(/[\s<].*/,'');
	        		errorHandler.error("end tag name: "+tagName+' is not complete:'+config.tagName);
	        		end = tagStart+1+tagName.length;
	        	}else if(tagName.match(/\s</)){
	        		tagName = tagName.replace(/[\s<].*/,'');
	        		errorHandler.error("end tag name: "+tagName+' maybe not complete');
	        		end = tagStart+1+tagName.length;
				}
				var localNSMap = config.localNSMap;
				var endMatch = config.tagName == tagName;
				var endIgnoreCaseMach = endMatch || config.tagName&&config.tagName.toLowerCase() == tagName.toLowerCase()
		        if(endIgnoreCaseMach){
		        	domBuilder.endElement(config.uri,config.localName,tagName);
					if(localNSMap){
						for(var prefix in localNSMap){
							domBuilder.endPrefixMapping(prefix) ;
						}
					}
					if(!endMatch){
		            	errorHandler.fatalError("end tag name: "+tagName+' is not match the current start tagName:'+config.tagName ); // No known test case
					}
		        }else{
		        	parseStack.push(config)
		        }

				end++;
				break;
				// end elment
			case '?':// <?...?>
				locator&&position(tagStart);
				end = parseInstruction(source,tagStart,domBuilder);
				break;
			case '!':// <!doctype,<![CDATA,<!--
				locator&&position(tagStart);
				end = parseDCC(source,tagStart,domBuilder,errorHandler);
				break;
			default:
				locator&&position(tagStart);
				var el = new ElementAttributes();
				var currentNSMap = parseStack[parseStack.length-1].currentNSMap;
				//elStartEnd
				var end = parseElementStartPart(source,tagStart,el,currentNSMap,entityReplacer,errorHandler);
				var len = el.length;


				if(!el.closed && fixSelfClosed(source,end,el.tagName,closeMap)){
					el.closed = true;
					if(!entityMap.nbsp){
						errorHandler.warning('unclosed xml attribute');
					}
				}
				if(locator && len){
					var locator2 = copyLocator(locator,{});
					//try{//attribute position fixed
					for(var i = 0;i<len;i++){
						var a = el[i];
						position(a.offset);
						a.locator = copyLocator(locator,{});
					}
					domBuilder.locator = locator2
					if(appendElement(el,domBuilder,currentNSMap)){
						parseStack.push(el)
					}
					domBuilder.locator = locator;
				}else{
					if(appendElement(el,domBuilder,currentNSMap)){
						parseStack.push(el)
					}
				}

				if (NAMESPACE.isHTML(el.uri) && !el.closed) {
					end = parseHtmlSpecialContent(source,end,el.tagName,entityReplacer,domBuilder)
				} else {
					end++;
				}
			}
		}catch(e){
			if (e instanceof ParseError) {
				throw e;
			}
			errorHandler.error('element parse error: '+e)
			end = -1;
		}
		if(end>start){
			start = end;
		}else{
			//TODO: 这里有可能sax回退，有位置错误风险
			appendText(Math.max(tagStart,start)+1);
		}
	}
}
function copyLocator(f,t){
	t.lineNumber = f.lineNumber;
	t.columnNumber = f.columnNumber;
	return t;
}

/**
 * @see #appendElement(source,elStartEnd,el,selfClosed,entityReplacer,domBuilder,parseStack);
 * @return end of the elementStartPart(end of elementEndPart for selfClosed el)
 */
function parseElementStartPart(source,start,el,currentNSMap,entityReplacer,errorHandler){

	/**
	 * @param {string} qname
	 * @param {string} value
	 * @param {number} startIndex
	 */
	function addAttribute(qname, value, startIndex) {
		if (el.attributeNames.hasOwnProperty(qname)) {
			errorHandler.fatalError('Attribute ' + qname + ' redefined')
		}
		el.addValue(
			qname,
			// @see https://www.w3.org/TR/xml/#AVNormalize
			// since the xmldom sax parser does not "interpret" DTD the following is not implemented:
			// - recursive replacement of (DTD) entity references
			// - trimming and collapsing multiple spaces into a single one for attributes that are not of type CDATA
			value.replace(/[\t\n\r]/g, ' ').replace(/&#?\w+;/g, entityReplacer),
			startIndex
		)
	}
	var attrName;
	var value;
	var p = ++start;
	var s = S_TAG;//status
	while(true){
		var c = source.charAt(p);
		switch(c){
		case '=':
			if(s === S_ATTR){//attrName
				attrName = source.slice(start,p);
				s = S_EQ;
			}else if(s === S_ATTR_SPACE){
				s = S_EQ;
			}else{
				//fatalError: equal must after attrName or space after attrName
				throw new Error('attribute equal must after attrName'); // No known test case
			}
			break;
		case '\'':
		case '"':
			if(s === S_EQ || s === S_ATTR //|| s == S_ATTR_SPACE
				){//equal
				if(s === S_ATTR){
					errorHandler.warning('attribute value must after "="')
					attrName = source.slice(start,p)
				}
				start = p+1;
				p = source.indexOf(c,start)
				if(p>0){
					value = source.slice(start, p);
					addAttribute(attrName, value, start-1);
					s = S_ATTR_END;
				}else{
					//fatalError: no end quot match
					throw new Error('attribute value no end \''+c+'\' match');
				}
			}else if(s == S_ATTR_NOQUOT_VALUE){
				value = source.slice(start, p);
				addAttribute(attrName, value, start);
				errorHandler.warning('attribute "'+attrName+'" missed start quot('+c+')!!');
				start = p+1;
				s = S_ATTR_END
			}else{
				//fatalError: no equal before
				throw new Error('attribute value must after "="'); // No known test case
			}
			break;
		case '/':
			switch(s){
			case S_TAG:
				el.setTagName(source.slice(start,p));
			case S_ATTR_END:
			case S_TAG_SPACE:
			case S_TAG_CLOSE:
				s =S_TAG_CLOSE;
				el.closed = true;
			case S_ATTR_NOQUOT_VALUE:
			case S_ATTR:
			case S_ATTR_SPACE:
				break;
			//case S_EQ:
			default:
				throw new Error("attribute invalid close char('/')") // No known test case
			}
			break;
		case ''://end document
			errorHandler.error('unexpected end of input');
			if(s == S_TAG){
				el.setTagName(source.slice(start,p));
			}
			return p;
		case '>':
			switch(s){
			case S_TAG:
				el.setTagName(source.slice(start,p));
			case S_ATTR_END:
			case S_TAG_SPACE:
			case S_TAG_CLOSE:
				break;//normal
			case S_ATTR_NOQUOT_VALUE://Compatible state
			case S_ATTR:
				value = source.slice(start,p);
				if(value.slice(-1) === '/'){
					el.closed  = true;
					value = value.slice(0,-1)
				}
			case S_ATTR_SPACE:
				if(s === S_ATTR_SPACE){
					value = attrName;
				}
				if(s == S_ATTR_NOQUOT_VALUE){
					errorHandler.warning('attribute "'+value+'" missed quot(")!');
					addAttribute(attrName, value, start)
				}else{
					if(!NAMESPACE.isHTML(currentNSMap['']) || !value.match(/^(?:disabled|checked|selected)$/i)){
						errorHandler.warning('attribute "'+value+'" missed value!! "'+value+'" instead!!')
					}
					addAttribute(value, value, start)
				}
				break;
			case S_EQ:
				throw new Error('attribute value missed!!');
			}
//			console.log(tagName,tagNamePattern,tagNamePattern.test(tagName))
			return p;
		/*xml space '\x20' | #x9 | #xD | #xA; */
		case '\u0080':
			c = ' ';
		default:
			if(c<= ' '){//space
				switch(s){
				case S_TAG:
					el.setTagName(source.slice(start,p));//tagName
					s = S_TAG_SPACE;
					break;
				case S_ATTR:
					attrName = source.slice(start,p)
					s = S_ATTR_SPACE;
					break;
				case S_ATTR_NOQUOT_VALUE:
					var value = source.slice(start, p);
					errorHandler.warning('attribute "'+value+'" missed quot(")!!');
					addAttribute(attrName, value, start)
				case S_ATTR_END:
					s = S_TAG_SPACE;
					break;
				//case S_TAG_SPACE:
				//case S_EQ:
				//case S_ATTR_SPACE:
				//	void();break;
				//case S_TAG_CLOSE:
					//ignore warning
				}
			}else{//not space
//S_TAG,	S_ATTR,	S_EQ,	S_ATTR_NOQUOT_VALUE
//S_ATTR_SPACE,	S_ATTR_END,	S_TAG_SPACE, S_TAG_CLOSE
				switch(s){
				//case S_TAG:void();break;
				//case S_ATTR:void();break;
				//case S_ATTR_NOQUOT_VALUE:void();break;
				case S_ATTR_SPACE:
					var tagName =  el.tagName;
					if (!NAMESPACE.isHTML(currentNSMap['']) || !attrName.match(/^(?:disabled|checked|selected)$/i)) {
						errorHandler.warning('attribute "'+attrName+'" missed value!! "'+attrName+'" instead2!!')
					}
					addAttribute(attrName, attrName, start);
					start = p;
					s = S_ATTR;
					break;
				case S_ATTR_END:
					errorHandler.warning('attribute space is required"'+attrName+'"!!')
				case S_TAG_SPACE:
					s = S_ATTR;
					start = p;
					break;
				case S_EQ:
					s = S_ATTR_NOQUOT_VALUE;
					start = p;
					break;
				case S_TAG_CLOSE:
					throw new Error("elements closed character '/' and '>' must be connected to");
				}
			}
		}//end outer switch
		//console.log('p++',p)
		p++;
	}
}
/**
 * @return true if has new namespace define
 */
function appendElement(el,domBuilder,currentNSMap){
	var tagName = el.tagName;
	var localNSMap = null;
	//var currentNSMap = parseStack[parseStack.length-1].currentNSMap;
	var i = el.length;
	while(i--){
		var a = el[i];
		var qName = a.qName;
		var value = a.value;
		var nsp = qName.indexOf(':');
		if(nsp>0){
			var prefix = a.prefix = qName.slice(0,nsp);
			var localName = qName.slice(nsp+1);
			var nsPrefix = prefix === 'xmlns' && localName
		}else{
			localName = qName;
			prefix = null
			nsPrefix = qName === 'xmlns' && ''
		}
		//can not set prefix,because prefix !== ''
		a.localName = localName ;
		//prefix == null for no ns prefix attribute
		if(nsPrefix !== false){//hack!!
			if(localNSMap == null){
				localNSMap = {}
				//console.log(currentNSMap,0)
				_copy(currentNSMap,currentNSMap={})
				//console.log(currentNSMap,1)
			}
			currentNSMap[nsPrefix] = localNSMap[nsPrefix] = value;
			a.uri = NAMESPACE.XMLNS
			domBuilder.startPrefixMapping(nsPrefix, value)
		}
	}
	var i = el.length;
	while(i--){
		a = el[i];
		var prefix = a.prefix;
		if(prefix){//no prefix attribute has no namespace
			if(prefix === 'xml'){
				a.uri = NAMESPACE.XML;
			}if(prefix !== 'xmlns'){
				a.uri = currentNSMap[prefix || '']

				//{console.log('###'+a.qName,domBuilder.locator.systemId+'',currentNSMap,a.uri)}
			}
		}
	}
	var nsp = tagName.indexOf(':');
	if(nsp>0){
		prefix = el.prefix = tagName.slice(0,nsp);
		localName = el.localName = tagName.slice(nsp+1);
	}else{
		prefix = null;//important!!
		localName = el.localName = tagName;
	}
	//no prefix element has default namespace
	var ns = el.uri = currentNSMap[prefix || ''];
	domBuilder.startElement(ns,localName,tagName,el);
	//endPrefixMapping and startPrefixMapping have not any help for dom builder
	//localNSMap = null
	if(el.closed){
		domBuilder.endElement(ns,localName,tagName);
		if(localNSMap){
			for(prefix in localNSMap){
				domBuilder.endPrefixMapping(prefix)
			}
		}
	}else{
		el.currentNSMap = currentNSMap;
		el.localNSMap = localNSMap;
		//parseStack.push(el);
		return true;
	}
}
function parseHtmlSpecialContent(source,elStartEnd,tagName,entityReplacer,domBuilder){
	if(/^(?:script|textarea)$/i.test(tagName)){
		var elEndStart =  source.indexOf('</'+tagName+'>',elStartEnd);
		var text = source.substring(elStartEnd+1,elEndStart);
		if(/[&<]/.test(text)){
			if(/^script$/i.test(tagName)){
				//if(!/\]\]>/.test(text)){
					//lexHandler.startCDATA();
					domBuilder.characters(text,0,text.length);
					//lexHandler.endCDATA();
					return elEndStart;
				//}
			}//}else{//text area
				text = text.replace(/&#?\w+;/g,entityReplacer);
				domBuilder.characters(text,0,text.length);
				return elEndStart;
			//}

		}
	}
	return elStartEnd+1;
}
function fixSelfClosed(source,elStartEnd,tagName,closeMap){
	//if(tagName in closeMap){
	var pos = closeMap[tagName];
	if(pos == null){
		//console.log(tagName)
		pos =  source.lastIndexOf('</'+tagName+'>')
		if(pos<elStartEnd){//忘记闭合
			pos = source.lastIndexOf('</'+tagName)
		}
		closeMap[tagName] =pos
	}
	return pos<elStartEnd;
	//}
}
function _copy(source,target){
	for(var n in source){target[n] = source[n]}
}
function parseDCC(source,start,domBuilder,errorHandler){//sure start with '<!'
	var next= source.charAt(start+2)
	switch(next){
	case '-':
		if(source.charAt(start + 3) === '-'){
			var end = source.indexOf('-->',start+4);
			//append comment source.substring(4,end)//<!--
			if(end>start){
				domBuilder.comment(source,start+4,end-start-4);
				return end+3;
			}else{
				errorHandler.error("Unclosed comment");
				return -1;
			}
		}else{
			//error
			return -1;
		}
	default:
		if(source.substr(start+3,6) == 'CDATA['){
			var end = source.indexOf(']]>',start+9);
			domBuilder.startCDATA();
			domBuilder.characters(source,start+9,end-start-9);
			domBuilder.endCDATA()
			return end+3;
		}
		//<!DOCTYPE
		//startDTD(java.lang.String name, java.lang.String publicId, java.lang.String systemId)
		var matchs = split(source,start);
		var len = matchs.length;
		if(len>1 && /!doctype/i.test(matchs[0][0])){
			var name = matchs[1][0];
			var pubid = false;
			var sysid = false;
			if(len>3){
				if(/^public$/i.test(matchs[2][0])){
					pubid = matchs[3][0];
					sysid = len>4 && matchs[4][0];
				}else if(/^system$/i.test(matchs[2][0])){
					sysid = matchs[3][0];
				}
			}
			var lastMatch = matchs[len-1]
			domBuilder.startDTD(name, pubid, sysid);
			domBuilder.endDTD();

			return lastMatch.index+lastMatch[0].length
		}
	}
	return -1;
}



function parseInstruction(source,start,domBuilder){
	var end = source.indexOf('?>',start);
	if(end){
		var match = source.substring(start,end).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);
		if(match){
			var len = match[0].length;
			domBuilder.processingInstruction(match[1], match[2]) ;
			return end+2;
		}else{//error
			return -1;
		}
	}
	return -1;
}

function ElementAttributes(){
	this.attributeNames = {}
}
ElementAttributes.prototype = {
	setTagName:function(tagName){
		if(!tagNamePattern.test(tagName)){
			throw new Error('invalid tagName:'+tagName)
		}
		this.tagName = tagName
	},
	addValue:function(qName, value, offset) {
		if(!tagNamePattern.test(qName)){
			throw new Error('invalid attribute:'+qName)
		}
		this.attributeNames[qName] = this.length;
		this[this.length++] = {qName:qName,value:value,offset:offset}
	},
	length:0,
	getLocalName:function(i){return this[i].localName},
	getLocator:function(i){return this[i].locator},
	getQName:function(i){return this[i].qName},
	getURI:function(i){return this[i].uri},
	getValue:function(i){return this[i].value}
//	,getIndex:function(uri, localName)){
//		if(localName){
//
//		}else{
//			var qName = uri
//		}
//	},
//	getValue:function(){return this.getValue(this.getIndex.apply(this,arguments))},
//	getType:function(uri,localName){}
//	getType:function(i){},
}



function split(source,start){
	var match;
	var buf = [];
	var reg = /'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;
	reg.lastIndex = start;
	reg.exec(source);//skip <
	while(match = reg.exec(source)){
		buf.push(match);
		if(match[1])return buf;
	}
}

exports.XMLReader = XMLReader;
exports.ParseError = ParseError;


/***/ }),

/***/ "./node_modules/process/browser.js":
/*!*****************************************!*\
  !*** ./node_modules/process/browser.js ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports) {

// shim for using process in browser
var process = module.exports = {};

// cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.

var cachedSetTimeout;
var cachedClearTimeout;

function defaultSetTimout() {
    throw new Error('setTimeout has not been defined');
}
function defaultClearTimeout () {
    throw new Error('clearTimeout has not been defined');
}
(function () {
    try {
        if (typeof setTimeout === 'function') {
            cachedSetTimeout = setTimeout;
        } else {
            cachedSetTimeout = defaultSetTimout;
        }
    } catch (e) {
        cachedSetTimeout = defaultSetTimout;
    }
    try {
        if (typeof clearTimeout === 'function') {
            cachedClearTimeout = clearTimeout;
        } else {
            cachedClearTimeout = defaultClearTimeout;
        }
    } catch (e) {
        cachedClearTimeout = defaultClearTimeout;
    }
} ())
function runTimeout(fun) {
    if (cachedSetTimeout === setTimeout) {
        //normal enviroments in sane situations
        return setTimeout(fun, 0);
    }
    // if setTimeout wasn't available but was latter defined
    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
        cachedSetTimeout = setTimeout;
        return setTimeout(fun, 0);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedSetTimeout(fun, 0);
    } catch(e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
            return cachedSetTimeout.call(null, fun, 0);
        } catch(e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
            return cachedSetTimeout.call(this, fun, 0);
        }
    }


}
function runClearTimeout(marker) {
    if (cachedClearTimeout === clearTimeout) {
        //normal enviroments in sane situations
        return clearTimeout(marker);
    }
    // if clearTimeout wasn't available but was latter defined
    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
        cachedClearTimeout = clearTimeout;
        return clearTimeout(marker);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedClearTimeout(marker);
    } catch (e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
            return cachedClearTimeout.call(null, marker);
        } catch (e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
            // Some versions of I.E. have different rules for clearTimeout vs setTimeout
            return cachedClearTimeout.call(this, marker);
        }
    }



}
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
    if (!draining || !currentQueue) {
        return;
    }
    draining = false;
    if (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } else {
        queueIndex = -1;
    }
    if (queue.length) {
        drainQueue();
    }
}

function drainQueue() {
    if (draining) {
        return;
    }
    var timeout = runTimeout(cleanUpNextTick);
    draining = true;

    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) {
            if (currentQueue) {
                currentQueue[queueIndex].run();
            }
        }
        queueIndex = -1;
        len = queue.length;
    }
    currentQueue = null;
    draining = false;
    runClearTimeout(timeout);
}

process.nextTick = function (fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) {
        for (var i = 1; i < arguments.length; i++) {
            args[i - 1] = arguments[i];
        }
    }
    queue.push(new Item(fun, args));
    if (queue.length === 1 && !draining) {
        runTimeout(drainQueue);
    }
};

// v8 likes predictible objects
function Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
Item.prototype.run = function () {
    this.fun.apply(null, this.array);
};
process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;
process.prependListener = noop;
process.prependOnceListener = noop;

process.listeners = function (name) { return [] }

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };


/***/ }),

/***/ "./node_modules/webpack/buildin/amd-options.js":
/*!****************************************!*\
  !*** (webpack)/buildin/amd-options.js ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports) {

/* WEBPACK VAR INJECTION */(function(__webpack_amd_options__) {/* globals __webpack_amd_options__ */
module.exports = __webpack_amd_options__;

/* WEBPACK VAR INJECTION */}.call(this, {}))

/***/ }),

/***/ "./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

var g;

// This works in non-strict mode
g = (function() {
	return this;
})();

try {
	// This works if eval is allowed (see CSP)
	g = g || new Function("return this")();
} catch (e) {
	// This works if the window reference is available
	if (typeof window === "object") g = window;
}

// g can still be undefined, but nothing to do about it...
// We return undefined, instead of nothing here, so it's
// easier to handle this case. if(!global) { ...}

module.exports = g;


/***/ }),

/***/ "./node_modules/webpack/buildin/module.js":
/*!***********************************!*\
  !*** (webpack)/buildin/module.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = function(module) {
	if (!module.webpackPolyfill) {
		module.deprecate = function() {};
		module.paths = [];
		// module.parent = undefined by default
		if (!module.children) module.children = [];
		Object.defineProperty(module, "loaded", {
			enumerable: true,
			get: function() {
				return module.l;
			}
		});
		Object.defineProperty(module, "id", {
			enumerable: true,
			get: function() {
				return module.i;
			}
		});
		module.webpackPolyfill = 1;
	}
	return module;
};


/***/ }),

/***/ "./package.json":
/*!**********************!*\
  !*** ./package.json ***!
  \**********************/
/*! exports provided: name, version, description, main, types, scripts, repository, keywords, author, license, bugs, homepage, dependencies, devDependencies, default */
/***/ (function(module) {

module.exports = JSON.parse("{\"name\":\"cos-js-sdk-v5\",\"version\":\"1.4.2\",\"description\":\"JavaScript SDK for [腾讯云对象存储](https://cloud.tencent.com/product/cos)\",\"main\":\"dist/cos-js-sdk-v5.js\",\"types\":\"index.d.ts\",\"scripts\":{\"server\":\"node server/sts.js\",\"dev\":\"cross-env NODE_ENV=development webpack -w --mode=development\",\"build\":\"cross-env NODE_ENV=production webpack --mode=production\",\"cos-auth.min.js\":\"uglifyjs ./demo/common/cos-auth.js -o ./demo/common/cos-auth.min.js -c -m\"},\"repository\":{\"type\":\"git\",\"url\":\"git+https://github.com/tencentyun/cos-js-sdk-v5.git\"},\"keywords\":[],\"author\":\"carsonxu\",\"license\":\"ISC\",\"bugs\":{\"url\":\"https://github.com/tencentyun/cos-js-sdk-v5/issues\"},\"homepage\":\"https://github.com/tencentyun/cos-js-sdk-v5#readme\",\"dependencies\":{\"@xmldom/xmldom\":\"^0.8.2\"},\"devDependencies\":{\"@babel/core\":\"7.17.9\",\"@babel/plugin-transform-runtime\":\"7.18.10\",\"@babel/preset-env\":\"7.16.11\",\"babel-loader\":\"8.2.5\",\"body-parser\":\"^1.18.3\",\"cross-env\":\"^5.2.0\",\"express\":\"^4.16.4\",\"qcloud-cos-sts\":\"^3.0.2\",\"request\":\"^2.87.0\",\"terser-webpack-plugin\":\"4.2.3\",\"webpack\":\"4.46.0\",\"webpack-cli\":\"4.10.0\"}}");

/***/ }),

/***/ "./src/advance.js":
/*!************************!*\
  !*** ./src/advance.js ***!
  \************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var _typeof = __webpack_require__(/*! @babel/runtime/helpers/typeof */ "./node_modules/@babel/runtime/helpers/typeof.js");

var session = __webpack_require__(/*! ./session */ "./src/session.js");

var Async = __webpack_require__(/*! ./async */ "./src/async.js");

var EventProxy = __webpack_require__(/*! ./event */ "./src/event.js").EventProxy;

var util = __webpack_require__(/*! ./util */ "./src/util.js");

var Tracker = __webpack_require__(/*! ./tracker */ "./src/tracker.js"); // 文件分块上传全过程，暴露的分块上传接口


function sliceUploadFile(params, callback) {
  var self = this;
  var ep = new EventProxy();
  var TaskId = params.TaskId;
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var Body = params.Body;
  var ChunkSize = params.ChunkSize || params.SliceSize || self.options.ChunkSize;
  var AsyncLimit = params.AsyncLimit;
  var StorageClass = params.StorageClass;
  var ServerSideEncryption = params.ServerSideEncryption;
  var FileSize;
  var onProgress;
  var onHashProgress = params.onHashProgress;
  var tracker = params.tracker;
  tracker && tracker.setParams({
    chunkSize: ChunkSize
  }); // 上传过程中出现错误，返回错误

  ep.on('error', function (err) {
    if (!self._isRunningTask(TaskId)) return;
    err.UploadId = params.UploadData.UploadId || '';
    return callback(err);
  }); // 上传分块完成，开始 uploadSliceComplete 操作

  ep.on('upload_complete', function (UploadCompleteData) {
    var _UploadCompleteData = util.extend({
      UploadId: params.UploadData.UploadId || ''
    }, UploadCompleteData);

    callback(null, _UploadCompleteData);
  }); // 上传分块完成，开始 uploadSliceComplete 操作

  ep.on('upload_slice_complete', function (UploadData) {
    var metaHeaders = {};
    util.each(params.Headers, function (val, k) {
      var shortKey = k.toLowerCase();
      if (shortKey.indexOf('x-cos-meta-') === 0 || shortKey === 'pic-operations') metaHeaders[k] = val;
    });
    uploadSliceComplete.call(self, {
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      UploadId: UploadData.UploadId,
      SliceList: UploadData.SliceList,
      Headers: metaHeaders,
      tracker: tracker
    }, function (err, data) {
      if (!self._isRunningTask(TaskId)) return;
      session.removeUsing(UploadData.UploadId);

      if (err) {
        onProgress(null, true);
        return ep.emit('error', err);
      }

      session.removeUploadId.call(self, UploadData.UploadId);
      onProgress({
        loaded: FileSize,
        total: FileSize
      }, true);
      ep.emit('upload_complete', data);
    });
  }); // 获取 UploadId 完成，开始上传每个分片

  ep.on('get_upload_data_finish', function (UploadData) {
    // 处理 UploadId 缓存
    var uuid = session.getFileId(Body, params.ChunkSize, Bucket, Key);
    uuid && session.saveUploadId.call(self, uuid, UploadData.UploadId, self.options.UploadIdCacheLimit); // 缓存 UploadId

    session.setUsing(UploadData.UploadId); // 标记 UploadId 为正在使用
    // 获取 UploadId

    onProgress(null, true); // 任务状态开始 uploading

    uploadSliceList.call(self, {
      TaskId: TaskId,
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      Body: Body,
      FileSize: FileSize,
      SliceSize: ChunkSize,
      AsyncLimit: AsyncLimit,
      ServerSideEncryption: ServerSideEncryption,
      UploadData: UploadData,
      Headers: params.Headers,
      onProgress: onProgress,
      tracker: tracker
    }, function (err, data) {
      if (!self._isRunningTask(TaskId)) return;

      if (err) {
        onProgress(null, true);
        return ep.emit('error', err);
      }

      ep.emit('upload_slice_complete', data);
    });
  }); // 开始获取文件 UploadId，里面会视情况计算 ETag，并比对，保证文件一致性，也优化上传

  ep.on('get_file_size_finish', function () {
    onProgress = util.throttleOnProgress.call(self, FileSize, params.onProgress);

    if (params.UploadData.UploadId) {
      ep.emit('get_upload_data_finish', params.UploadData);
    } else {
      var _params = util.extend({
        TaskId: TaskId,
        Bucket: Bucket,
        Region: Region,
        Key: Key,
        Headers: params.Headers,
        StorageClass: StorageClass,
        Body: Body,
        FileSize: FileSize,
        SliceSize: ChunkSize,
        onHashProgress: onHashProgress,
        tracker: tracker
      }, params);

      getUploadIdAndPartList.call(self, _params, function (err, UploadData) {
        if (!self._isRunningTask(TaskId)) return;
        if (err) return ep.emit('error', err);
        params.UploadData.UploadId = UploadData.UploadId;
        params.UploadData.PartList = UploadData.PartList;
        ep.emit('get_upload_data_finish', params.UploadData);
      });
    }
  }); // 获取上传文件大小

  FileSize = params.ContentLength;
  delete params.ContentLength;
  !params.Headers && (params.Headers = {});
  util.each(params.Headers, function (item, key) {
    if (key.toLowerCase() === 'content-length') {
      delete params.Headers[key];
    }
  }); // 控制分片大小

  (function () {
    var SIZE = [1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 1024 * 2, 1024 * 4, 1024 * 5];
    var AutoChunkSize = 1024 * 1024;

    for (var i = 0; i < SIZE.length; i++) {
      AutoChunkSize = SIZE[i] * 1024 * 1024;
      if (FileSize / AutoChunkSize <= self.options.MaxPartNumber) break;
    }

    params.ChunkSize = params.SliceSize = ChunkSize = Math.max(ChunkSize, AutoChunkSize);
  })(); // 开始上传


  if (FileSize === 0) {
    params.Body = '';
    params.ContentLength = 0;
    params.SkipTask = true;
    self.putObject(params, callback);
  } else {
    ep.emit('get_file_size_finish');
  }
} // 获取上传任务的 UploadId


function getUploadIdAndPartList(params, callback) {
  var TaskId = params.TaskId;
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var StorageClass = params.StorageClass;
  var self = this; // 计算 ETag

  var ETagMap = {};
  var FileSize = params.FileSize;
  var SliceSize = params.SliceSize;
  var SliceCount = Math.ceil(FileSize / SliceSize);
  var FinishSliceCount = 0;
  var FinishSize = 0;
  var onHashProgress = util.throttleOnProgress.call(self, FileSize, params.onHashProgress);

  var getChunkETag = function getChunkETag(PartNumber, callback) {
    var start = SliceSize * (PartNumber - 1);
    var end = Math.min(start + SliceSize, FileSize);
    var ChunkSize = end - start;

    if (ETagMap[PartNumber]) {
      callback(null, {
        PartNumber: PartNumber,
        ETag: ETagMap[PartNumber],
        Size: ChunkSize
      });
    } else {
      util.fileSlice(params.Body, start, end, false, function (chunkItem) {
        util.getFileMd5(chunkItem, function (err, md5) {
          if (err) return callback(util.error(err));
          var ETag = '"' + md5 + '"';
          ETagMap[PartNumber] = ETag;
          FinishSliceCount += 1;
          FinishSize += ChunkSize;
          onHashProgress({
            loaded: FinishSize,
            total: FileSize
          });
          callback(null, {
            PartNumber: PartNumber,
            ETag: ETag,
            Size: ChunkSize
          });
        });
      });
    }
  }; // 通过和文件的 md5 对比，判断 UploadId 是否可用


  var isAvailableUploadList = function isAvailableUploadList(PartList, callback) {
    var PartCount = PartList.length; // 如果没有分片，通过

    if (PartCount === 0) {
      return callback(null, true);
    } // 检查分片数量


    if (PartCount > SliceCount) {
      return callback(null, false);
    } // 检查分片大小


    if (PartCount > 1) {
      var PartSliceSize = Math.max(PartList[0].Size, PartList[1].Size);

      if (PartSliceSize !== SliceSize) {
        return callback(null, false);
      }
    } // 逐个分片计算并检查 ETag 是否一致


    var next = function next(index) {
      if (index < PartCount) {
        var Part = PartList[index];
        getChunkETag(Part.PartNumber, function (err, chunk) {
          if (chunk && chunk.ETag === Part.ETag && chunk.Size === Part.Size) {
            next(index + 1);
          } else {
            callback(null, false);
          }
        });
      } else {
        callback(null, true);
      }
    };

    next(0);
  };

  var ep = new EventProxy();
  ep.on('error', function (errData) {
    if (!self._isRunningTask(TaskId)) return;
    return callback(errData);
  }); // 存在 UploadId

  ep.on('upload_id_available', function (UploadData) {
    // 转换成 map
    var map = {};
    var list = [];
    util.each(UploadData.PartList, function (item) {
      map[item.PartNumber] = item;
    });

    for (var PartNumber = 1; PartNumber <= SliceCount; PartNumber++) {
      var item = map[PartNumber];

      if (item) {
        item.PartNumber = PartNumber;
        item.Uploaded = true;
      } else {
        item = {
          PartNumber: PartNumber,
          ETag: null,
          Uploaded: false
        };
      }

      list.push(item);
    }

    UploadData.PartList = list;
    callback(null, UploadData);
  }); // 不存在 UploadId, 初始化生成 UploadId

  ep.on('no_available_upload_id', function () {
    if (!self._isRunningTask(TaskId)) return;

    var _params = util.extend({
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      Query: util.clone(params.Query),
      StorageClass: StorageClass,
      Body: params.Body,
      calledBySdk: 'sliceUploadFile',
      tracker: params.tracker
    }, params);

    var headers = util.clone(params.Headers);
    delete headers['x-cos-mime-limit'];
    _params.Headers = headers;
    self.multipartInit(_params, function (err, data) {
      if (!self._isRunningTask(TaskId)) return;
      if (err) return ep.emit('error', err);
      var UploadId = data.UploadId;

      if (!UploadId) {
        return callback(util.error(new Error('no such upload id')));
      }

      ep.emit('upload_id_available', {
        UploadId: UploadId,
        PartList: []
      });
    });
  }); // 如果已存在 UploadId，找一个可以用的 UploadId

  ep.on('has_and_check_upload_id', function (UploadIdList) {
    // 串行地，找一个内容一致的 UploadId
    UploadIdList = UploadIdList.reverse();
    Async.eachLimit(UploadIdList, 1, function (UploadId, asyncCallback) {
      if (!self._isRunningTask(TaskId)) return; // 如果正在上传，跳过

      if (session.using[UploadId]) {
        asyncCallback(); // 检查下一个 UploadId

        return;
      } // 判断 UploadId 是否可用


      wholeMultipartListPart.call(self, {
        Bucket: Bucket,
        Region: Region,
        Key: Key,
        UploadId: UploadId,
        tracker: params.tracker
      }, function (err, PartListData) {
        if (!self._isRunningTask(TaskId)) return;

        if (err) {
          session.removeUsing(UploadId);
          return ep.emit('error', err);
        }

        var PartList = PartListData.PartList;
        PartList.forEach(function (item) {
          item.PartNumber *= 1;
          item.Size *= 1;
          item.ETag = item.ETag || '';
        });
        isAvailableUploadList(PartList, function (err, isAvailable) {
          if (!self._isRunningTask(TaskId)) return;
          if (err) return ep.emit('error', err);

          if (isAvailable) {
            asyncCallback({
              UploadId: UploadId,
              PartList: PartList
            }); // 马上结束
          } else {
            asyncCallback(); // 检查下一个 UploadId
          }
        });
      });
    }, function (AvailableUploadData) {
      if (!self._isRunningTask(TaskId)) return;
      onHashProgress(null, true);

      if (AvailableUploadData && AvailableUploadData.UploadId) {
        ep.emit('upload_id_available', AvailableUploadData);
      } else {
        ep.emit('no_available_upload_id');
      }
    });
  }); // 在本地缓存找可用的 UploadId

  ep.on('seek_local_avail_upload_id', function (RemoteUploadIdList) {
    // 在本地找可用的 UploadId
    var uuid = session.getFileId(params.Body, params.ChunkSize, Bucket, Key);
    var LocalUploadIdList = session.getUploadIdList.call(self, uuid);

    if (!uuid || !LocalUploadIdList) {
      ep.emit('has_and_check_upload_id', RemoteUploadIdList);
      return;
    }

    var next = function next(index) {
      // 如果本地找不到可用 UploadId，再一个个遍历校验远端
      if (index >= LocalUploadIdList.length) {
        ep.emit('has_and_check_upload_id', RemoteUploadIdList);
        return;
      }

      var UploadId = LocalUploadIdList[index]; // 如果不在远端 UploadId 列表里，跳过并删除

      if (!util.isInArray(RemoteUploadIdList, UploadId)) {
        session.removeUploadId.call(self, UploadId);
        next(index + 1);
        return;
      } // 如果正在上传，跳过


      if (session.using[UploadId]) {
        next(index + 1);
        return;
      } // 判断 UploadId 是否存在线上


      wholeMultipartListPart.call(self, {
        Bucket: Bucket,
        Region: Region,
        Key: Key,
        UploadId: UploadId,
        tracker: params.tracker
      }, function (err, PartListData) {
        if (!self._isRunningTask(TaskId)) return;

        if (err) {
          // 如果 UploadId 获取会出错，跳过并删除
          session.removeUploadId.call(self, UploadId);
          next(index + 1);
        } else {
          // 找到可用 UploadId
          ep.emit('upload_id_available', {
            UploadId: UploadId,
            PartList: PartListData.PartList
          });
        }
      });
    };

    next(0);
  }); // 获取线上 UploadId 列表

  ep.on('get_remote_upload_id_list', function () {
    // 获取符合条件的 UploadId 列表，因为同一个文件可以有多个上传任务。
    wholeMultipartList.call(self, {
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      tracker: params.tracker
    }, function (err, data) {
      if (!self._isRunningTask(TaskId)) return;
      if (err) return ep.emit('error', err); // 整理远端 UploadId 列表

      var RemoteUploadIdList = util.filter(data.UploadList, function (item) {
        return item.Key === Key && (!StorageClass || item.StorageClass.toUpperCase() === StorageClass.toUpperCase());
      }).reverse().map(function (item) {
        return item.UploadId || item.UploadID;
      });

      if (RemoteUploadIdList.length) {
        ep.emit('seek_local_avail_upload_id', RemoteUploadIdList);
      } else {
        // 远端没有 UploadId，清理缓存的 UploadId
        var uuid = session.getFileId(params.Body, params.ChunkSize, Bucket, Key),
            LocalUploadIdList;

        if (uuid && (LocalUploadIdList = session.getUploadIdList.call(self, uuid))) {
          util.each(LocalUploadIdList, function (UploadId) {
            session.removeUploadId.call(self, UploadId);
          });
        }

        ep.emit('no_available_upload_id');
      }
    });
  }); // 开始找可用 UploadId

  ep.emit('get_remote_upload_id_list');
} // 获取符合条件的全部上传任务 (条件包括 Bucket, Region, Prefix)


function wholeMultipartList(params, callback) {
  var self = this;
  var UploadList = [];
  var sendParams = {
    Bucket: params.Bucket,
    Region: params.Region,
    Prefix: params.Key,
    calledBySdk: params.calledBySdk || 'sliceUploadFile',
    tracker: params.tracker
  };

  var next = function next() {
    self.multipartList(sendParams, function (err, data) {
      if (err) return callback(err);
      UploadList.push.apply(UploadList, data.Upload || []);

      if (data.IsTruncated === 'true') {
        // 列表不完整
        sendParams.KeyMarker = data.NextKeyMarker;
        sendParams.UploadIdMarker = data.NextUploadIdMarker;
        next();
      } else {
        callback(null, {
          UploadList: UploadList
        });
      }
    });
  };

  next();
} // 获取指定上传任务的分块列表


function wholeMultipartListPart(params, callback) {
  var self = this;
  var PartList = [];
  var sendParams = {
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    UploadId: params.UploadId,
    calledBySdk: 'sliceUploadFile',
    tracker: params.tracker
  };

  var next = function next() {
    self.multipartListPart(sendParams, function (err, data) {
      if (err) return callback(err);
      PartList.push.apply(PartList, data.Part || []);

      if (data.IsTruncated === 'true') {
        // 列表不完整
        sendParams.PartNumberMarker = data.NextPartNumberMarker;
        next();
      } else {
        callback(null, {
          PartList: PartList
        });
      }
    });
  };

  next();
} // 上传文件分块，包括

/*
 UploadId (上传任务编号)
 AsyncLimit (并发量)，
 SliceList (上传的分块数组)，
 FilePath (本地文件的位置)，
 SliceSize (文件分块大小)
 FileSize (文件大小)
 onProgress (上传成功之后的回调函数)
 */


function uploadSliceList(params, cb) {
  var self = this;
  var TaskId = params.TaskId;
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var UploadData = params.UploadData;
  var FileSize = params.FileSize;
  var SliceSize = params.SliceSize;
  var ChunkParallel = Math.min(params.AsyncLimit || self.options.ChunkParallelLimit || 1, 256);
  var Body = params.Body;
  var SliceCount = Math.ceil(FileSize / SliceSize);
  var FinishSize = 0;
  var ServerSideEncryption = params.ServerSideEncryption;
  var Headers = params.Headers;
  var needUploadSlices = util.filter(UploadData.PartList, function (SliceItem) {
    if (SliceItem['Uploaded']) {
      FinishSize += SliceItem['PartNumber'] >= SliceCount ? FileSize % SliceSize || SliceSize : SliceSize;
    }

    return !SliceItem['Uploaded'];
  });
  var _onProgress2 = params.onProgress;
  Async.eachLimit(needUploadSlices, ChunkParallel, function (SliceItem, asyncCallback) {
    if (!self._isRunningTask(TaskId)) return;
    var PartNumber = SliceItem['PartNumber'];
    var currentSize = Math.min(FileSize, SliceItem['PartNumber'] * SliceSize) - (SliceItem['PartNumber'] - 1) * SliceSize;
    var preAddSize = 0;
    uploadSliceItem.call(self, {
      TaskId: TaskId,
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      SliceSize: SliceSize,
      FileSize: FileSize,
      PartNumber: PartNumber,
      ServerSideEncryption: ServerSideEncryption,
      Body: Body,
      UploadData: UploadData,
      Headers: Headers,
      onProgress: function onProgress(data) {
        FinishSize += data.loaded - preAddSize;
        preAddSize = data.loaded;

        _onProgress2({
          loaded: FinishSize,
          total: FileSize
        });
      },
      tracker: params.tracker
    }, function (err, data) {
      if (!self._isRunningTask(TaskId)) return;
      if (!err && !data.ETag) err = 'get ETag error, please add "ETag" to CORS ExposeHeader setting.( 获取ETag失败，请在CORS ExposeHeader设置中添加ETag，请参考文档：https://cloud.tencent.com/document/product/436/13318 )';

      if (err) {
        FinishSize -= preAddSize;
      } else {
        FinishSize += currentSize - preAddSize;
        SliceItem.ETag = data.ETag;
      }

      _onProgress2({
        loaded: FinishSize,
        total: FileSize
      });

      asyncCallback(err || null, data);
    });
  }, function (err) {
    if (!self._isRunningTask(TaskId)) return;
    if (err) return cb(err);
    cb(null, {
      UploadId: UploadData.UploadId,
      SliceList: UploadData.PartList
    });
  });
} // 上传指定分片


function uploadSliceItem(params, callback) {
  var self = this;
  var TaskId = params.TaskId;
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var FileSize = params.FileSize;
  var FileBody = params.Body;
  var PartNumber = params.PartNumber * 1;
  var SliceSize = params.SliceSize;
  var ServerSideEncryption = params.ServerSideEncryption;
  var UploadData = params.UploadData;
  var Headers = params.Headers || {};
  var ChunkRetryTimes = self.options.ChunkRetryTimes + 1;
  var start = SliceSize * (PartNumber - 1);
  var ContentLength = SliceSize;
  var end = start + SliceSize;

  if (end > FileSize) {
    end = FileSize;
    ContentLength = end - start;
  }

  var headersWhiteList = ['x-cos-traffic-limit', 'x-cos-mime-limit'];
  var headers = {};
  util.each(Headers, function (v, k) {
    if (headersWhiteList.indexOf(k) > -1) {
      headers[k] = v;
    }
  });
  var PartItem = UploadData.PartList[PartNumber - 1];
  Async.retry(ChunkRetryTimes, function (tryCallback) {
    if (!self._isRunningTask(TaskId)) return;
    util.fileSlice(FileBody, start, end, true, function (Body) {
      self.multipartUpload({
        TaskId: TaskId,
        Bucket: Bucket,
        Region: Region,
        Key: Key,
        ContentLength: ContentLength,
        PartNumber: PartNumber,
        UploadId: UploadData.UploadId,
        ServerSideEncryption: ServerSideEncryption,
        Body: Body,
        Headers: headers,
        onProgress: params.onProgress,
        calledBySdk: 'sliceUploadFile',
        tracker: params.tracker
      }, function (err, data) {
        if (!self._isRunningTask(TaskId)) return;
        if (err) return tryCallback(err);
        PartItem.Uploaded = true;
        return tryCallback(null, data);
      });
    });
  }, function (err, data) {
    if (!self._isRunningTask(TaskId)) return;
    return callback(err, data);
  });
} // 完成分块上传


function uploadSliceComplete(params, callback) {
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var UploadId = params.UploadId;
  var SliceList = params.SliceList;
  var self = this;
  var ChunkRetryTimes = this.options.ChunkRetryTimes + 1;
  var Headers = params.Headers;
  var Parts = SliceList.map(function (item) {
    return {
      PartNumber: item.PartNumber,
      ETag: item.ETag
    };
  }); // 完成上传的请求也做重试

  Async.retry(ChunkRetryTimes, function (tryCallback) {
    self.multipartComplete({
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      UploadId: UploadId,
      Parts: Parts,
      Headers: Headers,
      calledBySdk: 'sliceUploadFile',
      tracker: params.tracker
    }, tryCallback);
  }, function (err, data) {
    callback(err, data);
  });
} // 抛弃分块上传任务

/*
 AsyncLimit (抛弃上传任务的并发量)，
 UploadId (上传任务的编号，当 Level 为 task 时候需要)
 Level (抛弃分块上传任务的级别，task : 抛弃指定的上传任务，file ： 抛弃指定的文件对应的上传任务，其他值 ：抛弃指定Bucket 的全部上传任务)
 */


function abortUploadTask(params, callback) {
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var UploadId = params.UploadId;
  var Level = params.Level || 'task';
  var AsyncLimit = params.AsyncLimit;
  var self = this;
  var ep = new EventProxy();
  ep.on('error', function (errData) {
    return callback(errData);
  }); // 已经获取到需要抛弃的任务列表

  ep.on('get_abort_array', function (AbortArray) {
    abortUploadTaskArray.call(self, {
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      Headers: params.Headers,
      AsyncLimit: AsyncLimit,
      AbortArray: AbortArray
    }, callback);
  });

  if (Level === 'bucket') {
    // Bucket 级别的任务抛弃，抛弃该 Bucket 下的全部上传任务
    wholeMultipartList.call(self, {
      Bucket: Bucket,
      Region: Region,
      calledBySdk: 'abortUploadTask'
    }, function (err, data) {
      if (err) return callback(err);
      ep.emit('get_abort_array', data.UploadList || []);
    });
  } else if (Level === 'file') {
    // 文件级别的任务抛弃，抛弃该文件的全部上传任务
    if (!Key) return callback(util.error(new Error('abort_upload_task_no_key')));
    wholeMultipartList.call(self, {
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      calledBySdk: 'abortUploadTask'
    }, function (err, data) {
      if (err) return callback(err);
      ep.emit('get_abort_array', data.UploadList || []);
    });
  } else if (Level === 'task') {
    // 单个任务级别的任务抛弃，抛弃指定 UploadId 的上传任务
    if (!UploadId) return callback(util.error(new Error('abort_upload_task_no_id')));
    if (!Key) return callback(util.error(new Error('abort_upload_task_no_key')));
    ep.emit('get_abort_array', [{
      Key: Key,
      UploadId: UploadId
    }]);
  } else {
    return callback(util.error(new Error('abort_unknown_level')));
  }
} // 批量抛弃分块上传任务


function abortUploadTaskArray(params, callback) {
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var AbortArray = params.AbortArray;
  var AsyncLimit = params.AsyncLimit || 1;
  var self = this;
  var index = 0;
  var resultList = new Array(AbortArray.length);
  Async.eachLimit(AbortArray, AsyncLimit, function (AbortItem, nextItem) {
    var eachIndex = index;

    if (Key && Key !== AbortItem.Key) {
      resultList[eachIndex] = {
        error: {
          KeyNotMatch: true
        }
      };
      nextItem(null);
      return;
    }

    var UploadId = AbortItem.UploadId || AbortItem.UploadID;
    self.multipartAbort({
      Bucket: Bucket,
      Region: Region,
      Key: AbortItem.Key,
      Headers: params.Headers,
      UploadId: UploadId
    }, function (err) {
      var task = {
        Bucket: Bucket,
        Region: Region,
        Key: AbortItem.Key,
        UploadId: UploadId
      };
      resultList[eachIndex] = {
        error: err,
        task: task
      };
      nextItem(null);
    });
    index++;
  }, function (err) {
    if (err) return callback(err);
    var successList = [];
    var errorList = [];

    for (var i = 0, len = resultList.length; i < len; i++) {
      var item = resultList[i];

      if (item['task']) {
        if (item['error']) {
          errorList.push(item['task']);
        } else {
          successList.push(item['task']);
        }
      }
    }

    return callback(null, {
      successList: successList,
      errorList: errorList
    });
  });
} // 高级上传


function uploadFile(params, callback) {
  var self = this; // 判断多大的文件使用分片上传

  var SliceSize = params.SliceSize === undefined ? self.options.SliceSize : params.SliceSize;
  var taskList = [];
  var Body = params.Body;
  var FileSize = Body.size || Body.length || 0;
  var fileInfo = {
    TaskId: ''
  }; // 上传链路

  if (self.options.EnableTracker) {
    var accelerate = self.options.UseAccelerate || self.options.Domain.includes('accelerate.');
    params.tracker = new Tracker({
      bucket: params.Bucket,
      region: params.Region,
      apiName: 'uploadFile',
      fileKey: params.Key,
      fileSize: FileSize,
      accelerate: accelerate,
      deepTracker: self.options.DeepTracker,
      customId: self.options.CustomId,
      delay: self.options.TrackerDelay
    });
  } // 整理 option，用于返回给回调


  util.each(params, function (v, k) {
    if (_typeof(v) !== 'object' && typeof v !== 'function') {
      fileInfo[k] = v;
    }
  }); // 处理文件 TaskReady

  var _onTaskReady = params.onTaskReady;

  var onTaskReady = function onTaskReady(tid) {
    fileInfo.TaskId = tid;
    _onTaskReady && _onTaskReady(tid);
  };

  params.onTaskReady = onTaskReady; // 添加上传任务,超过阈值使用分块上传，小于等于则简单上传

  var api = FileSize > SliceSize ? 'sliceUploadFile' : 'putObject'; // 处理文件完成

  var _onFileFinish = params.onFileFinish;

  var onFileFinish = function onFileFinish(err, data) {
    // 格式化上报参数并上报
    params.tracker && params.tracker.formatResult(err, data);
    _onFileFinish && _onFileFinish(err, data, fileInfo);
    callback && callback(err, data);
  };

  taskList.push({
    api: api,
    params: params,
    callback: onFileFinish
  });

  self._addTasks(taskList);
} // 批量上传文件


function uploadFiles(params, callback) {
  var self = this; // 判断多大的文件使用分片上传

  var SliceSize = params.SliceSize === undefined ? self.options.SliceSize : params.SliceSize; // 汇总返回进度

  var TotalSize = 0;
  var TotalFinish = 0;
  var onTotalProgress = util.throttleOnProgress.call(self, TotalFinish, params.onProgress); // 汇总返回回调

  var unFinishCount = params.files.length;
  var _onTotalFileFinish = params.onFileFinish;
  var resultList = Array(unFinishCount);

  var onTotalFileFinish = function onTotalFileFinish(err, data, options) {
    onTotalProgress(null, true);
    _onTotalFileFinish && _onTotalFileFinish(err, data, options);
    resultList[options.Index] = {
      options: options,
      error: err,
      data: data
    };

    if (--unFinishCount <= 0 && callback) {
      callback(null, {
        files: resultList
      });
    }
  }; // 开始处理每个文件


  var taskList = [];
  util.each(params.files, function (fileParams, index) {
    (function () {
      // 对齐 nodejs 缩进
      var Body = fileParams.Body;
      var FileSize = Body.size || Body.length || 0;
      var fileInfo = {
        Index: index,
        TaskId: ''
      }; // 更新文件总大小

      TotalSize += FileSize; // 单个文件上传链路

      if (self.options.EnableTracker) {
        var accelerate = self.options.UseAccelerate || self.options.Domain.includes('accelerate.');
        fileParams.tracker = new Tracker({
          bucket: fileParams.Bucket,
          region: fileParams.Region,
          apiName: 'uploadFiles',
          fileKey: fileParams.Key,
          fileSize: FileSize,
          accelerate: accelerate,
          deepTracker: self.options.DeepTracker,
          customId: self.options.CustomId,
          delay: self.options.TrackerDelay
        });
      } // 整理 option，用于返回给回调


      util.each(fileParams, function (v, k) {
        if (_typeof(v) !== 'object' && typeof v !== 'function') {
          fileInfo[k] = v;
        }
      }); // 处理单个文件 TaskReady

      var _onTaskReady = fileParams.onTaskReady;

      var onTaskReady = function onTaskReady(tid) {
        fileInfo.TaskId = tid;
        _onTaskReady && _onTaskReady(tid);
      };

      fileParams.onTaskReady = onTaskReady; // 处理单个文件进度

      var PreAddSize = 0;
      var _onProgress = fileParams.onProgress;

      var onProgress = function onProgress(info) {
        TotalFinish = TotalFinish - PreAddSize + info.loaded;
        PreAddSize = info.loaded;
        _onProgress && _onProgress(info);
        onTotalProgress({
          loaded: TotalFinish,
          total: TotalSize
        });
      };

      fileParams.onProgress = onProgress; // 添加上传任务

      var api = FileSize > SliceSize ? 'sliceUploadFile' : 'putObject'; // 处理单个文件完成

      var _onFileFinish = fileParams.onFileFinish;

      var onFileFinish = function onFileFinish(err, data) {
        // 格式化上报参数并上报
        fileParams.tracker && fileParams.tracker.formatResult(err, data);
        _onFileFinish && _onFileFinish(err, data);
        onTotalFileFinish && onTotalFileFinish(err, data, fileInfo);
      };

      taskList.push({
        api: api,
        params: fileParams,
        callback: onFileFinish
      });
    })();
  });

  self._addTasks(taskList);
} // 分片复制文件


function sliceCopyFile(params, callback) {
  var ep = new EventProxy();
  var self = this;
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var CopySource = params.CopySource;
  var m = util.getSourceParams.call(this, CopySource);

  if (!m) {
    callback(util.error(new Error('CopySource format error')));
    return;
  }

  var SourceBucket = m.Bucket;
  var SourceRegion = m.Region;
  var SourceKey = decodeURIComponent(m.Key);
  var CopySliceSize = params.CopySliceSize === undefined ? self.options.CopySliceSize : params.CopySliceSize;
  CopySliceSize = Math.max(0, CopySliceSize);
  var ChunkSize = params.CopyChunkSize || this.options.CopyChunkSize;
  var ChunkParallel = this.options.CopyChunkParallelLimit;
  var ChunkRetryTimes = this.options.ChunkRetryTimes + 1;
  var ChunkCount = 0;
  var FinishSize = 0;
  var FileSize;
  var onProgress;
  var SourceResHeaders = {};
  var SourceHeaders = {};
  var TargetHeader = {}; // 分片复制完成，开始 multipartComplete 操作

  ep.on('copy_slice_complete', function (UploadData) {
    var metaHeaders = {};
    util.each(params.Headers, function (val, k) {
      if (k.toLowerCase().indexOf('x-cos-meta-') === 0) metaHeaders[k] = val;
    });
    var Parts = util.map(UploadData.PartList, function (item) {
      return {
        PartNumber: item.PartNumber,
        ETag: item.ETag
      };
    }); // 完成上传的请求也做重试

    Async.retry(ChunkRetryTimes, function (tryCallback) {
      self.multipartComplete({
        Bucket: Bucket,
        Region: Region,
        Key: Key,
        UploadId: UploadData.UploadId,
        Parts: Parts,
        calledBySdk: 'sliceCopyFile'
      }, tryCallback);
    }, function (err, data) {
      session.removeUsing(UploadData.UploadId); // 标记 UploadId 没被使用了，因为复制没提供重试，所以只要出错，就是 UploadId 停用了。

      if (err) {
        onProgress(null, true);
        return callback(err);
      }

      session.removeUploadId(UploadData.UploadId);
      onProgress({
        loaded: FileSize,
        total: FileSize
      }, true);
      callback(null, data);
    });
  });
  ep.on('get_copy_data_finish', function (UploadData) {
    // 处理 UploadId 缓存
    var uuid = session.getCopyFileId(CopySource, SourceResHeaders, ChunkSize, Bucket, Key);
    uuid && session.saveUploadId(uuid, UploadData.UploadId, self.options.UploadIdCacheLimit); // 缓存 UploadId

    session.setUsing(UploadData.UploadId); // 标记 UploadId 为正在使用

    var needCopySlices = util.filter(UploadData.PartList, function (SliceItem) {
      if (SliceItem['Uploaded']) {
        FinishSize += SliceItem['PartNumber'] >= ChunkCount ? FileSize % ChunkSize || ChunkSize : ChunkSize;
      }

      return !SliceItem['Uploaded'];
    });
    Async.eachLimit(needCopySlices, ChunkParallel, function (SliceItem, asyncCallback) {
      var PartNumber = SliceItem.PartNumber;
      var CopySourceRange = SliceItem.CopySourceRange;
      var currentSize = SliceItem.end - SliceItem.start;
      Async.retry(ChunkRetryTimes, function (tryCallback) {
        copySliceItem.call(self, {
          Bucket: Bucket,
          Region: Region,
          Key: Key,
          CopySource: CopySource,
          UploadId: UploadData.UploadId,
          PartNumber: PartNumber,
          CopySourceRange: CopySourceRange
        }, tryCallback);
      }, function (err, data) {
        if (err) return asyncCallback(err);
        FinishSize += currentSize;
        onProgress({
          loaded: FinishSize,
          total: FileSize
        });
        SliceItem.ETag = data.ETag;
        asyncCallback(err || null, data);
      });
    }, function (err) {
      if (err) {
        session.removeUsing(UploadData.UploadId); // 标记 UploadId 没被使用了，因为复制没提供重试，所以只要出错，就是 UploadId 停用了。

        onProgress(null, true);
        return callback(err);
      }

      ep.emit('copy_slice_complete', UploadData);
    });
  });
  ep.on('get_chunk_size_finish', function () {
    var createNewUploadId = function createNewUploadId() {
      self.multipartInit({
        Bucket: Bucket,
        Region: Region,
        Key: Key,
        Headers: TargetHeader
      }, function (err, data) {
        if (err) return callback(err);
        params.UploadId = data.UploadId;
        ep.emit('get_copy_data_finish', {
          UploadId: params.UploadId,
          PartList: params.PartList
        });
      });
    }; // 在本地找可用的 UploadId


    var uuid = session.getCopyFileId(CopySource, SourceResHeaders, ChunkSize, Bucket, Key);
    var LocalUploadIdList = session.getUploadIdList(uuid);
    if (!uuid || !LocalUploadIdList) return createNewUploadId();

    var next = function next(index) {
      // 如果本地找不到可用 UploadId，再一个个遍历校验远端
      if (index >= LocalUploadIdList.length) return createNewUploadId();
      var UploadId = LocalUploadIdList[index]; // 如果正在被使用，跳过

      if (session.using[UploadId]) return next(index + 1); // 判断 UploadId 是否存在线上

      wholeMultipartListPart.call(self, {
        Bucket: Bucket,
        Region: Region,
        Key: Key,
        UploadId: UploadId
      }, function (err, PartListData) {
        if (err) {
          // 如果 UploadId 获取会出错，跳过并删除
          session.removeUploadId(UploadId);
          next(index + 1);
        } else {
          // 如果异步回来 UploadId 已经被用了，也跳过
          if (session.using[UploadId]) return next(index + 1); // 找到可用 UploadId

          var finishETagMap = {};
          var offset = 0;
          util.each(PartListData.PartList, function (PartItem) {
            var size = parseInt(PartItem.Size);
            var end = offset + size - 1;
            finishETagMap[PartItem.PartNumber + '|' + offset + '|' + end] = PartItem.ETag;
            offset += size;
          });
          util.each(params.PartList, function (PartItem) {
            var ETag = finishETagMap[PartItem.PartNumber + '|' + PartItem.start + '|' + PartItem.end];

            if (ETag) {
              PartItem.ETag = ETag;
              PartItem.Uploaded = true;
            }
          });
          ep.emit('get_copy_data_finish', {
            UploadId: UploadId,
            PartList: params.PartList
          });
        }
      });
    };

    next(0);
  });
  ep.on('get_file_size_finish', function () {
    // 控制分片大小
    (function () {
      var SIZE = [1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 1024 * 2, 1024 * 4, 1024 * 5];
      var AutoChunkSize = 1024 * 1024;

      for (var i = 0; i < SIZE.length; i++) {
        AutoChunkSize = SIZE[i] * 1024 * 1024;
        if (FileSize / AutoChunkSize <= self.options.MaxPartNumber) break;
      }

      params.ChunkSize = ChunkSize = Math.max(ChunkSize, AutoChunkSize);
      ChunkCount = Math.ceil(FileSize / ChunkSize);
      var list = [];

      for (var partNumber = 1; partNumber <= ChunkCount; partNumber++) {
        var start = (partNumber - 1) * ChunkSize;
        var end = partNumber * ChunkSize < FileSize ? partNumber * ChunkSize - 1 : FileSize - 1;
        var item = {
          PartNumber: partNumber,
          start: start,
          end: end,
          CopySourceRange: "bytes=" + start + "-" + end
        };
        list.push(item);
      }

      params.PartList = list;
    })();

    if (params.Headers['x-cos-metadata-directive'] === 'Replaced') {
      TargetHeader = params.Headers;
    } else {
      TargetHeader = SourceHeaders;
    }

    TargetHeader['x-cos-storage-class'] = params.Headers['x-cos-storage-class'] || SourceHeaders['x-cos-storage-class'];
    TargetHeader = util.clearKey(TargetHeader);
    /**
     * 对于归档存储的对象，如果未恢复副本，则不允许 Copy
     */

    if (SourceHeaders['x-cos-storage-class'] === 'ARCHIVE' || SourceHeaders['x-cos-storage-class'] === 'DEEP_ARCHIVE') {
      var restoreHeader = SourceHeaders['x-cos-restore'];

      if (!restoreHeader || restoreHeader === 'ongoing-request="true"') {
        callback(util.error(new Error('Unrestored archive object is not allowed to be copied')));
        return;
      }
    }
    /**
     * 去除一些无用的头部，规避 multipartInit 出错
     * 这些头部通常是在 putObjectCopy 时才使用
     */


    delete TargetHeader['x-cos-copy-source'];
    delete TargetHeader['x-cos-metadata-directive'];
    delete TargetHeader['x-cos-copy-source-If-Modified-Since'];
    delete TargetHeader['x-cos-copy-source-If-Unmodified-Since'];
    delete TargetHeader['x-cos-copy-source-If-Match'];
    delete TargetHeader['x-cos-copy-source-If-None-Match'];
    ep.emit('get_chunk_size_finish');
  }); // 获取远端复制源文件的大小

  self.headObject({
    Bucket: SourceBucket,
    Region: SourceRegion,
    Key: SourceKey
  }, function (err, data) {
    if (err) {
      if (err.statusCode && err.statusCode === 404) {
        callback(util.error(err, {
          ErrorStatus: SourceKey + ' Not Exist'
        }));
      } else {
        callback(err);
      }

      return;
    }

    FileSize = params.FileSize = data.headers['content-length'];

    if (FileSize === undefined || !FileSize) {
      callback(util.error(new Error('get Content-Length error, please add "Content-Length" to CORS ExposeHeader setting.（ 获取Content-Length失败，请在CORS ExposeHeader设置中添加Content-Length，请参考文档：https://cloud.tencent.com/document/product/436/13318 ）')));
      return;
    }

    onProgress = util.throttleOnProgress.call(self, FileSize, params.onProgress); // 开始上传

    if (FileSize <= CopySliceSize) {
      if (!params.Headers['x-cos-metadata-directive']) {
        params.Headers['x-cos-metadata-directive'] = 'Copy';
      }

      self.putObjectCopy(params, function (err, data) {
        if (err) {
          onProgress(null, true);
          return callback(err);
        }

        onProgress({
          loaded: FileSize,
          total: FileSize
        }, true);
        callback(err, data);
      });
    } else {
      var resHeaders = data.headers;
      SourceResHeaders = resHeaders;
      SourceHeaders = {
        'Cache-Control': resHeaders['cache-control'],
        'Content-Disposition': resHeaders['content-disposition'],
        'Content-Encoding': resHeaders['content-encoding'],
        'Content-Type': resHeaders['content-type'],
        'Expires': resHeaders['expires'],
        'x-cos-storage-class': resHeaders['x-cos-storage-class']
      };
      util.each(resHeaders, function (v, k) {
        var metaPrefix = 'x-cos-meta-';

        if (k.indexOf(metaPrefix) === 0 && k.length > metaPrefix.length) {
          SourceHeaders[k] = v;
        }
      });
      ep.emit('get_file_size_finish');
    }
  });
} // 复制指定分片


function copySliceItem(params, callback) {
  var TaskId = params.TaskId;
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var CopySource = params.CopySource;
  var UploadId = params.UploadId;
  var PartNumber = params.PartNumber * 1;
  var CopySourceRange = params.CopySourceRange;
  var ChunkRetryTimes = this.options.ChunkRetryTimes + 1;
  var self = this;
  Async.retry(ChunkRetryTimes, function (tryCallback) {
    self.uploadPartCopy({
      TaskId: TaskId,
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      CopySource: CopySource,
      UploadId: UploadId,
      PartNumber: PartNumber,
      CopySourceRange: CopySourceRange
    }, function (err, data) {
      tryCallback(err || null, data);
    });
  }, function (err, data) {
    return callback(err, data);
  });
}

var API_MAP = {
  sliceUploadFile: sliceUploadFile,
  abortUploadTask: abortUploadTask,
  uploadFile: uploadFile,
  uploadFiles: uploadFiles,
  sliceCopyFile: sliceCopyFile
};

module.exports.init = function (COS, task) {
  task.transferToTaskMethod(API_MAP, 'sliceUploadFile');
  util.each(API_MAP, function (fn, apiName) {
    COS.prototype[apiName] = util.apiWrapper(apiName, fn);
  });
};

/***/ }),

/***/ "./src/async.js":
/*!**********************!*\
  !*** ./src/async.js ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports) {

var eachLimit = function eachLimit(arr, limit, iterator, callback) {
  callback = callback || function () {};

  if (!arr.length || limit <= 0) {
    return callback();
  }

  var completed = 0;
  var started = 0;
  var running = 0;

  (function replenish() {
    if (completed >= arr.length) {
      return callback();
    }

    while (running < limit && started < arr.length) {
      started += 1;
      running += 1;
      iterator(arr[started - 1], function (err) {
        if (err) {
          callback(err);

          callback = function callback() {};
        } else {
          completed += 1;
          running -= 1;

          if (completed >= arr.length) {
            callback();
          } else {
            replenish();
          }
        }
      });
    }
  })();
};

var retry = function retry(times, iterator, callback) {
  var next = function next(index) {
    iterator(function (err, data) {
      if (err && index < times) {
        next(index + 1);
      } else {
        callback(err, data);
      }
    });
  };

  if (times < 1) {
    callback();
  } else {
    next(1);
  }
};

var async = {
  eachLimit: eachLimit,
  retry: retry
};
module.exports = async;

/***/ }),

/***/ "./src/base.js":
/*!*********************!*\
  !*** ./src/base.js ***!
  \*********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var REQUEST = __webpack_require__(/*! ../lib/request */ "./lib/request.js");

var util = __webpack_require__(/*! ./util */ "./src/util.js"); // Bucket 相关

/**
 * 获取用户的 bucket 列表
 * @param  {Object}  params         回调函数，必须，下面为参数列表
 * 无特殊参数
 * @param  {Function}  callback     回调函数，必须
 */


function getService(params, callback) {
  if (typeof params === 'function') {
    callback = params;
    params = {};
  }

  var protocol = this.options.Protocol || (util.isBrowser && location.protocol === 'http:' ? 'http:' : 'https:');
  var domain = this.options.ServiceDomain;
  var appId = params.AppId || this.options.appId;
  var region = params.Region;

  if (domain) {
    domain = domain.replace(/\{\{AppId\}\}/ig, appId || '').replace(/\{\{Region\}\}/ig, region || '').replace(/\{\{.*?\}\}/ig, '');

    if (!/^[a-zA-Z]+:\/\//.test(domain)) {
      domain = protocol + '//' + domain;
    }

    if (domain.slice(-1) === '/') {
      domain = domain.slice(0, -1);
    }
  } else if (region) {
    domain = protocol + '//cos.' + region + '.myqcloud.com';
  } else {
    domain = protocol + '//service.cos.myqcloud.com';
  }

  var SignHost = '';
  var standardHost = region ? 'cos.' + region + '.myqcloud.com' : 'service.cos.myqcloud.com';
  var urlHost = domain.replace(/^https?:\/\/([^/]+)(\/.*)?$/, '$1');
  if (standardHost === urlHost) SignHost = standardHost;
  submitRequest.call(this, {
    Action: 'name/cos:GetService',
    url: domain,
    method: 'GET',
    headers: params.Headers,
    SignHost: SignHost
  }, function (err, data) {
    if (err) return callback(err);
    var buckets = data && data.ListAllMyBucketsResult && data.ListAllMyBucketsResult.Buckets && data.ListAllMyBucketsResult.Buckets.Bucket || [];
    buckets = util.isArray(buckets) ? buckets : [buckets];
    var owner = data && data.ListAllMyBucketsResult && data.ListAllMyBucketsResult.Owner || {};
    callback(null, {
      Buckets: buckets,
      Owner: owner,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 创建 Bucket，并初始化访问权限
 * @param  {Object}  params                         参数对象，必须
 *     @param  {String}  params.Bucket              Bucket名称，必须
 *     @param  {String}  params.Region              地域名称，必须
 *     @param  {String}  params.ACL                 用户自定义文件权限，可以设置：private，public-read；默认值：private，非必须
 *     @param  {String}  params.GrantRead           赋予被授权者读的权限，格式x-cos-grant-read: uin=" ",uin=" "，非必须
 *     @param  {String}  params.GrantWrite          赋予被授权者写的权限，格式x-cos-grant-write: uin=" ",uin=" "，非必须
 *     @param  {String}  params.GrantFullControl    赋予被授权者读写权限，格式x-cos-grant-full-control: uin=" ",uin=" "，非必须
 * @param  {Function}  callback                     回调函数，必须
 * @return  {Object}  err                           请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                          返回的数据
 *     @return  {String}  data.Location             操作地址
 */


function putBucket(params, callback) {
  var self = this;
  var xml = '';

  if (params['BucketAZConfig']) {
    var CreateBucketConfiguration = {
      BucketAZConfig: params.BucketAZConfig
    };
    xml = util.json2xml({
      CreateBucketConfiguration: CreateBucketConfiguration
    });
  }

  submitRequest.call(this, {
    Action: 'name/cos:PutBucket',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    body: xml
  }, function (err, data) {
    if (err) return callback(err);
    var url = getUrl({
      protocol: self.options.Protocol,
      domain: self.options.Domain,
      bucket: params.Bucket,
      region: params.Region,
      isLocation: true
    });
    callback(null, {
      Location: url,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 查看是否存在该Bucket，是否有权限访问
 * @param  {Object}  params                     参数对象，必须
 *     @param  {String}  params.Bucket          Bucket名称，必须
 *     @param  {String}  params.Region          地域名称，必须
 * @param  {Function}  callback                 回调函数，必须
 * @return  {Object}  err                       请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                      返回的数据
 *     @return  {Boolean}  data.BucketExist     Bucket是否存在
 *     @return  {Boolean}  data.BucketAuth      是否有 Bucket 的访问权限
 */


function headBucket(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:HeadBucket',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    method: 'HEAD'
  }, callback);
}
/**
 * 获取 Bucket 下的 object 列表
 * @param  {Object}  params                         参数对象，必须
 *     @param  {String}  params.Bucket              Bucket名称，必须
 *     @param  {String}  params.Region              地域名称，必须
 *     @param  {String}  params.Prefix              前缀匹配，用来规定返回的文件前缀地址，非必须
 *     @param  {String}  params.Delimiter           定界符为一个符号，如果有Prefix，则将Prefix到delimiter之间的相同路径归为一类，非必须
 *     @param  {String}  params.Marker              默认以UTF-8二进制顺序列出条目，所有列出条目从marker开始，非必须
 *     @param  {String}  params.MaxKeys             单次返回最大的条目数量，默认1000，非必须
 *     @param  {String}  params.EncodingType        规定返回值的编码方式，非必须
 * @param  {Function}  callback                     回调函数，必须
 * @return  {Object}  err                           请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                          返回的数据
 *     @return  {Object}  data.ListBucketResult     返回的 object 列表信息
 */


function getBucket(params, callback) {
  var reqParams = {};
  reqParams['prefix'] = params['Prefix'] || '';
  reqParams['delimiter'] = params['Delimiter'];
  reqParams['marker'] = params['Marker'];
  reqParams['max-keys'] = params['MaxKeys'];
  reqParams['encoding-type'] = params['EncodingType'];
  submitRequest.call(this, {
    Action: 'name/cos:GetBucket',
    ResourceKey: reqParams['prefix'],
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    qs: reqParams
  }, function (err, data) {
    if (err) return callback(err);
    var ListBucketResult = data.ListBucketResult || {};
    var Contents = ListBucketResult.Contents || [];
    var CommonPrefixes = ListBucketResult.CommonPrefixes || [];
    Contents = util.isArray(Contents) ? Contents : [Contents];
    CommonPrefixes = util.isArray(CommonPrefixes) ? CommonPrefixes : [CommonPrefixes];
    var result = util.clone(ListBucketResult);
    util.extend(result, {
      Contents: Contents,
      CommonPrefixes: CommonPrefixes,
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}
/**
 * 删除 Bucket
 * @param  {Object}  params                 参数对象，必须
 *     @param  {String}  params.Bucket      Bucket名称，必须
 *     @param  {String}  params.Region      地域名称，必须
 * @param  {Function}  callback             回调函数，必须
 * @return  {Object}  err                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                  返回的数据
 *     @return  {String}  data.Location     操作地址
 */


function deleteBucket(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucket',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    method: 'DELETE'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 设置 Bucket 的 权限列表
 * @param  {Object}  params                         参数对象，必须
 *     @param  {String}  params.Bucket              Bucket名称，必须
 *     @param  {String}  params.Region              地域名称，必须
 *     @param  {String}  params.ACL                 用户自定义文件权限，可以设置：private，public-read；默认值：private，非必须
 *     @param  {String}  params.GrantRead           赋予被授权者读的权限，格式x-cos-grant-read: uin=" ",uin=" "，非必须
 *     @param  {String}  params.GrantWrite          赋予被授权者写的权限，格式x-cos-grant-write: uin=" ",uin=" "，非必须
 *     @param  {String}  params.GrantFullControl    赋予被授权者读写权限，格式x-cos-grant-full-control: uin=" ",uin=" "，非必须
 * @param  {Function}  callback                     回调函数，必须
 * @return  {Object}  err                           请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                          返回的数据
 */


function putBucketAcl(params, callback) {
  var headers = params.Headers;
  var xml = '';

  if (params['AccessControlPolicy']) {
    var AccessControlPolicy = util.clone(params['AccessControlPolicy'] || {});
    var Grants = AccessControlPolicy.Grants || AccessControlPolicy.Grant;
    Grants = util.isArray(Grants) ? Grants : [Grants];
    delete AccessControlPolicy.Grant;
    delete AccessControlPolicy.Grants;
    AccessControlPolicy.AccessControlList = {
      Grant: Grants
    };
    xml = util.json2xml({
      AccessControlPolicy: AccessControlPolicy
    });
    headers['Content-Type'] = 'application/xml';
    headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  } // Grant Header 去重


  util.each(headers, function (val, key) {
    if (key.indexOf('x-cos-grant-') === 0) {
      headers[key] = uniqGrant(headers[key]);
    }
  });
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketACL',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: headers,
    action: 'acl',
    body: xml
  }, function (err, data) {
    if (err) return callback(err);
    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的 权限列表
 * @param  {Object}  params                         参数对象，必须
 *     @param  {String}  params.Bucket              Bucket名称，必须
 *     @param  {String}  params.Region              地域名称，必须
 * @param  {Function}  callback                     回调函数，必须
 * @return  {Object}  err                           请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                          返回的数据
 *     @return  {Object}  data.AccessControlPolicy  访问权限信息
 */


function getBucketAcl(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketACL',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'acl'
  }, function (err, data) {
    if (err) return callback(err);
    var AccessControlPolicy = data.AccessControlPolicy || {};
    var Owner = AccessControlPolicy.Owner || {};
    var Grant = AccessControlPolicy.AccessControlList.Grant || [];
    Grant = util.isArray(Grant) ? Grant : [Grant];
    var result = decodeAcl(AccessControlPolicy);

    if (data.headers && data.headers['x-cos-acl']) {
      result.ACL = data.headers['x-cos-acl'];
    }

    result = util.extend(result, {
      Owner: Owner,
      Grants: Grant,
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}
/**
 * 设置 Bucket 的 跨域设置
 * @param  {Object}  params                             参数对象，必须
 *     @param  {String}  params.Bucket                  Bucket名称，必须
 *     @param  {String}  params.Region                  地域名称，必须
 *     @param  {Object}  params.CORSConfiguration       相关的跨域设置，必须
 * @param  {Array}  params.CORSConfiguration.CORSRules  对应的跨域规则
 * @param  {Function}  callback                         回调函数，必须
 * @return  {Object}  err                               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                              返回的数据
 */


function putBucketCors(params, callback) {
  var CORSConfiguration = params['CORSConfiguration'] || {};
  var CORSRules = CORSConfiguration['CORSRules'] || params['CORSRules'] || [];
  CORSRules = util.clone(util.isArray(CORSRules) ? CORSRules : [CORSRules]);
  util.each(CORSRules, function (rule) {
    util.each(['AllowedOrigin', 'AllowedHeader', 'AllowedMethod', 'ExposeHeader'], function (key) {
      var sKey = key + 's';
      var val = rule[sKey] || rule[key] || [];
      delete rule[sKey];
      rule[key] = util.isArray(val) ? val : [val];
    });
  });
  var Conf = {
    CORSRule: CORSRules
  };
  if (params.ResponseVary) Conf.ResponseVary = params.ResponseVary;
  var xml = util.json2xml({
    CORSConfiguration: Conf
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketCORS',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'cors',
    headers: headers
  }, function (err, data) {
    if (err) return callback(err);
    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的 跨域设置
 * @param  {Object}  params                         参数对象，必须
 *     @param  {String}  params.Bucket              Bucket名称，必须
 *     @param  {String}  params.Region              地域名称，必须
 * @param  {Function}  callback                     回调函数，必须
 * @return  {Object}  err                           请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                          返回的数据
 *     @return  {Object}  data.CORSRules            Bucket的跨域设置
 */


function getBucketCors(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketCORS',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'cors'
  }, function (err, data) {
    if (err) {
      if (err.statusCode === 404 && err.error && err.error.Code === 'NoSuchCORSConfiguration') {
        var result = {
          CORSRules: [],
          statusCode: err.statusCode
        };
        err.headers && (result.headers = err.headers);
        callback(null, result);
      } else {
        callback(err);
      }

      return;
    }

    var CORSConfiguration = data.CORSConfiguration || {};
    var CORSRules = CORSConfiguration.CORSRules || CORSConfiguration.CORSRule || [];
    CORSRules = util.clone(util.isArray(CORSRules) ? CORSRules : [CORSRules]);
    var ResponseVary = CORSConfiguration.ResponseVary;
    util.each(CORSRules, function (rule) {
      util.each(['AllowedOrigin', 'AllowedHeader', 'AllowedMethod', 'ExposeHeader'], function (key) {
        var sKey = key + 's';
        var val = rule[sKey] || rule[key] || [];
        delete rule[key];
        rule[sKey] = util.isArray(val) ? val : [val];
      });
    });
    callback(null, {
      CORSRules: CORSRules,
      ResponseVary: ResponseVary,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 删除 Bucket 的 跨域设置
 * @param  {Object}  params                 参数对象，必须
 *     @param  {String}  params.Bucket      Bucket名称，必须
 *     @param  {String}  params.Region      地域名称，必须
 * @param  {Function}  callback             回调函数，必须
 * @return  {Object}  err                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                  返回的数据
 */


function deleteBucketCors(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketCORS',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'cors'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode || err.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的 地域信息
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据，包含地域信息 LocationConstraint
 */


function getBucketLocation(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketLocation',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'location'
  }, callback);
}

function putBucketPolicy(params, callback) {
  var Policy = params['Policy'];

  try {
    if (typeof Policy === 'string') Policy = JSON.parse(Policy);
  } catch (e) {}

  if (!Policy || typeof Policy === 'string') return callback(util.error(new Error('Policy format error')));
  var PolicyStr = JSON.stringify(Policy);
  if (!Policy.version) Policy.version = '2.0';
  var headers = params.Headers;
  headers['Content-Type'] = 'application/json';
  headers['Content-MD5'] = util.binaryBase64(util.md5(PolicyStr));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketPolicy',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    action: 'policy',
    body: PolicyStr,
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的读取权限策略
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function getBucketPolicy(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketPolicy',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'policy',
    rawBody: true
  }, function (err, data) {
    if (err) {
      if (err.statusCode && err.statusCode === 403) {
        return callback(util.error(err, {
          ErrorStatus: 'Access Denied'
        }));
      }

      if (err.statusCode && err.statusCode === 405) {
        return callback(util.error(err, {
          ErrorStatus: 'Method Not Allowed'
        }));
      }

      if (err.statusCode && err.statusCode === 404) {
        return callback(util.error(err, {
          ErrorStatus: 'Policy Not Found'
        }));
      }

      return callback(err);
    }

    var Policy = {};

    try {
      Policy = JSON.parse(data.body);
    } catch (e) {}

    callback(null, {
      Policy: Policy,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 删除 Bucket 的 跨域设置
 * @param  {Object}  params                 参数对象，必须
 *     @param  {String}  params.Bucket      Bucket名称，必须
 *     @param  {String}  params.Region      地域名称，必须
 * @param  {Function}  callback             回调函数，必须
 * @return  {Object}  err                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                  返回的数据
 */


function deleteBucketPolicy(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketPolicy',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'policy'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode || err.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 设置 Bucket 的标签
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 *     @param  {Array}   params.TagSet  标签设置，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function putBucketTagging(params, callback) {
  var Tagging = params['Tagging'] || {};
  var Tags = Tagging.TagSet || Tagging.Tags || params['Tags'] || [];
  Tags = util.clone(util.isArray(Tags) ? Tags : [Tags]);
  var xml = util.json2xml({
    Tagging: {
      TagSet: {
        Tag: Tags
      }
    }
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketTagging',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'tagging',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的标签设置
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function getBucketTagging(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketTagging',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'tagging'
  }, function (err, data) {
    if (err) {
      if (err.statusCode === 404 && err.error && (err.error === "Not Found" || err.error.Code === 'NoSuchTagSet')) {
        var result = {
          Tags: [],
          statusCode: err.statusCode
        };
        err.headers && (result.headers = err.headers);
        callback(null, result);
      } else {
        callback(err);
      }

      return;
    }

    var Tags = [];

    try {
      Tags = data.Tagging.TagSet.Tag || [];
    } catch (e) {}

    Tags = util.clone(util.isArray(Tags) ? Tags : [Tags]);
    callback(null, {
      Tags: Tags,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 删除 Bucket 的 标签设置
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回的数据
 */


function deleteBucketTagging(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketTagging',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'tagging'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}

function putBucketLifecycle(params, callback) {
  var LifecycleConfiguration = params['LifecycleConfiguration'] || {};
  var Rules = LifecycleConfiguration.Rules || params.Rules || [];
  Rules = util.clone(Rules);
  var xml = util.json2xml({
    LifecycleConfiguration: {
      Rule: Rules
    }
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketLifecycle',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'lifecycle',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}

function getBucketLifecycle(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketLifecycle',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'lifecycle'
  }, function (err, data) {
    if (err) {
      if (err.statusCode === 404 && err.error && err.error.Code === 'NoSuchLifecycleConfiguration') {
        var result = {
          Rules: [],
          statusCode: err.statusCode
        };
        err.headers && (result.headers = err.headers);
        callback(null, result);
      } else {
        callback(err);
      }

      return;
    }

    var Rules = [];

    try {
      Rules = data.LifecycleConfiguration.Rule || [];
    } catch (e) {}

    Rules = util.clone(util.isArray(Rules) ? Rules : [Rules]);
    callback(null, {
      Rules: Rules,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}

function deleteBucketLifecycle(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketLifecycle',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'lifecycle'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}

function putBucketVersioning(params, callback) {
  if (!params['VersioningConfiguration']) {
    callback(util.error(new Error('missing param VersioningConfiguration')));
    return;
  }

  var VersioningConfiguration = params['VersioningConfiguration'] || {};
  var xml = util.json2xml({
    VersioningConfiguration: VersioningConfiguration
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketVersioning',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'versioning',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}

function getBucketVersioning(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketVersioning',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'versioning'
  }, function (err, data) {
    if (!err) {
      !data.VersioningConfiguration && (data.VersioningConfiguration = {});
    }

    callback(err, data);
  });
}

function putBucketReplication(params, callback) {
  var ReplicationConfiguration = util.clone(params.ReplicationConfiguration);
  var xml = util.json2xml({
    ReplicationConfiguration: ReplicationConfiguration
  });
  xml = xml.replace(/<(\/?)Rules>/ig, '<$1Rule>');
  xml = xml.replace(/<(\/?)Tags>/ig, '<$1Tag>');
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketReplication',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'replication',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}

function getBucketReplication(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketReplication',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'replication'
  }, function (err, data) {
    if (err) {
      if (err.statusCode === 404 && err.error && (err.error === 'Not Found' || err.error.Code === 'ReplicationConfigurationnotFoundError')) {
        var result = {
          ReplicationConfiguration: {
            Rules: []
          },
          statusCode: err.statusCode
        };
        err.headers && (result.headers = err.headers);
        callback(null, result);
      } else {
        callback(err);
      }

      return;
    }

    !data.ReplicationConfiguration && (data.ReplicationConfiguration = {});

    if (data.ReplicationConfiguration.Rule) {
      data.ReplicationConfiguration.Rules = util.makeArray(data.ReplicationConfiguration.Rule);
      delete data.ReplicationConfiguration.Rule;
    }

    callback(err, data);
  });
}

function deleteBucketReplication(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketReplication',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'replication'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 设置 Bucket 静态网站配置信息
 * @param  {Object}  params                                                 参数对象，必须
 *     @param  {String}  params.Bucket                                      Bucket名称，必须
 *     @param  {String}  params.Region                                      地域名称，必须
 *     @param  {Object}  params.WebsiteConfiguration                        地域名称，必须
 *         @param  {Object}   WebsiteConfiguration.IndexDocument            索引文档，必须
 *         @param  {Object}   WebsiteConfiguration.ErrorDocument            错误文档，非必须
 *         @param  {Object}   WebsiteConfiguration.RedirectAllRequestsTo    重定向所有请求，非必须
 *         @param  {Array}   params.RoutingRules                            重定向规则，非必须
 * @param  {Function}  callback                                             回调函数，必须
 * @return  {Object}  err                                                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                                  返回数据
 */


function putBucketWebsite(params, callback) {
  if (!params['WebsiteConfiguration']) {
    callback(util.error(new Error('missing param WebsiteConfiguration')));
    return;
  }

  var WebsiteConfiguration = util.clone(params['WebsiteConfiguration'] || {});
  var RoutingRules = WebsiteConfiguration['RoutingRules'] || WebsiteConfiguration['RoutingRule'] || [];
  RoutingRules = util.isArray(RoutingRules) ? RoutingRules : [RoutingRules];
  delete WebsiteConfiguration.RoutingRule;
  delete WebsiteConfiguration.RoutingRules;
  if (RoutingRules.length) WebsiteConfiguration.RoutingRules = {
    RoutingRule: RoutingRules
  };
  var xml = util.json2xml({
    WebsiteConfiguration: WebsiteConfiguration
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketWebsite',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'website',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的静态网站配置信息
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function getBucketWebsite(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketWebsite',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: params.Headers,
    action: 'website'
  }, function (err, data) {
    if (err) {
      if (err.statusCode === 404 && err.error.Code === 'NoSuchWebsiteConfiguration') {
        var result = {
          WebsiteConfiguration: {},
          statusCode: err.statusCode
        };
        err.headers && (result.headers = err.headers);
        callback(null, result);
      } else {
        callback(err);
      }

      return;
    }

    var WebsiteConfiguration = data.WebsiteConfiguration || {};

    if (WebsiteConfiguration['RoutingRules']) {
      var RoutingRules = util.clone(WebsiteConfiguration['RoutingRules'].RoutingRule || []);
      RoutingRules = util.makeArray(RoutingRules);
      WebsiteConfiguration.RoutingRules = RoutingRules;
    }

    callback(null, {
      WebsiteConfiguration: WebsiteConfiguration,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 删除 Bucket 的静态网站配置
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function deleteBucketWebsite(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketWebsite',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'website'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 设置 Bucket 的防盗链白名单或者黑名单
 * @param  {Object}  params                                                 参数对象，必须
 *     @param  {String}  params.Bucket                                      Bucket名称，必须
 *     @param  {String}  params.Region                                      地域名称，必须
 *     @param  {Object}  params.RefererConfiguration                        地域名称，必须
 *         @param  {String}   RefererConfiguration.Status                   是否开启防盗链，枚举值：Enabled、Disabled
 *         @param  {String}   RefererConfiguration.RefererType              防盗链类型，枚举值：Black-List、White-List，必须
 *         @param  {Array}   RefererConfiguration.DomianList.Domain         生效域名，必须
 *         @param  {String}   RefererConfiguration.EmptyReferConfiguration  ，非必须
 * @param  {Function}  callback                                             回调函数，必须
 * @return  {Object}  err                                                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                                  返回数据
 */


function putBucketReferer(params, callback) {
  if (!params['RefererConfiguration']) {
    callback(util.error(new Error('missing param RefererConfiguration')));
    return;
  }

  var RefererConfiguration = util.clone(params['RefererConfiguration'] || {});
  var DomainList = RefererConfiguration['DomainList'] || {};
  var Domains = DomainList['Domains'] || DomainList['Domain'] || [];
  Domains = util.isArray(Domains) ? Domains : [Domains];
  if (Domains.length) RefererConfiguration.DomainList = {
    Domain: Domains
  };
  var xml = util.json2xml({
    RefererConfiguration: RefererConfiguration
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketReferer',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'referer',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的防盗链白名单或者黑名单
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function getBucketReferer(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketReferer',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: params.Headers,
    action: 'referer'
  }, function (err, data) {
    if (err) {
      if (err.statusCode === 404 && err.error.Code === 'NoSuchRefererConfiguration') {
        var result = {
          WebsiteConfiguration: {},
          statusCode: err.statusCode
        };
        err.headers && (result.headers = err.headers);
        callback(null, result);
      } else {
        callback(err);
      }

      return;
    }

    var RefererConfiguration = data.RefererConfiguration || {};

    if (RefererConfiguration['DomainList']) {
      var Domains = util.makeArray(RefererConfiguration['DomainList'].Domain || []);
      RefererConfiguration.DomainList = {
        Domains: Domains
      };
    }

    callback(null, {
      RefererConfiguration: RefererConfiguration,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 设置 Bucket 自定义域名
 * @param  {Object}  params                                                 参数对象，必须
 *     @param  {String}  params.Bucket                                      Bucket名称，必须
 *     @param  {String}  params.Region                                      地域名称，必须
 * @param  {Function}  callback                                             回调函数，必须
 * @return  {Object}  err                                                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                                  返回数据
 */


function putBucketDomain(params, callback) {
  var DomainConfiguration = params['DomainConfiguration'] || {};
  var DomainRule = DomainConfiguration.DomainRule || params.DomainRule || [];
  DomainRule = util.clone(DomainRule);
  var xml = util.json2xml({
    DomainConfiguration: {
      DomainRule: DomainRule
    }
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketDomain',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'domain',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的自定义域名
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function getBucketDomain(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketDomain',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'domain'
  }, function (err, data) {
    if (err) return callback(err);
    var DomainRule = [];

    try {
      DomainRule = data.DomainConfiguration.DomainRule || [];
    } catch (e) {}

    DomainRule = util.clone(util.isArray(DomainRule) ? DomainRule : [DomainRule]);
    callback(null, {
      DomainRule: DomainRule,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 删除 Bucket 自定义域名
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function deleteBucketDomain(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketDomain',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'domain'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 设置 Bucket 的回源
 * @param  {Object}  params                                                 参数对象，必须
 *     @param  {String}  params.Bucket                                      Bucket名称，必须
 *     @param  {String}  params.Region                                      地域名称，必须
 * @param  {Function}  callback                                             回调函数，必须
 * @return  {Object}  err                                                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                                  返回数据
 */


function putBucketOrigin(params, callback) {
  var OriginConfiguration = params['OriginConfiguration'] || {};
  var OriginRule = OriginConfiguration.OriginRule || params.OriginRule || [];
  OriginRule = util.clone(OriginRule);
  var xml = util.json2xml({
    OriginConfiguration: {
      OriginRule: OriginRule
    }
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketOrigin',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'origin',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的回源
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function getBucketOrigin(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketOrigin',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'origin'
  }, function (err, data) {
    if (err) return callback(err);
    var OriginRule = [];

    try {
      OriginRule = data.OriginConfiguration.OriginRule || [];
    } catch (e) {}

    OriginRule = util.clone(util.isArray(OriginRule) ? OriginRule : [OriginRule]);
    callback(null, {
      OriginRule: OriginRule,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 删除 Bucket 的回源
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function deleteBucketOrigin(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketOrigin',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'origin'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 设置 Bucket 的日志记录
 * @param  {Object}  params                                                 参数对象，必须
 *     @param  {String}  params.Bucket                                      Bucket名称，必须
 *     @param  {String}  params.Region                                      地域名称，必须
 *     @param  {(Object|String)}  params.BucketLoggingStatus                         说明日志记录配置的状态，如果无子节点信息则意为关闭日志记录，必须
 * @param  {Function}  callback                                             回调函数，必须
 * @return  {Object}  err                                                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                                  返回数据
 */


function putBucketLogging(params, callback) {
  var xml = util.json2xml({
    BucketLoggingStatus: params['BucketLoggingStatus'] || ''
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketLogging',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'logging',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的日志记录
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function getBucketLogging(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketLogging',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'logging'
  }, function (err, data) {
    if (err) return callback(err);
    callback(null, {
      BucketLoggingStatus: data.BucketLoggingStatus,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 创建/编辑 Bucket 的清单任务
 * @param  {Object}  params                                                 参数对象，必须
 *     @param  {String}  params.Bucket                                      Bucket名称，必须
 *     @param  {String}  params.Region                                      地域名称，必须
 *     @param  {String}  params.Id                                          清单任务的名称，必须
 *     @param  {Object}  params.InventoryConfiguration                      包含清单的配置参数，必须
 * @param  {Function}  callback                                             回调函数，必须
 * @return  {Object}  err                                                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                                  返回数据
 */


function putBucketInventory(params, callback) {
  var InventoryConfiguration = util.clone(params['InventoryConfiguration']);

  if (InventoryConfiguration.OptionalFields) {
    var Field = InventoryConfiguration.OptionalFields || [];
    InventoryConfiguration.OptionalFields = {
      Field: Field
    };
  }

  if (InventoryConfiguration.Destination && InventoryConfiguration.Destination.COSBucketDestination && InventoryConfiguration.Destination.COSBucketDestination.Encryption) {
    var Encryption = InventoryConfiguration.Destination.COSBucketDestination.Encryption;

    if (Object.keys(Encryption).indexOf('SSECOS') > -1) {
      Encryption['SSE-COS'] = Encryption['SSECOS'];
      delete Encryption['SSECOS'];
    }
  }

  var xml = util.json2xml({
    InventoryConfiguration: InventoryConfiguration
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketInventory',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'inventory',
    qs: {
      id: params['Id']
    },
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的清单任务信息
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 *     @param  {String}  params.Id      清单任务的名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function getBucketInventory(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketInventory',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'inventory',
    qs: {
      id: params['Id']
    }
  }, function (err, data) {
    if (err) return callback(err);
    var InventoryConfiguration = data['InventoryConfiguration'];

    if (InventoryConfiguration && InventoryConfiguration.OptionalFields && InventoryConfiguration.OptionalFields.Field) {
      var Field = InventoryConfiguration.OptionalFields.Field;

      if (!util.isArray(Field)) {
        Field = [Field];
      }

      InventoryConfiguration.OptionalFields = Field;
    }

    if (InventoryConfiguration.Destination && InventoryConfiguration.Destination.COSBucketDestination && InventoryConfiguration.Destination.COSBucketDestination.Encryption) {
      var Encryption = InventoryConfiguration.Destination.COSBucketDestination.Encryption;

      if (Object.keys(Encryption).indexOf('SSE-COS') > -1) {
        Encryption['SSECOS'] = Encryption['SSE-COS'];
        delete Encryption['SSE-COS'];
      }
    }

    callback(null, {
      InventoryConfiguration: InventoryConfiguration,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的清单任务信息
 * @param  {Object}  params                             参数对象，必须
 *     @param  {String}  params.Bucket                  Bucket名称，必须
 *     @param  {String}  params.Region                  地域名称，必须
 *     @param  {String}  params.ContinuationToken       当 COS 响应体中 IsTruncated 为 true，且 NextContinuationToken 节点中存在参数值时，您可以将这个参数作为 continuation-token 参数值，以获取下一页的清单任务信息，非必须
 * @param  {Function}  callback                         回调函数，必须
 * @return  {Object}  err                               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                              返回数据
 */


function listBucketInventory(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:ListBucketInventory',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'inventory',
    qs: {
      'continuation-token': params['ContinuationToken']
    }
  }, function (err, data) {
    if (err) return callback(err);
    var ListInventoryConfigurationResult = data['ListInventoryConfigurationResult'];
    var InventoryConfigurations = ListInventoryConfigurationResult.InventoryConfiguration || [];
    InventoryConfigurations = util.isArray(InventoryConfigurations) ? InventoryConfigurations : [InventoryConfigurations];
    delete ListInventoryConfigurationResult['InventoryConfiguration'];
    util.each(InventoryConfigurations, function (InventoryConfiguration) {
      if (InventoryConfiguration && InventoryConfiguration.OptionalFields && InventoryConfiguration.OptionalFields.Field) {
        var Field = InventoryConfiguration.OptionalFields.Field;

        if (!util.isArray(Field)) {
          Field = [Field];
        }

        InventoryConfiguration.OptionalFields = Field;
      }

      if (InventoryConfiguration.Destination && InventoryConfiguration.Destination.COSBucketDestination && InventoryConfiguration.Destination.COSBucketDestination.Encryption) {
        var Encryption = InventoryConfiguration.Destination.COSBucketDestination.Encryption;

        if (Object.keys(Encryption).indexOf('SSE-COS') > -1) {
          Encryption['SSECOS'] = Encryption['SSE-COS'];
          delete Encryption['SSE-COS'];
        }
      }
    });
    ListInventoryConfigurationResult.InventoryConfigurations = InventoryConfigurations;
    util.extend(ListInventoryConfigurationResult, {
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, ListInventoryConfigurationResult);
  });
}
/**
 * 删除 Bucket 的清单任务
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 *     @param  {String}  params.Id      清单任务的名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function deleteBucketInventory(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketInventory',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'inventory',
    qs: {
      id: params['Id']
    }
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/* 全球加速 */


function putBucketAccelerate(params, callback) {
  if (!params['AccelerateConfiguration']) {
    callback(util.error(new Error('missing param AccelerateConfiguration')));
    return;
  }

  var configuration = {
    AccelerateConfiguration: params.AccelerateConfiguration || {}
  };
  var xml = util.json2xml(configuration);
  var headers = {};
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketAccelerate',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'accelerate',
    headers: headers
  }, function (err, data) {
    if (err) return callback(err);
    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}

function getBucketAccelerate(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketAccelerate',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    action: 'accelerate'
  }, function (err, data) {
    if (!err) {
      !data.AccelerateConfiguration && (data.AccelerateConfiguration = {});
    }

    callback(err, data);
  });
}

function putBucketEncryption(params, callback) {
  var conf = params.ServerSideEncryptionConfiguration || {};
  var Rules = conf.Rule || conf.Rules || [];
  var xml = util.json2xml({
    ServerSideEncryptionConfiguration: {
      Rule: Rules
    }
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketEncryption',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'encryption',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}

function getBucketEncryption(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketEncryption',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'encryption'
  }, function (err, data) {
    if (err) {
      if (err.statusCode === 404 && err.code === 'NoSuchEncryptionConfiguration') {
        var result = {
          EncryptionConfiguration: {
            Rules: []
          },
          statusCode: err.statusCode
        };
        err.headers && (result.headers = err.headers);
        callback(null, result);
      } else {
        callback(err);
      }

      return;
    }

    var Rules = util.makeArray(data.EncryptionConfiguration && data.EncryptionConfiguration.Rule || []);
    data.EncryptionConfiguration = {
      Rules: Rules
    };
    callback(err, data);
  });
}

function deleteBucketEncryption(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketReplication',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'encryption'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
} // Object 相关

/**
 * 取回对应Object的元数据，Head的权限与Get的权限一致
 * @param  {Object}  params                         参数对象，必须
 *     @param  {String}  params.Bucket              Bucket名称，必须
 *     @param  {String}  params.Region              地域名称，必须
 *     @param  {String}  params.Key                 文件名称，必须
 *     @param  {String}  params.IfModifiedSince     当Object在指定时间后被修改，则返回对应Object元信息，否则返回304，非必须
 * @param  {Function}  callback                     回调函数，必须
 * @return  {Object}  err                           请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                          为指定 object 的元数据，如果设置了 IfModifiedSince ，且文件未修改，则返回一个对象，NotModified 属性为 true
 *     @return  {Boolean}  data.NotModified         是否在 IfModifiedSince 时间点之后未修改该 object，则为 true
 */


function headObject(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:HeadObject',
    method: 'HEAD',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    VersionId: params.VersionId,
    headers: params.Headers
  }, function (err, data) {
    if (err) {
      var statusCode = err.statusCode;

      if (params.Headers['If-Modified-Since'] && statusCode && statusCode === 304) {
        return callback(null, {
          NotModified: true,
          statusCode: statusCode
        });
      }

      return callback(err);
    }

    data.ETag = util.attr(data.headers, 'etag', '');
    callback(null, data);
  });
}

function listObjectVersions(params, callback) {
  var reqParams = {};
  reqParams['prefix'] = params['Prefix'] || '';
  reqParams['delimiter'] = params['Delimiter'];
  reqParams['key-marker'] = params['KeyMarker'];
  reqParams['version-id-marker'] = params['VersionIdMarker'];
  reqParams['max-keys'] = params['MaxKeys'];
  reqParams['encoding-type'] = params['EncodingType'];
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketObjectVersions',
    ResourceKey: reqParams['prefix'],
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    qs: reqParams,
    action: 'versions'
  }, function (err, data) {
    if (err) return callback(err);
    var ListVersionsResult = data.ListVersionsResult || {};
    var DeleteMarkers = ListVersionsResult.DeleteMarker || [];
    DeleteMarkers = util.isArray(DeleteMarkers) ? DeleteMarkers : [DeleteMarkers];
    var Versions = ListVersionsResult.Version || [];
    Versions = util.isArray(Versions) ? Versions : [Versions];
    var result = util.clone(ListVersionsResult);
    delete result.DeleteMarker;
    delete result.Version;
    util.extend(result, {
      DeleteMarkers: DeleteMarkers,
      Versions: Versions,
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}
/**
 * 下载 object
 * @param  {Object}  params                                 参数对象，必须
 *     @param  {String}  params.Bucket                      Bucket名称，必须
 *     @param  {String}  params.Region                      地域名称，必须
 *     @param  {String}  params.Key                         文件名称，必须
 *     @param  {WriteStream}  params.Output                 文件写入流，非必须
 *     @param  {String}  params.IfModifiedSince             当Object在指定时间后被修改，则返回对应Object元信息，否则返回304，非必须
 *     @param  {String}  params.IfUnmodifiedSince           如果文件修改时间早于或等于指定时间，才返回文件内容。否则返回 412 (precondition failed)，非必须
 *     @param  {String}  params.IfMatch                     当 ETag 与指定的内容一致，才返回文件。否则返回 412 (precondition failed)，非必须
 *     @param  {String}  params.IfNoneMatch                 当 ETag 与指定的内容不一致，才返回文件。否则返回304 (not modified)，非必须
 *     @param  {String}  params.ResponseContentType         设置返回头部中的 Content-Type 参数，非必须
 *     @param  {String}  params.ResponseContentLanguage     设置返回头部中的 Content-Language 参数，非必须
 *     @param  {String}  params.ResponseExpires             设置返回头部中的 Content-Expires 参数，非必须
 *     @param  {String}  params.ResponseCacheControl        设置返回头部中的 Cache-Control 参数，非必须
 *     @param  {String}  params.ResponseContentDisposition  设置返回头部中的 Content-Disposition 参数，非必须
 *     @param  {String}  params.ResponseContentEncoding     设置返回头部中的 Content-Encoding 参数，非必须
 * @param  {Function}  callback                             回调函数，必须
 * @param  {Object}  err                                    请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @param  {Object}  data                                   为对应的 object 数据，包括 body 和 headers
 */


function getObject(params, callback) {
  var reqParams = params.Query || {};
  var reqParamsStr = params.QueryString || '';
  var onProgress = util.throttleOnProgress.call(this, 0, params.onProgress);
  var tracker = params.tracker;
  tracker && tracker.setParams({
    signStartTime: new Date().getTime()
  });
  reqParams['response-content-type'] = params['ResponseContentType'];
  reqParams['response-content-language'] = params['ResponseContentLanguage'];
  reqParams['response-expires'] = params['ResponseExpires'];
  reqParams['response-cache-control'] = params['ResponseCacheControl'];
  reqParams['response-content-disposition'] = params['ResponseContentDisposition'];
  reqParams['response-content-encoding'] = params['ResponseContentEncoding']; // 如果用户自己传入了 output

  submitRequest.call(this, {
    Action: 'name/cos:GetObject',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    VersionId: params.VersionId,
    DataType: params.DataType,
    headers: params.Headers,
    qs: reqParams,
    qsStr: reqParamsStr,
    rawBody: true,
    onDownloadProgress: onProgress,
    tracker: tracker
  }, function (err, data) {
    onProgress(null, true);

    if (err) {
      var statusCode = err.statusCode;

      if (params.Headers['If-Modified-Since'] && statusCode && statusCode === 304) {
        return callback(null, {
          NotModified: true
        });
      }

      return callback(err);
    }

    callback(null, {
      Body: data.body,
      ETag: util.attr(data.headers, 'etag', ''),
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 上传 object
 * @param  {Object} params                                          参数对象，必须
 *     @param  {String}  params.Bucket                              Bucket名称，必须
 *     @param  {String}  params.Region                              地域名称，必须
 *     @param  {String}  params.Key                                 文件名称，必须
 *     @param  {File || Blob || String}  params.Body                上传文件对象或字符串，必须
 *     @param  {String}  params.CacheControl                        RFC 2616 中定义的缓存策略，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ContentDisposition                  RFC 2616 中定义的文件名称，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ContentEncoding                     RFC 2616 中定义的编码格式，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ContentLength                       RFC 2616 中定义的 HTTP 请求内容长度（字节），必须
 *     @param  {String}  params.ContentType                         RFC 2616 中定义的内容类型（MIME），将作为 Object 元数据保存，非必须
 *     @param  {String}  params.Expect                              当使用 Expect: 100-continue 时，在收到服务端确认后，才会发送请求内容，非必须
 *     @param  {String}  params.Expires                             RFC 2616 中定义的过期时间，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ACL                                 允许用户自定义文件权限，有效值：private | public-read，非必须
 *     @param  {String}  params.GrantRead                           赋予被授权者读取对象的权限，格式：id="[OwnerUin]"，可使用半角逗号（,）分隔多组被授权者，非必须
 *     @param  {String}  params.GrantReadAcp                        赋予被授权者读取对象的访问控制列表（ACL）的权限，格式：id="[OwnerUin]"，可使用半角逗号（,）分隔多组被授权者，非必须
 *     @param  {String}  params.GrantWriteAcp                       赋予被授权者写入对象的访问控制列表（ACL）的权限，格式：id="[OwnerUin]"，可使用半角逗号（,）分隔多组被授权者，非必须
 *     @param  {String}  params.GrantFullControl                    赋予被授权者操作对象的所有权限，格式：id="[OwnerUin]"，可使用半角逗号（,）分隔多组被授权者，非必须
 *     @param  {String}  params.StorageClass                        设置对象的存储级别，枚举值：STANDARD、STANDARD_IA、ARCHIVE，默认值：STANDARD，非必须
 *     @param  {String}  params.x-cos-meta-*                        允许用户自定义的头部信息，将作为对象的元数据保存。大小限制2KB，非必须
 *     @param  {String}  params.ContentSha1                         RFC 3174 中定义的 160-bit 内容 SHA-1 算法校验，非必须
 *     @param  {String}  params.ServerSideEncryption                支持按照指定的加密算法进行服务端数据加密，格式 x-cos-server-side-encryption: "AES256"，非必须
 *     @param  {Function}  params.onProgress                        上传进度回调函数
 * @param  {Function}  callback                                     回调函数，必须
 * @return  {Object}  err                                           请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                          为对应的 object 数据
 *     @return  {String}  data.ETag                                 为对应上传文件的 ETag 值
 */


function putObject(params, callback) {
  var self = this;
  var FileSize = params.ContentLength;
  var onProgress = util.throttleOnProgress.call(self, FileSize, params.onProgress); // 特殊处理 Cache-Control、Content-Type，避免代理更改这两个字段导致写入到 Object 属性里

  var headers = params.Headers;
  if (!headers['Cache-Control'] && !headers['cache-control']) headers['Cache-Control'] = '';
  if (!headers['Content-Type'] && !headers['content-type']) headers['Content-Type'] = params.Body && params.Body.type || '';
  var needCalcMd5 = params.UploadAddMetaMd5 || self.options.UploadAddMetaMd5 || self.options.UploadCheckContentMd5;
  var tracker = params.tracker;
  needCalcMd5 && tracker && tracker.setParams({
    md5StartTime: new Date().getTime()
  });
  util.getBodyMd5(needCalcMd5, params.Body, function (md5) {
    if (md5) {
      tracker && tracker.setParams({
        md5EndTime: new Date().getTime()
      });
      if (self.options.UploadCheckContentMd5) headers['Content-MD5'] = util.binaryBase64(md5);
      if (params.UploadAddMetaMd5 || self.options.UploadAddMetaMd5) headers['x-cos-meta-md5'] = md5;
    }

    if (params.ContentLength !== undefined) headers['Content-Length'] = params.ContentLength;
    onProgress(null, true); // 任务状态开始 uploading

    submitRequest.call(self, {
      Action: 'name/cos:PutObject',
      TaskId: params.TaskId,
      method: 'PUT',
      Bucket: params.Bucket,
      Region: params.Region,
      Key: params.Key,
      headers: params.Headers,
      qs: params.Query,
      body: params.Body,
      onProgress: onProgress,
      tracker: tracker
    }, function (err, data) {
      if (err) {
        onProgress(null, true);
        return callback(err);
      }

      onProgress({
        loaded: FileSize,
        total: FileSize
      }, true);
      var url = getUrl({
        ForcePathStyle: self.options.ForcePathStyle,
        protocol: self.options.Protocol,
        domain: self.options.Domain,
        bucket: params.Bucket,
        region: !self.options.UseAccelerate ? params.Region : 'accelerate',
        object: params.Key
      });
      url = url.substr(url.indexOf('://') + 3);
      data.Location = url;
      data.ETag = util.attr(data.headers, 'etag', '');
      callback(null, data);
    });
  }, params.onHashProgress);
}
/**
 * 删除 object
 * @param  {Object}  params                     参数对象，必须
 *     @param  {String}  params.Bucket          Bucket名称，必须
 *     @param  {String}  params.Region          地域名称，必须
 *     @param  {String}  params.Key             object名称，必须
 * @param  {Function}  callback                 回调函数，必须
 * @param  {Object}  err                        请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @param  {Object}  data                       删除操作成功之后返回的数据
 */


function deleteObject(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteObject',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: params.Headers,
    VersionId: params.VersionId,
    action: params.Recursive ? 'recursive' : ''
  }, function (err, data) {
    if (err) {
      var statusCode = err.statusCode;

      if (statusCode && statusCode === 404) {
        return callback(null, {
          BucketNotFound: true,
          statusCode: statusCode
        });
      } else {
        return callback(err);
      }
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 object 的 权限列表
 * @param  {Object}  params                         参数对象，必须
 *     @param  {String}  params.Bucket              Bucket名称，必须
 *     @param  {String}  params.Region              地域名称，必须
 *     @param  {String}  params.Key                 object名称，必须
 * @param  {Function}  callback                     回调函数，必须
 * @return  {Object}  err                           请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                          返回的数据
 *     @return  {Object}  data.AccessControlPolicy  权限列表
 */


function getObjectAcl(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetObjectACL',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: params.Headers,
    action: 'acl'
  }, function (err, data) {
    if (err) return callback(err);
    var AccessControlPolicy = data.AccessControlPolicy || {};
    var Owner = AccessControlPolicy.Owner || {};
    var Grant = AccessControlPolicy.AccessControlList && AccessControlPolicy.AccessControlList.Grant || [];
    Grant = util.isArray(Grant) ? Grant : [Grant];
    var result = decodeAcl(AccessControlPolicy);
    delete result.GrantWrite;

    if (data.headers && data.headers['x-cos-acl']) {
      result.ACL = data.headers['x-cos-acl'];
    }

    result = util.extend(result, {
      Owner: Owner,
      Grants: Grant,
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}
/**
 * 设置 object 的 权限列表
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 *     @param  {String}  params.Key     object名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回的数据
 */


function putObjectAcl(params, callback) {
  var headers = params.Headers;
  var xml = '';

  if (params['AccessControlPolicy']) {
    var AccessControlPolicy = util.clone(params['AccessControlPolicy'] || {});
    var Grants = AccessControlPolicy.Grants || AccessControlPolicy.Grant;
    Grants = util.isArray(Grants) ? Grants : [Grants];
    delete AccessControlPolicy.Grant;
    delete AccessControlPolicy.Grants;
    AccessControlPolicy.AccessControlList = {
      Grant: Grants
    };
    xml = util.json2xml({
      AccessControlPolicy: AccessControlPolicy
    });
    headers['Content-Type'] = 'application/xml';
    headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  } // Grant Header 去重


  util.each(headers, function (val, key) {
    if (key.indexOf('x-cos-grant-') === 0) {
      headers[key] = uniqGrant(headers[key]);
    }
  });
  submitRequest.call(this, {
    Action: 'name/cos:PutObjectACL',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    action: 'acl',
    headers: headers,
    body: xml
  }, function (err, data) {
    if (err) return callback(err);
    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * Options Object请求实现跨域访问的预请求。即发出一个 OPTIONS 请求给服务器以确认是否可以进行跨域操作。
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 *     @param  {String}  params.Key     object名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回的数据
 */


function optionsObject(params, callback) {
  var headers = params.Headers;
  headers['Origin'] = params['Origin'];
  headers['Access-Control-Request-Method'] = params['AccessControlRequestMethod'];
  headers['Access-Control-Request-Headers'] = params['AccessControlRequestHeaders'];
  submitRequest.call(this, {
    Action: 'name/cos:OptionsObject',
    method: 'OPTIONS',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: headers
  }, function (err, data) {
    if (err) {
      if (err.statusCode && err.statusCode === 403) {
        return callback(null, {
          OptionsForbidden: true,
          statusCode: err.statusCode
        });
      }

      return callback(err);
    }

    var headers = data.headers || {};
    callback(null, {
      AccessControlAllowOrigin: headers['access-control-allow-origin'],
      AccessControlAllowMethods: headers['access-control-allow-methods'],
      AccessControlAllowHeaders: headers['access-control-allow-headers'],
      AccessControlExposeHeaders: headers['access-control-expose-headers'],
      AccessControlMaxAge: headers['access-control-max-age'],
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * @param  {Object}                                     参数列表
 *     @param  {String}  Bucket                         Bucket 名称
 *     @param  {String}  Region                         地域名称
 *     @param  {String}  Key                            文件名称
 *     @param  {String}  CopySource                     源文件URL绝对路径，可以通过versionid子资源指定历史版本
 *     @param  {String}  ACL                            允许用户自定义文件权限。有效值：private，public-read默认值：private。
 *     @param  {String}  GrantRead                      赋予被授权者读的权限，格式 x-cos-grant-read: uin=" ",uin=" "，当需要给子账户授权时，uin="RootAcountID/SubAccountID"，当需要给根账户授权时，uin="RootAcountID"。
 *     @param  {String}  GrantWrite                     赋予被授权者写的权限，格式 x-cos-grant-write: uin=" ",uin=" "，当需要给子账户授权时，uin="RootAcountID/SubAccountID"，当需要给根账户授权时，uin="RootAcountID"。
 *     @param  {String}  GrantFullControl               赋予被授权者读写权限，格式 x-cos-grant-full-control: uin=" ",uin=" "，当需要给子账户授权时，uin="RootAcountID/SubAccountID"，当需要给根账户授权时，uin="RootAcountID"。
 *     @param  {String}  MetadataDirective              是否拷贝元数据，枚举值：Copy, Replaced，默认值Copy。假如标记为Copy，忽略Header中的用户元数据信息直接复制；假如标记为Replaced，按Header信息修改元数据。当目标路径和原路径一致，即用户试图修改元数据时，必须为Replaced
 *     @param  {String}  CopySourceIfModifiedSince      当Object在指定时间后被修改，则执行操作，否则返回412。可与x-cos-copy-source-If-None-Match一起使用，与其他条件联合使用返回冲突。
 *     @param  {String}  CopySourceIfUnmodifiedSince    当Object在指定时间后未被修改，则执行操作，否则返回412。可与x-cos-copy-source-If-Match一起使用，与其他条件联合使用返回冲突。
 *     @param  {String}  CopySourceIfMatch              当Object的ETag和给定一致时，则执行操作，否则返回412。可与x-cos-copy-source-If-Unmodified-Since一起使用，与其他条件联合使用返回冲突。
 *     @param  {String}  CopySourceIfNoneMatch          当Object的ETag和给定不一致时，则执行操作，否则返回412。可与x-cos-copy-source-If-Modified-Since一起使用，与其他条件联合使用返回冲突。
 *     @param  {String}  StorageClass                   存储级别，枚举值：存储级别，枚举值：Standard, Standard_IA，Archive；默认值：Standard
 *     @param  {String}  CacheControl                   指定所有缓存机制在整个请求/响应链中必须服从的指令。
 *     @param  {String}  ContentDisposition             MIME 协议的扩展，MIME 协议指示 MIME 用户代理如何显示附加的文件
 *     @param  {String}  ContentEncoding                HTTP 中用来对「采用何种编码格式传输正文」进行协定的一对头部字段
 *     @param  {String}  ContentLength                  设置响应消息的实体内容的大小，单位为字节
 *     @param  {String}  ContentType                    RFC 2616 中定义的 HTTP 请求内容类型（MIME），例如text/plain
 *     @param  {String}  Expect                         请求的特定的服务器行为
 *     @param  {String}  Expires                        响应过期的日期和时间
 *     @param  {String}  params.ServerSideEncryption   支持按照指定的加密算法进行服务端数据加密，格式 x-cos-server-side-encryption: "AES256"，非必须
 *     @param  {String}  ContentLanguage                指定内容语言
 *     @param  {String}  x-cos-meta-*                   允许用户自定义的头部信息，将作为 Object 元数据返回。大小限制2K。
 */


function putObjectCopy(params, callback) {
  // 特殊处理 Cache-Control
  var self = this;
  var headers = params.Headers;
  if (!headers['Cache-Control'] && !headers['cache-control']) headers['Cache-Control'] = '';
  var CopySource = params.CopySource || '';
  var m = util.getSourceParams.call(this, CopySource);

  if (!m) {
    callback(util.error(new Error('CopySource format error')));
    return;
  }

  var SourceBucket = m[1];
  var SourceRegion = m[3];
  var SourceKey = decodeURIComponent(m[4]);
  submitRequest.call(this, {
    Scope: [{
      action: 'name/cos:GetObject',
      bucket: SourceBucket,
      region: SourceRegion,
      prefix: SourceKey
    }, {
      action: 'name/cos:PutObject',
      bucket: params.Bucket,
      region: params.Region,
      prefix: params.Key
    }],
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    VersionId: params.VersionId,
    headers: params.Headers
  }, function (err, data) {
    if (err) return callback(err);
    var result = util.clone(data.CopyObjectResult || {});
    var url = getUrl({
      ForcePathStyle: self.options.ForcePathStyle,
      protocol: self.options.Protocol,
      domain: self.options.Domain,
      bucket: params.Bucket,
      region: params.Region,
      object: params.Key,
      isLocation: true
    });
    util.extend(result, {
      Location: url,
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}

function uploadPartCopy(params, callback) {
  var CopySource = params.CopySource || '';
  var m = util.getSourceParams.call(this, CopySource);

  if (!m) {
    callback(util.error(new Error('CopySource format error')));
    return;
  }

  var SourceBucket = m[1];
  var SourceRegion = m[3];
  var SourceKey = decodeURIComponent(m[4]);
  submitRequest.call(this, {
    Scope: [{
      action: 'name/cos:GetObject',
      bucket: SourceBucket,
      region: SourceRegion,
      prefix: SourceKey
    }, {
      action: 'name/cos:PutObject',
      bucket: params.Bucket,
      region: params.Region,
      prefix: params.Key
    }],
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    VersionId: params.VersionId,
    qs: {
      partNumber: params['PartNumber'],
      uploadId: params['UploadId']
    },
    headers: params.Headers
  }, function (err, data) {
    if (err) return callback(err);
    var result = util.clone(data.CopyPartResult || {});
    util.extend(result, {
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}

function deleteMultipleObject(params, callback) {
  var Objects = params.Objects || [];
  var Quiet = params.Quiet;
  Objects = util.isArray(Objects) ? Objects : [Objects];
  var xml = util.json2xml({
    Delete: {
      Object: Objects,
      Quiet: Quiet || false
    }
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  var Scope = util.map(Objects, function (v) {
    return {
      action: 'name/cos:DeleteObject',
      bucket: params.Bucket,
      region: params.Region,
      prefix: v.Key
    };
  });
  submitRequest.call(this, {
    Scope: Scope,
    method: 'POST',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'delete',
    headers: headers
  }, function (err, data) {
    if (err) return callback(err);
    var DeleteResult = data.DeleteResult || {};
    var Deleted = DeleteResult.Deleted || [];
    var Errors = DeleteResult.Error || [];
    Deleted = util.isArray(Deleted) ? Deleted : [Deleted];
    Errors = util.isArray(Errors) ? Errors : [Errors];
    var result = util.clone(DeleteResult);
    util.extend(result, {
      Error: Errors,
      Deleted: Deleted,
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}

function restoreObject(params, callback) {
  var headers = params.Headers;

  if (!params['RestoreRequest']) {
    callback(util.error(new Error('missing param RestoreRequest')));
    return;
  }

  var RestoreRequest = params.RestoreRequest || {};
  var xml = util.json2xml({
    RestoreRequest: RestoreRequest
  });
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:RestoreObject',
    method: 'POST',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    VersionId: params.VersionId,
    body: xml,
    action: 'restore',
    headers: headers
  }, callback);
}
/**
 * 设置 Object 的标签
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Object名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 *     @param  {Array}   params.TagSet  标签设置，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/42998
 * @return  {Object}  data              返回数据
 */


function putObjectTagging(params, callback) {
  var Tagging = params['Tagging'] || {};
  var Tags = Tagging.TagSet || Tagging.Tags || params['Tags'] || [];
  Tags = util.clone(util.isArray(Tags) ? Tags : [Tags]);
  var xml = util.json2xml({
    Tagging: {
      TagSet: {
        Tag: Tags
      }
    }
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutObjectTagging',
    method: 'PUT',
    Bucket: params.Bucket,
    Key: params.Key,
    Region: params.Region,
    body: xml,
    action: 'tagging',
    headers: headers,
    VersionId: params.VersionId
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Object 的标签设置
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/42998
 * @return  {Object}  data              返回数据
 */


function getObjectTagging(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetObjectTagging',
    method: 'GET',
    Key: params.Key,
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'tagging',
    VersionId: params.VersionId
  }, function (err, data) {
    if (err) {
      if (err.statusCode === 404 && err.error && (err.error === "Not Found" || err.error.Code === 'NoSuchTagSet')) {
        var result = {
          Tags: [],
          statusCode: err.statusCode
        };
        err.headers && (result.headers = err.headers);
        callback(null, result);
      } else {
        callback(err);
      }

      return;
    }

    var Tags = [];

    try {
      Tags = data.Tagging.TagSet.Tag || [];
    } catch (e) {}

    Tags = util.clone(util.isArray(Tags) ? Tags : [Tags]);
    callback(null, {
      Tags: Tags,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 删除 Object 的 标签设置
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Object名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/42998
 * @return  {Object}  data              返回的数据
 */


function deleteObjectTagging(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteObjectTagging',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: params.Headers,
    action: 'tagging',
    VersionId: params.VersionId
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 使用 SQL 语句从指定对象（CSV 格式或者 JSON 格式）中检索内容
 * @param  {Object}  params                   参数对象，必须
 *     @param  {String}  params.Bucket        Object名称，必须
 *     @param  {String}  params.Region        地域名称，必须
 *     @param  {Object}  params.SelectRequest 地域名称，必须
 * @param  {Function}  callback               回调函数，必须
 * @return  {Object}  err                     请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/42998
 * @return  {Object}  data                    返回的数据
 */


function selectObjectContent(params, callback) {
  var SelectType = params['SelectType'];
  if (!SelectType) return callback(util.error(new Error('missing param SelectType')));
  var SelectRequest = params['SelectRequest'] || {};
  var xml = util.json2xml({
    SelectRequest: SelectRequest
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:GetObject',
    method: 'POST',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: params.Headers,
    action: 'select',
    qs: {
      'select-type': params['SelectType']
    },
    VersionId: params.VersionId,
    body: xml,
    DataType: 'arraybuffer',
    rawBody: true
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    var result = util.parseSelectPayload(data.body);
    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers,
      Body: result.body,
      Payload: result.payload
    });
  });
} // 分块上传

/**
 * 初始化分块上传
 * @param  {Object}  params                                     参数对象，必须
 *     @param  {String}  params.Bucket                          Bucket名称，必须
 *     @param  {String}  params.Region                          地域名称，必须
 *     @param  {String}  params.Key                             object名称，必须
 *     @param  {String}  params.UploadId                        object名称，必须
 *     @param  {String}  params.CacheControl                    RFC 2616 中定义的缓存策略，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ContentDisposition              RFC 2616 中定义的文件名称，将作为 Object 元数据保存    ，非必须
 *     @param  {String}  params.ContentEncoding                 RFC 2616 中定义的编码格式，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ContentType                     RFC 2616 中定义的内容类型（MIME），将作为 Object 元数据保存，非必须
 *     @param  {String}  params.Expires                         RFC 2616 中定义的过期时间，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ACL                             允许用户自定义文件权限，非必须
 *     @param  {String}  params.GrantRead                       赋予被授权者读的权限 ，非必须
 *     @param  {String}  params.GrantWrite                      赋予被授权者写的权限 ，非必须
 *     @param  {String}  params.GrantFullControl                赋予被授权者读写权限 ，非必须
 *     @param  {String}  params.StorageClass                    设置Object的存储级别，枚举值：Standard，Standard_IA，Archive，非必须
 *     @param  {String}  params.ServerSideEncryption           支持按照指定的加密算法进行服务端数据加密，格式 x-cos-server-side-encryption: "AES256"，非必须
 * @param  {Function}  callback                                 回调函数，必须
 * @return  {Object}  err                                       请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                      返回的数据
 */


function multipartInit(params, callback) {
  var self = this; // 特殊处理 Cache-Control

  var headers = params.Headers;
  var tracker = params.tracker; // 特殊处理 Cache-Control、Content-Type

  if (!headers['Cache-Control'] && !headers['cache-control']) headers['Cache-Control'] = '';
  if (!headers['Content-Type'] && !headers['content-type']) headers['Content-Type'] = params.Body && params.Body.type || '';
  var needCalcMd5 = params.Body && (params.UploadAddMetaMd5 || self.options.UploadAddMetaMd5);
  needCalcMd5 && tracker && tracker.setParams({
    md5StartTime: new Date().getTime()
  });
  util.getBodyMd5(needCalcMd5, params.Body, function (md5) {
    if (md5) params.Headers['x-cos-meta-md5'] = md5;
    needCalcMd5 && tracker && tracker.setParams({
      md5EndTime: new Date().getTime()
    });
    submitRequest.call(self, {
      Action: 'name/cos:InitiateMultipartUpload',
      method: 'POST',
      Bucket: params.Bucket,
      Region: params.Region,
      Key: params.Key,
      action: 'uploads',
      headers: params.Headers,
      qs: params.Query,
      tracker: tracker
    }, function (err, data) {
      if (err) {
        tracker && tracker.parent && tracker.parent.setParams({
          errorNode: 'multipartInit'
        });
        return callback(err);
      }

      data = util.clone(data || {});

      if (data && data.InitiateMultipartUploadResult) {
        return callback(null, util.extend(data.InitiateMultipartUploadResult, {
          statusCode: data.statusCode,
          headers: data.headers
        }));
      }

      callback(null, data);
    });
  }, params.onHashProgress);
}
/**
 * 分块上传
 * @param  {Object}  params                                 参数对象，必须
 *     @param  {String}  params.Bucket                      Bucket名称，必须
 *     @param  {String}  params.Region                      地域名称，必须
 *     @param  {String}  params.Key                         object名称，必须
 *     @param  {File || Blob || String}  params.Body        上传文件对象或字符串
 *     @param  {String} params.ContentLength                RFC 2616 中定义的 HTTP 请求内容长度（字节），非必须
 *     @param  {String} params.Expect                       当使用 Expect: 100-continue 时，在收到服务端确认后，才会发送请求内容，非必须
 *     @param  {String} params.ServerSideEncryption         支持按照指定的加密算法进行服务端数据加密，格式 x-cos-server-side-encryption: "AES256"，非必须
 *     @param  {String} params.ContentSha1                  RFC 3174 中定义的 160-bit 内容 SHA-1 算法校验值，非必须
 * @param  {Function}  callback                             回调函数，必须
 *     @return  {Object}  err                               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 *     @return  {Object}  data                              返回的数据
 *     @return  {Object}  data.ETag                         返回的文件分块 sha1 值
 */


function multipartUpload(params, callback) {
  var self = this;
  util.getFileSize('multipartUpload', params, function () {
    var tracker = params.tracker;
    var needCalcMd5 = self.options.UploadCheckContentMd5;
    needCalcMd5 && tracker && tracker.setParams({
      md5StartTime: new Date().getTime()
    });
    util.getBodyMd5(needCalcMd5, params.Body, function (md5) {
      if (md5) params.Headers['Content-MD5'] = util.binaryBase64(md5);
      needCalcMd5 && tracker && tracker.setParams({
        md5EndTime: new Date().getTime()
      });
      tracker && tracker.setParams({
        partNumber: params.PartNumber
      });
      submitRequest.call(self, {
        Action: 'name/cos:UploadPart',
        TaskId: params.TaskId,
        method: 'PUT',
        Bucket: params.Bucket,
        Region: params.Region,
        Key: params.Key,
        qs: {
          partNumber: params['PartNumber'],
          uploadId: params['UploadId']
        },
        headers: params.Headers,
        onProgress: params.onProgress,
        body: params.Body || null,
        tracker: tracker
      }, function (err, data) {
        if (err) {
          tracker && tracker.parent && tracker.parent.setParams({
            errorNode: 'multipartUpload'
          });
          return callback(err);
        }

        callback(null, {
          ETag: util.attr(data.headers, 'etag', ''),
          statusCode: data.statusCode,
          headers: data.headers
        });
      });
    });
  });
}
/**
 * 完成分块上传
 * @param  {Object}  params                             参数对象，必须
 *     @param  {String}  params.Bucket                  Bucket名称，必须
 *     @param  {String}  params.Region                  地域名称，必须
 *     @param  {String}  params.Key                     object名称，必须
 *     @param  {Array}   params.Parts                   分块信息列表，必须
 *     @param  {String}  params.Parts[i].PartNumber     块编号，必须
 *     @param  {String}  params.Parts[i].ETag           分块的 sha1 校验值
 * @param  {Function}  callback                         回调函数，必须
 * @return  {Object}  err                               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                              返回的数据
 *     @return  {Object}  data.CompleteMultipartUpload  完成分块上传后的文件信息，包括Location, Bucket, Key 和 ETag
 */


function multipartComplete(params, callback) {
  var self = this;
  var UploadId = params.UploadId;
  var Parts = params['Parts'];
  var tracker = params.tracker;

  for (var i = 0, len = Parts.length; i < len; i++) {
    if (Parts[i]['ETag'] && Parts[i]['ETag'].indexOf('"') === 0) {
      continue;
    }

    Parts[i]['ETag'] = '"' + Parts[i]['ETag'] + '"';
  }

  var xml = util.json2xml({
    CompleteMultipartUpload: {
      Part: Parts
    }
  }); // CSP/ceph CompleteMultipartUpload 接口 body 写死了限制 1MB，这里醉倒 10000 片时，xml 字符串去掉空格853KB

  xml = xml.replace(/\n\s*/g, '');
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:CompleteMultipartUpload',
    method: 'POST',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    qs: {
      uploadId: UploadId
    },
    body: xml,
    headers: headers,
    tracker: tracker
  }, function (err, data) {
    if (err) {
      tracker && tracker.parent && tracker.parent.setParams({
        errorNode: 'multipartComplete'
      });
      return callback(err);
    }

    var url = getUrl({
      ForcePathStyle: self.options.ForcePathStyle,
      protocol: self.options.Protocol,
      domain: self.options.Domain,
      bucket: params.Bucket,
      region: params.Region,
      object: params.Key,
      isLocation: true
    });
    var res = data.CompleteMultipartUploadResult || {};

    if (res.ProcessResults) {
      if (res && res.ProcessResults) {
        res.UploadResult = {
          OriginalInfo: {
            Key: res.Key,
            Location: url,
            ETag: res.ETag,
            ImageInfo: res.ImageInfo
          },
          ProcessResults: res.ProcessResults
        };
        delete res.ImageInfo;
        delete res.ProcessResults;
      }
    }

    var result = util.extend(res, {
      Location: url,
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}
/**
 * 分块上传任务列表查询
 * @param  {Object}  params                                 参数对象，必须
 *     @param  {String}  params.Bucket                      Bucket名称，必须
 *     @param  {String}  params.Region                      地域名称，必须
 *     @param  {String}  params.Delimiter                   定界符为一个符号，如果有Prefix，则将Prefix到delimiter之间的相同路径归为一类，定义为Common Prefix，然后列出所有Common Prefix。如果没有Prefix，则从路径起点开始，非必须
 *     @param  {String}  params.EncodingType                规定返回值的编码方式，非必须
 *     @param  {String}  params.Prefix                      前缀匹配，用来规定返回的文件前缀地址，非必须
 *     @param  {String}  params.MaxUploads                  单次返回最大的条目数量，默认1000，非必须
 *     @param  {String}  params.KeyMarker                   与upload-id-marker一起使用 </Br>当upload-id-marker未被指定时，ObjectName字母顺序大于key-marker的条目将被列出 </Br>当upload-id-marker被指定时，ObjectName字母顺序大于key-marker的条目被列出，ObjectName字母顺序等于key-marker同时UploadId大于upload-id-marker的条目将被列出，非必须
 *     @param  {String}  params.UploadIdMarker              与key-marker一起使用 </Br>当key-marker未被指定时，upload-id-marker将被忽略 </Br>当key-marker被指定时，ObjectName字母顺序大于key-marker的条目被列出，ObjectName字母顺序等于key-marker同时UploadId大于upload-id-marker的条目将被列出，非必须
 * @param  {Function}  callback                             回调函数，必须
 * @return  {Object}  err                                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                  返回的数据
 *     @return  {Object}  data.ListMultipartUploadsResult   分块上传任务信息
 */


function multipartList(params, callback) {
  var reqParams = {};
  reqParams['delimiter'] = params['Delimiter'];
  reqParams['encoding-type'] = params['EncodingType'];
  reqParams['prefix'] = params['Prefix'] || '';
  reqParams['max-uploads'] = params['MaxUploads'];
  reqParams['key-marker'] = params['KeyMarker'];
  reqParams['upload-id-marker'] = params['UploadIdMarker'];
  reqParams = util.clearKey(reqParams);
  var tracker = params.tracker;
  tracker && tracker.setParams({
    signStartTime: new Date().getTime()
  });
  submitRequest.call(this, {
    Action: 'name/cos:ListMultipartUploads',
    ResourceKey: reqParams['prefix'],
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    qs: reqParams,
    action: 'uploads',
    tracker: tracker
  }, function (err, data) {
    if (err) {
      tracker && tracker.parent && tracker.parent.setParams({
        errorNode: 'multipartList'
      });
      return callback(err);
    }

    if (data && data.ListMultipartUploadsResult) {
      var Upload = data.ListMultipartUploadsResult.Upload || [];
      Upload = util.isArray(Upload) ? Upload : [Upload];
      data.ListMultipartUploadsResult.Upload = Upload;
    }

    var result = util.clone(data.ListMultipartUploadsResult || {});
    util.extend(result, {
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}
/**
 * 上传的分块列表查询
 * @param  {Object}  params                                 参数对象，必须
 *     @param  {String}  params.Bucket                      Bucket名称，必须
 *     @param  {String}  params.Region                      地域名称，必须
 *     @param  {String}  params.Key                         object名称，必须
 *     @param  {String}  params.UploadId                    标示本次分块上传的ID，必须
 *     @param  {String}  params.EncodingType                规定返回值的编码方式，非必须
 *     @param  {String}  params.MaxParts                    单次返回最大的条目数量，默认1000，非必须
 *     @param  {String}  params.PartNumberMarker            默认以UTF-8二进制顺序列出条目，所有列出条目从marker开始，非必须
 * @param  {Function}  callback                             回调函数，必须
 * @return  {Object}  err                                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                  返回的数据
 *     @return  {Object}  data.ListMultipartUploadsResult   分块信息
 */


function multipartListPart(params, callback) {
  var reqParams = {};
  var tracker = params.tracker;
  reqParams['uploadId'] = params['UploadId'];
  reqParams['encoding-type'] = params['EncodingType'];
  reqParams['max-parts'] = params['MaxParts'];
  reqParams['part-number-marker'] = params['PartNumberMarker'];
  submitRequest.call(this, {
    Action: 'name/cos:ListParts',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: params.Headers,
    qs: reqParams
  }, function (err, data) {
    if (err) {
      tracker && tracker.parent && tracker.parent.setParams({
        errorNode: 'multipartListPart'
      });
      return callback(err);
    }

    var ListPartsResult = data.ListPartsResult || {};
    var Part = ListPartsResult.Part || [];
    Part = util.isArray(Part) ? Part : [Part];
    ListPartsResult.Part = Part;
    var result = util.clone(ListPartsResult);
    util.extend(result, {
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}
/**
 * 抛弃分块上传
 * @param  {Object}  params                 参数对象，必须
 *     @param  {String}  params.Bucket      Bucket名称，必须
 *     @param  {String}  params.Region      地域名称，必须
 *     @param  {String}  params.Key         object名称，必须
 *     @param  {String}  params.UploadId    标示本次分块上传的ID，必须
 * @param  {Function}  callback             回调函数，必须
 *     @return  {Object}    err             请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 *     @return  {Object}    data            返回的数据
 */


function multipartAbort(params, callback) {
  var reqParams = {};
  reqParams['uploadId'] = params['UploadId'];
  submitRequest.call(this, {
    Action: 'name/cos:AbortMultipartUpload',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: params.Headers,
    qs: reqParams
  }, function (err, data) {
    if (err) return callback(err);
    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 抛弃分块上传
 * @param  {Object}  params                 参数对象，必须
 *     @param  {String}  params.Bucket      Bucket名称，必须
 *     @param  {String}  params.Region      地域名称，必须
 *     @param  {String}  params.Key         object名称，必须
 *     @param  {String}  params.UploadId    标示本次分块上传的ID，必须
 * @param  {Function}  callback             回调函数，必须
 *     @return  {Object}    err             请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 *     @return  {Object}    data            返回的数据
 */


function request(params, callback) {
  submitRequest.call(this, {
    method: params.Method,
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    action: params.Action,
    headers: params.Headers,
    qs: params.Query,
    body: params.Body,
    Url: params.Url,
    rawBody: params.RawBody,
    DataType: params.DataType
  }, function (err, data) {
    if (err) return callback(err);

    if (data && data.body) {
      data.Body = data.body;
      delete data.body;
    }

    callback(err, data);
  });
}
/**
 * 追加上传
 * @param  {Object}  params                                         参数对象，必须
 *     @param  {String}  params.Bucket                              Bucket名称，必须
 *     @param  {String}  params.Region                              地域名称，必须
 *     @param  {String}  params.Key                                 object名称，必须
 *     @param  {File || Blob || String}  params.Body                上传文件对象或字符串
 *     @param  {Number}  params.Position                            追加操作的起始点，单位为字节，必须
 *     @param  {String}  params.CacheControl                        RFC 2616 中定义的缓存策略，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ContentDisposition                  RFC 2616 中定义的文件名称，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ContentEncoding                     RFC 2616 中定义的编码格式，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ContentLength                       RFC 2616 中定义的 HTTP 请求内容长度（字节），必须
 *     @param  {String}  params.ContentType                         RFC 2616 中定义的内容类型（MIME），将作为 Object 元数据保存，非必须
 *     @param  {String}  params.Expect                              当使用 Expect: 100-continue 时，在收到服务端确认后，才会发送请求内容，非必须
 *     @param  {String}  params.Expires                             RFC 2616 中定义的过期时间，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ACL                                 允许用户自定义文件权限，有效值：private | public-read，非必须
 *     @param  {String}  params.GrantRead                           赋予被授权者读取对象的权限，格式：id="[OwnerUin]"，可使用半角逗号（,）分隔多组被授权者，非必须
 *     @param  {String}  params.GrantReadAcp                        赋予被授权者读取对象的访问控制列表（ACL）的权限，格式：id="[OwnerUin]"，可使用半角逗号（,）分隔多组被授权者，非必须
 *     @param  {String}  params.GrantWriteAcp                       赋予被授权者写入对象的访问控制列表（ACL）的权限，格式：id="[OwnerUin]"，可使用半角逗号（,）分隔多组被授权者，非必须
 *     @param  {String}  params.GrantFullControl                    赋予被授权者操作对象的所有权限，格式：id="[OwnerUin]"，可使用半角逗号（,）分隔多组被授权者，非必须
 *     @param  {String}  params.StorageClass                        设置对象的存储级别，枚举值：STANDARD、STANDARD_IA、ARCHIVE，默认值：STANDARD，非必须
 *     @param  {String}  params.x-cos-meta-*                        允许用户自定义的头部信息，将作为对象的元数据保存。大小限制2KB，非必须
 *     @param  {String}  params.ContentSha1                         RFC 3174 中定义的 160-bit 内容 SHA-1 算法校验，非必须
 *     @param  {String}  params.ServerSideEncryption                支持按照指定的加密算法进行服务端数据加密，格式 x-cos-server-side-encryption: "AES256"，非必须
 * @param  {Function}  callback                                     回调函数，必须
 *     @return  {Object}    err                                     请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 *     @return  {Object}    data                                    返回的数据
 */


function appendObject(params, callback) {
  // 特殊处理 Cache-Control、Content-Type，避免代理更改这两个字段导致写入到 Object 属性里
  var headers = params.Headers;
  if (!headers['Cache-Control'] && !headers['cache-control']) headers['Cache-Control'] = '';
  if (!headers['Content-Type'] && !headers['content-type']) headers['Content-Type'] = params.Body && params.Body.type || '';
  submitRequest.call(this, {
    Action: 'name/cos:AppendObject',
    method: 'POST',
    Bucket: params.Bucket,
    Region: params.Region,
    action: 'append',
    Key: params.Key,
    body: params.Body,
    qs: {
      position: params.Position
    },
    headers: params.Headers
  }, function (err, data) {
    if (err) return callback(err);
    callback(null, data);
  });
}
/**
 * 获取签名
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Method  请求方法，必须
 *     @param  {String}  params.Key     object名称，必须
 *     @param  {String}  params.Expires 名超时时间，单位秒，可选
 * @return  {String}  data              返回签名字符串
 */


function getAuth(params) {
  var self = this;
  return util.getAuth({
    SecretId: params.SecretId || this.options.SecretId || '',
    SecretKey: params.SecretKey || this.options.SecretKey || '',
    Bucket: params.Bucket,
    Region: params.Region,
    Method: params.Method,
    Key: params.Key,
    Query: params.Query,
    Headers: params.Headers,
    Expires: params.Expires,
    UseRawKey: self.options.UseRawKey,
    SystemClockOffset: self.options.SystemClockOffset
  });
}
/**
 * 获取文件下载链接
 * @param  {Object}  params                 参数对象，必须
 *     @param  {String}  params.Bucket      Bucket名称，必须
 *     @param  {String}  params.Region      地域名称，必须
 *     @param  {String}  params.Key         object名称，必须
 *     @param  {String}  params.Method      请求的方法，可选
 *     @param  {String}  params.Expires     签名超时时间，单位秒，可选
 * @param  {Function}  callback             回调函数，必须
 *     @return  {Object}    err             请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 *     @return  {Object}    data            返回的数据
 */


function getObjectUrl(params, callback) {
  var self = this;
  var useAccelerate = params.UseAccelerate === undefined ? self.options.UseAccelerate : params.UseAccelerate;
  var url = getUrl({
    ForcePathStyle: self.options.ForcePathStyle,
    protocol: params.Protocol || self.options.Protocol,
    domain: params.Domain || self.options.Domain,
    bucket: params.Bucket,
    region: useAccelerate ? 'accelerate' : params.Region,
    object: params.Key
  });
  var queryParamsStr = '';

  if (params.Query) {
    queryParamsStr += util.obj2str(params.Query);
  }

  if (params.QueryString) {
    queryParamsStr += (queryParamsStr ? '&' : '') + params.QueryString;
  }

  var syncUrl = url;

  if (params.Sign !== undefined && !params.Sign) {
    queryParamsStr && (syncUrl += '?' + queryParamsStr);
    callback(null, {
      Url: syncUrl
    });
    return syncUrl;
  } // 签名加上 Host，避免跨桶访问


  var SignHost = getSignHost.call(this, {
    Bucket: params.Bucket,
    Region: params.Region,
    UseAccelerate: params.UseAccelerate,
    Url: url
  });
  var AuthData = getAuthorizationAsync.call(this, {
    Action: (params.Method || '').toUpperCase() === 'PUT' ? 'name/cos:PutObject' : 'name/cos:GetObject',
    Bucket: params.Bucket || '',
    Region: params.Region || '',
    Method: params.Method || 'get',
    Key: params.Key,
    Expires: params.Expires,
    Headers: params.Headers,
    Query: params.Query,
    SignHost: SignHost,
    ForceSignHost: params.ForceSignHost === false ? false : self.options.ForceSignHost // getObjectUrl支持传参ForceSignHost

  }, function (err, AuthData) {
    if (!callback) return;

    if (err) {
      callback(err);
      return;
    } // 兼容万象url qUrlParamList需要再encode一次


    var replaceUrlParamList = function replaceUrlParamList(url) {
      var urlParams = url.match(/q-url-param-list.*?(?=&)/g)[0];
      var encodedParams = 'q-url-param-list=' + encodeURIComponent(urlParams.replace(/q-url-param-list=/, '')).toLowerCase();
      var reg = new RegExp(urlParams, 'g');
      var replacedUrl = url.replace(reg, encodedParams);
      return replacedUrl;
    };

    var signUrl = url;
    signUrl += '?' + (AuthData.Authorization.indexOf('q-signature') > -1 ? replaceUrlParamList(AuthData.Authorization) : 'sign=' + encodeURIComponent(AuthData.Authorization));
    AuthData.SecurityToken && (signUrl += '&x-cos-security-token=' + AuthData.SecurityToken);
    AuthData.ClientIP && (signUrl += '&clientIP=' + AuthData.ClientIP);
    AuthData.ClientUA && (signUrl += '&clientUA=' + AuthData.ClientUA);
    AuthData.Token && (signUrl += '&token=' + AuthData.Token);
    queryParamsStr && (signUrl += '&' + queryParamsStr);
    setTimeout(function () {
      callback(null, {
        Url: signUrl
      });
    });
  });

  if (AuthData) {
    syncUrl += '?' + AuthData.Authorization + (AuthData.SecurityToken ? '&x-cos-security-token=' + AuthData.SecurityToken : '');
    queryParamsStr && (syncUrl += '&' + queryParamsStr);
  } else {
    queryParamsStr && (syncUrl += '?' + queryParamsStr);
  }

  return syncUrl;
}
/**
 * 私有方法
 */


function decodeAcl(AccessControlPolicy) {
  var result = {
    GrantFullControl: [],
    GrantWrite: [],
    GrantRead: [],
    GrantReadAcp: [],
    GrantWriteAcp: [],
    ACL: ''
  };
  var GrantMap = {
    'FULL_CONTROL': 'GrantFullControl',
    'WRITE': 'GrantWrite',
    'READ': 'GrantRead',
    'READ_ACP': 'GrantReadAcp',
    'WRITE_ACP': 'GrantWriteAcp'
  };
  var AccessControlList = AccessControlPolicy && AccessControlPolicy.AccessControlList || {};
  var Grant = AccessControlList.Grant;

  if (Grant) {
    Grant = util.isArray(Grant) ? Grant : [Grant];
  }

  var PublicAcl = {
    READ: 0,
    WRITE: 0,
    FULL_CONTROL: 0
  };
  Grant && Grant.length && util.each(Grant, function (item) {
    if (item.Grantee.ID === 'qcs::cam::anyone:anyone' || item.Grantee.URI === 'http://cam.qcloud.com/groups/global/AllUsers') {
      PublicAcl[item.Permission] = 1;
    } else if (item.Grantee.ID !== AccessControlPolicy.Owner.ID) {
      result[GrantMap[item.Permission]].push('id="' + item.Grantee.ID + '"');
    }
  });

  if (PublicAcl.FULL_CONTROL || PublicAcl.WRITE && PublicAcl.READ) {
    result.ACL = 'public-read-write';
  } else if (PublicAcl.READ) {
    result.ACL = 'public-read';
  } else {
    result.ACL = 'private';
  }

  util.each(GrantMap, function (item) {
    result[item] = uniqGrant(result[item].join(','));
  });
  return result;
} // Grant 去重


function uniqGrant(str) {
  var arr = str.split(',');
  var exist = {};
  var i, item;

  for (i = 0; i < arr.length;) {
    item = arr[i].trim();

    if (exist[item]) {
      arr.splice(i, 1);
    } else {
      exist[item] = true;
      arr[i] = item;
      i++;
    }
  }

  return arr.join(',');
} // 生成操作 url


function getUrl(params) {
  var region = params.region || '';
  var longBucket = params.bucket || '';
  var shortBucket = longBucket.substr(0, longBucket.lastIndexOf('-'));
  var appId = longBucket.substr(longBucket.lastIndexOf('-') + 1);
  var domain = params.domain;
  var object = params.object;

  if (typeof domain === 'function') {
    domain = domain({
      Bucket: longBucket,
      Region: region
    });
  }

  var protocol = params.protocol || (util.isBrowser && location.protocol === 'http:' ? 'http:' : 'https:');

  if (!domain) {
    if (['cn-south', 'cn-south-2', 'cn-north', 'cn-east', 'cn-southwest', 'sg'].indexOf(region) > -1) {
      domain = '{Region}.myqcloud.com';
    } else {
      domain = 'cos.{Region}.myqcloud.com';
    }

    if (!params.ForcePathStyle) {
      domain = '{Bucket}.' + domain;
    }
  }

  domain = domain.replace(/\{\{AppId\}\}/ig, appId).replace(/\{\{Bucket\}\}/ig, shortBucket).replace(/\{\{Region\}\}/ig, region).replace(/\{\{.*?\}\}/ig, '');
  domain = domain.replace(/\{AppId\}/ig, appId).replace(/\{BucketName\}/ig, shortBucket).replace(/\{Bucket\}/ig, longBucket).replace(/\{Region\}/ig, region).replace(/\{.*?\}/ig, '');

  if (!/^[a-zA-Z]+:\/\//.test(domain)) {
    domain = protocol + '//' + domain;
  } // 去掉域名最后的斜杆


  if (domain.slice(-1) === '/') {
    domain = domain.slice(0, -1);
  }

  var url = domain;

  if (params.ForcePathStyle) {
    url += '/' + longBucket;
  }

  url += '/';

  if (object) {
    url += util.camSafeUrlEncode(object).replace(/%2F/g, '/');
  }

  if (params.isLocation) {
    url = url.replace(/^https?:\/\//, '');
  }

  return url;
}

var getSignHost = function getSignHost(opt) {
  if (!opt.Bucket || !opt.Region) return '';
  var useAccelerate = opt.UseAccelerate === undefined ? this.options.UseAccelerate : opt.UseAccelerate;
  var url = opt.Url || getUrl({
    ForcePathStyle: this.options.ForcePathStyle,
    protocol: this.options.Protocol,
    domain: this.options.Domain,
    bucket: opt.Bucket,
    region: useAccelerate ? 'accelerate' : opt.Region
  });
  var urlHost = url.replace(/^https?:\/\/([^/]+)(\/.*)?$/, '$1');
  var standardHostReg = new RegExp('^([a-z\\d-]+-\\d+\\.)?(cos|cosv6|ci|pic)\\.([a-z\\d-]+)\\.myqcloud\\.com$');
  if (standardHostReg.test(urlHost)) return urlHost;
  return '';
}; // 异步获取签名


function getAuthorizationAsync(params, callback) {
  var headers = util.clone(params.Headers);
  var headerHost = '';
  util.each(headers, function (v, k) {
    (v === '' || ['content-type', 'cache-control', 'expires'].indexOf(k.toLowerCase()) > -1) && delete headers[k];
    if (k.toLowerCase() === 'host') headerHost = v;
  }); // ForceSignHost明确传入false才不加入host签名

  var forceSignHost = params.ForceSignHost === false ? false : true; // Host 加入签名计算

  if (!headerHost && params.SignHost && forceSignHost) headers.Host = params.SignHost; // 获取凭证的回调，避免用户 callback 多次

  var cbDone = false;

  var cb = function cb(err, AuthData) {
    if (cbDone) return;
    cbDone = true;

    if (AuthData && AuthData.XCosSecurityToken && !AuthData.SecurityToken) {
      AuthData = util.clone(AuthData);
      AuthData.SecurityToken = AuthData.XCosSecurityToken;
      delete AuthData.XCosSecurityToken;
    }

    callback && callback(err, AuthData);
  };

  var self = this;
  var Bucket = params.Bucket || '';
  var Region = params.Region || ''; // PathName

  var KeyName = params.Key || '';

  if (self.options.ForcePathStyle && Bucket) {
    KeyName = Bucket + '/' + KeyName;
  }

  var Pathname = '/' + KeyName; // Action、ResourceKey

  var StsData = {};
  var Scope = params.Scope;

  if (!Scope) {
    var Action = params.Action || '';
    var ResourceKey = params.ResourceKey || params.Key || '';
    Scope = params.Scope || [{
      action: Action,
      bucket: Bucket,
      region: Region,
      prefix: ResourceKey
    }];
  }

  var ScopeKey = util.md5(JSON.stringify(Scope)); // STS

  self._StsCache = self._StsCache || [];

  (function () {
    var i, AuthData;

    for (i = self._StsCache.length - 1; i >= 0; i--) {
      AuthData = self._StsCache[i];
      var compareTime = Math.round(util.getSkewTime(self.options.SystemClockOffset) / 1000) + 30;

      if (AuthData.StartTime && compareTime < AuthData.StartTime || compareTime >= AuthData.ExpiredTime) {
        self._StsCache.splice(i, 1);

        continue;
      }

      if (!AuthData.ScopeLimit || AuthData.ScopeLimit && AuthData.ScopeKey === ScopeKey) {
        StsData = AuthData;
        break;
      }
    }
  })();

  var calcAuthByTmpKey = function calcAuthByTmpKey() {
    var KeyTime = '';
    if (StsData.StartTime && params.Expires) KeyTime = StsData.StartTime + ';' + (StsData.StartTime + params.Expires * 1);else if (StsData.StartTime && StsData.ExpiredTime) KeyTime = StsData.StartTime + ';' + StsData.ExpiredTime;
    var Authorization = util.getAuth({
      SecretId: StsData.TmpSecretId,
      SecretKey: StsData.TmpSecretKey,
      Method: params.Method,
      Pathname: Pathname,
      Query: params.Query,
      Headers: headers,
      Expires: params.Expires,
      UseRawKey: self.options.UseRawKey,
      SystemClockOffset: self.options.SystemClockOffset,
      KeyTime: KeyTime,
      ForceSignHost: forceSignHost
    });
    var AuthData = {
      Authorization: Authorization,
      SecurityToken: StsData.SecurityToken || StsData.XCosSecurityToken || '',
      Token: StsData.Token || '',
      ClientIP: StsData.ClientIP || '',
      ClientUA: StsData.ClientUA || ''
    };
    cb(null, AuthData);
  };

  var checkAuthError = function checkAuthError(AuthData) {
    if (AuthData.Authorization) {
      // 检查签名格式
      var formatAllow = false;
      var auth = AuthData.Authorization;

      if (auth) {
        if (auth.indexOf(' ') > -1) {
          formatAllow = false;
        } else if (auth.indexOf('q-sign-algorithm=') > -1 && auth.indexOf('q-ak=') > -1 && auth.indexOf('q-sign-time=') > -1 && auth.indexOf('q-key-time=') > -1 && auth.indexOf('q-url-param-list=') > -1) {
          formatAllow = true;
        } else {
          try {
            auth = atob(auth);

            if (auth.indexOf('a=') > -1 && auth.indexOf('k=') > -1 && auth.indexOf('t=') > -1 && auth.indexOf('r=') > -1 && auth.indexOf('b=') > -1) {
              formatAllow = true;
            }
          } catch (e) {}
        }
      }

      if (!formatAllow) return util.error(new Error('getAuthorization callback params format error'));
    } else {
      if (!AuthData.TmpSecretId) return util.error(new Error('getAuthorization callback params missing "TmpSecretId"'));
      if (!AuthData.TmpSecretKey) return util.error(new Error('getAuthorization callback params missing "TmpSecretKey"'));
      if (!AuthData.SecurityToken && !AuthData.XCosSecurityToken) return util.error(new Error('getAuthorization callback params missing "SecurityToken"'));
      if (!AuthData.ExpiredTime) return util.error(new Error('getAuthorization callback params missing "ExpiredTime"'));
      if (AuthData.ExpiredTime && AuthData.ExpiredTime.toString().length !== 10) return util.error(new Error('getAuthorization callback params "ExpiredTime" should be 10 digits'));
      if (AuthData.StartTime && AuthData.StartTime.toString().length !== 10) return util.error(new Error('getAuthorization callback params "StartTime" should be 10 StartTime'));
    }

    return false;
  }; // 先判断是否有临时密钥


  if (StsData.ExpiredTime && StsData.ExpiredTime - util.getSkewTime(self.options.SystemClockOffset) / 1000 > 60) {
    // 如果缓存的临时密钥有效，并还有超过60秒有效期就直接使用
    calcAuthByTmpKey();
  } else if (self.options.getAuthorization) {
    // 外部计算签名或获取临时密钥
    self.options.getAuthorization.call(self, {
      Bucket: Bucket,
      Region: Region,
      Method: params.Method,
      Key: KeyName,
      Pathname: Pathname,
      Query: params.Query,
      Headers: headers,
      Scope: Scope,
      SystemClockOffset: self.options.SystemClockOffset,
      ForceSignHost: forceSignHost
    }, function (AuthData) {
      if (typeof AuthData === 'string') AuthData = {
        Authorization: AuthData
      };
      var AuthError = checkAuthError(AuthData);
      if (AuthError) return cb(AuthError);

      if (AuthData.Authorization) {
        cb(null, AuthData);
      } else {
        StsData = AuthData || {};
        StsData.Scope = Scope;
        StsData.ScopeKey = ScopeKey;

        self._StsCache.push(StsData);

        calcAuthByTmpKey();
      }
    });
  } else if (self.options.getSTS) {
    // 外部获取临时密钥
    self.options.getSTS.call(self, {
      Bucket: Bucket,
      Region: Region
    }, function (data) {
      StsData = data || {};
      StsData.Scope = Scope;
      StsData.ScopeKey = ScopeKey;
      if (!StsData.TmpSecretId) StsData.TmpSecretId = StsData.SecretId;
      if (!StsData.TmpSecretKey) StsData.TmpSecretKey = StsData.SecretKey;
      var AuthError = checkAuthError(StsData);
      if (AuthError) return cb(AuthError);

      self._StsCache.push(StsData);

      calcAuthByTmpKey();
    });
  } else {
    // 内部计算获取签名
    return function () {
      var Authorization = util.getAuth({
        SecretId: params.SecretId || self.options.SecretId,
        SecretKey: params.SecretKey || self.options.SecretKey,
        Method: params.Method,
        Pathname: Pathname,
        Query: params.Query,
        Headers: headers,
        Expires: params.Expires,
        UseRawKey: self.options.UseRawKey,
        SystemClockOffset: self.options.SystemClockOffset,
        ForceSignHost: forceSignHost
      });
      var AuthData = {
        Authorization: Authorization,
        SecurityToken: self.options.SecurityToken || self.options.XCosSecurityToken
      };
      cb(null, AuthData);
      return AuthData;
    }();
  }

  return '';
} // 调整时间偏差


function allowRetry(err) {
  var allowRetry = false;
  var isTimeError = false;
  var serverDate = err.headers && (err.headers.date || err.headers.Date) || err.error && err.error.ServerTime;

  try {
    var errorCode = err.error.Code;
    var errorMessage = err.error.Message;

    if (errorCode === 'RequestTimeTooSkewed' || errorCode === 'AccessDenied' && errorMessage === 'Request has expired') {
      isTimeError = true;
    }
  } catch (e) {}

  if (err) {
    if (isTimeError && serverDate) {
      var serverTime = Date.parse(serverDate);

      if (this.options.CorrectClockSkew && Math.abs(util.getSkewTime(this.options.SystemClockOffset) - serverTime) >= 30000) {
        console.error('error: Local time is too skewed.');
        this.options.SystemClockOffset = serverTime - Date.now();
        allowRetry = true;
      }
    } else if (Math.floor(err.statusCode / 100) === 5) {
      allowRetry = true;
    }
  }

  return allowRetry;
} // 获取签名并发起请求


function submitRequest(params, callback) {
  var self = this; // 处理 headers

  !params.headers && (params.headers = {}); // 处理 query

  !params.qs && (params.qs = {});
  params.VersionId && (params.qs.versionId = params.VersionId);
  params.qs = util.clearKey(params.qs); // 清理 undefined 和 null 字段

  params.headers && (params.headers = util.clearKey(params.headers));
  params.qs && (params.qs = util.clearKey(params.qs));
  var Query = util.clone(params.qs);
  params.action && (Query[params.action] = '');
  var paramsUrl = params.url || params.Url;
  var SignHost = params.SignHost || getSignHost.call(this, {
    Bucket: params.Bucket,
    Region: params.Region,
    Url: paramsUrl
  });
  var tracker = params.tracker;

  var next = function next(tryTimes) {
    var oldClockOffset = self.options.SystemClockOffset;
    tracker && tracker.setParams({
      signStartTime: new Date().getTime(),
      retryTimes: tryTimes - 1
    });
    getAuthorizationAsync.call(self, {
      Bucket: params.Bucket || '',
      Region: params.Region || '',
      Method: params.method,
      Key: params.Key,
      Query: Query,
      Headers: params.headers,
      SignHost: SignHost,
      Action: params.Action,
      ResourceKey: params.ResourceKey,
      Scope: params.Scope,
      ForceSignHost: self.options.ForceSignHost
    }, function (err, AuthData) {
      if (err) {
        callback(err);
        return;
      }

      tracker && tracker.setParams({
        signEndTime: new Date().getTime(),
        httpStartTime: new Date().getTime()
      });
      params.AuthData = AuthData;

      _submitRequest.call(self, params, function (err, data) {
        tracker && tracker.setParams({
          httpEndTime: new Date().getTime()
        });

        if (err && tryTimes < 2 && (oldClockOffset !== self.options.SystemClockOffset || allowRetry.call(self, err))) {
          if (params.headers) {
            delete params.headers.Authorization;
            delete params.headers['token'];
            delete params.headers['clientIP'];
            delete params.headers['clientUA'];
            params.headers['x-cos-security-token'] && delete params.headers['x-cos-security-token'];
            params.headers['x-ci-security-token'] && delete params.headers['x-ci-security-token'];
          }

          next(tryTimes + 1);
        } else {
          callback(err, data);
        }
      });
    });
  };

  next(1);
} // 发起请求


function _submitRequest(params, callback) {
  var self = this;
  var TaskId = params.TaskId;
  if (TaskId && !self._isRunningTask(TaskId)) return;
  var bucket = params.Bucket;
  var region = params.Region;
  var object = params.Key;
  var method = params.method || 'GET';
  var url = params.Url || params.url;
  var body = params.body;
  var rawBody = params.rawBody; // url

  if (self.options.UseAccelerate) {
    region = 'accelerate';
  }

  url = url || getUrl({
    ForcePathStyle: self.options.ForcePathStyle,
    protocol: self.options.Protocol,
    domain: self.options.Domain,
    bucket: bucket,
    region: region,
    object: object
  });

  if (params.action) {
    url = url + '?' + params.action;
  }

  if (params.qsStr) {
    if (url.indexOf('?') > -1) {
      url = url + '&' + params.qsStr;
    } else {
      url = url + '?' + params.qsStr;
    }
  }

  var opt = {
    method: method,
    url: url,
    headers: params.headers,
    qs: params.qs,
    body: body
  }; // 兼容ci接口

  var token = 'x-cos-security-token';

  if (util.isCIHost(url)) {
    token = 'x-ci-security-token';
  } // 获取签名


  opt.headers.Authorization = params.AuthData.Authorization;
  params.AuthData.Token && (opt.headers['token'] = params.AuthData.Token);
  params.AuthData.ClientIP && (opt.headers['clientIP'] = params.AuthData.ClientIP);
  params.AuthData.ClientUA && (opt.headers['clientUA'] = params.AuthData.ClientUA);
  params.AuthData.SecurityToken && (opt.headers[token] = params.AuthData.SecurityToken); // 清理 undefined 和 null 字段

  opt.headers && (opt.headers = util.clearKey(opt.headers));
  opt = util.clearKey(opt); // progress

  if (params.onProgress && typeof params.onProgress === 'function') {
    var contentLength = body && (body.size || body.length) || 0;

    opt.onProgress = function (e) {
      if (TaskId && !self._isRunningTask(TaskId)) return;
      var loaded = e ? e.loaded : 0;
      params.onProgress({
        loaded: loaded,
        total: contentLength
      });
    };
  }

  if (params.onDownloadProgress) {
    opt.onDownloadProgress = params.onDownloadProgress;
  }

  if (params.DataType) {
    opt.dataType = params.DataType;
  }

  if (this.options.Timeout) {
    opt.timeout = this.options.Timeout;
  }

  self.options.ForcePathStyle && (opt.pathStyle = self.options.ForcePathStyle);
  self.emit('before-send', opt);
  var useAccelerate = opt.url.includes('accelerate.');
  var queryString = Object.keys(opt.qs).map(function (key) {
    return "".concat(key, "=").concat(opt.qs[key]);
  }).join('&');
  var fullUrl = queryString ? opt.url + '?' + queryString : opt.url;
  params.tracker && params.tracker.setParams({
    reqUrl: fullUrl,
    accelerate: useAccelerate ? 'Y' : 'N'
  }); // 分块上传时给父级tracker设置url信息

  params.tracker && params.tracker.parent && params.tracker.parent.setParams({
    reqUrl: fullUrl,
    accelerate: useAccelerate ? 'Y' : 'N'
  });
  var sender = (self.options.Request || REQUEST)(opt, function (r) {
    if (r.error === 'abort') return;
    var receive = {
      options: opt,
      error: err,
      statusCode: response && response.statusCode || 0,
      headers: response && response.headers || {},
      body: body
    };
    self.emit('after-receive', receive);
    err = receive.error;
    body = receive.body;
    response = {
      statusCode: receive.statusCode,
      headers: receive.headers
    }; // 抛出事件，允许修改返回值的 error、statusCode、statusMessage、body

    self.emit('after-receive', r);
    var response = {
      statusCode: r.statusCode,
      statusMessage: r.statusMessage,
      headers: r.headers
    };
    var err = r.error;
    var body = r.body; // 返回内容添加 状态码 和 headers

    var hasReturned;

    var cb = function cb(err, data) {
      TaskId && self.off('inner-kill-task', killTask);
      if (hasReturned) return;
      hasReturned = true;
      var attrs = {};
      response && response.statusCode && (attrs.statusCode = response.statusCode);
      response && response.headers && (attrs.headers = response.headers);

      if (err) {
        err = util.extend(err || {}, attrs);
        callback(err, null);
      } else {
        data = util.extend(data || {}, attrs);
        callback(null, data);
      }

      sender = null;
    }; // 请求错误，发生网络错误


    if (err) return cb(util.error(err)); // 请求返回码不为 200

    var statusCode = response.statusCode;
    var statusSuccess = Math.floor(statusCode / 100) === 2; // 200 202 204 206
    // 不对 body 进行转换，body 直接挂载返回

    if (rawBody && statusSuccess) return cb(null, {
      body: body
    }); // 解析 xml body

    var json;

    try {
      json = body && body.indexOf('<') > -1 && body.indexOf('>') > -1 && util.xml2json(body) || {};
    } catch (e) {
      json = {};
    } // 处理返回值


    var xmlError = json && json.Error;

    if (statusSuccess) {
      // 正确返回，状态码 2xx 时，body 不会有 Error
      cb(null, json);
    } else if (xmlError) {
      // 正常返回了 xml body，且有 Error 节点
      cb(util.error(new Error(xmlError.Message), {
        code: xmlError.Code,
        error: xmlError
      }));
    } else if (statusCode) {
      // 有错误的状态码
      cb(util.error(new Error(response.statusMessage), {
        code: '' + statusCode
      }));
    } else if (statusCode) {
      // 无状态码，或者获取不到状态码
      cb(util.error(new Error('statusCode error')));
    }
  }); // kill task

  var killTask = function killTask(data) {
    if (data.TaskId === TaskId) {
      sender && sender.abort && sender.abort();
      self.off('inner-kill-task', killTask);
    }
  };

  TaskId && self.on('inner-kill-task', killTask);
}

var API_MAP = {
  // Bucket 相关方法
  getService: getService,
  // Bucket
  putBucket: putBucket,
  headBucket: headBucket,
  // Bucket
  getBucket: getBucket,
  deleteBucket: deleteBucket,
  putBucketAcl: putBucketAcl,
  // BucketACL
  getBucketAcl: getBucketAcl,
  putBucketCors: putBucketCors,
  // BucketCors
  getBucketCors: getBucketCors,
  deleteBucketCors: deleteBucketCors,
  getBucketLocation: getBucketLocation,
  // BucketLocation
  getBucketPolicy: getBucketPolicy,
  // BucketPolicy
  putBucketPolicy: putBucketPolicy,
  deleteBucketPolicy: deleteBucketPolicy,
  putBucketTagging: putBucketTagging,
  // BucketTagging
  getBucketTagging: getBucketTagging,
  deleteBucketTagging: deleteBucketTagging,
  putBucketLifecycle: putBucketLifecycle,
  // BucketLifecycle
  getBucketLifecycle: getBucketLifecycle,
  deleteBucketLifecycle: deleteBucketLifecycle,
  putBucketVersioning: putBucketVersioning,
  // BucketVersioning
  getBucketVersioning: getBucketVersioning,
  putBucketReplication: putBucketReplication,
  // BucketReplication
  getBucketReplication: getBucketReplication,
  deleteBucketReplication: deleteBucketReplication,
  putBucketWebsite: putBucketWebsite,
  // BucketWebsite
  getBucketWebsite: getBucketWebsite,
  deleteBucketWebsite: deleteBucketWebsite,
  putBucketReferer: putBucketReferer,
  // BucketReferer
  getBucketReferer: getBucketReferer,
  putBucketDomain: putBucketDomain,
  // BucketDomain
  getBucketDomain: getBucketDomain,
  deleteBucketDomain: deleteBucketDomain,
  putBucketOrigin: putBucketOrigin,
  // BucketOrigin
  getBucketOrigin: getBucketOrigin,
  deleteBucketOrigin: deleteBucketOrigin,
  putBucketLogging: putBucketLogging,
  // BucketLogging
  getBucketLogging: getBucketLogging,
  putBucketInventory: putBucketInventory,
  // BucketInventory
  getBucketInventory: getBucketInventory,
  listBucketInventory: listBucketInventory,
  deleteBucketInventory: deleteBucketInventory,
  putBucketAccelerate: putBucketAccelerate,
  getBucketAccelerate: getBucketAccelerate,
  putBucketEncryption: putBucketEncryption,
  getBucketEncryption: getBucketEncryption,
  deleteBucketEncryption: deleteBucketEncryption,
  // Object 相关方法
  getObject: getObject,
  headObject: headObject,
  listObjectVersions: listObjectVersions,
  putObject: putObject,
  deleteObject: deleteObject,
  getObjectAcl: getObjectAcl,
  putObjectAcl: putObjectAcl,
  optionsObject: optionsObject,
  putObjectCopy: putObjectCopy,
  deleteMultipleObject: deleteMultipleObject,
  restoreObject: restoreObject,
  putObjectTagging: putObjectTagging,
  getObjectTagging: getObjectTagging,
  deleteObjectTagging: deleteObjectTagging,
  selectObjectContent: selectObjectContent,
  appendObject: appendObject,
  // 分块上传相关方法
  uploadPartCopy: uploadPartCopy,
  multipartInit: multipartInit,
  multipartUpload: multipartUpload,
  multipartComplete: multipartComplete,
  multipartList: multipartList,
  multipartListPart: multipartListPart,
  multipartAbort: multipartAbort,
  // 工具方法
  request: request,
  getObjectUrl: getObjectUrl,
  getAuth: getAuth
};

function warnOldApi(apiName, fn, proto) {
  util.each(['Cors', 'Acl'], function (suffix) {
    if (apiName.slice(-suffix.length) === suffix) {
      var oldName = apiName.slice(0, -suffix.length) + suffix.toUpperCase();
      var apiFn = util.apiWrapper(apiName, fn);
      var warned = false;

      proto[oldName] = function () {
        !warned && console.warn('warning: cos.' + oldName + ' has been deprecated. Please Use cos.' + apiName + ' instead.');
        warned = true;
        apiFn.apply(this, arguments);
      };
    }
  });
}

module.exports.init = function (COS, task) {
  task.transferToTaskMethod(API_MAP, 'putObject');
  util.each(API_MAP, function (fn, apiName) {
    COS.prototype[apiName] = util.apiWrapper(apiName, fn);
    warnOldApi(apiName, fn, COS.prototype);
  });
};

/***/ }),

/***/ "./src/cos.js":
/*!********************!*\
  !*** ./src/cos.js ***!
  \********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var util = __webpack_require__(/*! ./util */ "./src/util.js");

var event = __webpack_require__(/*! ./event */ "./src/event.js");

var task = __webpack_require__(/*! ./task */ "./src/task.js");

var base = __webpack_require__(/*! ./base */ "./src/base.js");

var advance = __webpack_require__(/*! ./advance */ "./src/advance.js");

var pkg = __webpack_require__(/*! ../package.json */ "./package.json");

var defaultOptions = {
  AppId: '',
  // AppId 已废弃，请拼接到 Bucket 后传入，例如：test-1250000000
  SecretId: '',
  SecretKey: '',
  SecurityToken: '',
  // 使用临时密钥需要注意自行刷新 Token
  ChunkRetryTimes: 2,
  FileParallelLimit: 3,
  ChunkParallelLimit: 3,
  ChunkSize: 1024 * 1024,
  SliceSize: 1024 * 1024,
  CopyChunkParallelLimit: 20,
  CopyChunkSize: 1024 * 1024 * 10,
  CopySliceSize: 1024 * 1024 * 10,
  MaxPartNumber: 10000,
  ProgressInterval: 1000,
  Domain: '',
  ServiceDomain: '',
  Protocol: '',
  CompatibilityMode: false,
  ForcePathStyle: false,
  UseRawKey: false,
  Timeout: 0,
  // 单位毫秒，0 代表不设置超时时间
  CorrectClockSkew: true,
  SystemClockOffset: 0,
  // 单位毫秒，ms
  UploadCheckContentMd5: false,
  UploadQueueSize: 10000,
  UploadAddMetaMd5: false,
  UploadIdCacheLimit: 50,
  UseAccelerate: false,
  ForceSignHost: true,
  // 默认将host加入签名计算，关闭后可能导致越权风险，建议保持为true
  EnableTracker: false,
  // 默认关闭上报
  DeepTracker: false,
  // 上报时是否对每个分块上传做单独上报
  TrackerDelay: 5000,
  // 周期性上报，单位毫秒。0代表实时上报
  CustomId: '' // 自定义上报id

}; // 对外暴露的类

var COS = function COS(options) {
  this.options = util.extend(util.clone(defaultOptions), options || {});
  this.options.FileParallelLimit = Math.max(1, this.options.FileParallelLimit);
  this.options.ChunkParallelLimit = Math.max(1, this.options.ChunkParallelLimit);
  this.options.ChunkRetryTimes = Math.max(0, this.options.ChunkRetryTimes);
  this.options.ChunkSize = Math.max(1024 * 1024, this.options.ChunkSize);
  this.options.CopyChunkParallelLimit = Math.max(1, this.options.CopyChunkParallelLimit);
  this.options.CopyChunkSize = Math.max(1024 * 1024, this.options.CopyChunkSize);
  this.options.CopySliceSize = Math.max(0, this.options.CopySliceSize);
  this.options.MaxPartNumber = Math.max(1024, Math.min(10000, this.options.MaxPartNumber));
  this.options.Timeout = Math.max(0, this.options.Timeout);

  if (this.options.AppId) {
    console.warn('warning: AppId has been deprecated, Please put it at the end of parameter Bucket(E.g: "test-1250000000").');
  }

  if (this.options.SecretId && this.options.SecretId.indexOf(' ') > -1) {
    console.error('error: SecretId格式错误，请检查');
    console.error('error: SecretId format is incorrect. Please check');
  }

  if (this.options.SecretKey && this.options.SecretKey.indexOf(' ') > -1) {
    console.error('error: SecretKey格式错误，请检查');
    console.error('error: SecretKey format is incorrect. Please check');
  }

  if (util.isNode()) {
    console.warn('warning: cos-js-sdk-v5 不支持 nodejs 环境使用，请改用 cos-nodejs-sdk-v5，参考文档： https://cloud.tencent.com/document/product/436/8629');
    console.warn('warning: cos-js-sdk-v5 does not support nodejs environment. Please use cos-nodejs-sdk-v5 instead. See: https://cloud.tencent.com/document/product/436/8629');
  }

  event.init(this);
  task.init(this);
};

base.init(COS, task);
advance.init(COS, task);
COS.util = {
  md5: util.md5,
  xml2json: util.xml2json,
  json2xml: util.json2xml
};
COS.getAuthorization = util.getAuth;
COS.version = pkg.version;
module.exports = COS;

/***/ }),

/***/ "./src/event.js":
/*!**********************!*\
  !*** ./src/event.js ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports) {

var initEvent = function initEvent(cos) {
  var listeners = {};

  var getList = function getList(action) {
    !listeners[action] && (listeners[action] = []);
    return listeners[action];
  };

  cos.on = function (action, callback) {
    if (action === 'task-list-update') {
      console.warn('warning: Event "' + action + '" has been deprecated. Please use "list-update" instead.');
    }

    getList(action).push(callback);
  };

  cos.off = function (action, callback) {
    var list = getList(action);

    for (var i = list.length - 1; i >= 0; i--) {
      callback === list[i] && list.splice(i, 1);
    }
  };

  cos.emit = function (action, data) {
    var list = getList(action).map(function (cb) {
      return cb;
    });

    for (var i = 0; i < list.length; i++) {
      list[i](data);
    }
  };
};

var EventProxy = function EventProxy() {
  initEvent(this);
};

module.exports.init = initEvent;
module.exports.EventProxy = EventProxy;

/***/ }),

/***/ "./src/session.js":
/*!************************!*\
  !*** ./src/session.js ***!
  \************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var util = __webpack_require__(/*! ./util */ "./src/util.js"); // 按照文件特征值，缓存 UploadId


var cacheKey = 'cos_sdk_upload_cache';
var expires = 30 * 24 * 3600;
var cache;
var timer;

var getCache = function getCache() {
  try {
    var val = JSON.parse(localStorage.getItem(cacheKey));
  } catch (e) {}

  if (!val) val = [];
  cache = val;
};

var setCache = function setCache() {
  try {
    if (cache.length) localStorage.setItem(cacheKey, JSON.stringify(cache));else localStorage.removeItem(cacheKey);
  } catch (e) {}
};

var init = function init() {
  if (cache) return;
  getCache.call(this); // 清理太老旧的数据

  var changed = false;
  var now = Math.round(Date.now() / 1000);

  for (var i = cache.length - 1; i >= 0; i--) {
    var mtime = cache[i][2];

    if (!mtime || mtime + expires < now) {
      cache.splice(i, 1);
      changed = true;
    }
  }

  changed && setCache();
}; // 把缓存存到本地


var save = function save() {
  if (timer) return;
  timer = setTimeout(function () {
    setCache();
    timer = null;
  }, 400);
};

var mod = {
  using: {},
  // 标记 UploadId 正在使用
  setUsing: function setUsing(uuid) {
    mod.using[uuid] = true;
  },
  // 标记 UploadId 已经没在使用
  removeUsing: function removeUsing(uuid) {
    delete mod.using[uuid];
  },
  // 用上传参数生成哈希值
  getFileId: function getFileId(file, ChunkSize, Bucket, Key) {
    if (file.name && file.size && file.lastModifiedDate && ChunkSize) {
      return util.md5([file.name, file.size, file.lastModifiedDate, ChunkSize, Bucket, Key].join('::'));
    } else {
      return null;
    }
  },
  // 用上传参数生成哈希值
  getCopyFileId: function getCopyFileId(copySource, sourceHeaders, ChunkSize, Bucket, Key) {
    var size = sourceHeaders['content-length'];
    var etag = sourceHeaders.etag || '';
    var lastModified = sourceHeaders['last-modified'];

    if (copySource && ChunkSize) {
      return util.md5([copySource, size, etag, lastModified, ChunkSize, Bucket, Key].join('::'));
    } else {
      return null;
    }
  },
  // 获取文件对应的 UploadId 列表
  getUploadIdList: function getUploadIdList(uuid) {
    if (!uuid) return null;
    init.call(this);
    var list = [];

    for (var i = 0; i < cache.length; i++) {
      if (cache[i][0] === uuid) list.push(cache[i][1]);
    }

    return list.length ? list : null;
  },
  // 缓存 UploadId
  saveUploadId: function saveUploadId(uuid, UploadId, limit) {
    init.call(this);
    if (!uuid) return; // 清理没用的 UploadId，js 文件没有 FilePath ，只清理相同记录

    for (var i = cache.length - 1; i >= 0; i--) {
      var item = cache[i];

      if (item[0] === uuid && item[1] === UploadId) {
        cache.splice(i, 1);
      }
    }

    cache.unshift([uuid, UploadId, Math.round(Date.now() / 1000)]);
    if (cache.length > limit) cache.splice(limit);
    save();
  },
  // UploadId 已用完，移除掉
  removeUploadId: function removeUploadId(UploadId) {
    init.call(this);
    delete mod.using[UploadId];

    for (var i = cache.length - 1; i >= 0; i--) {
      if (cache[i][1] === UploadId) cache.splice(i, 1);
    }

    save();
  }
};
module.exports = mod;

/***/ }),

/***/ "./src/task.js":
/*!*********************!*\
  !*** ./src/task.js ***!
  \*********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var session = __webpack_require__(/*! ./session */ "./src/session.js");

var util = __webpack_require__(/*! ./util */ "./src/util.js");

var originApiMap = {};

var transferToTaskMethod = function transferToTaskMethod(apiMap, apiName) {
  originApiMap[apiName] = apiMap[apiName];

  apiMap[apiName] = function (params, callback) {
    if (params.SkipTask) {
      originApiMap[apiName].call(this, params, callback);
    } else {
      this._addTask(apiName, params, callback);
    }
  };
};

var initTask = function initTask(cos) {
  var queue = [];
  var tasks = {};
  var uploadingFileCount = 0;
  var nextUploadIndex = 0; // 接口返回简略的任务信息

  var formatTask = function formatTask(task) {
    var t = {
      id: task.id,
      Bucket: task.Bucket,
      Region: task.Region,
      Key: task.Key,
      FilePath: task.FilePath,
      state: task.state,
      loaded: task.loaded,
      size: task.size,
      speed: task.speed,
      percent: task.percent,
      hashPercent: task.hashPercent,
      error: task.error
    };
    if (task.FilePath) t.FilePath = task.FilePath;
    if (task._custom) t._custom = task._custom; // 控制台使用

    return t;
  };

  var emitListUpdate = function () {
    var timer;

    var emit = function emit() {
      timer = 0;
      cos.emit('task-list-update', {
        list: util.map(queue, formatTask)
      });
      cos.emit('list-update', {
        list: util.map(queue, formatTask)
      });
    };

    return function () {
      if (!timer) timer = setTimeout(emit);
    };
  }();

  var clearQueue = function clearQueue() {
    if (queue.length <= cos.options.UploadQueueSize) return;

    for (var i = 0; i < nextUploadIndex && // 小于当前操作的 index 才清理
    i < queue.length && // 大于队列才清理
    queue.length > cos.options.UploadQueueSize // 如果还太多，才继续清理
    ;) {
      var isActive = queue[i].state === 'waiting' || queue[i].state === 'checking' || queue[i].state === 'uploading';

      if (!queue[i] || !isActive) {
        tasks[queue[i].id] && delete tasks[queue[i].id];
        queue.splice(i, 1);
        nextUploadIndex--;
      } else {
        i++;
      }
    }

    emitListUpdate();
  };

  var startNextTask = function startNextTask() {
    // 检查是否允许增加执行进程
    if (uploadingFileCount >= cos.options.FileParallelLimit) return; // 跳过不可执行的任务

    while (queue[nextUploadIndex] && queue[nextUploadIndex].state !== 'waiting') {
      nextUploadIndex++;
    } // 检查是否已遍历结束


    if (nextUploadIndex >= queue.length) return; // 上传该遍历到的任务

    var task = queue[nextUploadIndex];
    nextUploadIndex++;
    uploadingFileCount++;
    task.state = 'checking';
    task.params.onTaskStart && task.params.onTaskStart(formatTask(task));
    !task.params.UploadData && (task.params.UploadData = {});
    var apiParams = util.formatParams(task.api, task.params);
    originApiMap[task.api].call(cos, apiParams, function (err, data) {
      if (!cos._isRunningTask(task.id)) return;

      if (task.state === 'checking' || task.state === 'uploading') {
        task.state = err ? 'error' : 'success';
        err && (task.error = err);
        uploadingFileCount--;
        emitListUpdate();
        startNextTask();
        task.callback && task.callback(err, data);

        if (task.state === 'success') {
          if (task.params) {
            delete task.params.UploadData;
            delete task.params.Body;
            delete task.params;
          }

          delete task.callback;
        }
      }

      clearQueue();
    });
    emitListUpdate(); // 异步执行下一个任务

    setTimeout(startNextTask);
  };

  var killTask = function killTask(id, switchToState) {
    var task = tasks[id];
    if (!task) return;
    var waiting = task && task.state === 'waiting';
    var running = task && (task.state === 'checking' || task.state === 'uploading');

    if (switchToState === 'canceled' && task.state !== 'canceled' || switchToState === 'paused' && waiting || switchToState === 'paused' && running) {
      if (switchToState === 'paused' && task.params.Body && typeof task.params.Body.pipe === 'function') {
        console.error('stream not support pause');
        return;
      }

      task.state = switchToState;
      cos.emit('inner-kill-task', {
        TaskId: id,
        toState: switchToState
      });

      try {
        var UploadId = task && task.params && task.params.UploadData.UploadId;
      } catch (e) {}

      if (switchToState === 'canceled' && UploadId) session.removeUsing(UploadId);
      emitListUpdate();

      if (running) {
        uploadingFileCount--;
        startNextTask();
      }

      if (switchToState === 'canceled') {
        if (task.params) {
          delete task.params.UploadData;
          delete task.params.Body;
          delete task.params;
        }

        delete task.callback;
      }
    }

    clearQueue();
  };

  cos._addTasks = function (taskList) {
    util.each(taskList, function (task) {
      cos._addTask(task.api, task.params, task.callback, true);
    });
    emitListUpdate();
  };

  var isTaskReadyWarning = true;

  cos._addTask = function (api, params, callback, ignoreAddEvent) {
    // 复制参数对象
    params = util.formatParams(api, params); // 生成 id

    var id = util.uuid();
    params.TaskId = id;
    params.onTaskReady && params.onTaskReady(id);

    if (params.TaskReady) {
      params.TaskReady(id);
      isTaskReadyWarning && console.warn('warning: Param "TaskReady" has been deprecated. Please use "onTaskReady" instead.');
      isTaskReadyWarning = false;
    }

    var task = {
      // env
      params: params,
      callback: callback,
      api: api,
      index: queue.length,
      // task
      id: id,
      Bucket: params.Bucket,
      Region: params.Region,
      Key: params.Key,
      FilePath: params.FilePath || '',
      state: 'waiting',
      loaded: 0,
      size: 0,
      speed: 0,
      percent: 0,
      hashPercent: 0,
      error: null,
      _custom: params._custom
    };
    var onHashProgress = params.onHashProgress;

    params.onHashProgress = function (info) {
      if (!cos._isRunningTask(task.id)) return;
      task.hashPercent = info.percent;
      onHashProgress && onHashProgress(info);
      emitListUpdate();
    };

    var onProgress = params.onProgress;

    params.onProgress = function (info) {
      if (!cos._isRunningTask(task.id)) return;
      task.state === 'checking' && (task.state = 'uploading');
      task.loaded = info.loaded;
      task.speed = info.speed;
      task.percent = info.percent;
      onProgress && onProgress(info);
      emitListUpdate();
    }; // 异步获取 filesize


    util.getFileSize(api, params, function (err, size) {
      // 开始处理上传
      if (err) return callback(util.error(err)); // 如果获取大小出错，不加入队列
      // 获取完文件大小再把任务加入队列

      tasks[id] = task;
      queue.push(task);
      task.size = size;
      !ignoreAddEvent && emitListUpdate();
      startNextTask();
      clearQueue();
    });
    return id;
  };

  cos._isRunningTask = function (id) {
    var task = tasks[id];
    return !!(task && (task.state === 'checking' || task.state === 'uploading'));
  };

  cos.getTaskList = function () {
    return util.map(queue, formatTask);
  };

  cos.cancelTask = function (id) {
    killTask(id, 'canceled');
  };

  cos.pauseTask = function (id) {
    killTask(id, 'paused');
  };

  cos.restartTask = function (id) {
    var task = tasks[id];

    if (task && (task.state === 'paused' || task.state === 'error')) {
      task.state = 'waiting';
      emitListUpdate();
      nextUploadIndex = Math.min(nextUploadIndex, task.index);
      startNextTask();
    }
  };

  cos.isUploadRunning = function () {
    return uploadingFileCount || nextUploadIndex < queue.length;
  };
};

module.exports.transferToTaskMethod = transferToTaskMethod;
module.exports.init = initTask;

/***/ }),

/***/ "./src/tracker.js":
/*!************************!*\
  !*** ./src/tracker.js ***!
  \************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var _classCallCheck = __webpack_require__(/*! @babel/runtime/helpers/classCallCheck */ "./node_modules/@babel/runtime/helpers/classCallCheck.js");

var _createClass = __webpack_require__(/*! @babel/runtime/helpers/createClass */ "./node_modules/@babel/runtime/helpers/createClass.js");

var _typeof = __webpack_require__(/*! @babel/runtime/helpers/typeof */ "./node_modules/@babel/runtime/helpers/typeof.js");

var pkg = __webpack_require__(/*! ../package.json */ "./package.json");

var BeaconAction = __webpack_require__(/*! ../lib/beacon.min */ "./lib/beacon.min.js");

var beacon = null;

var getBeacon = function getBeacon(delay) {
  if (!beacon) {
    beacon = new BeaconAction({
      appkey: "0AND0VEVB24UBGDU",
      versionCode: pkg.version,
      channelID: 'js_sdk',
      //渠道,选填
      openid: 'openid',
      // 用户id, 选填
      unionid: 'unid',
      //用户unionid , 类似idfv,选填
      strictMode: false,
      //严苛模式开关, 打开严苛模式会主动抛出异常, 上线请务必关闭!!!
      delay: delay,
      // 普通事件延迟上报时间(单位毫秒), 默认1000(1秒),选填
      sessionDuration: 60 * 1000 // session变更的时间间隔, 一个用户持续30分钟(默认值)没有任何上报则算另一次 session,每变更一次session上报一次启动事件(rqd_applaunched),使用毫秒(ms),最小值30秒,选填

    });
  }

  return beacon;
};

var utils = {
  // 生成uid 每个链路对应唯一一条uid
  getUid: function getUid() {
    var S4 = function S4() {
      return ((1 + Math.random()) * 0x10000 | 0).toString(16).substring(1);
    };

    return S4() + S4() + "-" + S4() + "-" + S4() + "-" + S4() + "-" + S4() + S4() + S4();
  },
  // 获取网络类型
  getNetType: function getNetType() {
    if ((typeof navigator === "undefined" ? "undefined" : _typeof(navigator)) === 'object') {
      var connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      return (connection === null || connection === void 0 ? void 0 : connection.type) || (connection === null || connection === void 0 ? void 0 : connection.effectiveType) || 'unknown';
    }

    return 'unknown';
  },
  // 获取pc端操作系统类型
  getOsType: function getOsType() {
    if ((typeof navigator === "undefined" ? "undefined" : _typeof(navigator)) !== 'object') {
      return 'unknown os';
    }

    var agent = navigator.userAgent.toLowerCase();
    var isMac = /macintosh|mac os x/i.test(navigator.userAgent);

    if (agent.indexOf("win32") >= 0 || agent.indexOf("wow32") >= 0) {
      return 'win32';
    }

    if (agent.indexOf("win64") >= 0 || agent.indexOf("wow64") >= 0) {
      return 'win64';
    }

    if (isMac) {
      return 'mac';
    }

    return 'unknown os';
  },
  isMobile: function isMobile() {
    var exp = /(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i;

    if ((typeof navigator === "undefined" ? "undefined" : _typeof(navigator)) === 'object' && navigator.userAgent.match(exp)) {
      return true; // 移动端
    }

    return false; // PC端
  },
  isAndroid: function isAndroid() {
    var exp = /(Android|Adr|Linux)/i;

    if ((typeof navigator === "undefined" ? "undefined" : _typeof(navigator)) === 'object' && navigator.userAgent.match(exp)) {
      return true;
    }

    return false;
  },
  isIOS: function isIOS() {
    var exp = /(iPhone|iPod|iPad|iOS)/i;

    if ((typeof navigator === "undefined" ? "undefined" : _typeof(navigator)) === 'object' && navigator.userAgent.match(exp)) {
      return true;
    }

    return false;
  },
  isOtherMobile: function isOtherMobile() {
    return isMobile && !isAndroid && !isIOS;
  },
  // 获取浏览器类型
  getDeviceName: function getDeviceName() {
    if ((typeof navigator === "undefined" ? "undefined" : _typeof(navigator)) !== 'object') {
      return 'unknown device';
    }

    var explorer = navigator.userAgent.toLowerCase(); // 腾讯会议内置浏览器

    if (explorer.includes('app/tencent_wemeet')) {
      return 'tencent_wemeet';
    } // 遨游浏览器


    if (explorer.indexOf('maxthon') >= 0) {
      var match = explorer.match(/maxthon\/([\d.]+)/);
      var ver = match && match[1] || '';
      return "\u50B2\u6E38\u6D4F\u89C8\u5668 ".concat(ver).trim();
    } // QQ浏览器


    if (explorer.indexOf('qqbrowser') >= 0) {
      var _match = explorer.match(/qqbrowser\/([\d.]+)/);

      var _ver = _match && _match[1] || '';

      return "QQ\u6D4F\u89C8\u5668 ".concat(_ver).trim();
    } // 搜狗浏览器


    if (explorer.indexOf('se 2.x') >= 0) {
      return '搜狗浏览器';
    } // 微信浏览器


    if (explorer.indexOf('wxwork') >= 0) {
      return '微信内置浏览器';
    } // ie


    if (explorer.indexOf('msie') >= 0) {
      var _match2 = explorer.match(/msie ([\d.]+)/);

      var _ver2 = _match2 && _match2[1] || '';

      return "IE ".concat(_ver2).trim();
    } // firefox


    if (explorer.indexOf('firefox') >= 0) {
      var _match3 = explorer.match(/firefox\/([\d.]+)/);

      var _ver3 = _match3 && _match3[1] || '';

      return "Firefox ".concat(_ver3).trim();
    } // Chrome


    if (explorer.indexOf('chrome') >= 0) {
      var _match4 = explorer.match(/chrome\/([\d.]+)/);

      var _ver4 = _match4 && _match4[1] || '';

      return "Chrome ".concat(_ver4).trim();
    } // Opera


    if (explorer.indexOf('opera') >= 0) {
      var _match5 = explorer.match(/opera.([\d.]+)/);

      var _ver5 = _match5 && _match5[1] || '';

      return "Opera ".concat(_ver5).trim();
    } // Safari


    if (explorer.indexOf('safari') >= 0) {
      var _match6 = explorer.match(/version\/([\d.]+)/);

      var _ver6 = _match6 && _match6[1] || '';

      return "Safari ".concat(_ver6).trim();
    }

    if (explorer.indexOf('edge') >= 0) {
      var _match7 = explorer.match(/edge\/([\d.]+)/);

      var _ver7 = _match7 && _match7[1] || '';

      return "edge ".concat(_ver7).trim();
    }

    return explorer.substr(0, 200);
  }
};
var constant = {
  isMobile: utils.isMobile(),
  isBrowser: !utils.isMobile(),
  mobileOsType: utils.isAndroid() ? 'android' : utils.isIOS ? 'ios' : 'other_mobile',
  pcOsType: utils.getOsType()
}; // 设备信息，只取一次值

var deviceInfo = {
  // ↓上报项
  deviceType: constant.isMobile ? 'mobile' : constant.isBrowser ? 'browser' : 'unknown',
  devicePlatform: constant.isMobile ? constant.mobileOsType : constant.pcOsType,
  deviceName: utils.getDeviceName() //浏览器名称

}; // 分块上传原子方法

var sliceUploadMethods = ['multipartInit', 'multipartUpload', 'multipartComplete', 'multipartList', 'multipartListPart', 'multipartAbort'];
var uploadApi = ['putObject', 'postObject', 'appendObject', 'sliceUploadFile', 'uploadFile', 'uploadFiles'].concat(sliceUploadMethods);
var downloadApi = ['getObject'];

function getEventCode(apiName) {
  if (uploadApi.includes(apiName)) {
    return 'cos_upload';
  }

  if (downloadApi.includes(apiName)) {
    return 'cos_download';
  }

  return 'base_service';
} // 上报参数驼峰改下划线


function camel2underline(key) {
  return key.replace(/([A-Z])/g, "_$1").toLowerCase();
}

function formatParams(params) {
  var formattedParams = {};
  var allReporterKeys = ['tracePlatform', 'cossdkVersion', 'region', 'networkType', 'host', 'accelerate', 'requestPath', 'size', 'httpMd5', 'httpSign', 'httpFull', 'name', 'result', 'tookTime', 'errorNode', 'errorCode', 'errorMessage', 'errorRequestId', 'errorStatusCode', 'errorServiceName', 'errorType', 'traceId', 'bucket', 'appid', 'partNumber', 'retryTimes', 'reqUrl', 'customId', 'fullError', 'deviceType', 'devicePlatform', 'deviceName'];
  var successKeys = ['tracePlatform', 'cossdkVersion', 'region', 'bucket', 'appid', 'networkType', 'host', 'accelerate', 'requestPath', 'partNumber', 'size', 'name', 'result', 'tookTime', 'errorRequestId', 'retryTimes', 'reqUrl', 'customId', 'deviceType', 'devicePlatform', 'deviceName']; // 需要上报的参数字段

  var reporterKeys = params.result === 'Success' ? successKeys : allReporterKeys;

  for (var key in params) {
    if (!reporterKeys.includes(key)) continue;
    var formattedKey = camel2underline(key);
    formattedParams[formattedKey] = params[key];
  }

  return formattedParams;
} // 链路追踪器


var Tracker = /*#__PURE__*/function () {
  "use strict";

  function Tracker(opt) {
    _classCallCheck(this, Tracker);

    var parent = opt.parent,
        traceId = opt.traceId,
        bucket = opt.bucket,
        region = opt.region,
        apiName = opt.apiName,
        fileKey = opt.fileKey,
        fileSize = opt.fileSize,
        accelerate = opt.accelerate,
        customId = opt.customId,
        delay = opt.delay,
        deepTracker = opt.deepTracker;
    var appid = bucket && bucket.substr(bucket.lastIndexOf('-') + 1) || '';
    this.parent = parent;
    this.deepTracker = deepTracker; // 上报用到的字段

    this.params = {
      // 通用字段
      cossdkVersion: pkg.version,
      region: region,
      networkType: '',
      host: '',
      accelerate: accelerate ? 'Y' : 'N',
      requestPath: fileKey || '',
      size: fileSize || -1,
      httpMd5: 0,
      // MD5耗时
      httpSign: 0,
      // 计算签名耗时
      httpFull: 0,
      // http请求耗时
      name: apiName || '',
      result: '',
      // sdk api调用结果Success、Fail
      tookTime: 0,
      // 总耗时
      errorNode: '',
      errorCode: '',
      errorMessage: '',
      errorRequestId: '',
      errorStatusCode: 0,
      errorServiceName: '',
      // js补充字段
      tracePlatform: 'cos-js-sdk-v5',
      // 上报平台=js
      traceId: traceId || utils.getUid(),
      // 每条上报唯一标识
      bucket: bucket,
      appid: appid,
      partNumber: 0,
      // 分块上传编号
      retryTimes: 0,
      // sdk内部发起的请求重试
      reqUrl: '',
      // 请求url
      customId: customId || '',
      // 业务id
      deviceType: deviceInfo.deviceType,
      // 设备类型 移动端浏览器、web浏览器
      devicePlatform: deviceInfo.devicePlatform,
      deviceName: deviceInfo.deviceName,
      md5StartTime: 0,
      // md5计算开始时间
      md5EndTime: 0,
      // md5计算结束时间
      signStartTime: 0,
      // 计算签名开始时间
      signEndTime: 0,
      // 计算签名结束时间
      httpStartTime: 0,
      // 发起网络请求开始时间
      httpEndTime: 0,
      // 网路请求结束时间
      startTime: new Date().getTime(),
      // sdk api调用起始时间，不是纯网络耗时
      endTime: 0 //  sdk api调用结束时间，不是纯网络耗时

    };
    this.beacon = getBeacon(delay);
  } // 格式化sdk回调


  _createClass(Tracker, [{
    key: "formatResult",
    value: function formatResult(err, data) {
      var _err$error, _err$error2, _err$error3, _err$error4, _err$error5, _err$error6;

      var now = new Date().getTime();
      var tookTime = now - this.params.startTime;
      var networkType = utils.getNetType();
      var errorCode = err ? (err === null || err === void 0 ? void 0 : err.code) || (err === null || err === void 0 ? void 0 : (_err$error = err.error) === null || _err$error === void 0 ? void 0 : _err$error.code) || (err === null || err === void 0 ? void 0 : (_err$error2 = err.error) === null || _err$error2 === void 0 ? void 0 : _err$error2.Code) : '';
      var errorMessage = err ? (err === null || err === void 0 ? void 0 : err.message) || (err === null || err === void 0 ? void 0 : (_err$error3 = err.error) === null || _err$error3 === void 0 ? void 0 : _err$error3.message) || (err === null || err === void 0 ? void 0 : (_err$error4 = err.error) === null || _err$error4 === void 0 ? void 0 : _err$error4.Message) : '';
      var errorServiceName = err ? (err === null || err === void 0 ? void 0 : err.resource) || (err === null || err === void 0 ? void 0 : (_err$error5 = err.error) === null || _err$error5 === void 0 ? void 0 : _err$error5.resource) || (err === null || err === void 0 ? void 0 : (_err$error6 = err.error) === null || _err$error6 === void 0 ? void 0 : _err$error6.Resource) : '';
      var errorStatusCode = err ? err === null || err === void 0 ? void 0 : err.statusCode : data.statusCode;
      var requestId = err ? (err === null || err === void 0 ? void 0 : err.headers) && (err === null || err === void 0 ? void 0 : err.headers['x-cos-request-id']) : (data === null || data === void 0 ? void 0 : data.headers) && (data === null || data === void 0 ? void 0 : data.headers['x-cos-request-id']);
      var errorType = err ? requestId ? 'Server' : 'Client' : '';
      Object.assign(this.params, {
        tookTime: tookTime,
        networkType: networkType,
        httpMd5: this.params.md5EndTime - this.params.md5StartTime,
        httpSign: this.params.signEndTime - this.params.signStartTime,
        httpFull: this.params.httpEndTime - this.params.httpStartTime,
        result: err ? 'Fail' : 'Success',
        errorType: errorType,
        errorCode: errorCode,
        errorStatusCode: errorStatusCode,
        errorMessage: errorMessage,
        errorServiceName: errorServiceName,
        errorRequestId: requestId
      });

      if (err && (!errorCode || !errorMessage)) {
        // 暂存全量err一段时间 观察是否所有err格式都可被解析
        this.params.fullError = err ? JSON.stringify(err) : '';
      }

      if (this.params.name === 'getObject') {
        this.params.size = data ? data.headers && data.headers['content-length'] : -1;
      }

      if (this.params.reqUrl) {
        try {
          var execRes = /^http(s)?:\/\/(.*?)\//.exec(this.params.reqUrl);
          this.params.host = execRes[2];
        } catch (e) {
          this.params.host = this.params.reqUrl;
        }
      }

      this.sendEvents();
    } // 设置当前链路的参数

  }, {
    key: "setParams",
    value: function setParams(params) {
      Object.assign(this.params, params);
    } // 使用灯塔延时上报

  }, {
    key: "sendEvents",
    value: function sendEvents() {
      // DeepTracker模式下才会上报分块上传内部细节
      if (sliceUploadMethods.includes(this.params.name) && !this.deepTracker) {
        return;
      }

      var eventCode = getEventCode(this.params.name);
      var formattedParams = formatParams(this.params);

      if (this.params.delay === 0) {
        // 实时上报
        this.beacon.onDirectUserAction(eventCode, formattedParams);
      } else {
        // 周期性上报
        this.beacon.onUserAction(eventCode, formattedParams);
      } // 上报结束即销毁


      this.destroy();
    } // 生成子实例，与父所属一个链路，可用于分块上传内部流程上报单个分块操作

  }, {
    key: "generateSubTracker",
    value: function generateSubTracker(subParams) {
      Object.assign(subParams, {
        parent: this,
        deepTracker: this.deepTracker,
        traceId: this.params.traceId,
        bucket: this.params.bucket,
        region: this.params.region,
        fileKey: this.params.requestPath,
        customId: this.params.customId,
        delay: this.params.delay
      });
      return new Tracker(subParams);
    } // 链路结束后销毁实例

  }, {
    key: "destroy",
    value: function destroy() {
      this.beacon = null;
      this.params = {};
    }
  }]);

  return Tracker;
}();

module.exports = Tracker;

/***/ }),

/***/ "./src/util.js":
/*!*********************!*\
  !*** ./src/util.js ***!
  \*********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(process) {

var _typeof = __webpack_require__(/*! @babel/runtime/helpers/typeof */ "./node_modules/@babel/runtime/helpers/typeof.js");

var md5 = __webpack_require__(/*! ../lib/md5 */ "./lib/md5.js");

var CryptoJS = __webpack_require__(/*! ../lib/crypto */ "./lib/crypto.js");

var xml2json = __webpack_require__(/*! ../lib/xml2json */ "./lib/xml2json.js");

var json2xml = __webpack_require__(/*! ../lib/json2xml */ "./lib/json2xml.js");

var Tracker = __webpack_require__(/*! ./tracker */ "./src/tracker.js");

function camSafeUrlEncode(str) {
  return encodeURIComponent(str).replace(/!/g, '%21').replace(/'/g, '%27').replace(/\(/g, '%28').replace(/\)/g, '%29').replace(/\*/g, '%2A');
}

function getObjectKeys(obj, forKey) {
  var list = [];

  for (var key in obj) {
    if (obj.hasOwnProperty(key)) {
      list.push(forKey ? camSafeUrlEncode(key).toLowerCase() : key);
    }
  }

  return list.sort(function (a, b) {
    a = a.toLowerCase();
    b = b.toLowerCase();
    return a === b ? 0 : a > b ? 1 : -1;
  });
}

;
/**
 * obj转为string
 * @param  {Object}  obj                需要转的对象，必须
 * @param  {Boolean} lowerCaseKey       key是否转为小写，默认false，非必须
 * @return {String}  data               返回字符串
 */

var obj2str = function obj2str(obj, lowerCaseKey) {
  var i, key, val;
  var list = [];
  var keyList = getObjectKeys(obj);

  for (i = 0; i < keyList.length; i++) {
    key = keyList[i];
    val = obj[key] === undefined || obj[key] === null ? '' : '' + obj[key];
    key = lowerCaseKey ? camSafeUrlEncode(key).toLowerCase() : camSafeUrlEncode(key);
    val = camSafeUrlEncode(val) || '';
    list.push(key + '=' + val);
  }

  return list.join('&');
}; // 可以签入签名的headers


var signHeaders = ['content-disposition', 'content-encoding', 'content-length', 'content-md5', 'expect', 'host', 'if-match', 'if-modified-since', 'if-none-match', 'if-unmodified-since', 'origin', 'range', 'response-cache-control', 'response-content-disposition', 'response-content-encoding', 'response-content-language', 'response-content-type', 'response-expires', 'transfer-encoding', 'versionid'];

var getSignHeaderObj = function getSignHeaderObj(headers) {
  var signHeaderObj = {};

  for (var i in headers) {
    var key = i.toLowerCase();

    if (key.indexOf('x-cos-') > -1 || signHeaders.indexOf(key) > -1) {
      signHeaderObj[i] = headers[i];
    }
  }

  return signHeaderObj;
}; //测试用的key后面可以去掉


var getAuth = function getAuth(opt) {
  opt = opt || {};
  var SecretId = opt.SecretId;
  var SecretKey = opt.SecretKey;
  var KeyTime = opt.KeyTime;
  var method = (opt.method || opt.Method || 'get').toLowerCase();
  var queryParams = clone(opt.Query || opt.params || {});
  var headers = getSignHeaderObj(clone(opt.Headers || opt.headers || {}));
  var Key = opt.Key || '';
  var pathname;

  if (opt.UseRawKey) {
    pathname = opt.Pathname || opt.pathname || '/' + Key;
  } else {
    pathname = opt.Pathname || opt.pathname || Key;
    pathname.indexOf('/') !== 0 && (pathname = '/' + pathname);
  } // ForceSignHost明确传入false才不加入host签名


  var forceSignHost = opt.ForceSignHost === false ? false : true; // 如果有传入存储桶且需要强制签名，那么签名默认加 Host 参与计算，避免跨桶访问

  if (!headers.Host && !headers.host && opt.Bucket && opt.Region && forceSignHost) headers.Host = opt.Bucket + '.cos.' + opt.Region + '.myqcloud.com';
  if (!SecretId) throw new Error('missing param SecretId');
  if (!SecretKey) throw new Error('missing param SecretKey'); // 签名有效起止时间

  var now = Math.round(getSkewTime(opt.SystemClockOffset) / 1000) - 1;
  var exp = now;
  var Expires = opt.Expires || opt.expires;

  if (Expires === undefined) {
    exp += 900; // 签名过期时间为当前 + 900s
  } else {
    exp += Expires * 1 || 0;
  } // 要用到的 Authorization 参数列表


  var qSignAlgorithm = 'sha1';
  var qAk = SecretId;
  var qSignTime = KeyTime || now + ';' + exp;
  var qKeyTime = KeyTime || now + ';' + exp;
  var qHeaderList = getObjectKeys(headers, true).join(';').toLowerCase();
  var qUrlParamList = getObjectKeys(queryParams, true).join(';').toLowerCase(); // 签名算法说明文档：https://www.qcloud.com/document/product/436/7778
  // 步骤一：计算 SignKey

  var signKey = CryptoJS.HmacSHA1(qKeyTime, SecretKey).toString(); // 步骤二：构成 FormatString

  var formatString = [method, pathname, util.obj2str(queryParams, true), util.obj2str(headers, true), ''].join('\n'); // 步骤三：计算 StringToSign

  var stringToSign = ['sha1', qSignTime, CryptoJS.SHA1(formatString).toString(), ''].join('\n'); // 步骤四：计算 Signature

  var qSignature = CryptoJS.HmacSHA1(stringToSign, signKey).toString(); // 步骤五：构造 Authorization

  var authorization = ['q-sign-algorithm=' + qSignAlgorithm, 'q-ak=' + qAk, 'q-sign-time=' + qSignTime, 'q-key-time=' + qKeyTime, 'q-header-list=' + qHeaderList, 'q-url-param-list=' + qUrlParamList, 'q-signature=' + qSignature].join('&');
  return authorization;
};

var readIntBE = function readIntBE(chunk, size, offset) {
  var bytes = size / 8;
  var buf = chunk.slice(offset, offset + bytes);
  new Uint8Array(buf).reverse();
  return new {
    8: Uint8Array,
    16: Uint16Array,
    32: Uint32Array
  }[size](buf)[0];
};

var buf2str = function buf2str(chunk, start, end, isUtf8) {
  var buf = chunk.slice(start, end);
  var str = '';
  new Uint8Array(buf).forEach(function (charCode) {
    str += String.fromCharCode(charCode);
  });
  if (isUtf8) str = decodeURIComponent(escape(str));
  return str;
};

var parseSelectPayload = function parseSelectPayload(chunk) {
  var header = {};
  var body = buf2str(chunk);
  var result = {
    records: []
  };

  while (chunk.byteLength) {
    var totalLength = readIntBE(chunk, 32, 0);
    var headerLength = readIntBE(chunk, 32, 4);
    var payloadRestLength = totalLength - headerLength - 16;
    var offset = 0;
    var content;
    chunk = chunk.slice(12); // 获取 Message 的 header 信息

    while (offset < headerLength) {
      var headerNameLength = readIntBE(chunk, 8, offset);
      var headerName = buf2str(chunk, offset + 1, offset + 1 + headerNameLength);
      var headerValueLength = readIntBE(chunk, 16, offset + headerNameLength + 2);
      var headerValue = buf2str(chunk, offset + headerNameLength + 4, offset + headerNameLength + 4 + headerValueLength);
      header[headerName] = headerValue;
      offset += headerNameLength + 4 + headerValueLength;
    }

    if (header[':event-type'] === 'Records') {
      content = buf2str(chunk, offset, offset + payloadRestLength, true);
      result.records.push(content);
    } else if (header[':event-type'] === 'Stats') {
      content = buf2str(chunk, offset, offset + payloadRestLength, true);
      result.stats = util.xml2json(content).Stats;
    } else if (header[':event-type'] === 'error') {
      var errCode = header[':error-code'];
      var errMessage = header[':error-message'];
      var err = new Error(errMessage);
      err.message = errMessage;
      err.name = err.code = errCode;
      result.error = err;
    } else if (['Progress', 'Continuation', 'End'].includes(header[':event-type'])) {// do nothing
    }

    chunk = chunk.slice(offset + payloadRestLength + 4);
  }

  return {
    payload: result.records.join(''),
    body: body
  };
};

var getSourceParams = function getSourceParams(source) {
  var parser = this.options.CopySourceParser;
  if (parser) return parser(source);
  var m = source.match(/^([^.]+-\d+)\.cos(v6|-cdc)?\.([^.]+)\.myqcloud\.com\/(.+)$/);
  if (!m) return null;
  return {
    Bucket: m[1],
    Region: m[3],
    Key: m[4]
  };
};

var noop = function noop() {}; // 清除对象里值为的 undefined 或 null 的属性


var clearKey = function clearKey(obj) {
  var retObj = {};

  for (var key in obj) {
    if (obj.hasOwnProperty(key) && obj[key] !== undefined && obj[key] !== null) {
      retObj[key] = obj[key];
    }
  }

  return retObj;
};

var readAsBinaryString = function readAsBinaryString(blob, callback) {
  var readFun;
  var fr = new FileReader();

  if (FileReader.prototype.readAsBinaryString) {
    readFun = FileReader.prototype.readAsBinaryString;

    fr.onload = function () {
      callback(this.result);
    };
  } else if (FileReader.prototype.readAsArrayBuffer) {
    // 在 ie11 添加 readAsBinaryString 兼容
    readFun = function readFun(fileData) {
      var binary = "";
      var pt = this;
      var reader = new FileReader();

      reader.onload = function (e) {
        var bytes = new Uint8Array(reader.result);
        var length = bytes.byteLength;

        for (var i = 0; i < length; i++) {
          binary += String.fromCharCode(bytes[i]);
        }

        callback(binary);
      };

      reader.readAsArrayBuffer(fileData);
    };
  } else {
    console.error('FileReader not support readAsBinaryString');
  }

  readFun.call(fr, blob);
};

var fileSliceNeedCopy = function () {
  var compareVersion = function compareVersion(a, b) {
    a = a.split('.');
    b = b.split('.');

    for (var i = 0; i < b.length; i++) {
      if (a[i] !== b[i]) {
        return parseInt(a[i]) > parseInt(b[i]) ? 1 : -1;
      }
    }

    return 0;
  };

  var check = function check(ua) {
    if (!ua) return false;
    var ChromeVersion = (ua.match(/Chrome\/([.\d]+)/) || [])[1];
    var QBCoreVersion = (ua.match(/QBCore\/([.\d]+)/) || [])[1];
    var QQBrowserVersion = (ua.match(/QQBrowser\/([.\d]+)/) || [])[1];
    var need = ChromeVersion && compareVersion(ChromeVersion, '53.0.2785.116') < 0 && QBCoreVersion && compareVersion(QBCoreVersion, '3.53.991.400') < 0 && QQBrowserVersion && compareVersion(QQBrowserVersion, '9.0.2524.400') <= 0 || false;
    return need;
  };

  return check(typeof navigator !== 'undefined' && navigator.userAgent);
}(); // 获取文件分片


var fileSlice = function fileSlice(file, start, end, isUseToUpload, callback) {
  var blob;

  if (file.slice) {
    blob = file.slice(start, end);
  } else if (file.mozSlice) {
    blob = file.mozSlice(start, end);
  } else if (file.webkitSlice) {
    blob = file.webkitSlice(start, end);
  }

  if (isUseToUpload && fileSliceNeedCopy) {
    var reader = new FileReader();

    reader.onload = function (e) {
      blob = null;
      callback(new Blob([reader.result]));
    };

    reader.readAsArrayBuffer(blob);
  } else {
    callback(blob);
  }
}; // 获取文件内容的 MD5


var getBodyMd5 = function getBodyMd5(UploadCheckContentMd5, Body, callback, onProgress) {
  callback = callback || noop;

  if (UploadCheckContentMd5) {
    if (typeof Body === 'string') {
      callback(util.md5(Body, true));
    } else if (Blob && Body instanceof Blob) {
      util.getFileMd5(Body, function (err, md5) {
        callback(md5);
      }, onProgress);
    } else {
      callback();
    }
  } else {
    callback();
  }
}; // 获取文件 md5 值


var md5ChunkSize = 1024 * 1024;

var getFileMd5 = function getFileMd5(blob, callback, onProgress) {
  var size = blob.size;
  var loaded = 0;
  var md5ctx = md5.getCtx();

  var next = function next(start) {
    if (start >= size) {
      var hash = md5ctx.digest('hex');
      callback(null, hash);
      return;
    }

    var end = Math.min(size, start + md5ChunkSize);
    util.fileSlice(blob, start, end, false, function (chunk) {
      readAsBinaryString(chunk, function (content) {
        chunk = null;
        md5ctx = md5ctx.update(content, true);
        loaded += content.length;
        content = null;
        if (onProgress) onProgress({
          loaded: loaded,
          total: size,
          percent: Math.round(loaded / size * 10000) / 10000
        });
        next(start + md5ChunkSize);
      });
    });
  };

  next(0);
};

function clone(obj) {
  return map(obj, function (v) {
    return _typeof(v) === 'object' && v !== null ? clone(v) : v;
  });
}

function attr(obj, name, defaultValue) {
  return obj && name in obj ? obj[name] : defaultValue;
}

function extend(target, source) {
  each(source, function (val, key) {
    target[key] = source[key];
  });
  return target;
}

function isArray(arr) {
  return arr instanceof Array;
}

function isInArray(arr, item) {
  var flag = false;

  for (var i = 0; i < arr.length; i++) {
    if (item === arr[i]) {
      flag = true;
      break;
    }
  }

  return flag;
}

function makeArray(arr) {
  return isArray(arr) ? arr : [arr];
}

function each(obj, fn) {
  for (var i in obj) {
    if (obj.hasOwnProperty(i)) {
      fn(obj[i], i);
    }
  }
}

function map(obj, fn) {
  var o = isArray(obj) ? [] : {};

  for (var i in obj) {
    if (obj.hasOwnProperty(i)) {
      o[i] = fn(obj[i], i);
    }
  }

  return o;
}

function filter(obj, fn) {
  var iaArr = isArray(obj);
  var o = iaArr ? [] : {};

  for (var i in obj) {
    if (obj.hasOwnProperty(i)) {
      if (fn(obj[i], i)) {
        if (iaArr) {
          o.push(obj[i]);
        } else {
          o[i] = obj[i];
        }
      }
    }
  }

  return o;
}

var binaryBase64 = function binaryBase64(str) {
  var i,
      len,
      char,
      res = '';

  for (i = 0, len = str.length / 2; i < len; i++) {
    char = parseInt(str[i * 2] + str[i * 2 + 1], 16);
    res += String.fromCharCode(char);
  }

  return btoa(res);
};

var uuid = function uuid() {
  var S4 = function S4() {
    return ((1 + Math.random()) * 0x10000 | 0).toString(16).substring(1);
  };

  return S4() + S4() + "-" + S4() + "-" + S4() + "-" + S4() + "-" + S4() + S4() + S4();
};

var hasMissingParams = function hasMissingParams(apiName, params) {
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var Domain = this.options.Domain;
  var checkBucket = !Domain || typeof Domain === 'string' && Domain.indexOf('{Bucket}') > -1;
  var checkRegion = !Domain || typeof Domain === 'string' && Domain.indexOf('{Region}') > -1;

  if (apiName.indexOf('Bucket') > -1 || apiName === 'deleteMultipleObject' || apiName === 'multipartList' || apiName === 'listObjectVersions') {
    if (checkBucket && !Bucket) return 'Bucket';
    if (checkRegion && !Region) return 'Region';
  } else if (apiName.indexOf('Object') > -1 || apiName.indexOf('multipart') > -1 || apiName === 'sliceUploadFile' || apiName === 'abortUploadTask') {
    if (checkBucket && !Bucket) return 'Bucket';
    if (checkRegion && !Region) return 'Region';
    if (!Key) return 'Key';
  }

  return false;
};

var formatParams = function formatParams(apiName, params) {
  // 复制参数对象
  params = extend({}, params); // 统一处理 Headers

  if (apiName !== 'getAuth' && apiName !== 'getV4Auth' && apiName !== 'getObjectUrl') {
    var Headers = params.Headers || {};

    if (params && _typeof(params) === 'object') {
      (function () {
        for (var key in params) {
          if (params.hasOwnProperty(key) && key.indexOf('x-cos-') > -1) {
            Headers[key] = params[key];
          }
        }
      })();

      var headerMap = {
        // params headers
        'x-cos-mfa': 'MFA',
        'Content-MD5': 'ContentMD5',
        'Content-Length': 'ContentLength',
        'Content-Type': 'ContentType',
        'Expect': 'Expect',
        'Expires': 'Expires',
        'Cache-Control': 'CacheControl',
        'Content-Disposition': 'ContentDisposition',
        'Content-Encoding': 'ContentEncoding',
        'Range': 'Range',
        'If-Modified-Since': 'IfModifiedSince',
        'If-Unmodified-Since': 'IfUnmodifiedSince',
        'If-Match': 'IfMatch',
        'If-None-Match': 'IfNoneMatch',
        'x-cos-copy-source': 'CopySource',
        'x-cos-copy-source-Range': 'CopySourceRange',
        'x-cos-metadata-directive': 'MetadataDirective',
        'x-cos-copy-source-If-Modified-Since': 'CopySourceIfModifiedSince',
        'x-cos-copy-source-If-Unmodified-Since': 'CopySourceIfUnmodifiedSince',
        'x-cos-copy-source-If-Match': 'CopySourceIfMatch',
        'x-cos-copy-source-If-None-Match': 'CopySourceIfNoneMatch',
        'x-cos-acl': 'ACL',
        'x-cos-grant-read': 'GrantRead',
        'x-cos-grant-write': 'GrantWrite',
        'x-cos-grant-full-control': 'GrantFullControl',
        'x-cos-grant-read-acp': 'GrantReadAcp',
        'x-cos-grant-write-acp': 'GrantWriteAcp',
        'x-cos-storage-class': 'StorageClass',
        'x-cos-traffic-limit': 'TrafficLimit',
        'x-cos-mime-limit': 'MimeLimit',
        // SSE-C
        'x-cos-server-side-encryption-customer-algorithm': 'SSECustomerAlgorithm',
        'x-cos-server-side-encryption-customer-key': 'SSECustomerKey',
        'x-cos-server-side-encryption-customer-key-MD5': 'SSECustomerKeyMD5',
        // SSE-COS、SSE-KMS
        'x-cos-server-side-encryption': 'ServerSideEncryption',
        'x-cos-server-side-encryption-cos-kms-key-id': 'SSEKMSKeyId',
        'x-cos-server-side-encryption-context': 'SSEContext'
      };
      util.each(headerMap, function (paramKey, headerKey) {
        if (params[paramKey] !== undefined) {
          Headers[headerKey] = params[paramKey];
        }
      });
      params.Headers = clearKey(Headers);
    }
  }

  return params;
};

var apiWrapper = function apiWrapper(apiName, apiFn) {
  return function (params, callback) {
    var self = this; // 处理参数

    if (typeof params === 'function') {
      callback = params;
      params = {};
    } // 整理参数格式


    params = formatParams(apiName, params); // tracker传递

    var tracker;

    if (self.options.EnableTracker) {
      if (params.calledBySdk === 'sliceUploadFile') {
        // 分块上传内部方法使用sliceUploadFile的子链路
        tracker = params.tracker && params.tracker.generateSubTracker({
          apiName: apiName
        });
      } else if (['uploadFile', 'uploadFiles'].includes(apiName)) {
        // uploadFile、uploadFiles方法在内部处理，此处不处理
        tracker = null;
      } else {
        var fileSize = -1;

        if (params.Body) {
          fileSize = typeof params.Body === 'string' ? params.Body.length : params.Body.size || params.Body.byteLength || -1;
        }

        tracker = new Tracker({
          bucket: params.Bucket,
          region: params.Region,
          apiName: apiName,
          fileKey: params.Key,
          fileSize: fileSize,
          deepTracker: self.options.DeepTracker,
          customId: self.options.CustomId,
          delay: self.options.TrackerDelay
        });
      }
    }

    params.tracker = tracker; // 代理回调函数

    var formatResult = function formatResult(result) {
      if (result && result.headers) {
        result.headers['x-cos-request-id'] && (result.RequestId = result.headers['x-cos-request-id']);
        result.headers['x-ci-request-id'] && (result.RequestId = result.headers['x-ci-request-id']);
        result.headers['x-cos-version-id'] && (result.VersionId = result.headers['x-cos-version-id']);
        result.headers['x-cos-delete-marker'] && (result.DeleteMarker = result.headers['x-cos-delete-marker']);
      }

      return result;
    };

    var _callback = function _callback(err, data) {
      // 格式化上报参数并上报
      tracker && tracker.formatResult(err, data);
      callback && callback(formatResult(err), formatResult(data));
    };

    var checkParams = function checkParams() {
      if (apiName !== 'getService' && apiName !== 'abortUploadTask') {
        // 判断参数是否完整
        var missingResult = hasMissingParams.call(self, apiName, params);

        if (missingResult) {
          return 'missing param ' + missingResult;
        } // 判断 region 格式


        if (params.Region) {
          if (self.options.CompatibilityMode) {
            if (!/^([a-z\d-.]+)$/.test(params.Region)) {
              return 'Region format error.';
            }
          } else {
            if (params.Region.indexOf('cos.') > -1) {
              return 'param Region should not be start with "cos."';
            } else if (!/^([a-z\d-]+)$/.test(params.Region)) {
              return 'Region format error.';
            }
          } // 判断 region 格式


          if (!self.options.CompatibilityMode && params.Region.indexOf('-') === -1 && params.Region !== 'yfb' && params.Region !== 'default' && params.Region !== 'accelerate') {
            console.warn('warning: param Region format error, find help here: https://cloud.tencent.com/document/product/436/6224');
          }
        } // 兼容不带 AppId 的 Bucket


        if (params.Bucket) {
          if (!/^([a-z\d-]+)-(\d+)$/.test(params.Bucket)) {
            if (params.AppId) {
              params.Bucket = params.Bucket + '-' + params.AppId;
            } else if (self.options.AppId) {
              params.Bucket = params.Bucket + '-' + self.options.AppId;
            } else {
              return 'Bucket should format as "test-1250000000".';
            }
          }

          if (params.AppId) {
            console.warn('warning: AppId has been deprecated, Please put it at the end of parameter Bucket(E.g Bucket:"test-1250000000" ).');
            delete params.AppId;
          }
        } // 如果 Key 是 / 开头，强制去掉第一个 /


        if (!self.options.UseRawKey && params.Key && params.Key.substr(0, 1) === '/') {
          params.Key = params.Key.substr(1);
        }
      }
    };

    var errMsg = checkParams();
    var isSync = apiName === 'getAuth' || apiName === 'getObjectUrl';

    if (typeof Promise === 'function' && !isSync && !callback) {
      return new Promise(function (resolve, reject) {
        callback = function callback(err, data) {
          err ? reject(err) : resolve(data);
        };

        if (errMsg) return _callback(util.error(new Error(errMsg)));
        apiFn.call(self, params, _callback);
      });
    } else {
      if (errMsg) return _callback(util.error(new Error(errMsg)));
      var res = apiFn.call(self, params, _callback);
      if (isSync) return res;
    }
  };
};

var throttleOnProgress = function throttleOnProgress(total, onProgress) {
  var self = this;
  var size0 = 0;
  var size1 = 0;
  var time0 = Date.now();
  var time1;
  var timer;

  function update() {
    timer = 0;

    if (onProgress && typeof onProgress === 'function') {
      time1 = Date.now();
      var speed = Math.max(0, Math.round((size1 - size0) / ((time1 - time0) / 1000) * 100) / 100) || 0;
      var percent;

      if (size1 === 0 && total === 0) {
        percent = 1;
      } else {
        percent = Math.floor(size1 / total * 100) / 100 || 0;
      }

      time0 = time1;
      size0 = size1;

      try {
        onProgress({
          loaded: size1,
          total: total,
          speed: speed,
          percent: percent
        });
      } catch (e) {}
    }
  }

  return function (info, immediately) {
    if (info) {
      size1 = info.loaded;
      total = info.total;
    }

    if (immediately) {
      clearTimeout(timer);
      update();
    } else {
      if (timer) return;
      timer = setTimeout(update, self.options.ProgressInterval);
    }
  };
};

var getFileSize = function getFileSize(api, params, callback) {
  var size;

  if (typeof params.Body === 'string') {
    params.Body = new Blob([params.Body], {
      type: 'text/plain'
    });
  } else if (params.Body instanceof ArrayBuffer) {
    params.Body = new Blob([params.Body]);
  }

  if (params.Body && (params.Body instanceof Blob || params.Body.toString() === '[object File]' || params.Body.toString() === '[object Blob]')) {
    size = params.Body.size;
  } else {
    callback(util.error(new Error('params body format error, Only allow File|Blob|String.')));
    return;
  }

  params.ContentLength = size;
  callback(null, size);
}; // 获取调正的时间戳


var getSkewTime = function getSkewTime(offset) {
  return Date.now() + (offset || 0);
};

var error = function error(err, opt) {
  var sourceErr = err;
  err.message = err.message || null;

  if (typeof opt === 'string') {
    err.error = opt;
    err.message = opt;
  } else if (_typeof(opt) === 'object' && opt !== null) {
    extend(err, opt);
    if (opt.code || opt.name) err.code = opt.code || opt.name;
    if (opt.message) err.message = opt.message;
    if (opt.stack) err.stack = opt.stack;
  }

  if (typeof Object.defineProperty === 'function') {
    Object.defineProperty(err, 'name', {
      writable: true,
      enumerable: false
    });
    Object.defineProperty(err, 'message', {
      enumerable: true
    });
  }

  err.name = opt && opt.name || err.name || err.code || 'Error';
  if (!err.code) err.code = err.name;
  if (!err.error) err.error = clone(sourceErr); // 兼容老的错误格式

  return err;
};

var isWebWorker = function isWebWorker() {
  // 有限判断 worker 环境的 constructor name 其次用 worker 独有的 FileReaderSync 兜底 详细参考 https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers
  return (typeof globalThis === "undefined" ? "undefined" : _typeof(globalThis)) === 'object' && (globalThis.constructor.name === 'DedicatedWorkerGlobalScope' || globalThis.FileReaderSync);
};

var isNode = function isNode() {
  // 得兜底 web worker 环境中 webpack 用了 process 插件之类的情况
  return (typeof window === "undefined" ? "undefined" : _typeof(window)) !== 'object' && (typeof process === "undefined" ? "undefined" : _typeof(process)) === 'object' && "function" === 'function' && !isWebWorker();
};

var isCIHost = function isCIHost(url) {
  return /^https?:\/\/([^/]+\.)?ci\.[^/]+/.test(url);
};

var util = {
  noop: noop,
  formatParams: formatParams,
  apiWrapper: apiWrapper,
  xml2json: xml2json,
  json2xml: json2xml,
  md5: md5,
  clearKey: clearKey,
  fileSlice: fileSlice,
  getBodyMd5: getBodyMd5,
  getFileMd5: getFileMd5,
  binaryBase64: binaryBase64,
  extend: extend,
  isArray: isArray,
  isInArray: isInArray,
  makeArray: makeArray,
  each: each,
  map: map,
  filter: filter,
  clone: clone,
  attr: attr,
  uuid: uuid,
  camSafeUrlEncode: camSafeUrlEncode,
  throttleOnProgress: throttleOnProgress,
  getFileSize: getFileSize,
  getSkewTime: getSkewTime,
  error: error,
  obj2str: obj2str,
  getAuth: getAuth,
  parseSelectPayload: parseSelectPayload,
  getSourceParams: getSourceParams,
  isBrowser: true,
  isNode: isNode,
  isCIHost: isCIHost
};
module.exports = util;
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../node_modules/process/browser.js */ "./node_modules/process/browser.js")))

/***/ })

/******/ });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29zLWpzLXNkay12NS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL0NPUy93ZWJwYWNrL3VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24iLCJ3ZWJwYWNrOi8vQ09TL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL0NPUy8uL2luZGV4LmpzIiwid2VicGFjazovL0NPUy8uL2xpYi9iZWFjb24ubWluLmpzIiwid2VicGFjazovL0NPUy8uL2xpYi9jcnlwdG8uanMiLCJ3ZWJwYWNrOi8vQ09TLy4vbGliL2pzb24yeG1sLmpzIiwid2VicGFjazovL0NPUy8uL2xpYi9tZDUuanMiLCJ3ZWJwYWNrOi8vQ09TLy4vbGliL3JlcXVlc3QuanMiLCJ3ZWJwYWNrOi8vQ09TLy4vbGliL3htbDJqc29uLmpzIiwid2VicGFjazovL0NPUy8uL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrLmpzIiwid2VicGFjazovL0NPUy8uL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzLmpzIiwid2VicGFjazovL0NPUy8uL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL3R5cGVvZi5qcyIsIndlYnBhY2s6Ly9DT1MvLi9ub2RlX21vZHVsZXMvQHhtbGRvbS94bWxkb20vbGliL2NvbnZlbnRpb25zLmpzIiwid2VicGFjazovL0NPUy8uL25vZGVfbW9kdWxlcy9AeG1sZG9tL3htbGRvbS9saWIvZG9tLXBhcnNlci5qcyIsIndlYnBhY2s6Ly9DT1MvLi9ub2RlX21vZHVsZXMvQHhtbGRvbS94bWxkb20vbGliL2RvbS5qcyIsIndlYnBhY2s6Ly9DT1MvLi9ub2RlX21vZHVsZXMvQHhtbGRvbS94bWxkb20vbGliL2VudGl0aWVzLmpzIiwid2VicGFjazovL0NPUy8uL25vZGVfbW9kdWxlcy9AeG1sZG9tL3htbGRvbS9saWIvaW5kZXguanMiLCJ3ZWJwYWNrOi8vQ09TLy4vbm9kZV9tb2R1bGVzL0B4bWxkb20veG1sZG9tL2xpYi9zYXguanMiLCJ3ZWJwYWNrOi8vQ09TLy4vbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qcyIsIndlYnBhY2s6Ly9DT1MvKHdlYnBhY2spL2J1aWxkaW4vYW1kLW9wdGlvbnMuanMiLCJ3ZWJwYWNrOi8vQ09TLyh3ZWJwYWNrKS9idWlsZGluL2dsb2JhbC5qcyIsIndlYnBhY2s6Ly9DT1MvKHdlYnBhY2spL2J1aWxkaW4vbW9kdWxlLmpzIiwid2VicGFjazovL0NPUy8uL3NyYy9hZHZhbmNlLmpzIiwid2VicGFjazovL0NPUy8uL3NyYy9hc3luYy5qcyIsIndlYnBhY2s6Ly9DT1MvLi9zcmMvYmFzZS5qcyIsIndlYnBhY2s6Ly9DT1MvLi9zcmMvY29zLmpzIiwid2VicGFjazovL0NPUy8uL3NyYy9ldmVudC5qcyIsIndlYnBhY2s6Ly9DT1MvLi9zcmMvc2Vzc2lvbi5qcyIsIndlYnBhY2s6Ly9DT1MvLi9zcmMvdGFzay5qcyIsIndlYnBhY2s6Ly9DT1MvLi9zcmMvdHJhY2tlci5qcyIsIndlYnBhY2s6Ly9DT1MvLi9zcmMvdXRpbC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJDT1NcIl0gPSBmYWN0b3J5KCk7XG5cdGVsc2Vcblx0XHRyb290W1wiQ09TXCJdID0gZmFjdG9yeSgpO1xufSkod2luZG93LCBmdW5jdGlvbigpIHtcbnJldHVybiAiLCIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIi9kaXN0L1wiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gXCIuL2luZGV4LmpzXCIpO1xuIiwidmFyIENPUyA9IHJlcXVpcmUoJy4vc3JjL2NvcycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IENPUzsiLCJ2YXIgX3R5cGVvZiA9IHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL3R5cGVvZlwiKTtcblxuIWZ1bmN0aW9uICh0LCBlKSB7XG4gIFwib2JqZWN0XCIgPT0gKHR5cGVvZiBleHBvcnRzID09PSBcInVuZGVmaW5lZFwiID8gXCJ1bmRlZmluZWRcIiA6IF90eXBlb2YoZXhwb3J0cykpICYmIFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIG1vZHVsZSA/IG1vZHVsZS5leHBvcnRzID0gZSgpIDogXCJmdW5jdGlvblwiID09IHR5cGVvZiBkZWZpbmUgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShlKSA6ICh0ID0gXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgZ2xvYmFsVGhpcyA/IGdsb2JhbFRoaXMgOiB0IHx8IHNlbGYpLkJlYWNvbkFjdGlvbiA9IGUoKTtcbn0odGhpcywgZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX3QgPSBmdW5jdGlvbiB0KGUsIHIpIHtcbiAgICByZXR1cm4gKF90ID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IHtcbiAgICAgIF9fcHJvdG9fXzogW11cbiAgICB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgIHQuX19wcm90b19fID0gZTtcbiAgICB9IHx8IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICBmb3IgKHZhciByIGluIGUpIHtcbiAgICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHIpICYmICh0W3JdID0gZVtyXSk7XG4gICAgICB9XG4gICAgfSkoZSwgcik7XG4gIH07XG5cbiAgdmFyIF9lID0gZnVuY3Rpb24gZSgpIHtcbiAgICByZXR1cm4gKF9lID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodCkge1xuICAgICAgZm9yICh2YXIgZSwgciA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyByIDwgbjsgcisrKSB7XG4gICAgICAgIGZvciAodmFyIG8gaW4gZSA9IGFyZ3VtZW50c1tyXSkge1xuICAgICAgICAgIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCBvKSAmJiAodFtvXSA9IGVbb10pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0O1xuICAgIH0pLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH07XG5cbiAgZnVuY3Rpb24gcih0LCBlLCByLCBuKSB7XG4gICAgcmV0dXJuIG5ldyAociB8fCAociA9IFByb21pc2UpKShmdW5jdGlvbiAobywgaSkge1xuICAgICAgZnVuY3Rpb24gYSh0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYyhuLm5leHQodCkpO1xuICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgaSh0KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBzKHQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjKG4udGhyb3codCkpO1xuICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgaSh0KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBjKHQpIHtcbiAgICAgICAgdmFyIGU7XG4gICAgICAgIHQuZG9uZSA/IG8odC52YWx1ZSkgOiAoZSA9IHQudmFsdWUsIGUgaW5zdGFuY2VvZiByID8gZSA6IG5ldyByKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgdChlKTtcbiAgICAgICAgfSkpLnRoZW4oYSwgcyk7XG4gICAgICB9XG5cbiAgICAgIGMoKG4gPSBuLmFwcGx5KHQsIGUgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gbih0LCBlKSB7XG4gICAgdmFyIHIsXG4gICAgICAgIG4sXG4gICAgICAgIG8sXG4gICAgICAgIGksXG4gICAgICAgIGEgPSB7XG4gICAgICBsYWJlbDogMCxcbiAgICAgIHNlbnQ6IGZ1bmN0aW9uIHNlbnQoKSB7XG4gICAgICAgIGlmICgxICYgb1swXSkgdGhyb3cgb1sxXTtcbiAgICAgICAgcmV0dXJuIG9bMV07XG4gICAgICB9LFxuICAgICAgdHJ5czogW10sXG4gICAgICBvcHM6IFtdXG4gICAgfTtcbiAgICByZXR1cm4gaSA9IHtcbiAgICAgIG5leHQ6IHMoMCksXG4gICAgICB0aHJvdzogcygxKSxcbiAgICAgIHJldHVybjogcygyKVxuICAgIH0sIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgU3ltYm9sICYmIChpW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9KSwgaTtcblxuICAgIGZ1bmN0aW9uIHMoaSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoaSkge1xuICAgICAgICAgIGlmIChyKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcblxuICAgICAgICAgIGZvciAoOyBhOykge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgaWYgKHIgPSAxLCBuICYmIChvID0gMiAmIGlbMF0gPyBuLnJldHVybiA6IGlbMF0gPyBuLnRocm93IHx8ICgobyA9IG4ucmV0dXJuKSAmJiBvLmNhbGwobiksIDApIDogbi5uZXh0KSAmJiAhKG8gPSBvLmNhbGwobiwgaVsxXSkpLmRvbmUpIHJldHVybiBvO1xuXG4gICAgICAgICAgICAgIHN3aXRjaCAobiA9IDAsIG8gJiYgKGkgPSBbMiAmIGlbMF0sIG8udmFsdWVdKSwgaVswXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICBvID0gaTtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGEubGFiZWwrKywge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogaVsxXSxcbiAgICAgICAgICAgICAgICAgICAgZG9uZTogITFcbiAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICBhLmxhYmVsKyssIG4gPSBpWzFdLCBpID0gWzBdO1xuICAgICAgICAgICAgICAgICAgY29udGludWU7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICAgICAgICBpID0gYS5vcHMucG9wKCksIGEudHJ5cy5wb3AoKTtcbiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgIGlmICghKG8gPSBhLnRyeXMsIChvID0gby5sZW5ndGggPiAwICYmIG9bby5sZW5ndGggLSAxXSkgfHwgNiAhPT0gaVswXSAmJiAyICE9PSBpWzBdKSkge1xuICAgICAgICAgICAgICAgICAgICBhID0gMDtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIGlmICgzID09PSBpWzBdICYmICghbyB8fCBpWzFdID4gb1swXSAmJiBpWzFdIDwgb1szXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgYS5sYWJlbCA9IGlbMV07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICBpZiAoNiA9PT0gaVswXSAmJiBhLmxhYmVsIDwgb1sxXSkge1xuICAgICAgICAgICAgICAgICAgICBhLmxhYmVsID0gb1sxXSwgbyA9IGk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICBpZiAobyAmJiBhLmxhYmVsIDwgb1syXSkge1xuICAgICAgICAgICAgICAgICAgICBhLmxhYmVsID0gb1syXSwgYS5vcHMucHVzaChpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIG9bMl0gJiYgYS5vcHMucG9wKCksIGEudHJ5cy5wb3AoKTtcbiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaSA9IGUuY2FsbCh0LCBhKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgICAgaSA9IFs2LCB0XSwgbiA9IDA7XG4gICAgICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgICAgICByID0gbyA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKDUgJiBpWzBdKSB0aHJvdyBpWzFdO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2YWx1ZTogaVswXSA/IGlbMV0gOiB2b2lkIDAsXG4gICAgICAgICAgICBkb25lOiAhMFxuICAgICAgICAgIH07XG4gICAgICAgIH0oW2ksIHNdKTtcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgdmFyIG8gPSBcIl9fQkVBQ09OX1wiLFxuICAgICAgaSA9IFwiX19CRUFDT05fZGV2aWNlSWRcIixcbiAgICAgIGEgPSBcImxhc3RfcmVwb3J0X3RpbWVcIixcbiAgICAgIHMgPSBcInNlbmRpbmdfZXZlbnRfaWRzXCIsXG4gICAgICBjID0gXCJiZWFjb25fY29uZmlnXCIsXG4gICAgICB1ID0gXCJiZWFjb25fY29uZmlnX3JlcXVlc3RfdGltZVwiLFxuICAgICAgbCA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiB0KCkge1xuICAgICAgdmFyIHQgPSB0aGlzO1xuICAgICAgdGhpcy5lbWl0ID0gZnVuY3Rpb24gKGUsIHIpIHtcbiAgICAgICAgaWYgKHQpIHtcbiAgICAgICAgICB2YXIgbixcbiAgICAgICAgICAgICAgbyA9IHQuX19FdmVudHNMaXN0W2VdO1xuXG4gICAgICAgICAgaWYgKG51bGwgPT0gbyA/IHZvaWQgMCA6IG8ubGVuZ3RoKSB7XG4gICAgICAgICAgICBvID0gby5zbGljZSgpO1xuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG8ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgbiA9IG9baV07XG5cbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB2YXIgYSA9IG4uY2FsbGJhY2suYXBwbHkodCwgW3JdKTtcbiAgICAgICAgICAgICAgICBpZiAoMSA9PT0gbi50eXBlICYmIHQucmVtb3ZlKGUsIG4uY2FsbGJhY2spLCAhMSA9PT0gYSkgYnJlYWs7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyB0O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgIH1cbiAgICAgIH0sIHRoaXMuX19FdmVudHNMaXN0ID0ge307XG4gICAgfVxuXG4gICAgcmV0dXJuIHQucHJvdG90eXBlLmluZGV4T2YgPSBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgZm9yICh2YXIgciA9IDA7IHIgPCB0Lmxlbmd0aDsgcisrKSB7XG4gICAgICAgIGlmICh0W3JdLmNhbGxiYWNrID09PSBlKSByZXR1cm4gcjtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIC0xO1xuICAgIH0sIHQucHJvdG90eXBlLm9uID0gZnVuY3Rpb24gKHQsIGUsIHIpIHtcbiAgICAgIGlmICh2b2lkIDAgPT09IHIgJiYgKHIgPSAwKSwgdGhpcykge1xuICAgICAgICB2YXIgbiA9IHRoaXMuX19FdmVudHNMaXN0W3RdO1xuXG4gICAgICAgIGlmIChuIHx8IChuID0gdGhpcy5fX0V2ZW50c0xpc3RbdF0gPSBbXSksIC0xID09PSB0aGlzLmluZGV4T2YobiwgZSkpIHtcbiAgICAgICAgICB2YXIgbyA9IHtcbiAgICAgICAgICAgIG5hbWU6IHQsXG4gICAgICAgICAgICB0eXBlOiByIHx8IDAsXG4gICAgICAgICAgICBjYWxsYmFjazogZVxuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIG4ucHVzaChvKSwgdGhpcztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuICAgIH0sIHQucHJvdG90eXBlLm9uZSA9IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICB0aGlzLm9uKHQsIGUsIDEpO1xuICAgIH0sIHQucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICBpZiAodGhpcykge1xuICAgICAgICB2YXIgciA9IHRoaXMuX19FdmVudHNMaXN0W3RdO1xuICAgICAgICBpZiAoIXIpIHJldHVybiBudWxsO1xuXG4gICAgICAgIGlmICghZSkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fX0V2ZW50c0xpc3RbdF07XG4gICAgICAgICAgfSBjYXRjaCAodCkge31cblxuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHIubGVuZ3RoKSB7XG4gICAgICAgICAgdmFyIG4gPSB0aGlzLmluZGV4T2YociwgZSk7XG4gICAgICAgICAgci5zcGxpY2UobiwgMSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICB9LCB0O1xuICB9KCk7XG5cbiAgZnVuY3Rpb24gaCh0LCBlKSB7XG4gICAgZm9yICh2YXIgciA9IHt9LCBuID0gMCwgbyA9IE9iamVjdC5rZXlzKHQpOyBuIDwgby5sZW5ndGg7IG4rKykge1xuICAgICAgdmFyIGkgPSBvW25dLFxuICAgICAgICAgIGEgPSB0W2ldO1xuICAgICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIGEpIHJbZihpKV0gPSBmKGEpO2Vsc2Uge1xuICAgICAgICBpZiAoZSkgdGhyb3cgbmV3IEVycm9yKFwidmFsdWUgbWFzdCBiZSBzdHJpbmcgICEhISFcIik7XG4gICAgICAgIHJbZihTdHJpbmcoaSkpXSA9IGYoU3RyaW5nKGEpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcjtcbiAgfVxuXG4gIGZ1bmN0aW9uIGYodCkge1xuICAgIGlmIChcInN0cmluZ1wiICE9IHR5cGVvZiB0KSByZXR1cm4gdDtcblxuICAgIHRyeSB7XG4gICAgICByZXR1cm4gdC5yZXBsYWNlKG5ldyBSZWdFeHAoXCJcXFxcfFwiLCBcImdcIiksIFwiJTdDXCIpLnJlcGxhY2UobmV3IFJlZ0V4cChcIlxcXFwmXCIsIFwiZ1wiKSwgXCIlMjZcIikucmVwbGFjZShuZXcgUmVnRXhwKFwiXFxcXD1cIiwgXCJnXCIpLCBcIiUzRFwiKS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJcXFxcK1wiLCBcImdcIiksIFwiJTJCXCIpO1xuICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHAodCkge1xuICAgIHJldHVybiBTdHJpbmcodC5BOTkpICsgU3RyaW5nKHQuQTEwMCk7XG4gIH1cblxuICB2YXIgZCA9IGZ1bmN0aW9uIGQoKSB7fTtcblxuICB2YXIgdiA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiB0KHQpIHtcbiAgICAgIHZhciByID0gdGhpcztcbiAgICAgIHRoaXMubGlmZUN5Y2xlID0gbmV3IGwoKSwgdGhpcy51cGxvYWRKb2JRdWV1ZSA9IFtdLCB0aGlzLmFkZGl0aW9uYWxQYXJhbXMgPSB7fSwgdGhpcy5kZWxheVRpbWUgPSAwLCB0aGlzLl9ub3JtYWxMb2dQaXBlbGluZSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIGlmICghdCB8fCAhdC5yZWR1Y2UgfHwgIXQubGVuZ3RoKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiY3JlYXRlUGlwZWxpbmUg5pa55rOV6ZyA6KaB5Lyg5YWl6Iez5bCR5pyJ5LiA5LiqIHBpcGUg55qE5pWw57uEXCIpO1xuICAgICAgICByZXR1cm4gMSA9PT0gdC5sZW5ndGggPyBmdW5jdGlvbiAoZSwgcikge1xuICAgICAgICAgIHRbMF0oZSwgciB8fCBkKTtcbiAgICAgICAgfSA6IHQucmVkdWNlKGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyLCBuKSB7XG4gICAgICAgICAgICByZXR1cm4gdm9pZCAwID09PSBuICYmIChuID0gZCksIHQociwgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIG51bGwgPT0gZSA/IHZvaWQgMCA6IGUodCwgbik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgIH0oW2Z1bmN0aW9uICh0KSB7XG4gICAgICAgIHIuc2VuZCh7XG4gICAgICAgICAgdXJsOiByLnN0cmF0ZWd5LmdldFVwbG9hZFVybCgpLFxuICAgICAgICAgIGRhdGE6IHQsXG4gICAgICAgICAgbWV0aG9kOiBcInBvc3RcIixcbiAgICAgICAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9VVRGLThcIlxuICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIGUgPSByLmNvbmZpZy5vblJlcG9ydFN1Y2Nlc3M7XG4gICAgICAgICAgXCJmdW5jdGlvblwiID09IHR5cGVvZiBlICYmIGUoSlNPTi5zdHJpbmdpZnkodC5ldmVudHMpKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciBlID0gci5jb25maWcub25SZXBvcnRGYWlsO1xuICAgICAgICAgIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgZSAmJiBlKEpTT04uc3RyaW5naWZ5KHQuZXZlbnRzKSk7XG4gICAgICAgIH0pO1xuICAgICAgfV0pLCBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgICBpZiAoIXQpIHRocm93IGUgaW5zdGFuY2VvZiBFcnJvciA/IGUgOiBuZXcgRXJyb3IoZSk7XG4gICAgICB9KEJvb2xlYW4odC5hcHBrZXkpLCBcImFwcGtleSBtdXN0IGJlIGluaXRpYWxcIiksIHRoaXMuY29uZmlnID0gX2Uoe30sIHQpO1xuICAgIH1cblxuICAgIHJldHVybiB0LnByb3RvdHlwZS5vblVzZXJBY3Rpb24gPSBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgdGhpcy5wcmVSZXBvcnQodCwgZSwgITEpO1xuICAgIH0sIHQucHJvdG90eXBlLm9uRGlyZWN0VXNlckFjdGlvbiA9IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICB0aGlzLnByZVJlcG9ydCh0LCBlLCAhMCk7XG4gICAgfSwgdC5wcm90b3R5cGUucHJlUmVwb3J0ID0gZnVuY3Rpb24gKHQsIGUsIHIpIHtcbiAgICAgIHQgPyB0aGlzLnN0cmF0ZWd5LmlzRXZlbnRVcE9uT2ZmKCkgJiYgKHRoaXMuc3RyYXRlZ3kuaXNCbGFja0V2ZW50KHQpIHx8IHRoaXMuc3RyYXRlZ3kuaXNTYW1wbGVFdmVudCh0KSB8fCB0aGlzLm9uUmVwb3J0KHQsIGUsIHIpKSA6IHRoaXMuZXJyb3JSZXBvcnQucmVwb3J0RXJyb3IoXCI2MDJcIiwgXCIgbm8gZXZlbnRDb2RlXCIpO1xuICAgIH0sIHQucHJvdG90eXBlLmFkZEFkZGl0aW9uYWxQYXJhbXMgPSBmdW5jdGlvbiAodCkge1xuICAgICAgZm9yICh2YXIgZSA9IDAsIHIgPSBPYmplY3Qua2V5cyh0KTsgZSA8IHIubGVuZ3RoOyBlKyspIHtcbiAgICAgICAgdmFyIG4gPSByW2VdO1xuICAgICAgICB0aGlzLmFkZGl0aW9uYWxQYXJhbXNbbl0gPSB0W25dO1xuICAgICAgfVxuICAgIH0sIHQucHJvdG90eXBlLnNldENoYW5uZWxJZCA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICB0aGlzLmNvbW1vbkluZm8uY2hhbm5lbElEID0gU3RyaW5nKHQpO1xuICAgIH0sIHQucHJvdG90eXBlLnNldE9wZW5JZCA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICB0aGlzLmNvbW1vbkluZm8ub3BlbmlkID0gU3RyaW5nKHQpO1xuICAgIH0sIHQucHJvdG90eXBlLnNldFVuaW9uaWQgPSBmdW5jdGlvbiAodCkge1xuICAgICAgdGhpcy5jb21tb25JbmZvLnVuaWQgPSBTdHJpbmcodCk7XG4gICAgfSwgdC5wcm90b3R5cGUuZ2V0RGV2aWNlSWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb21tb25JbmZvLmRldmljZUlkO1xuICAgIH0sIHQucHJvdG90eXBlLmdldENvbW1vbkluZm8gPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb21tb25JbmZvO1xuICAgIH0sIHQucHJvdG90eXBlLnJlbW92ZVNlbmRpbmdJZCA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICB0cnkge1xuICAgICAgICB2YXIgZSA9IEpTT04ucGFyc2UodGhpcy5zdG9yYWdlLmdldEl0ZW0ocykpLFxuICAgICAgICAgICAgciA9IGUuaW5kZXhPZih0KTtcbiAgICAgICAgLTEgIT0gciAmJiAoZS5zcGxpY2UociwgMSksIHRoaXMuc3RvcmFnZS5zZXRJdGVtKHMsIEpTT04uc3RyaW5naWZ5KGUpKSk7XG4gICAgICB9IGNhdGNoICh0KSB7fVxuICAgIH0sIHQ7XG4gIH0oKSxcbiAgICAgIHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gdCh0LCBlLCByLCBuKSB7XG4gICAgICB0aGlzLnJlcXVlc3RQYXJhbXMgPSB7fSwgdGhpcy5uZXR3b3JrID0gbiwgdGhpcy5yZXF1ZXN0UGFyYW1zLmF0dGFpZCA9IFwiMDA0MDAwMTQxNDRcIiwgdGhpcy5yZXF1ZXN0UGFyYW1zLnRva2VuID0gXCI2NDc4MTU5OTM3XCIsIHRoaXMucmVxdWVzdFBhcmFtcy5wcm9kdWN0X2lkID0gdC5hcHBrZXksIHRoaXMucmVxdWVzdFBhcmFtcy5wbGF0Zm9ybSA9IHIsIHRoaXMucmVxdWVzdFBhcmFtcy51aW4gPSBlLmRldmljZUlkLCB0aGlzLnJlcXVlc3RQYXJhbXMubW9kZWwgPSBcIlwiLCB0aGlzLnJlcXVlc3RQYXJhbXMub3MgPSByLCB0aGlzLnJlcXVlc3RQYXJhbXMuYXBwX3ZlcnNpb24gPSB0LmFwcFZlcnNpb24sIHRoaXMucmVxdWVzdFBhcmFtcy5zZGtfdmVyc2lvbiA9IGUuc2RrVmVyc2lvbiwgdGhpcy5yZXF1ZXN0UGFyYW1zLmVycm9yX3N0YWNrID0gXCJcIiwgdGhpcy51cGxvYWRVcmwgPSB0LmlzT3ZlcnNlYSA/IFwiaHR0cHM6Ly9odHJhY2Uud2V0dmluZm8uY29tL2t2XCIgOiBcImh0dHBzOi8vaC50cmFjZS5xcS5jb20va3ZcIjtcbiAgICB9XG5cbiAgICByZXR1cm4gdC5wcm90b3R5cGUucmVwb3J0RXJyb3IgPSBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgdGhpcy5yZXF1ZXN0UGFyYW1zLl9kYyA9IE1hdGgucmFuZG9tKCksIHRoaXMucmVxdWVzdFBhcmFtcy5lcnJvcl9tc2cgPSBlLCB0aGlzLnJlcXVlc3RQYXJhbXMuZXJyb3JfY29kZSA9IHQsIHRoaXMubmV0d29yay5nZXQodGhpcy51cGxvYWRVcmwsIHtcbiAgICAgICAgcGFyYW1zOiB0aGlzLnJlcXVlc3RQYXJhbXNcbiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICh0KSB7fSk7XG4gICAgfSwgdDtcbiAgfSgpLFxuICAgICAgZyA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiB0KHQsIGUsIHIsIG4pIHtcbiAgICAgIHRoaXMuc3RyYXRlZ3kgPSB7XG4gICAgICAgIGlzRXZlbnRVcE9uT2ZmOiAhMCxcbiAgICAgICAgaHR0cHNVcGxvYWRVcmw6IFwiaHR0cHM6Ly9vdGhldmUuYmVhY29uLnFxLmNvbS9hbmFseXRpY3MvdjJfdXBsb2FkXCIsXG4gICAgICAgIHJlcXVlc3RJbnRlcnZhbDogMzAsXG4gICAgICAgIGJsYWNrbGlzdDogW10sXG4gICAgICAgIHNhbXBsZWxpc3Q6IFtdXG4gICAgICB9LCB0aGlzLnJlYWxTYW1wbGUgPSB7fSwgdGhpcy5hcHBrZXkgPSBcIlwiLCB0aGlzLmFwcGtleSA9IHQuYXBwa2V5LCB0aGlzLnN0b3JhZ2UgPSByO1xuXG4gICAgICB0cnkge1xuICAgICAgICB2YXIgbyA9IEpTT04ucGFyc2UodGhpcy5zdG9yYWdlLmdldEl0ZW0oYykpO1xuICAgICAgICBvICYmIHRoaXMucHJvY2Vzc0RhdGEobyk7XG4gICAgICB9IGNhdGNoICh0KSB7fVxuXG4gICAgICB0LmlzT3ZlcnNlYSAmJiAodGhpcy5zdHJhdGVneS5odHRwc1VwbG9hZFVybCA9IFwiaHR0cHM6Ly9zdmliZWFjb24ub25lemFwcC5jb20vYW5hbHl0aWNzL3YyX3VwbG9hZFwiKSwgIXQuaXNPdmVyc2VhICYmIHRoaXMubmVlZFJlcXVlc3RDb25maWcoKSAmJiB0aGlzLnJlcXVlc3RDb25maWcodC5hcHBWZXJzaW9uLCBlLCBuKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdC5wcm90b3R5cGUucmVxdWVzdENvbmZpZyA9IGZ1bmN0aW9uICh0LCBlLCByKSB7XG4gICAgICB2YXIgbiA9IHRoaXM7XG4gICAgICB0aGlzLnN0b3JhZ2Uuc2V0SXRlbSh1LCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpLCByLnBvc3QoXCJodHRwczovL290aC5zdHIuYmVhY29uLnFxLmNvbS90cnBjLmJlYWNvbi5jb25maWdzZXJ2ZXIuQmVhY29uQ29uZmlnU2VydmljZS9RdWVyeUNvbmZpZ1wiLCB7XG4gICAgICAgIHBsYXRmb3JtSWQ6IFwidW5kZWZpbmVkXCIgPT0gdHlwZW9mIHd4ID8gXCIzXCIgOiBcIjRcIixcbiAgICAgICAgbWFpbkFwcEtleTogdGhpcy5hcHBrZXksXG4gICAgICAgIGFwcFZlcnNpb246IHQsXG4gICAgICAgIHNka1ZlcnNpb246IGUuc2RrVmVyc2lvbixcbiAgICAgICAgb3NWZXJzaW9uOiBlLnVzZXJBZ2VudCxcbiAgICAgICAgbW9kZWw6IFwiXCIsXG4gICAgICAgIHBhY2thZ2VOYW1lOiBcIlwiLFxuICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICBBMzogZS5kZXZpY2VJZFxuICAgICAgICB9XG4gICAgICB9KS50aGVuKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIGlmICgwID09IHQuZGF0YS5yZXQpIHRyeSB7XG4gICAgICAgICAgdmFyIGUgPSBKU09OLnBhcnNlKHQuZGF0YS5iZWFjb25Db25maWcpO1xuICAgICAgICAgIGUgJiYgKG4ucHJvY2Vzc0RhdGEoZSksIG4uc3RvcmFnZS5zZXRJdGVtKGMsIHQuZGF0YS5iZWFjb25Db25maWcpKTtcbiAgICAgICAgfSBjYXRjaCAodCkge30gZWxzZSBuLnByb2Nlc3NEYXRhKG51bGwpLCBuLnN0b3JhZ2Uuc2V0SXRlbShjLCBcIlwiKTtcbiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICh0KSB7fSk7XG4gICAgfSwgdC5wcm90b3R5cGUucHJvY2Vzc0RhdGEgPSBmdW5jdGlvbiAodCkge1xuICAgICAgdmFyIGUsIHIsIG4sIG8sIGk7XG4gICAgICB0aGlzLnN0cmF0ZWd5LmlzRXZlbnRVcE9uT2ZmID0gbnVsbCAhPT0gKGUgPSBudWxsID09IHQgPyB2b2lkIDAgOiB0LmlzRXZlbnRVcE9uT2ZmKSAmJiB2b2lkIDAgIT09IGUgPyBlIDogdGhpcy5zdHJhdGVneS5pc0V2ZW50VXBPbk9mZiwgdGhpcy5zdHJhdGVneS5odHRwc1VwbG9hZFVybCA9IG51bGwgIT09IChyID0gbnVsbCA9PSB0ID8gdm9pZCAwIDogdC5odHRwc1VwbG9hZFVybCkgJiYgdm9pZCAwICE9PSByID8gciA6IHRoaXMuc3RyYXRlZ3kuaHR0cHNVcGxvYWRVcmwsIHRoaXMuc3RyYXRlZ3kucmVxdWVzdEludGVydmFsID0gbnVsbCAhPT0gKG4gPSBudWxsID09IHQgPyB2b2lkIDAgOiB0LnJlcXVlc3RJbnRlcnZhbCkgJiYgdm9pZCAwICE9PSBuID8gbiA6IHRoaXMuc3RyYXRlZ3kucmVxdWVzdEludGVydmFsLCB0aGlzLnN0cmF0ZWd5LmJsYWNrbGlzdCA9IG51bGwgIT09IChvID0gbnVsbCA9PSB0ID8gdm9pZCAwIDogdC5ibGFja2xpc3QpICYmIHZvaWQgMCAhPT0gbyA/IG8gOiB0aGlzLnN0cmF0ZWd5LmJsYWNrbGlzdCwgdGhpcy5zdHJhdGVneS5zYW1wbGVsaXN0ID0gbnVsbCAhPT0gKGkgPSBudWxsID09IHQgPyB2b2lkIDAgOiB0LnNhbXBsZWxpc3QpICYmIHZvaWQgMCAhPT0gaSA/IGkgOiB0aGlzLnN0cmF0ZWd5LnNhbXBsZWxpc3Q7XG5cbiAgICAgIGZvciAodmFyIGEgPSAwLCBzID0gdGhpcy5zdHJhdGVneS5zYW1wbGVsaXN0OyBhIDwgcy5sZW5ndGg7IGErKykge1xuICAgICAgICB2YXIgYyA9IHNbYV0uc3BsaXQoXCIsXCIpO1xuICAgICAgICAyID09IGMubGVuZ3RoICYmICh0aGlzLnJlYWxTYW1wbGVbY1swXV0gPSBjWzFdKTtcbiAgICAgIH1cbiAgICB9LCB0LnByb3RvdHlwZS5uZWVkUmVxdWVzdENvbmZpZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciB0ID0gTnVtYmVyKHRoaXMuc3RvcmFnZS5nZXRJdGVtKHUpKTtcbiAgICAgIHJldHVybiBEYXRlLm5vdygpIC0gdCA+IDYwICogdGhpcy5zdHJhdGVneS5yZXF1ZXN0SW50ZXJ2YWwgKiAxZTM7XG4gICAgfSwgdC5wcm90b3R5cGUuZ2V0VXBsb2FkVXJsID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuc3RyYXRlZ3kuaHR0cHNVcGxvYWRVcmwgKyBcIj9hcHBrZXk9XCIgKyB0aGlzLmFwcGtleTtcbiAgICB9LCB0LnByb3RvdHlwZS5pc0JsYWNrRXZlbnQgPSBmdW5jdGlvbiAodCkge1xuICAgICAgcmV0dXJuIC0xICE9IHRoaXMuc3RyYXRlZ3kuYmxhY2tsaXN0LmluZGV4T2YodCk7XG4gICAgfSwgdC5wcm90b3R5cGUuaXNFdmVudFVwT25PZmYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5zdHJhdGVneS5pc0V2ZW50VXBPbk9mZjtcbiAgICB9LCB0LnByb3RvdHlwZS5pc1NhbXBsZUV2ZW50ID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHJldHVybiAhIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLnJlYWxTYW1wbGUsIHQpICYmIHRoaXMucmVhbFNhbXBsZVt0XSA8IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIE1hdGguZmxvb3IoMWU0KSk7XG4gICAgfSwgdDtcbiAgfSgpLFxuICAgICAgbSA9IFwic2Vzc2lvbl9zdG9yYWdlX2tleVwiLFxuICAgICAgdyA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiB0KHQsIGUsIHIpIHtcbiAgICAgIHRoaXMuYmVhY29uID0gciwgdGhpcy5zdG9yYWdlID0gdCwgdGhpcy5kdXJhdGlvbiA9IGUsIHRoaXMuYXBwa2V5ID0gci5jb25maWcuYXBwa2V5O1xuICAgIH1cblxuICAgIHJldHVybiB0LnByb3RvdHlwZS5nZXRTZXNzaW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHQgPSB0aGlzLnN0b3JhZ2UuZ2V0SXRlbShtKTtcbiAgICAgIGlmICghdCkgcmV0dXJuIHRoaXMuY3JlYXRlU2Vzc2lvbigpO1xuICAgICAgdmFyIGUgPSBcIlwiLFxuICAgICAgICAgIHIgPSAwO1xuXG4gICAgICB0cnkge1xuICAgICAgICB2YXIgbiA9IEpTT04ucGFyc2UodCkgfHwge1xuICAgICAgICAgIHNlc3Npb25JZDogdm9pZCAwLFxuICAgICAgICAgIHNlc3Npb25TdGFydDogdm9pZCAwXG4gICAgICAgIH07XG4gICAgICAgIGlmICghbi5zZXNzaW9uSWQgfHwgIW4uc2Vzc2lvblN0YXJ0KSByZXR1cm4gdGhpcy5jcmVhdGVTZXNzaW9uKCk7XG4gICAgICAgIHZhciBvID0gTnVtYmVyKHRoaXMuc3RvcmFnZS5nZXRJdGVtKGEpKTtcbiAgICAgICAgaWYgKERhdGUubm93KCkgLSBvID4gdGhpcy5kdXJhdGlvbikgcmV0dXJuIHRoaXMuY3JlYXRlU2Vzc2lvbigpO1xuICAgICAgICBlID0gbi5zZXNzaW9uSWQsIHIgPSBuLnNlc3Npb25TdGFydDtcbiAgICAgIH0gY2F0Y2ggKHQpIHt9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNlc3Npb25JZDogZSxcbiAgICAgICAgc2Vzc2lvblN0YXJ0OiByXG4gICAgICB9O1xuICAgIH0sIHQucHJvdG90eXBlLmNyZWF0ZVNlc3Npb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgdCA9IERhdGUubm93KCksXG4gICAgICAgICAgZSA9IHtcbiAgICAgICAgc2Vzc2lvbklkOiB0aGlzLmFwcGtleSArIFwiX1wiICsgdC50b1N0cmluZygpLFxuICAgICAgICBzZXNzaW9uU3RhcnQ6IHRcbiAgICAgIH07XG4gICAgICB0aGlzLnN0b3JhZ2Uuc2V0SXRlbShtLCBKU09OLnN0cmluZ2lmeShlKSksIHRoaXMuc3RvcmFnZS5zZXRJdGVtKGEsIHQudG9TdHJpbmcoKSk7XG4gICAgICB2YXIgciA9IFwiaXNfbmV3X3VzZXJcIixcbiAgICAgICAgICBuID0gdGhpcy5zdG9yYWdlLmdldEl0ZW0ocik7XG4gICAgICByZXR1cm4gdGhpcy5iZWFjb24ub25EaXJlY3RVc2VyQWN0aW9uKFwicnFkX2FwcGxhdW5jaGVkXCIsIHtcbiAgICAgICAgQTIxOiBuID8gXCJOXCIgOiBcIllcIlxuICAgICAgfSksIHRoaXMuc3RvcmFnZS5zZXRJdGVtKHIsIEpTT04uc3RyaW5naWZ5KCExKSksIGU7XG4gICAgfSwgdDtcbiAgfSgpO1xuXG4gIGZ1bmN0aW9uIGIoKSB7XG4gICAgdmFyIHQgPSBuYXZpZ2F0b3IudXNlckFnZW50LFxuICAgICAgICBlID0gdC5pbmRleE9mKFwiY29tcGF0aWJsZVwiKSA+IC0xICYmIHQuaW5kZXhPZihcIk1TSUVcIikgPiAtMSxcbiAgICAgICAgciA9IHQuaW5kZXhPZihcIkVkZ2VcIikgPiAtMSAmJiAhZSxcbiAgICAgICAgbiA9IHQuaW5kZXhPZihcIlRyaWRlbnRcIikgPiAtMSAmJiB0LmluZGV4T2YoXCJydjoxMS4wXCIpID4gLTE7XG5cbiAgICBpZiAoZSkge1xuICAgICAgbmV3IFJlZ0V4cChcIk1TSUUgKFxcXFxkK1xcXFwuXFxcXGQrKTtcIikudGVzdCh0KTtcbiAgICAgIHZhciBvID0gcGFyc2VGbG9hdChSZWdFeHAuJDEpO1xuICAgICAgcmV0dXJuIDcgPT0gbyA/IDcgOiA4ID09IG8gPyA4IDogOSA9PSBvID8gOSA6IDEwID09IG8gPyAxMCA6IDY7XG4gICAgfVxuXG4gICAgcmV0dXJuIHIgPyAtMiA6IG4gPyAxMSA6IC0xO1xuICB9XG5cbiAgdmFyIF9TID0gZnVuY3Rpb24gUygpIHtcbiAgICByZXR1cm4gKF9TID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodCkge1xuICAgICAgZm9yICh2YXIgZSwgciA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyByIDwgbjsgcisrKSB7XG4gICAgICAgIGZvciAodmFyIG8gaW4gZSA9IGFyZ3VtZW50c1tyXSkge1xuICAgICAgICAgIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCBvKSAmJiAodFtvXSA9IGVbb10pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0O1xuICAgIH0pLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH07XG5cbiAgdmFyIEUsXG4gICAgICBJID0gZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIHQodCwgZSkge1xuICAgICAgdm9pZCAwID09PSBlICYmIChlID0ge30pLCB0aGlzLnJlcG9ydE9wdGlvbnMgPSB7fSwgdGhpcy5jb25maWcgPSB0LCB0aGlzLnJlcG9ydE9wdGlvbnMgPSBlO1xuICAgIH1cblxuICAgIHJldHVybiB0LmNhblVzZURCID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuICEhKG51bGwgPT09IHdpbmRvdyB8fCB2b2lkIDAgPT09IHdpbmRvdyA/IHZvaWQgMCA6IHdpbmRvdy5pbmRleGVkREIpO1xuICAgIH0sIHQucHJvdG90eXBlLm9wZW5EQiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBlID0gdGhpcztcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAociwgbikge1xuICAgICAgICBpZiAoIXQuY2FuVXNlREIoKSkgcmV0dXJuIG4oe1xuICAgICAgICAgIG1lc3NhZ2U6IFwi5b2T5YmN5LiN5pSv5oyBIGluZGV4ZWRkYlwiXG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgbyA9IGUuY29uZmlnLFxuICAgICAgICAgICAgaSA9IG8ubmFtZSxcbiAgICAgICAgICAgIGEgPSBvLnZlcnNpb24sXG4gICAgICAgICAgICBzID0gby5zdG9yZXMsXG4gICAgICAgICAgICBjID0gaW5kZXhlZERCLm9wZW4oaSwgYSk7XG4gICAgICAgIGMub25zdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGUuZGIgPSBjLnJlc3VsdCwgcigpLCBfUyh7XG4gICAgICAgICAgICByZXN1bHQ6IDEsXG4gICAgICAgICAgICBmdW5jOiBcIm9wZW5cIixcbiAgICAgICAgICAgIHBhcmFtczogSlNPTi5zdHJpbmdpZnkoZS5jb25maWcpXG4gICAgICAgICAgfSwgZS5yZXBvcnRPcHRpb25zKTtcbiAgICAgICAgfSwgYy5vbmVycm9yID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICB2YXIgciwgbztcbiAgICAgICAgICBuKHQpLCBfUyh7XG4gICAgICAgICAgICByZXN1bHQ6IDAsXG4gICAgICAgICAgICBmdW5jOiBcIm9wZW5cIixcbiAgICAgICAgICAgIHBhcmFtczogSlNPTi5zdHJpbmdpZnkoZS5jb25maWcpLFxuICAgICAgICAgICAgZXJyb3JfbXNnOiBudWxsID09PSAobyA9IG51bGwgPT09IChyID0gdC50YXJnZXQpIHx8IHZvaWQgMCA9PT0gciA/IHZvaWQgMCA6IHIuZXJyb3IpIHx8IHZvaWQgMCA9PT0gbyA/IHZvaWQgMCA6IG8ubWVzc2FnZVxuICAgICAgICAgIH0sIGUucmVwb3J0T3B0aW9ucyk7XG4gICAgICAgIH0sIGMub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGUuZGIgPSBjLnJlc3VsdDtcblxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBudWxsID09IHMgfHwgcy5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgIGUuY3JlYXRlU3RvcmUodCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICBfUyh7XG4gICAgICAgICAgICAgIHJlc3VsdDogMCxcbiAgICAgICAgICAgICAgZnVuYzogXCJvcGVuXCIsXG4gICAgICAgICAgICAgIHBhcmFtczogSlNPTi5zdHJpbmdpZnkoZS5jb25maWcpLFxuICAgICAgICAgICAgICBlcnJvcl9tc2c6IHQubWVzc2FnZVxuICAgICAgICAgICAgfSwgZS5yZXBvcnRPcHRpb25zKSwgbih0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9LCB0LnByb3RvdHlwZS51c2VTdG9yZSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICByZXR1cm4gdGhpcy5zdG9yZU5hbWUgPSB0LCB0aGlzO1xuICAgIH0sIHQucHJvdG90eXBlLmRlbGV0ZURCID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHQgPSB0aGlzO1xuICAgICAgcmV0dXJuIHRoaXMuY2xvc2VEQigpLCBuZXcgUHJvbWlzZShmdW5jdGlvbiAoZSwgcikge1xuICAgICAgICB2YXIgbiA9IGluZGV4ZWREQi5kZWxldGVEYXRhYmFzZSh0LmNvbmZpZy5uYW1lKTtcbiAgICAgICAgbi5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGUoKTtcbiAgICAgICAgfSwgbi5vbmVycm9yID0gcjtcbiAgICAgIH0pO1xuICAgIH0sIHQucHJvdG90eXBlLmNsb3NlREIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgdDtcbiAgICAgIG51bGwgPT09ICh0ID0gdGhpcy5kYikgfHwgdm9pZCAwID09PSB0IHx8IHQuY2xvc2UoKSwgdGhpcy5kYiA9IG51bGw7XG4gICAgfSwgdC5wcm90b3R5cGUuZ2V0U3RvcmVDb3VudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAoZSwgcikge1xuICAgICAgICB2YXIgbiA9IHQuZ2V0U3RvcmUoXCJyZWFkb25seVwiKS5jb3VudCgpO1xuICAgICAgICBuLm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZShuLnJlc3VsdCk7XG4gICAgICAgIH0sIG4ub25lcnJvciA9IHI7XG4gICAgICB9KTtcbiAgICB9LCB0LnByb3RvdHlwZS5jbGVhclN0b3JlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHQgPSB0aGlzO1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChlLCByKSB7XG4gICAgICAgIHZhciBuID0gdC5nZXRTdG9yZShcInJlYWR3cml0ZVwiKS5jbGVhcigpO1xuICAgICAgICBuLm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZSgpO1xuICAgICAgICB9LCBuLm9uZXJyb3IgPSByO1xuICAgICAgfSk7XG4gICAgfSwgdC5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgIHZhciByID0gdGhpcztcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAobiwgbykge1xuICAgICAgICB2YXIgaSA9IHIuZ2V0U3RvcmUoXCJyZWFkd3JpdGVcIikuYWRkKHQsIGUpO1xuICAgICAgICBpLm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBuKGkucmVzdWx0KTtcbiAgICAgICAgfSwgaS5vbmVycm9yID0gbztcbiAgICAgIH0pO1xuICAgIH0sIHQucHJvdG90eXBlLnB1dCA9IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICB2YXIgciA9IHRoaXM7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKG4sIG8pIHtcbiAgICAgICAgdmFyIGkgPSByLmdldFN0b3JlKFwicmVhZHdyaXRlXCIpLnB1dCh0LCBlKTtcbiAgICAgICAgaS5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgbihpLnJlc3VsdCk7XG4gICAgICAgIH0sIGkub25lcnJvciA9IG87XG4gICAgICB9KTtcbiAgICB9LCB0LnByb3RvdHlwZS5nZXRTdG9yZUFsbERhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgdCA9IHRoaXM7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGUsIHIpIHtcbiAgICAgICAgdmFyIG4gPSB0LmdldFN0b3JlKFwicmVhZG9ubHlcIikub3BlbkN1cnNvcigpLFxuICAgICAgICAgICAgbyA9IFtdO1xuICAgICAgICBuLm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgdDtcblxuICAgICAgICAgIGlmIChudWxsID09PSAodCA9IG4ucmVzdWx0KSB8fCB2b2lkIDAgPT09IHQgPyB2b2lkIDAgOiB0LnZhbHVlKSB7XG4gICAgICAgICAgICB2YXIgciA9IG4ucmVzdWx0LnZhbHVlO1xuICAgICAgICAgICAgby5wdXNoKHIpLCBuLnJlc3VsdC5jb250aW51ZSgpO1xuICAgICAgICAgIH0gZWxzZSBlKG8pO1xuICAgICAgICB9LCBuLm9uZXJyb3IgPSByO1xuICAgICAgfSk7XG4gICAgfSwgdC5wcm90b3R5cGUuZ2V0RGF0YVJhbmdlQnlJbmRleCA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBvKSB7XG4gICAgICB2YXIgaSA9IHRoaXM7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIHMpIHtcbiAgICAgICAgdmFyIGMgPSBpLmdldFN0b3JlKCkuaW5kZXgodCksXG4gICAgICAgICAgICB1ID0gSURCS2V5UmFuZ2UuYm91bmQoZSwgciwgbiwgbyksXG4gICAgICAgICAgICBsID0gW10sXG4gICAgICAgICAgICBoID0gYy5vcGVuQ3Vyc29yKHUpO1xuICAgICAgICBoLm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgdDtcbiAgICAgICAgICAobnVsbCA9PT0gKHQgPSBudWxsID09IGggPyB2b2lkIDAgOiBoLnJlc3VsdCkgfHwgdm9pZCAwID09PSB0ID8gdm9pZCAwIDogdC52YWx1ZSkgPyAobC5wdXNoKG51bGwgPT0gaCA/IHZvaWQgMCA6IGgucmVzdWx0LnZhbHVlKSwgbnVsbCA9PSBoIHx8IGgucmVzdWx0LmNvbnRpbnVlKCkpIDogYShsKTtcbiAgICAgICAgfSwgaC5vbmVycm9yID0gcztcbiAgICAgIH0pO1xuICAgIH0sIHQucHJvdG90eXBlLnJlbW92ZURhdGFCeUluZGV4ID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4sIG8pIHtcbiAgICAgIHZhciBpID0gdGhpcztcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAoYSwgcykge1xuICAgICAgICB2YXIgYyA9IGkuZ2V0U3RvcmUoXCJyZWFkd3JpdGVcIikuaW5kZXgodCksXG4gICAgICAgICAgICB1ID0gSURCS2V5UmFuZ2UuYm91bmQoZSwgciwgbiwgbyksXG4gICAgICAgICAgICBsID0gYy5vcGVuQ3Vyc29yKHUpLFxuICAgICAgICAgICAgaCA9IDA7XG4gICAgICAgIGwub25zdWNjZXNzID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICB2YXIgZSA9IHQudGFyZ2V0LnJlc3VsdDtcbiAgICAgICAgICBlID8gKGggKz0gMSwgZS5kZWxldGUoKSwgZS5jb250aW51ZSgpKSA6IGEoaCk7XG4gICAgICAgIH0sIGwub25lcnJvciA9IHM7XG4gICAgICB9KTtcbiAgICB9LCB0LnByb3RvdHlwZS5jcmVhdGVTdG9yZSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICB2YXIgZSA9IHQubmFtZSxcbiAgICAgICAgICByID0gdC5pbmRleGVzLFxuICAgICAgICAgIG4gPSB2b2lkIDAgPT09IHIgPyBbXSA6IHIsXG4gICAgICAgICAgbyA9IHQub3B0aW9ucztcblxuICAgICAgaWYgKHRoaXMuZGIpIHtcbiAgICAgICAgdGhpcy5kYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKGUpICYmIHRoaXMuZGIuZGVsZXRlT2JqZWN0U3RvcmUoZSk7XG4gICAgICAgIHZhciBpID0gdGhpcy5kYi5jcmVhdGVPYmplY3RTdG9yZShlLCBvKTtcbiAgICAgICAgbi5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgaS5jcmVhdGVJbmRleCh0LmluZGV4TmFtZSwgdC5rZXlQYXRoLCB0Lm9wdGlvbnMpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LCB0LnByb3RvdHlwZS5nZXRTdG9yZSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICB2YXIgZTtcbiAgICAgIHJldHVybiB2b2lkIDAgPT09IHQgJiYgKHQgPSBcInJlYWRvbmx5XCIpLCBudWxsID09PSAoZSA9IHRoaXMuZGIpIHx8IHZvaWQgMCA9PT0gZSA/IHZvaWQgMCA6IGUudHJhbnNhY3Rpb24odGhpcy5zdG9yZU5hbWUsIHQpLm9iamVjdFN0b3JlKHRoaXMuc3RvcmVOYW1lKTtcbiAgICB9LCB0O1xuICB9KCksXG4gICAgICBPID0gXCJldmVudF90YWJsZV92M1wiLFxuICAgICAgayA9IFwiZXZlbnRJZFwiLFxuICAgICAgeCA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiB0KHQpIHtcbiAgICAgIHRoaXMuaXNSZWFkeSA9ICExLCB0aGlzLnRhc2tRdWV1ZSA9IFByb21pc2UucmVzb2x2ZSgpLCB0aGlzLmRiID0gbmV3IEkoe1xuICAgICAgICBuYW1lOiBcIkJlYWNvbl9cIiArIHQgKyBcIl9WM1wiLFxuICAgICAgICB2ZXJzaW9uOiAxLFxuICAgICAgICBzdG9yZXM6IFt7XG4gICAgICAgICAgbmFtZTogTyxcbiAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICBrZXlQYXRoOiBrXG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbmRleGVzOiBbe1xuICAgICAgICAgICAgaW5kZXhOYW1lOiBrLFxuICAgICAgICAgICAga2V5UGF0aDogayxcbiAgICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgdW5pcXVlOiAhMFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1dXG4gICAgICAgIH1dXG4gICAgICB9KSwgdGhpcy5vcGVuKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHQucHJvdG90eXBlLmdldENvdW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHQgPSB0aGlzO1xuICAgICAgcmV0dXJuIHRoaXMucmVhZHlFeGVjKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHQuZGIuZ2V0U3RvcmVDb3VudCgpO1xuICAgICAgfSk7XG4gICAgfSwgdC5wcm90b3R5cGUuc2V0SXRlbSA9IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICB2YXIgciA9IHRoaXM7XG4gICAgICByZXR1cm4gdGhpcy5yZWFkeUV4ZWMoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gci5kYi5hZGQoe1xuICAgICAgICAgIGV2ZW50SWQ6IHQsXG4gICAgICAgICAgdmFsdWU6IGVcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LCB0LnByb3RvdHlwZS5nZXRJdGVtID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHJldHVybiByKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBlID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG4odGhpcywgZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICByZXR1cm4gWzIsIHRoaXMucmVhZHlFeGVjKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBlLmRiLmdldERhdGFSYW5nZUJ5SW5kZXgoaywgdCwgdCk7XG4gICAgICAgICAgfSldO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0sIHQucHJvdG90eXBlLnJlbW92ZUl0ZW0gPSBmdW5jdGlvbiAodCkge1xuICAgICAgdmFyIGUgPSB0aGlzO1xuICAgICAgcmV0dXJuIHRoaXMucmVhZHlFeGVjKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGUuZGIucmVtb3ZlRGF0YUJ5SW5kZXgoaywgdCwgdCk7XG4gICAgICB9KTtcbiAgICB9LCB0LnByb3RvdHlwZS51cGRhdGVJdGVtID0gZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgIHZhciByID0gdGhpcztcbiAgICAgIHJldHVybiB0aGlzLnJlYWR5RXhlYyhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiByLmRiLnB1dCh7XG4gICAgICAgICAgZXZlbnRJZDogdCxcbiAgICAgICAgICB2YWx1ZTogZVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0sIHQucHJvdG90eXBlLml0ZXJhdGUgPSBmdW5jdGlvbiAodCkge1xuICAgICAgdmFyIGUgPSB0aGlzO1xuICAgICAgcmV0dXJuIHRoaXMucmVhZHlFeGVjKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGUuZGIuZ2V0U3RvcmVBbGxEYXRhKCkudGhlbihmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIGUuZm9yRWFjaChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgdChlLnZhbHVlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LCB0LnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHQgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbih0aGlzLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIHN3aXRjaCAoZS5sYWJlbCkge1xuICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICByZXR1cm4gdGhpcy50YXNrUXVldWUgPSB0aGlzLnRhc2tRdWV1ZS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdC5kYi5vcGVuREIoKTtcbiAgICAgICAgICAgICAgfSksIFs0LCB0aGlzLnRhc2tRdWV1ZV07XG5cbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgcmV0dXJuIGUuc2VudCgpLCB0aGlzLmlzUmVhZHkgPSAhMCwgdGhpcy5kYi51c2VTdG9yZShPKSwgWzJdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LCB0LnByb3RvdHlwZS5yZWFkeUV4ZWMgPSBmdW5jdGlvbiAodCkge1xuICAgICAgcmV0dXJuIHRoaXMuaXNSZWFkeSA/IHQoKSA6ICh0aGlzLnRhc2tRdWV1ZSA9IHRoaXMudGFza1F1ZXVlLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdCgpO1xuICAgICAgfSksIHRoaXMudGFza1F1ZXVlKTtcbiAgICB9LCB0O1xuICB9KCksXG4gICAgICBDID0gZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIHQodCkge1xuICAgICAgdGhpcy5rZXlPYmplY3QgPSB7fSwgdGhpcy5zdG9yYWdlID0gdDtcbiAgICB9XG5cbiAgICByZXR1cm4gdC5wcm90b3R5cGUuZ2V0Q291bnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5zdG9yYWdlLmdldFN0b3JlQ291bnQoKTtcbiAgICB9LCB0LnByb3RvdHlwZS5yZW1vdmVJdGVtID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHRoaXMuc3RvcmFnZS5yZW1vdmVJdGVtKHQpLCBkZWxldGUgdGhpcy5rZXlPYmplY3RbdF07XG4gICAgfSwgdC5wcm90b3R5cGUuc2V0SXRlbSA9IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICB2YXIgciA9IEpTT04uc3RyaW5naWZ5KGUpO1xuICAgICAgdGhpcy5zdG9yYWdlLnNldEl0ZW0odCwgciksIHRoaXMua2V5T2JqZWN0W3RdID0gZTtcbiAgICB9LCB0LnByb3RvdHlwZS5pdGVyYXRlID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIGZvciAodmFyIGUgPSBPYmplY3Qua2V5cyh0aGlzLmtleU9iamVjdCksIHIgPSAwOyByIDwgZS5sZW5ndGg7IHIrKykge1xuICAgICAgICB2YXIgbiA9IHRoaXMuc3RvcmFnZS5nZXRJdGVtKGVbcl0pO1xuICAgICAgICB0KEpTT04ucGFyc2UobikpO1xuICAgICAgfVxuICAgIH0sIHQ7XG4gIH0oKSxcbiAgICAgIF8gPSBmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gdCh0LCBlKSB7XG4gICAgICB2YXIgciA9IHRoaXM7XG4gICAgICB0aGlzLmRiRXZlbnRDb3VudCA9IDAsIGIoKSA+IDAgfHwgIXdpbmRvdy5pbmRleGVkREIgfHwgL1g1TGl0ZS8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSA/ICh0aGlzLnN0b3JlID0gbmV3IEMoZSksIHRoaXMuZGJFdmVudENvdW50ID0gdGhpcy5zdG9yZS5nZXRDb3VudCgpKSA6ICh0aGlzLnN0b3JlID0gbmV3IHgodCksIHRoaXMuZ2V0Q291bnQoKS50aGVuKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIHIuZGJFdmVudENvdW50ID0gdDtcbiAgICAgIH0pKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdC5wcm90b3R5cGUuZ2V0Q291bnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbih0aGlzLCBmdW5jdGlvbiAodCkge1xuICAgICAgICAgIHN3aXRjaCAodC5sYWJlbCkge1xuICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICByZXR1cm4gdC50cnlzLnB1c2goWzAsIDIsLCAzXSksIFs0LCB0aGlzLnN0b3JlLmdldENvdW50KCldO1xuXG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgIHJldHVybiBbMiwgdC5zZW50KCldO1xuXG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgIHJldHVybiB0LnNlbnQoKSwgWzIsIFByb21pc2UucmVqZWN0KCldO1xuXG4gICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgIHJldHVybiBbMl07XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0sIHQucHJvdG90eXBlLmluc2VydEV2ZW50ID0gZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgIHJldHVybiByKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciByLCBvO1xuICAgICAgICByZXR1cm4gbih0aGlzLCBmdW5jdGlvbiAobikge1xuICAgICAgICAgIHN3aXRjaCAobi5sYWJlbCkge1xuICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICBpZiAodGhpcy5kYkV2ZW50Q291bnQgPj0gMWU0KSByZXR1cm4gWzIsIFByb21pc2UucmVqZWN0KCldO1xuICAgICAgICAgICAgICByID0gcCh0Lm1hcFZhbHVlKSwgbi5sYWJlbCA9IDE7XG5cbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgcmV0dXJuIG4udHJ5cy5wdXNoKFsxLCAzLCwgNF0pLCB0aGlzLmRiRXZlbnRDb3VudCsrLCBbNCwgdGhpcy5zdG9yZS5zZXRJdGVtKHIsIHQpXTtcblxuICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICByZXR1cm4gWzIsIG4uc2VudCgpXTtcblxuICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICByZXR1cm4gbyA9IG4uc2VudCgpLCBlICYmIGUobywgdCksIHRoaXMuZGJFdmVudENvdW50LS0sIFsyLCBQcm9taXNlLnJlamVjdCgpXTtcblxuICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICByZXR1cm4gWzJdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LCB0LnByb3RvdHlwZS5nZXRFdmVudHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdDtcbiAgICAgICAgcmV0dXJuIG4odGhpcywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBzd2l0Y2ggKGUubGFiZWwpIHtcbiAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgdCA9IFtdLCBlLmxhYmVsID0gMTtcblxuICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICByZXR1cm4gZS50cnlzLnB1c2goWzEsIDMsLCA0XSksIFs0LCB0aGlzLnN0b3JlLml0ZXJhdGUoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICB0LnB1c2goZSk7XG4gICAgICAgICAgICAgIH0pXTtcblxuICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICByZXR1cm4gZS5zZW50KCksIFsyLCBQcm9taXNlLmFsbCh0KV07XG5cbiAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgcmV0dXJuIGUuc2VudCgpLCBbMiwgUHJvbWlzZS5hbGwodCldO1xuXG4gICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgIHJldHVybiBbMl07XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0sIHQucHJvdG90eXBlLnJlbW92ZUV2ZW50ID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHJldHVybiByKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBlO1xuICAgICAgICByZXR1cm4gbih0aGlzLCBmdW5jdGlvbiAocikge1xuICAgICAgICAgIHN3aXRjaCAoci5sYWJlbCkge1xuICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICBlID0gcCh0Lm1hcFZhbHVlKSwgci5sYWJlbCA9IDE7XG5cbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgcmV0dXJuIHIudHJ5cy5wdXNoKFsxLCAzLCwgNF0pLCB0aGlzLmRiRXZlbnRDb3VudC0tLCBbNCwgdGhpcy5zdG9yZS5yZW1vdmVJdGVtKGUpXTtcblxuICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICByZXR1cm4gWzIsIHIuc2VudCgpXTtcblxuICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICByZXR1cm4gci5zZW50KCksIHRoaXMuZGJFdmVudENvdW50KyssIFsyLCBQcm9taXNlLnJlamVjdCgpXTtcblxuICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICByZXR1cm4gWzJdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LCB0O1xuICB9KCksXG4gICAgICBfQSA9IGZ1bmN0aW9uIEEoKSB7XG4gICAgcmV0dXJuIChfQSA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHQpIHtcbiAgICAgIGZvciAodmFyIGUsIHIgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgciA8IG47IHIrKykge1xuICAgICAgICBmb3IgKHZhciBvIGluIGUgPSBhcmd1bWVudHNbcl0pIHtcbiAgICAgICAgICBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgbykgJiYgKHRbb10gPSBlW29dKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdDtcbiAgICB9KS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9O1xuXG4gIGZ1bmN0aW9uIFAodCkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHQucmVwbGFjZSgvXFwrL2csIFwiIFwiKSk7XG4gICAgfSBjYXRjaCAodCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaih0LCBlKSB7XG4gICAgdmFyIHIgPSBbbnVsbCwgdm9pZCAwLCBcIlwiLCBOYU5dLmluY2x1ZGVzKHQpO1xuICAgIGlmIChlLmlzU2tpcEVtcHR5ICYmIHIpIHJldHVybiBudWxsO1xuICAgIHZhciBuID0gIWUuaXNTa2lwRW1wdHkgJiYgciA/IFwiXCIgOiB0O1xuXG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBlLmVuY29kZSA/IGVuY29kZVVSSUNvbXBvbmVudChuKSA6IG47XG4gICAgfSBjYXRjaCAodCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gRCh0KSB7XG4gICAgdmFyIGUgPSB0LnNwbGl0KFwiI1wiKSxcbiAgICAgICAgciA9IGVbMF0sXG4gICAgICAgIG4gPSBlWzFdLFxuICAgICAgICBvID0gdm9pZCAwID09PSBuID8gXCJcIiA6IG4sXG4gICAgICAgIGkgPSByLnNwbGl0KFwiP1wiKSxcbiAgICAgICAgYSA9IGlbMF0sXG4gICAgICAgIHMgPSBpWzFdLFxuICAgICAgICBjID0gdm9pZCAwID09PSBzID8gXCJcIiA6IHMsXG4gICAgICAgIHUgPSBQKG8pLFxuICAgICAgICBsID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICByZXR1cm4gYy5zcGxpdChcIiZcIikuZm9yRWFjaChmdW5jdGlvbiAodCkge1xuICAgICAgdmFyIGUgPSB0LnNwbGl0KFwiPVwiKSxcbiAgICAgICAgICByID0gZVswXSxcbiAgICAgICAgICBuID0gZVsxXSxcbiAgICAgICAgICBvID0gdm9pZCAwID09PSBuID8gXCJcIiA6IG4sXG4gICAgICAgICAgaSA9IFAociksXG4gICAgICAgICAgYSA9IFAobyk7XG4gICAgICBudWxsID09PSBpIHx8IG51bGwgPT09IGEgfHwgXCJcIiA9PT0gaSAmJiBcIlwiID09PSBhIHx8IGxbaV0gfHwgKGxbaV0gPSBhKTtcbiAgICB9KSwge1xuICAgICAgdXJsOiBhLFxuICAgICAgcXVlcnk6IGwsXG4gICAgICBoYXNoOiB1XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIFQodCwgZSkge1xuICAgIHZvaWQgMCA9PT0gZSAmJiAoZSA9IHtcbiAgICAgIGVuY29kZTogITAsXG4gICAgICBpc1NraXBFbXB0eTogITFcbiAgICB9KTtcblxuICAgIHZhciByID0gdC51cmwsXG4gICAgICAgIG4gPSB0LnF1ZXJ5LFxuICAgICAgICBvID0gdm9pZCAwID09PSBuID8ge30gOiBuLFxuICAgICAgICBpID0gdC5oYXNoLFxuICAgICAgICBhID0gci5zcGxpdChcIiNcIiksXG4gICAgICAgIHMgPSBhWzBdLFxuICAgICAgICBjID0gYVsxXSxcbiAgICAgICAgdSA9IHZvaWQgMCA9PT0gYyA/IFwiXCIgOiBjLFxuICAgICAgICBsID0gcy5zcGxpdChcIj9cIilbMF0sXG4gICAgICAgIGggPSBbXSxcbiAgICAgICAgZiA9IGooaSB8fCB1LCBlKSxcbiAgICAgICAgcCA9IF9BKF9BKHt9LCBEKHIpLnF1ZXJ5KSwgbyk7XG5cbiAgICByZXR1cm4gT2JqZWN0LmtleXMocCkuZm9yRWFjaChmdW5jdGlvbiAodCkge1xuICAgICAgdmFyIHIgPSBqKHQsIGUpLFxuICAgICAgICAgIG4gPSBqKHBbdF0sIGUpO1xuICAgICAgbnVsbCAhPT0gciAmJiBudWxsICE9PSBuICYmIGgucHVzaChyICsgXCI9XCIgKyBuKTtcbiAgICB9KSwgbCArIChoLmxlbmd0aCA/IFwiP1wiICsgaC5qb2luKFwiJlwiKSA6IFwiXCIpICsgKGYgPyBcIiNcIiArIGYgOiBcIlwiKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIE4odCwgZSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAociwgbikge1xuICAgICAgaWYgKGUgJiYgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcInNjcmlwdFtkYXRhLXRhZz1cIiArIGUgKyBcIl1cIikubGVuZ3RoKSByZXR1cm4gcigpO1xuXG4gICAgICB2YXIgbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIiksXG4gICAgICAgICAgaSA9IF9BKHtcbiAgICAgICAgdHlwZTogXCJ0ZXh0L2phdmFzY3JpcHRcIixcbiAgICAgICAgY2hhcnNldDogXCJ1dGYtOFwiXG4gICAgICB9LCB0KTtcblxuICAgICAgT2JqZWN0LmtleXMoaSkuZm9yRWFjaChmdW5jdGlvbiAodCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQsIGUsIHIpIHtcbiAgICAgICAgICBpZiAodCkgcmV0dXJuIHZvaWQgMCA9PT0gciA/IHQuZ2V0QXR0cmlidXRlKGUpIDogdC5zZXRBdHRyaWJ1dGUoZSwgcik7XG4gICAgICAgIH0obywgdCwgaVt0XSk7XG4gICAgICB9KSwgZSAmJiAoby5kYXRhc2V0LnRhZyA9IGUpLCBvLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHIoKTtcbiAgICAgIH0sIG8ub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdCA9IG8ucmVhZHlTdGF0ZTtcbiAgICAgICAgW1wiY29tcGxldGVcIiwgXCJsb2FkZWRcIl0uaW5jbHVkZXModCkgJiYgKG8ub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbCwgcigpKTtcbiAgICAgIH0sIG8ub25lcnJvciA9IG4sIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobyk7XG4gICAgfSk7XG4gIH1cblxuICAhZnVuY3Rpb24gKHQpIHtcbiAgICB0W3QuZXF1YWwgPSAwXSA9IFwiZXF1YWxcIiwgdFt0LmxvdyA9IC0xXSA9IFwibG93XCIsIHRbdC5oaWdoID0gMV0gPSBcImhpZ2hcIjtcbiAgfShFIHx8IChFID0ge30pKTtcblxuICB2YXIgX1UgPSBmdW5jdGlvbiBVKCkge1xuICAgIHJldHVybiAoX1UgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0KSB7XG4gICAgICBmb3IgKHZhciBlLCByID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IHIgPCBuOyByKyspIHtcbiAgICAgICAgZm9yICh2YXIgbyBpbiBlID0gYXJndW1lbnRzW3JdKSB7XG4gICAgICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIG8pICYmICh0W29dID0gZVtvXSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHQ7XG4gICAgfSkuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfTtcblxuICBmdW5jdGlvbiBxKHQsIGUsIHIsIG4pIHtcbiAgICByZXR1cm4gbmV3IChyIHx8IChyID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChvLCBpKSB7XG4gICAgICBmdW5jdGlvbiBhKHQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjKG4ubmV4dCh0KSk7XG4gICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICBpKHQpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIHModCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGMobi50aHJvdyh0KSk7XG4gICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICBpKHQpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGModCkge1xuICAgICAgICB2YXIgZTtcbiAgICAgICAgdC5kb25lID8gbyh0LnZhbHVlKSA6IChlID0gdC52YWx1ZSwgZSBpbnN0YW5jZW9mIHIgPyBlIDogbmV3IHIoZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICB0KGUpO1xuICAgICAgICB9KSkudGhlbihhLCBzKTtcbiAgICAgIH1cblxuICAgICAgYygobiA9IG4uYXBwbHkodCwgZSB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBSKHQsIGUpIHtcbiAgICB2YXIgcixcbiAgICAgICAgbixcbiAgICAgICAgbyxcbiAgICAgICAgaSxcbiAgICAgICAgYSA9IHtcbiAgICAgIGxhYmVsOiAwLFxuICAgICAgc2VudDogZnVuY3Rpb24gc2VudCgpIHtcbiAgICAgICAgaWYgKDEgJiBvWzBdKSB0aHJvdyBvWzFdO1xuICAgICAgICByZXR1cm4gb1sxXTtcbiAgICAgIH0sXG4gICAgICB0cnlzOiBbXSxcbiAgICAgIG9wczogW11cbiAgICB9O1xuICAgIHJldHVybiBpID0ge1xuICAgICAgbmV4dDogcygwKSxcbiAgICAgIHRocm93OiBzKDEpLFxuICAgICAgcmV0dXJuOiBzKDIpXG4gICAgfSwgXCJmdW5jdGlvblwiID09IHR5cGVvZiBTeW1ib2wgJiYgKGlbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0pLCBpO1xuXG4gICAgZnVuY3Rpb24gcyhpKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpKSB7XG4gICAgICAgICAgaWYgKHIpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO1xuXG4gICAgICAgICAgZm9yICg7IGE7KSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBpZiAociA9IDEsIG4gJiYgKG8gPSAyICYgaVswXSA/IG4ucmV0dXJuIDogaVswXSA/IG4udGhyb3cgfHwgKChvID0gbi5yZXR1cm4pICYmIG8uY2FsbChuKSwgMCkgOiBuLm5leHQpICYmICEobyA9IG8uY2FsbChuLCBpWzFdKSkuZG9uZSkgcmV0dXJuIG87XG5cbiAgICAgICAgICAgICAgc3dpdGNoIChuID0gMCwgbyAmJiAoaSA9IFsyICYgaVswXSwgby52YWx1ZV0pLCBpWzBdKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgIG8gPSBpO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICByZXR1cm4gYS5sYWJlbCsrLCB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBpWzFdLFxuICAgICAgICAgICAgICAgICAgICBkb25lOiAhMVxuICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgIGEubGFiZWwrKywgbiA9IGlbMV0sIGkgPSBbMF07XG4gICAgICAgICAgICAgICAgICBjb250aW51ZTtcblxuICAgICAgICAgICAgICAgIGNhc2UgNzpcbiAgICAgICAgICAgICAgICAgIGkgPSBhLm9wcy5wb3AoKSwgYS50cnlzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgY29udGludWU7XG5cbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgaWYgKCEoKG8gPSAobyA9IGEudHJ5cykubGVuZ3RoID4gMCAmJiBvW28ubGVuZ3RoIC0gMV0pIHx8IDYgIT09IGlbMF0gJiYgMiAhPT0gaVswXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgYSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICBpZiAoMyA9PT0gaVswXSAmJiAoIW8gfHwgaVsxXSA+IG9bMF0gJiYgaVsxXSA8IG9bM10pKSB7XG4gICAgICAgICAgICAgICAgICAgIGEubGFiZWwgPSBpWzFdO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgaWYgKDYgPT09IGlbMF0gJiYgYS5sYWJlbCA8IG9bMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgYS5sYWJlbCA9IG9bMV0sIG8gPSBpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgaWYgKG8gJiYgYS5sYWJlbCA8IG9bMl0pIHtcbiAgICAgICAgICAgICAgICAgICAgYS5sYWJlbCA9IG9bMl0sIGEub3BzLnB1c2goaSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICBvWzJdICYmIGEub3BzLnBvcCgpLCBhLnRyeXMucG9wKCk7XG4gICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGkgPSBlLmNhbGwodCwgYSk7XG4gICAgICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICAgIGkgPSBbNiwgdF0sIG4gPSAwO1xuICAgICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgciA9IG8gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICg1ICYgaVswXSkgdGhyb3cgaVsxXTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdmFsdWU6IGlbMF0gPyBpWzFdIDogdm9pZCAwLFxuICAgICAgICAgICAgZG9uZTogITBcbiAgICAgICAgICB9O1xuICAgICAgICB9KFtpLCBzXSk7XG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIHZhciBMID0gZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIHQoKSB7XG4gICAgICB0aGlzLmludGVyY2VwdG9ycyA9IFtdO1xuICAgIH1cblxuICAgIHJldHVybiB0LnByb3RvdHlwZS51c2UgPSBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgcmV0dXJuIHRoaXMuaW50ZXJjZXB0b3JzLnB1c2goe1xuICAgICAgICByZXNvbHZlZDogdCxcbiAgICAgICAgcmVqZWN0ZWQ6IGVcbiAgICAgIH0pLCB0aGlzLmludGVyY2VwdG9ycy5sZW5ndGggLSAxO1xuICAgIH0sIHQucHJvdG90eXBlLnRyYXZlcnNlID0gZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgIHZvaWQgMCA9PT0gZSAmJiAoZSA9ICExKTtcbiAgICAgIHZhciByID0gUHJvbWlzZS5yZXNvbHZlKHQpO1xuICAgICAgcmV0dXJuIChlID8gQXJyYXkucHJvdG90eXBlLnJlZHVjZVJpZ2h0IDogQXJyYXkucHJvdG90eXBlLnJlZHVjZSkuY2FsbCh0aGlzLmludGVyY2VwdG9ycywgZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgICAgaWYgKGUpIHtcbiAgICAgICAgICB2YXIgbiA9IGUucmVzb2x2ZWQsXG4gICAgICAgICAgICAgIG8gPSBlLnJlamVjdGVkO1xuICAgICAgICAgIHIgPSByLnRoZW4obiwgbyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdDtcbiAgICAgIH0sIFwiXCIpLCByO1xuICAgIH0sIHQucHJvdG90eXBlLmVqZWN0ID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHRoaXMuaW50ZXJjZXB0b3JzW3RdICYmICh0aGlzLmludGVyY2VwdG9yc1t0XSA9IG51bGwpO1xuICAgIH0sIHQ7XG4gIH0oKSxcbiAgICAgIEIgPSB7XG4gICAgZGVmYXVsdHM6IHtcbiAgICAgIHRpbWVvdXQ6IDAsXG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBtb2RlOiBcImNvcnNcIixcbiAgICAgIHJlZGlyZWN0OiBcImZvbGxvd1wiLFxuICAgICAgY3JlZGVudGlhbHM6IFwic2FtZS1vcmlnaW5cIlxuICAgIH0sXG4gICAgaGVhZGVyczoge1xuICAgICAgY29tbW9uOiB7XG4gICAgICAgIEFjY2VwdDogXCJhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L3BsYWluLCAqLypcIlxuICAgICAgfSxcbiAgICAgIFBPU1Q6IHtcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIlxuICAgICAgfSxcbiAgICAgIFBVVDoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiXG4gICAgICB9LFxuICAgICAgUEFUQ0g6IHtcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIlxuICAgICAgfVxuICAgIH0sXG4gICAgYmFzZVVSTDogXCJcIixcbiAgICBwb2x5ZmlsbFVybDogXCJodHRwczovL3ZtLmd0aW1nLmNuL2NvbXBzL3NjcmlwdC9mZXRjaC5taW4uanNcIixcbiAgICBpbnRlcmNlcHRvcnM6IHtcbiAgICAgIHJlcXVlc3Q6IG5ldyBMKCksXG4gICAgICByZXNwb25zZTogbmV3IEwoKVxuICAgIH1cbiAgfSxcbiAgICAgIEogPSAvXihbYS16XVthLXpcXGQrXFwtLl0qOik/XFwvXFwvL2ksXG4gICAgICBNID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZztcblxuICBmdW5jdGlvbiBWKHQpIHtcbiAgICByZXR1cm4gcSh0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGU7XG4gICAgICByZXR1cm4gUih0aGlzLCBmdW5jdGlvbiAocikge1xuICAgICAgICBzd2l0Y2ggKHIubGFiZWwpIHtcbiAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICBpZiAod2luZG93LmZldGNoKSByZXR1cm4gWzJdO1xuICAgICAgICAgICAgci5sYWJlbCA9IDE7XG5cbiAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICByZXR1cm4gci50cnlzLnB1c2goWzEsIDMsLCA0XSksIFs0LCBOKHtcbiAgICAgICAgICAgICAgc3JjOiB0XG4gICAgICAgICAgICB9KV07XG5cbiAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICByZXR1cm4gci5zZW50KCksIFszLCA0XTtcblxuICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgIHRocm93IGUgPSByLnNlbnQoKSwgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgaWYgKFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIEltYWdlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGUgPSBuZXcgSW1hZ2UoMSwgMSksXG4gICAgICAgICAgICAgICAgICAgIHIgPSBfVSh7XG4gICAgICAgICAgICAgICAgICBhdHRhaWQ6IFwiMGY0MDAwNTMxMzBcIixcbiAgICAgICAgICAgICAgICAgIHRva2VuOiBcIjY1NTIzNzQ0NDJcIixcbiAgICAgICAgICAgICAgICAgIGNvbXBzOiBcIkB0ZW5jZW50L292Yi1yZXF1ZXN0XCIsXG4gICAgICAgICAgICAgICAgICB2ZXJzaW9uOiBcIjEuMS4xOFwiLFxuICAgICAgICAgICAgICAgICAgdWE6IG5hdmlnYXRvci51c2VyQWdlbnQsXG4gICAgICAgICAgICAgICAgICB1cmw6IGxvY2F0aW9uLmhyZWYsXG4gICAgICAgICAgICAgICAgICBfZGM6IE1hdGgucmFuZG9tKClcbiAgICAgICAgICAgICAgICB9LCB0KSxcbiAgICAgICAgICAgICAgICAgICAgbiA9IE9iamVjdC5rZXlzKHIpLm1hcChmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIHQgKyBcIj1cIiArIGVuY29kZVVSSUNvbXBvbmVudChyW3RdKTtcbiAgICAgICAgICAgICAgICB9KS5qb2luKFwiJlwiKTtcblxuICAgICAgICAgICAgICAgIGUuc3JjID0gXCJodHRwczovL2gudHJhY2UucXEuY29tL2t2P1wiICsgbjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSh7XG4gICAgICAgICAgICAgIGZ1bmM6IFwibG9hZFBvbHlmaWxsXCIsXG4gICAgICAgICAgICAgIHJlc3VsdDogMCxcbiAgICAgICAgICAgICAgcGFyYW1zOiB0LFxuICAgICAgICAgICAgICBlcnJvcl9tc2c6IGUubWVzc2FnZVxuICAgICAgICAgICAgfSksIG5ldyBFcnJvcihcIuWKoOi9vSBwb2x5ZmlsbCBcIiArIHQgKyBcIiDlpLHotKU6IFwiICsgZS5tZXNzYWdlKTtcblxuICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgIHJldHVybiBbMl07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gRyh0KSB7XG4gICAgcmV0dXJuIFtcIkFjY2VwdFwiLCBcIkNvbnRlbnQtVHlwZVwiXS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gciA9IGUsIHZvaWQgKChuID0gdC5oZWFkZXJzKSAmJiBPYmplY3Qua2V5cyhuKS5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIHQgIT09IHIgJiYgdC50b1VwcGVyQ2FzZSgpID09PSByLnRvVXBwZXJDYXNlKCkgJiYgKG5bcl0gPSBuW3RdLCBkZWxldGUgblt0XSk7XG4gICAgICB9KSk7XG4gICAgICB2YXIgciwgbjtcbiAgICB9KSwgZnVuY3Rpb24gKHQpIHtcbiAgICAgIGlmIChcIltvYmplY3QgT2JqZWN0XVwiICE9PSBNLmNhbGwodCkpIHJldHVybiAhMTtcbiAgICAgIHZhciBlID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHQpO1xuICAgICAgcmV0dXJuIG51bGwgPT09IGUgfHwgZSA9PT0gT2JqZWN0LnByb3RvdHlwZTtcbiAgICB9KHQuYm9keSkgJiYgKHQuYm9keSA9IEpTT04uc3RyaW5naWZ5KHQuYm9keSksIHQuaGVhZGVycyAmJiAodC5oZWFkZXJzW1wiQ29udGVudC1UeXBlXCJdID0gXCJhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLThcIikpLCB0O1xuICB9XG5cbiAgZnVuY3Rpb24gRih0KSB7XG4gICAgcmV0dXJuIHEodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBlLCByLCBuLCBvLCBpLCBhLCBzLCBjLCB1LCBsLCBoLCBmLCBwLCBkLCB2LCB5LCBnO1xuICAgICAgcmV0dXJuIFIodGhpcywgZnVuY3Rpb24gKG0pIHtcbiAgICAgICAgc3dpdGNoIChtLmxhYmVsKSB7XG4gICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgcmV0dXJuIGUgPSBCLmJhc2VVUkwsIHIgPSBCLmRlZmF1bHRzLCBuID0gQi5pbnRlcmNlcHRvcnMsIFs0LCBWKEIucG9seWZpbGxVcmwpXTtcblxuICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgIHJldHVybiBtLnNlbnQoKSwgKG8gPSBfVShfVSh7fSwgciksIHQpKS5oZWFkZXJzIHx8IChvLmhlYWRlcnMgPSBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICB2b2lkIDAgPT09IHQgJiYgKHQgPSBcIkdFVFwiKTtcbiAgICAgICAgICAgICAgdmFyIGUgPSBCLmhlYWRlcnNbdF0gfHwge307XG4gICAgICAgICAgICAgIHJldHVybiBfVShfVSh7fSwgQi5oZWFkZXJzLmNvbW1vbiksIGUpO1xuICAgICAgICAgICAgfShvLm1ldGhvZCkpLCBHKG8pLCBbNCwgbi5yZXF1ZXN0LnRyYXZlcnNlKG8sICEwKV07XG5cbiAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICBpZiAoKGkgPSBtLnNlbnQoKSkgaW5zdGFuY2VvZiBFcnJvcikgdGhyb3cgaTtcbiAgICAgICAgICAgIHJldHVybiBpLnVybCA9IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICAgICAgICAgIHJldHVybiAhdCB8fCBKLnRlc3QoZSkgPyBlIDogdC5yZXBsYWNlKC9cXC8rJC8sIFwiXCIpICsgXCIvXCIgKyBlLnJlcGxhY2UoL15cXC8rLywgXCJcIik7XG4gICAgICAgICAgICB9KGUsIGkudXJsKSwgYSA9IGkudXJsLCBzID0gaS50aW1lb3V0LCBjID0gaS5wYXJhbXMsIHUgPSBpLm1ldGhvZCwgbCA9IFtcIkdFVFwiLCBcIkRFTEVURVwiLCBcIk9QVElPTlNcIiwgXCJIRUFEXCJdLmluY2x1ZGVzKHZvaWQgMCA9PT0gdSA/IFwiR0VUXCIgOiB1KSAmJiAhIWMsIGggPSBsID8gVCh7XG4gICAgICAgICAgICAgIHVybDogYSxcbiAgICAgICAgICAgICAgcXVlcnk6IGNcbiAgICAgICAgICAgIH0pIDogYSwgZiA9IFtdLCBzICYmICFpLnNpZ25hbCAmJiAodiA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgIHAgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0KG5ldyBFcnJvcihcInRpbWVvdXRcIikpO1xuICAgICAgICAgICAgICB9LCBzKTtcbiAgICAgICAgICAgIH0pLCBmLnB1c2godiksIGQgPSBuZXcgQWJvcnRDb250cm9sbGVyKCksIGkuc2lnbmFsID0gZC5zaWduYWwpLCBmLnB1c2goZmV0Y2goaCwgaSkuY2F0Y2goZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgICAgICB9KSksIFs0LCBQcm9taXNlLnJhY2UoZildO1xuXG4gICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgcmV0dXJuIHkgPSBtLnNlbnQoKSwgcCAmJiBjbGVhclRpbWVvdXQocCksIFs0LCBuLnJlc3BvbnNlLnRyYXZlcnNlKHkpXTtcblxuICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgIGlmICgoZyA9IG0uc2VudCgpKSBpbnN0YW5jZW9mIEVycm9yKSB0aHJvdyBudWxsID09IGQgfHwgZC5hYm9ydCgpLCBnO1xuICAgICAgICAgICAgcmV0dXJuIFsyLCBnXTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICB2YXIgUSA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiB0KHQpIHtcbiAgICAgIEIuaW50ZXJjZXB0b3JzLnJlcXVlc3QudXNlKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgIHZhciBuID0gci51cmwsXG4gICAgICAgICAgICBvID0gci5tZXRob2QsXG4gICAgICAgICAgICBpID0gci5ib2R5LFxuICAgICAgICAgICAgYSA9IGk7XG5cbiAgICAgICAgaWYgKHQub25SZXBvcnRCZWZvcmVTZW5kKSB7XG4gICAgICAgICAgdmFyIHMgPSB0Lm9uUmVwb3J0QmVmb3JlU2VuZCh7XG4gICAgICAgICAgICB1cmw6IG4sXG4gICAgICAgICAgICBtZXRob2Q6IG8sXG4gICAgICAgICAgICBkYXRhOiBpID8gSlNPTi5wYXJzZShpKSA6IG51bGxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBhID0gKG51bGwgPT0gcyA/IHZvaWQgMCA6IHMuZGF0YSkgPyBKU09OLnN0cmluZ2lmeShzLmRhdGEpIDogbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChcIkdFVFwiICE9PSBvICYmICFhKSB0aHJvdyBuZXcgRXJyb3IoXCJObyBkYXRhIGZvciBzZGssIGNhbmNlbC5cIik7XG4gICAgICAgIHJldHVybiBfZShfZSh7fSwgciksIHtcbiAgICAgICAgICBib2R5OiBhXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHQucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uICh0LCBvKSB7XG4gICAgICByZXR1cm4gcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgciwgaTtcbiAgICAgICAgcmV0dXJuIG4odGhpcywgZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgICBzd2l0Y2ggKG4ubGFiZWwpIHtcbiAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgcmV0dXJuIFs0LCBGKF9lKHtcbiAgICAgICAgICAgICAgICB1cmw6IHRcbiAgICAgICAgICAgICAgfSwgbykpXTtcblxuICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICByZXR1cm4gWzQsIChyID0gbi5zZW50KCkpLmpzb24oKV07XG5cbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgcmV0dXJuIGkgPSBuLnNlbnQoKSwgWzIsIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgZGF0YTogaSxcbiAgICAgICAgICAgICAgICBzdGF0dXM6IHIuc3RhdHVzLFxuICAgICAgICAgICAgICAgIHN0YXR1c1RleHQ6IHIuc3RhdHVzVGV4dCxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiByLmhlYWRlcnNcbiAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LCB0LnByb3RvdHlwZS5wb3N0ID0gZnVuY3Rpb24gKHQsIG8sIGkpIHtcbiAgICAgIHJldHVybiByKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciByLCBhO1xuICAgICAgICByZXR1cm4gbih0aGlzLCBmdW5jdGlvbiAobikge1xuICAgICAgICAgIHN3aXRjaCAobi5sYWJlbCkge1xuICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICByZXR1cm4gWzQsIEYoX2Uoe1xuICAgICAgICAgICAgICAgIHVybDogdCxcbiAgICAgICAgICAgICAgICBib2R5OiBvLFxuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCJcbiAgICAgICAgICAgICAgfSwgaSkpXTtcblxuICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICByZXR1cm4gWzQsIChyID0gbi5zZW50KCkpLmpzb24oKV07XG5cbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgcmV0dXJuIGEgPSBuLnNlbnQoKSwgWzIsIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgZGF0YTogYSxcbiAgICAgICAgICAgICAgICBzdGF0dXM6IHIuc3RhdHVzLFxuICAgICAgICAgICAgICAgIHN0YXR1c1RleHQ6IHIuc3RhdHVzVGV4dCxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiByLmhlYWRlcnNcbiAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LCB0O1xuICB9KCksXG4gICAgICBLID0gZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIHQodCkge1xuICAgICAgdGhpcy5hcHBrZXkgPSB0O1xuICAgIH1cblxuICAgIHJldHVybiB0LnByb3RvdHlwZS5nZXRJdGVtID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5nZXRTdG9yZUtleSh0KSk7XG4gICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgfVxuICAgIH0sIHQucHJvdG90eXBlLnJlbW92ZUl0ZW0gPSBmdW5jdGlvbiAodCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKHRoaXMuZ2V0U3RvcmVLZXkodCkpO1xuICAgICAgfSBjYXRjaCAodCkge31cbiAgICB9LCB0LnByb3RvdHlwZS5zZXRJdGVtID0gZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLmdldFN0b3JlS2V5KHQpLCBlKTtcbiAgICAgIH0gY2F0Y2ggKHQpIHt9XG4gICAgfSwgdC5wcm90b3R5cGUuc2V0U2Vzc2lvbkl0ZW0gPSBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgd2luZG93LnNlc3Npb25TdG9yYWdlLnNldEl0ZW0odGhpcy5nZXRTdG9yZUtleSh0KSwgZSk7XG4gICAgICB9IGNhdGNoICh0KSB7fVxuICAgIH0sIHQucHJvdG90eXBlLmdldFNlc3Npb25JdGVtID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSh0aGlzLmdldFN0b3JlS2V5KHQpKTtcbiAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICB9XG4gICAgfSwgdC5wcm90b3R5cGUuZ2V0U3RvcmVLZXkgPSBmdW5jdGlvbiAodCkge1xuICAgICAgcmV0dXJuIG8gKyB0aGlzLmFwcGtleSArIFwiX1wiICsgdDtcbiAgICB9LCB0LnByb3RvdHlwZS5jcmVhdGVEZXZpY2VJZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciB0ID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKGkpO1xuICAgICAgICByZXR1cm4gdCB8fCAodCA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgZm9yICh2YXIgZSA9IFwiQUJDREVGR0hKS01OUFFSU1RXWFlaYWJjZGVmaGlqa21ucHJzdHd4eXowMTIzNDU2Nzg5XCIsIHIgPSBcIlwiLCBuID0gMDsgbiA8IHQ7IG4rKykge1xuICAgICAgICAgICAgciArPSBlLmNoYXJBdChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBlLmxlbmd0aCkpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiByO1xuICAgICAgICB9KDMyKSwgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKGksIHQpKSwgdDtcbiAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICB9XG4gICAgfSwgdC5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0cnkge1xuICAgICAgICBmb3IgKHZhciB0ID0gd2luZG93LmxvY2FsU3RvcmFnZS5sZW5ndGgsIGUgPSAwOyBlIDwgdDsgZSsrKSB7XG4gICAgICAgICAgdmFyIHIgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmtleShlKTtcbiAgICAgICAgICAobnVsbCA9PSByID8gdm9pZCAwIDogci5zdWJzdHIoMCwgOSkpID09IG8gJiYgd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKHIpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoICh0KSB7fVxuICAgIH0sIHQucHJvdG90eXBlLmdldFN0b3JlQ291bnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgdCA9IDA7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIHQgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmxlbmd0aDtcbiAgICAgIH0gY2F0Y2ggKHQpIHt9XG5cbiAgICAgIHJldHVybiB0O1xuICAgIH0sIHQ7XG4gIH0oKTtcblxuICBcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBnbG9iYWxUaGlzID8gZ2xvYmFsVGhpcyA6IFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIHdpbmRvdyA/IHdpbmRvdyA6IFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIGdsb2JhbCA/IGdsb2JhbCA6IFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIHNlbGYgJiYgc2VsZjtcblxuICB2YXIgVyA9IGZ1bmN0aW9uICh0KSB7XG4gICAgdmFyIGUgPSB7XG4gICAgICBleHBvcnRzOiB7fVxuICAgIH07XG4gICAgcmV0dXJuIHQoZSwgZS5leHBvcnRzKSwgZS5leHBvcnRzO1xuICB9KGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgZnVuY3Rpb24gdCh0LCBlLCByLCBuLCBvLCBpLCBhKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdmFyIHMgPSB0W2ldKGEpLFxuICAgICAgICAgICAgICBjID0gcy52YWx1ZTtcbiAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgIHJldHVybiB2b2lkIHIodCk7XG4gICAgICAgIH1cblxuICAgICAgICBzLmRvbmUgPyBlKGMpIDogUHJvbWlzZS5yZXNvbHZlKGMpLnRoZW4obiwgbyk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGUodCwgZSkge1xuICAgICAgICBmb3IgKHZhciByID0gMDsgciA8IGUubGVuZ3RoOyByKyspIHtcbiAgICAgICAgICB2YXIgbiA9IGVbcl07XG4gICAgICAgICAgbi5lbnVtZXJhYmxlID0gbi5lbnVtZXJhYmxlIHx8ICExLCBuLmNvbmZpZ3VyYWJsZSA9ICEwLCBcInZhbHVlXCIgaW4gbiAmJiAobi53cml0YWJsZSA9ICEwKSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIG4ua2V5LCBuKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB2YXIgcixcbiAgICAgICAgICBuID0gKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIHQgPSBmdW5jdGlvbiAodCkge1xuICAgICAgICAgIHZhciBlLFxuICAgICAgICAgICAgICByID0gT2JqZWN0LnByb3RvdHlwZSxcbiAgICAgICAgICAgICAgbiA9IHIuaGFzT3duUHJvcGVydHksXG4gICAgICAgICAgICAgIG8gPSBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIFN5bWJvbCA/IFN5bWJvbCA6IHt9LFxuICAgICAgICAgICAgICBpID0gby5pdGVyYXRvciB8fCBcIkBAaXRlcmF0b3JcIixcbiAgICAgICAgICAgICAgYSA9IG8uYXN5bmNJdGVyYXRvciB8fCBcIkBAYXN5bmNJdGVyYXRvclwiLFxuICAgICAgICAgICAgICBzID0gby50b1N0cmluZ1RhZyB8fCBcIkBAdG9TdHJpbmdUYWdcIjtcblxuICAgICAgICAgIGZ1bmN0aW9uIGModCwgZSwgcikge1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCBlLCB7XG4gICAgICAgICAgICAgIHZhbHVlOiByLFxuICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMCxcbiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMCxcbiAgICAgICAgICAgICAgd3JpdGFibGU6ICEwXG4gICAgICAgICAgICB9KSwgdFtlXTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgYyh7fSwgXCJcIik7XG4gICAgICAgICAgfSBjYXRjaCAocikge1xuICAgICAgICAgICAgYyA9IGZ1bmN0aW9uIGModCwgZSwgcikge1xuICAgICAgICAgICAgICByZXR1cm4gdFtlXSA9IHI7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGZ1bmN0aW9uIHUodCwgciwgbiwgbykge1xuICAgICAgICAgICAgdmFyIGksIGEsIHMsIGM7XG4gICAgICAgICAgICByZXR1cm4gciA9IHIgJiYgci5wcm90b3R5cGUgaW5zdGFuY2VvZiB5ID8gciA6IHksIHIgPSBPYmplY3QuY3JlYXRlKHIucHJvdG90eXBlKSwgbyA9IG5ldyBrKG8gfHwgW10pLCByLl9pbnZva2UgPSAoaSA9IHQsIGEgPSBuLCBzID0gbywgYyA9IGgsIGZ1bmN0aW9uICh0LCByKSB7XG4gICAgICAgICAgICAgIGlmIChjID09PSBwKSB0aHJvdyBuZXcgRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBydW5uaW5nXCIpO1xuXG4gICAgICAgICAgICAgIGlmIChjID09PSBkKSB7XG4gICAgICAgICAgICAgICAgaWYgKFwidGhyb3dcIiA9PT0gdCkgdGhyb3cgcjtcbiAgICAgICAgICAgICAgICByZXR1cm4gQygpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgZm9yIChzLm1ldGhvZCA9IHQsIHMuYXJnID0gcjs7KSB7XG4gICAgICAgICAgICAgICAgdmFyIG4gPSBzLmRlbGVnYXRlO1xuXG4gICAgICAgICAgICAgICAgaWYgKG4pIHtcbiAgICAgICAgICAgICAgICAgIHZhciBvID0gZnVuY3Rpb24gdChyLCBuKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICgobyA9IHIuaXRlcmF0b3Jbbi5tZXRob2RdKSA9PT0gZSkge1xuICAgICAgICAgICAgICAgICAgICAgIGlmIChuLmRlbGVnYXRlID0gbnVsbCwgXCJ0aHJvd1wiID09PSBuLm1ldGhvZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHIuaXRlcmF0b3IucmV0dXJuICYmIChuLm1ldGhvZCA9IFwicmV0dXJuXCIsIG4uYXJnID0gZSwgdChyLCBuKSwgXCJ0aHJvd1wiID09PSBuLm1ldGhvZCkpIHJldHVybiB2O1xuICAgICAgICAgICAgICAgICAgICAgICAgbi5tZXRob2QgPSBcInRocm93XCIsIG4uYXJnID0gbmV3IFR5cGVFcnJvcihcIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJ3Rocm93JyBtZXRob2RcIik7XG4gICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHY7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJ0aHJvd1wiID09PSAobyA9IGwobywgci5pdGVyYXRvciwgbi5hcmcpKS50eXBlID8gKG4ubWV0aG9kID0gXCJ0aHJvd1wiLCBuLmFyZyA9IG8uYXJnLCBuLmRlbGVnYXRlID0gbnVsbCwgdikgOiAobyA9IG8uYXJnKSA/IG8uZG9uZSA/IChuW3IucmVzdWx0TmFtZV0gPSBvLnZhbHVlLCBuLm5leHQgPSByLm5leHRMb2MsIFwicmV0dXJuXCIgIT09IG4ubWV0aG9kICYmIChuLm1ldGhvZCA9IFwibmV4dFwiLCBuLmFyZyA9IGUpLCBuLmRlbGVnYXRlID0gbnVsbCwgdikgOiBvIDogKG4ubWV0aG9kID0gXCJ0aHJvd1wiLCBuLmFyZyA9IG5ldyBUeXBlRXJyb3IoXCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdFwiKSwgbi5kZWxlZ2F0ZSA9IG51bGwsIHYpO1xuICAgICAgICAgICAgICAgICAgfShuLCBzKTtcblxuICAgICAgICAgICAgICAgICAgaWYgKG8pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG8gPT09IHYpIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbztcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoXCJuZXh0XCIgPT09IHMubWV0aG9kKSBzLnNlbnQgPSBzLl9zZW50ID0gcy5hcmc7ZWxzZSBpZiAoXCJ0aHJvd1wiID09PSBzLm1ldGhvZCkge1xuICAgICAgICAgICAgICAgICAgaWYgKGMgPT09IGgpIHRocm93IGMgPSBkLCBzLmFyZztcbiAgICAgICAgICAgICAgICAgIHMuZGlzcGF0Y2hFeGNlcHRpb24ocy5hcmcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBcInJldHVyblwiID09PSBzLm1ldGhvZCAmJiBzLmFicnVwdChcInJldHVyblwiLCBzLmFyZyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoYyA9IHAsIFwibm9ybWFsXCIgPT09IChvID0gbChpLCBhLCBzKSkudHlwZSkge1xuICAgICAgICAgICAgICAgICAgaWYgKGMgPSBzLmRvbmUgPyBkIDogZiwgby5hcmcgIT09IHYpIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBvLmFyZyxcbiAgICAgICAgICAgICAgICAgICAgZG9uZTogcy5kb25lXG4gICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSBcInRocm93XCIgPT09IG8udHlwZSAmJiAoYyA9IGQsIHMubWV0aG9kID0gXCJ0aHJvd1wiLCBzLmFyZyA9IG8uYXJnKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSksIHI7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZnVuY3Rpb24gbCh0LCBlLCByKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwibm9ybWFsXCIsXG4gICAgICAgICAgICAgICAgYXJnOiB0LmNhbGwoZSwgcilcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcInRocm93XCIsXG4gICAgICAgICAgICAgICAgYXJnOiB0XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdC53cmFwID0gdTtcbiAgICAgICAgICB2YXIgaCA9IFwic3VzcGVuZGVkU3RhcnRcIixcbiAgICAgICAgICAgICAgZiA9IFwic3VzcGVuZGVkWWllbGRcIixcbiAgICAgICAgICAgICAgcCA9IFwiZXhlY3V0aW5nXCIsXG4gICAgICAgICAgICAgIGQgPSBcImNvbXBsZXRlZFwiLFxuICAgICAgICAgICAgICB2ID0ge307XG5cbiAgICAgICAgICBmdW5jdGlvbiB5KCkge31cblxuICAgICAgICAgIGZ1bmN0aW9uIGcoKSB7fVxuXG4gICAgICAgICAgZnVuY3Rpb24gbSgpIHt9XG5cbiAgICAgICAgICB2YXIgdyA9IHt9O1xuICAgICAgICAgIHdbaV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICB9LCAobyA9IChvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKSAmJiBvKG8oeChbXSkpKSkgJiYgbyAhPT0gciAmJiBuLmNhbGwobywgaSkgJiYgKHcgPSBvKTtcbiAgICAgICAgICB2YXIgYiA9IG0ucHJvdG90eXBlID0geS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHcpO1xuXG4gICAgICAgICAgZnVuY3Rpb24gUyh0KSB7XG4gICAgICAgICAgICBbXCJuZXh0XCIsIFwidGhyb3dcIiwgXCJyZXR1cm5cIl0uZm9yRWFjaChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICBjKHQsIGUsIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ludm9rZShlLCB0KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBmdW5jdGlvbiBFKHQsIGUpIHtcbiAgICAgICAgICAgIHZhciByO1xuXG4gICAgICAgICAgICB0aGlzLl9pbnZva2UgPSBmdW5jdGlvbiAobywgaSkge1xuICAgICAgICAgICAgICBmdW5jdGlvbiBhKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgZShmdW5jdGlvbiAociwgYSkge1xuICAgICAgICAgICAgICAgICAgIWZ1bmN0aW9uIHIobywgaSwgYSwgcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoXCJ0aHJvd1wiICE9PSAobyA9IGwodFtvXSwgdCwgaSkpLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IG8uYXJnO1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoaSA9IGMudmFsdWUpICYmIFwib2JqZWN0XCIgPT0gX3R5cGVvZihpKSAmJiBuLmNhbGwoaSwgXCJfX2F3YWl0XCIpID8gZS5yZXNvbHZlKGkuX19hd2FpdCkudGhlbihmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcihcIm5leHRcIiwgdCwgYSwgcyk7XG4gICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHIoXCJ0aHJvd1wiLCB0LCBhLCBzKTtcbiAgICAgICAgICAgICAgICAgICAgICB9KSA6IGUucmVzb2x2ZShpKS50aGVuKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjLnZhbHVlID0gdCwgYShjKTtcbiAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIoXCJ0aHJvd1wiLCB0LCBhLCBzKTtcbiAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHMoby5hcmcpO1xuICAgICAgICAgICAgICAgICAgfShvLCBpLCByLCBhKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJldHVybiByID0gciA/IHIudGhlbihhLCBhKSA6IGEoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZnVuY3Rpb24gSSh0KSB7XG4gICAgICAgICAgICB2YXIgZSA9IHtcbiAgICAgICAgICAgICAgdHJ5TG9jOiB0WzBdXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgMSBpbiB0ICYmIChlLmNhdGNoTG9jID0gdFsxXSksIDIgaW4gdCAmJiAoZS5maW5hbGx5TG9jID0gdFsyXSwgZS5hZnRlckxvYyA9IHRbM10pLCB0aGlzLnRyeUVudHJpZXMucHVzaChlKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBmdW5jdGlvbiBPKHQpIHtcbiAgICAgICAgICAgIHZhciBlID0gdC5jb21wbGV0aW9uIHx8IHt9O1xuICAgICAgICAgICAgZS50eXBlID0gXCJub3JtYWxcIiwgZGVsZXRlIGUuYXJnLCB0LmNvbXBsZXRpb24gPSBlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGZ1bmN0aW9uIGsodCkge1xuICAgICAgICAgICAgdGhpcy50cnlFbnRyaWVzID0gW3tcbiAgICAgICAgICAgICAgdHJ5TG9jOiBcInJvb3RcIlxuICAgICAgICAgICAgfV0sIHQuZm9yRWFjaChJLCB0aGlzKSwgdGhpcy5yZXNldCghMCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZnVuY3Rpb24geCh0KSB7XG4gICAgICAgICAgICBpZiAodCkge1xuICAgICAgICAgICAgICBpZiAociA9IHRbaV0pIHJldHVybiByLmNhbGwodCk7XG4gICAgICAgICAgICAgIGlmIChcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIHQubmV4dCkgcmV0dXJuIHQ7XG5cbiAgICAgICAgICAgICAgaWYgKCFpc05hTih0Lmxlbmd0aCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgcixcbiAgICAgICAgICAgICAgICAgICAgbyA9IC0xO1xuICAgICAgICAgICAgICAgIHJldHVybiAociA9IGZ1bmN0aW9uIHIoKSB7XG4gICAgICAgICAgICAgICAgICBmb3IgKDsgKytvIDwgdC5sZW5ndGg7KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuLmNhbGwodCwgbykpIHJldHVybiByLnZhbHVlID0gdFtvXSwgci5kb25lID0gITEsIHI7XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIHJldHVybiByLnZhbHVlID0gZSwgci5kb25lID0gITAsIHI7XG4gICAgICAgICAgICAgICAgfSkubmV4dCA9IHI7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgbmV4dDogQ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBmdW5jdGlvbiBDKCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgdmFsdWU6IGUsXG4gICAgICAgICAgICAgIGRvbmU6ICEwXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiAoKGcucHJvdG90eXBlID0gYi5jb25zdHJ1Y3RvciA9IG0pLmNvbnN0cnVjdG9yID0gZykuZGlzcGxheU5hbWUgPSBjKG0sIHMsIFwiR2VuZXJhdG9yRnVuY3Rpb25cIiksIHQuaXNHZW5lcmF0b3JGdW5jdGlvbiA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICByZXR1cm4gISEodCA9IFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgdCAmJiB0LmNvbnN0cnVjdG9yKSAmJiAodCA9PT0gZyB8fCBcIkdlbmVyYXRvckZ1bmN0aW9uXCIgPT09ICh0LmRpc3BsYXlOYW1lIHx8IHQubmFtZSkpO1xuICAgICAgICAgIH0sIHQubWFyayA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHQsIG0pIDogKHQuX19wcm90b19fID0gbSwgYyh0LCBzLCBcIkdlbmVyYXRvckZ1bmN0aW9uXCIpKSwgdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKGIpLCB0O1xuICAgICAgICAgIH0sIHQuYXdyYXAgPSBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgX19hd2FpdDogdFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9LCBTKEUucHJvdG90eXBlKSwgRS5wcm90b3R5cGVbYV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICB9LCB0LkFzeW5jSXRlcmF0b3IgPSBFLCB0LmFzeW5jID0gZnVuY3Rpb24gKGUsIHIsIG4sIG8sIGkpIHtcbiAgICAgICAgICAgIHZvaWQgMCA9PT0gaSAmJiAoaSA9IFByb21pc2UpO1xuICAgICAgICAgICAgdmFyIGEgPSBuZXcgRSh1KGUsIHIsIG4sIG8pLCBpKTtcbiAgICAgICAgICAgIHJldHVybiB0LmlzR2VuZXJhdG9yRnVuY3Rpb24ocikgPyBhIDogYS5uZXh0KCkudGhlbihmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICByZXR1cm4gdC5kb25lID8gdC52YWx1ZSA6IGEubmV4dCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSwgUyhiKSwgYyhiLCBzLCBcIkdlbmVyYXRvclwiKSwgYltpXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgIH0sIGIudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gXCJbb2JqZWN0IEdlbmVyYXRvcl1cIjtcbiAgICAgICAgICB9LCB0LmtleXMgPSBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgdmFyIGUsXG4gICAgICAgICAgICAgICAgciA9IFtdO1xuXG4gICAgICAgICAgICBmb3IgKGUgaW4gdCkge1xuICAgICAgICAgICAgICByLnB1c2goZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByLnJldmVyc2UoKSwgZnVuY3Rpb24gZSgpIHtcbiAgICAgICAgICAgICAgZm9yICg7IHIubGVuZ3RoOykge1xuICAgICAgICAgICAgICAgIHZhciBuID0gci5wb3AoKTtcbiAgICAgICAgICAgICAgICBpZiAobiBpbiB0KSByZXR1cm4gZS52YWx1ZSA9IG4sIGUuZG9uZSA9ICExLCBlO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgcmV0dXJuIGUuZG9uZSA9ICEwLCBlO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9LCB0LnZhbHVlcyA9IHgsIGsucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgY29uc3RydWN0b3I6IGssXG4gICAgICAgICAgICByZXNldDogZnVuY3Rpb24gcmVzZXQodCkge1xuICAgICAgICAgICAgICBpZiAodGhpcy5wcmV2ID0gMCwgdGhpcy5uZXh0ID0gMCwgdGhpcy5zZW50ID0gdGhpcy5fc2VudCA9IGUsIHRoaXMuZG9uZSA9ICExLCB0aGlzLmRlbGVnYXRlID0gbnVsbCwgdGhpcy5tZXRob2QgPSBcIm5leHRcIiwgdGhpcy5hcmcgPSBlLCB0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChPKSwgIXQpIGZvciAodmFyIHIgaW4gdGhpcykge1xuICAgICAgICAgICAgICAgIFwidFwiID09PSByLmNoYXJBdCgwKSAmJiBuLmNhbGwodGhpcywgcikgJiYgIWlzTmFOKCtyLnNsaWNlKDEpKSAmJiAodGhpc1tyXSA9IGUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHtcbiAgICAgICAgICAgICAgdGhpcy5kb25lID0gITA7XG4gICAgICAgICAgICAgIHZhciB0ID0gdGhpcy50cnlFbnRyaWVzWzBdLmNvbXBsZXRpb247XG4gICAgICAgICAgICAgIGlmIChcInRocm93XCIgPT09IHQudHlwZSkgdGhyb3cgdC5hcmc7XG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLnJ2YWw7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGlzcGF0Y2hFeGNlcHRpb246IGZ1bmN0aW9uIGRpc3BhdGNoRXhjZXB0aW9uKHQpIHtcbiAgICAgICAgICAgICAgaWYgKHRoaXMuZG9uZSkgdGhyb3cgdDtcbiAgICAgICAgICAgICAgdmFyIHIgPSB0aGlzO1xuXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIG8obiwgbykge1xuICAgICAgICAgICAgICAgIHJldHVybiBzLnR5cGUgPSBcInRocm93XCIsIHMuYXJnID0gdCwgci5uZXh0ID0gbiwgbyAmJiAoci5tZXRob2QgPSBcIm5leHRcIiwgci5hcmcgPSBlKSwgISFvO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyAwIDw9IGk7IC0taSkge1xuICAgICAgICAgICAgICAgIHZhciBhID0gdGhpcy50cnlFbnRyaWVzW2ldLFxuICAgICAgICAgICAgICAgICAgICBzID0gYS5jb21wbGV0aW9uO1xuICAgICAgICAgICAgICAgIGlmIChcInJvb3RcIiA9PT0gYS50cnlMb2MpIHJldHVybiBvKFwiZW5kXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGEudHJ5TG9jIDw9IHRoaXMucHJldikge1xuICAgICAgICAgICAgICAgICAgdmFyIGMgPSBuLmNhbGwoYSwgXCJjYXRjaExvY1wiKSxcbiAgICAgICAgICAgICAgICAgICAgICB1ID0gbi5jYWxsKGEsIFwiZmluYWxseUxvY1wiKTtcblxuICAgICAgICAgICAgICAgICAgaWYgKGMgJiYgdSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgYS5jYXRjaExvYykgcmV0dXJuIG8oYS5jYXRjaExvYywgITApO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgYS5maW5hbGx5TG9jKSByZXR1cm4gbyhhLmZpbmFsbHlMb2MpO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBhLmNhdGNoTG9jKSByZXR1cm4gbyhhLmNhdGNoTG9jLCAhMCk7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXUpIHRocm93IG5ldyBFcnJvcihcInRyeSBzdGF0ZW1lbnQgd2l0aG91dCBjYXRjaCBvciBmaW5hbGx5XCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgYS5maW5hbGx5TG9jKSByZXR1cm4gbyhhLmZpbmFsbHlMb2MpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFicnVwdDogZnVuY3Rpb24gYWJydXB0KHQsIGUpIHtcbiAgICAgICAgICAgICAgZm9yICh2YXIgciA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyAwIDw9IHI7IC0tcikge1xuICAgICAgICAgICAgICAgIHZhciBvID0gdGhpcy50cnlFbnRyaWVzW3JdO1xuXG4gICAgICAgICAgICAgICAgaWYgKG8udHJ5TG9jIDw9IHRoaXMucHJldiAmJiBuLmNhbGwobywgXCJmaW5hbGx5TG9jXCIpICYmIHRoaXMucHJldiA8IG8uZmluYWxseUxvYykge1xuICAgICAgICAgICAgICAgICAgdmFyIGkgPSBvO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgdmFyIGEgPSAoaSA9IGkgJiYgKFwiYnJlYWtcIiA9PT0gdCB8fCBcImNvbnRpbnVlXCIgPT09IHQpICYmIGkudHJ5TG9jIDw9IGUgJiYgZSA8PSBpLmZpbmFsbHlMb2MgPyBudWxsIDogaSkgPyBpLmNvbXBsZXRpb24gOiB7fTtcbiAgICAgICAgICAgICAgcmV0dXJuIGEudHlwZSA9IHQsIGEuYXJnID0gZSwgaSA/ICh0aGlzLm1ldGhvZCA9IFwibmV4dFwiLCB0aGlzLm5leHQgPSBpLmZpbmFsbHlMb2MsIHYpIDogdGhpcy5jb21wbGV0ZShhKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gY29tcGxldGUodCwgZSkge1xuICAgICAgICAgICAgICBpZiAoXCJ0aHJvd1wiID09PSB0LnR5cGUpIHRocm93IHQuYXJnO1xuICAgICAgICAgICAgICByZXR1cm4gXCJicmVha1wiID09PSB0LnR5cGUgfHwgXCJjb250aW51ZVwiID09PSB0LnR5cGUgPyB0aGlzLm5leHQgPSB0LmFyZyA6IFwicmV0dXJuXCIgPT09IHQudHlwZSA/ICh0aGlzLnJ2YWwgPSB0aGlzLmFyZyA9IHQuYXJnLCB0aGlzLm1ldGhvZCA9IFwicmV0dXJuXCIsIHRoaXMubmV4dCA9IFwiZW5kXCIpIDogXCJub3JtYWxcIiA9PT0gdC50eXBlICYmIGUgJiYgKHRoaXMubmV4dCA9IGUpLCB2O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZpbmlzaDogZnVuY3Rpb24gZmluaXNoKHQpIHtcbiAgICAgICAgICAgICAgZm9yICh2YXIgZSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyAwIDw9IGU7IC0tZSkge1xuICAgICAgICAgICAgICAgIHZhciByID0gdGhpcy50cnlFbnRyaWVzW2VdO1xuICAgICAgICAgICAgICAgIGlmIChyLmZpbmFsbHlMb2MgPT09IHQpIHJldHVybiB0aGlzLmNvbXBsZXRlKHIuY29tcGxldGlvbiwgci5hZnRlckxvYyksIE8ociksIHY7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjYXRjaDogZnVuY3Rpb24gX2NhdGNoKHQpIHtcbiAgICAgICAgICAgICAgZm9yICh2YXIgZSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyAwIDw9IGU7IC0tZSkge1xuICAgICAgICAgICAgICAgIHZhciByID0gdGhpcy50cnlFbnRyaWVzW2VdO1xuXG4gICAgICAgICAgICAgICAgaWYgKHIudHJ5TG9jID09PSB0KSB7XG4gICAgICAgICAgICAgICAgICB2YXIgbixcbiAgICAgICAgICAgICAgICAgICAgICBvID0gci5jb21wbGV0aW9uO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIFwidGhyb3dcIiA9PT0gby50eXBlICYmIChuID0gby5hcmcsIE8ocikpLCBuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZWxlZ2F0ZVlpZWxkOiBmdW5jdGlvbiBkZWxlZ2F0ZVlpZWxkKHQsIHIsIG4pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVsZWdhdGUgPSB7XG4gICAgICAgICAgICAgICAgaXRlcmF0b3I6IHgodCksXG4gICAgICAgICAgICAgICAgcmVzdWx0TmFtZTogcixcbiAgICAgICAgICAgICAgICBuZXh0TG9jOiBuXG4gICAgICAgICAgICAgIH0sIFwibmV4dFwiID09PSB0aGlzLm1ldGhvZCAmJiAodGhpcy5hcmcgPSBlKSwgdjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCB0O1xuICAgICAgICB9KHQuZXhwb3J0cyk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICByZWdlbmVyYXRvclJ1bnRpbWUgPSB0O1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgRnVuY3Rpb24oXCJyXCIsIFwicmVnZW5lcmF0b3JSdW50aW1lID0gclwiKSh0KTtcbiAgICAgICAgfVxuICAgICAgfShyID0ge1xuICAgICAgICBleHBvcnRzOiB7fVxuICAgICAgfSksIHIuZXhwb3J0cyk7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICBmdW5jdGlvbiByKHQpIHtcbiAgICAgICAgICAhZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgICAgICAgIGlmICghKHQgaW5zdGFuY2VvZiBlKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTtcbiAgICAgICAgICB9KHRoaXMsIHIpLCB0aGlzLnZlcnNpb24gPSBcIjEuMC4wXCI7XG4gICAgICAgICAgdmFyIGUgPSBBcnJheS5wcm90b3R5cGUubWFwLFxuICAgICAgICAgICAgICBuID0gQXJyYXkucHJvdG90eXBlLmZvckVhY2g7XG4gICAgICAgICAgdCAmJiAodGhpcy5oYXNoZXIgPSB0KSwgdGhpcy5lYWNoID0gZnVuY3Rpb24gKHQsIGUsIHIpIHtcbiAgICAgICAgICAgIGlmIChudWxsICE9IHQpIGlmIChuICYmIHQuZm9yRWFjaCA9PT0gbikgdC5mb3JFYWNoKGUsIHIpO2Vsc2UgaWYgKHQubGVuZ3RoID09PSArdC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgZm9yICh2YXIgbyA9IDAsIGkgPSB0Lmxlbmd0aDsgbyA8IGk7IG8rKykge1xuICAgICAgICAgICAgICAgIGlmIChlLmNhbGwociwgdFtvXSwgbywgdCkgPT09IHt9KSByZXR1cm47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBmb3IgKHZhciBhIGluIHQpIHtcbiAgICAgICAgICAgICAgaWYgKHQuaGFzT3duUHJvcGVydHkoYSkgJiYgZS5jYWxsKHIsIHRbYV0sIGEsIHQpID09PSB7fSkgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sIHRoaXMubWFwID0gZnVuY3Rpb24gKHQsIHIsIG4pIHtcbiAgICAgICAgICAgIHZhciBvID0gW107XG4gICAgICAgICAgICByZXR1cm4gbnVsbCA9PSB0ID8gbyA6IGUgJiYgdC5tYXAgPT09IGUgPyB0Lm1hcChyLCBuKSA6ICh0aGlzLmVhY2godCwgZnVuY3Rpb24gKHQsIGUsIGkpIHtcbiAgICAgICAgICAgICAgb1tvLmxlbmd0aF0gPSByLmNhbGwobiwgdCwgZSwgaSk7XG4gICAgICAgICAgICB9KSwgbyk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBvLCBpLCBhLCBzO1xuICAgICAgICByZXR1cm4gbyA9IHIsIChpID0gW3tcbiAgICAgICAgICBrZXk6IFwiZ2V0UWltZWkzNlwiLFxuICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSh0LCBlKSB7XG4gICAgICAgICAgICB2YXIgciA9IHRoaXM7XG4gICAgICAgICAgICB0aGlzLmdldEhpZCgpLnRoZW4oZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgICAgICAgdmFyIG8gPSBcIjNCSnJcIiArIHQuc3Vic3RyaW5nKDAsIDIpICsgKG4gJiYgbi5zdWJzdHJpbmcoMywgNykpLFxuICAgICAgICAgICAgICAgICAgaSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgICBpLm9wZW4oXCJQT1NUXCIsIFwiaHR0cHM6Ly9zbm93Zmxha2UucXEuY29tL29sYS9oNVwiLCAhMCksIGkuc2V0UmVxdWVzdEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIiksIGkub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChpLnJlYWR5U3RhdGUgPT0gWE1MSHR0cFJlcXVlc3QuRE9ORSAmJiAyMDAgPT0gaS5zdGF0dXMpIHRyeSB7XG4gICAgICAgICAgICAgICAgICBlICYmIGUoSlNPTi5wYXJzZShpLnJlc3BvbnNlVGV4dCkpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgICAgICAgIGUobnVsbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LCBpLnNlbmQoSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIGFwcEtleTogdCxcbiAgICAgICAgICAgICAgICBoaWQ6IG4sXG4gICAgICAgICAgICAgICAgc2lnbjogbyxcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiByLnZlcnNpb25cbiAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAga2V5OiBcImdldEhpZFwiLFxuICAgICAgICAgIHZhbHVlOiAoYSA9IG4ubWFyayhmdW5jdGlvbiB0KCkge1xuICAgICAgICAgICAgdmFyIGUsIHI7XG4gICAgICAgICAgICByZXR1cm4gbi53cmFwKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgIGZvciAoOzspIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHQucHJldiA9IHQubmV4dCkge1xuICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGUgPSBbXSkucHVzaCgobiA9IHZvaWQgMCwgKG4gPSBbTWF0aC5mbG9vcih3aW5kb3cuc2NyZWVuLndpZHRoICogd2luZG93LmRldmljZVBpeGVsUmF0aW8pLCBNYXRoLmZsb29yKHdpbmRvdy5zY3JlZW4uaGVpZ2h0ICogd2luZG93LmRldmljZVBpeGVsUmF0aW8pXSkuc29ydCgpLnJldmVyc2UoKSwgbi5qb2luKFwieFwiKSkpLCBlLnB1c2goKG4gPSB2b2lkIDAsIChuID0gW01hdGguZmxvb3Iod2luZG93LnNjcmVlbi5hdmFpbFdpZHRoICogd2luZG93LmRldmljZVBpeGVsUmF0aW8pLCBNYXRoLmZsb29yKHdpbmRvdy5zY3JlZW4uYXZhaWxIZWlnaHQgKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyldKS5zb3J0KCkucmV2ZXJzZSgpLCBuLmpvaW4oXCJ4XCIpKSksIGUucHVzaChuYXZpZ2F0b3IuZGV2aWNlTWVtb3J5KSwgZS5wdXNoKCEhd2luZG93LnNlc3Npb25TdG9yYWdlKSwgZS5wdXNoKCEhd2luZG93LmluZGV4ZWREQiksIGUucHVzaChuYXZpZ2F0b3IucHJvZHVjdFN1YiksIGUucHVzaChuYXZpZ2F0b3IuaGFyZHdhcmVDb25jdXJyZW5jeSksIGUucHVzaCh0aGlzLmdldFdlYmdsVmVuZG9yQW5kUmVuZGVyZXIoKSksIGUucHVzaChuZXcgRGF0ZSgpLmdldFRpbWV6b25lT2Zmc2V0KCkpLCB0Lm5leHQgPSAxMiwgdGhpcy5nZXRGYWN0b3IoKTtcblxuICAgICAgICAgICAgICAgICAgY2FzZSAxMjpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHIgPSB0LnNlbnQsIGUucHVzaChyKSwgdGhpcy5oYXNoZXIpIHJldHVybiB0LmFicnVwdChcInJldHVyblwiLCB0aGlzLmhhc2hlcihlLmpvaW4oXCIjIyNcIiksIDMxKSk7XG4gICAgICAgICAgICAgICAgICAgIHQubmV4dCA9IDE4O1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgY2FzZSAxODpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuYWJydXB0KFwicmV0dXJuXCIsIHRoaXMueDY0aGFzaDEyOChlLmpvaW4oXCIjIyNcIiksIDMxKSk7XG5cbiAgICAgICAgICAgICAgICAgIGNhc2UgMTk6XG4gICAgICAgICAgICAgICAgICBjYXNlIFwiZW5kXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0LnN0b3AoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICB2YXIgbjtcbiAgICAgICAgICAgIH0sIHQsIHRoaXMpO1xuICAgICAgICAgIH0pLCBzID0gZnVuY3Rpb24gcygpIHtcbiAgICAgICAgICAgIHZhciBlID0gdGhpcyxcbiAgICAgICAgICAgICAgICByID0gYXJndW1lbnRzO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChuLCBvKSB7XG4gICAgICAgICAgICAgIHZhciBpID0gYS5hcHBseShlLCByKTtcblxuICAgICAgICAgICAgICBmdW5jdGlvbiBzKGUpIHtcbiAgICAgICAgICAgICAgICB0KGksIG4sIG8sIHMsIGMsIFwibmV4dFwiLCBlKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGMoZSkge1xuICAgICAgICAgICAgICAgIHQoaSwgbiwgbywgcywgYywgXCJ0aHJvd1wiLCBlKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHModm9pZCAwKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgfSlcbiAgICAgICAgfSwge1xuICAgICAgICAgIGtleTogXCJnZXRVc2VyQWdlbnRcIixcbiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7XG4gICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLnVzZXJBZ2VudDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICBrZXk6IFwiZ2V0TmF0aXZlXCIsXG4gICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzO1xuICAgICAgICAgICAgdGhpcy5nZXRIaWQoKS50aGVuKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgIEpTSW50ZXJmYWNlLmNhbGxiYWNrKHQudmVyc2lvbiwgZSwgdC5nZXRVc2VyQWdlbnQoKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICBrZXk6IFwiZ2V0V2ViZ2xWZW5kb3JBbmRSZW5kZXJlclwiLFxuICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIHZhciB0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKSxcbiAgICAgICAgICAgICAgICAgICAgZSA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgZSA9IHQuZ2V0Q29udGV4dChcIndlYmdsXCIpIHx8IHQuZ2V0Q29udGV4dChcImV4cGVyaW1lbnRhbC13ZWJnbFwiKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoICh0KSB7fVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGUgfHwgbnVsbDtcbiAgICAgICAgICAgICAgfSgpLFxuICAgICAgICAgICAgICAgICAgZSA9IHQuZ2V0RXh0ZW5zaW9uKFwiV0VCR0xfZGVidWdfcmVuZGVyZXJfaW5mb1wiKSxcbiAgICAgICAgICAgICAgICAgIHIgPSBbdC5nZXRQYXJhbWV0ZXIoZS5VTk1BU0tFRF9WRU5ET1JfV0VCR0wpLCB0LmdldFBhcmFtZXRlcihlLlVOTUFTS0VEX1JFTkRFUkVSX1dFQkdMKV0uam9pbihcIn5cIiksXG4gICAgICAgICAgICAgICAgICBuID0gdC5nZXRFeHRlbnNpb24oXCJXRUJHTF9sb3NlX2NvbnRleHRcIik7XG5cbiAgICAgICAgICAgICAgcmV0dXJuIG51bGwgIT0gbiAmJiBuLmxvc2VDb250ZXh0KCksIHI7XG4gICAgICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgIGtleTogXCJnZXRGYWN0b3JcIixcbiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgICAgICAgICAgdmFyIHIgPSB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24gfHwgd2luZG93LndlYmtpdFJUQ1BlZXJDb25uZWN0aW9uIHx8IHdpbmRvdy5tb3pSVENQZWVyQ29ubmVjdGlvbjtcbiAgICAgICAgICAgICAgciA/IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZSA9IG5ldyByKHtcbiAgICAgICAgICAgICAgICAgIGljZVNlcnZlcnM6IFtdXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZS5jcmVhdGVEYXRhQ2hhbm5lbChcIlwiLCB7XG4gICAgICAgICAgICAgICAgICByZWxpYWJsZTogITFcbiAgICAgICAgICAgICAgICB9KSwgZS5vbmljZWNhbmRpZGF0ZSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgICAgICB0LmNhbmRpZGF0ZSAmJiBpKFwiYT1cIi5jb25jYXQodC5jYW5kaWRhdGUuY2FuZGlkYXRlKSk7XG4gICAgICAgICAgICAgICAgfSwgZS5jcmVhdGVPZmZlcihmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgaSh0LnNkcCksIGUuc2V0TG9jYWxEZXNjcmlwdGlvbih0KTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAodCkge30pO1xuICAgICAgICAgICAgICAgIHZhciBuID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG8oZSkge1xuICAgICAgICAgICAgICAgICAgaWYgKCEoZSBpbiBuKSkge1xuICAgICAgICAgICAgICAgICAgICBuW2VdID0gITA7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgciA9IE9iamVjdC5rZXlzKG4pLmZpbHRlcihmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuW3RdO1xuICAgICAgICAgICAgICAgICAgICB9KSwgbyA9IDA7IG8gPCByLmxlbmd0aDsgbysrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgMTYgPCByW29dLmxlbmd0aCAmJiAoci5zcGxpY2UobywgMSksIG8tLSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0KHJbMF0pO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGkodCkge1xuICAgICAgICAgICAgICAgICAgKDAgPCBhcmd1bWVudHMubGVuZ3RoICYmIHZvaWQgMCAhPT0gdCA/IHQgOiBcIlwiKS5zcGxpdChcIlxcclxcblwiKS5mb3JFYWNoKGZ1bmN0aW9uICh0LCBlLCByKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuLCBpO1xuICAgICAgICAgICAgICAgICAgICB+dC5pbmRleE9mKFwiYT1jYW5kaWRhdGVcIikgPyAoaSA9IChuID0gdC5zcGxpdChcIiBcIikpWzRdLCBcImhvc3RcIiA9PT0gbls3XSAmJiBvKGkpKSA6IH50LmluZGV4T2YoXCJjPVwiKSAmJiBvKHQuc3BsaXQoXCIgXCIpWzJdKTtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG5bXCIwLjAuMC4wXCJdID0gITE7XG4gICAgICAgICAgICAgIH0oKSA6IHQobnVsbCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICBrZXk6IFwieDY0aGFzaDEyOFwiLFxuICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSh0LCBlKSB7XG4gICAgICAgICAgICBmb3IgKHZhciByID0gZnVuY3Rpb24gcih0LCBlKSB7XG4gICAgICAgICAgICAgIHQgPSBbdFswXSA+Pj4gMTYsIDY1NTM1ICYgdFswXSwgdFsxXSA+Pj4gMTYsIDY1NTM1ICYgdFsxXV0sIGUgPSBbZVswXSA+Pj4gMTYsIDY1NTM1ICYgZVswXSwgZVsxXSA+Pj4gMTYsIDY1NTM1ICYgZVsxXV07XG4gICAgICAgICAgICAgIHZhciByID0gWzAsIDAsIDAsIDBdO1xuICAgICAgICAgICAgICByZXR1cm4gclszXSArPSB0WzNdICsgZVszXSwgclsyXSArPSByWzNdID4+PiAxNiwgclszXSAmPSA2NTUzNSwgclsyXSArPSB0WzJdICsgZVsyXSwgclsxXSArPSByWzJdID4+PiAxNiwgclsyXSAmPSA2NTUzNSwgclsxXSArPSB0WzFdICsgZVsxXSwgclswXSArPSByWzFdID4+PiAxNiwgclsxXSAmPSA2NTUzNSwgclswXSArPSB0WzBdICsgZVswXSwgclswXSAmPSA2NTUzNSwgW3JbMF0gPDwgMTYgfCByWzFdLCByWzJdIDw8IDE2IHwgclszXV07XG4gICAgICAgICAgICB9LCBuID0gZnVuY3Rpb24gbih0LCBlKSB7XG4gICAgICAgICAgICAgIHQgPSBbdFswXSA+Pj4gMTYsIDY1NTM1ICYgdFswXSwgdFsxXSA+Pj4gMTYsIDY1NTM1ICYgdFsxXV0sIGUgPSBbZVswXSA+Pj4gMTYsIDY1NTM1ICYgZVswXSwgZVsxXSA+Pj4gMTYsIDY1NTM1ICYgZVsxXV07XG4gICAgICAgICAgICAgIHZhciByID0gWzAsIDAsIDAsIDBdO1xuICAgICAgICAgICAgICByZXR1cm4gclszXSArPSB0WzNdICogZVszXSwgclsyXSArPSByWzNdID4+PiAxNiwgclszXSAmPSA2NTUzNSwgclsyXSArPSB0WzJdICogZVszXSwgclsxXSArPSByWzJdID4+PiAxNiwgclsyXSAmPSA2NTUzNSwgclsyXSArPSB0WzNdICogZVsyXSwgclsxXSArPSByWzJdID4+PiAxNiwgclsyXSAmPSA2NTUzNSwgclsxXSArPSB0WzFdICogZVszXSwgclswXSArPSByWzFdID4+PiAxNiwgclsxXSAmPSA2NTUzNSwgclsxXSArPSB0WzJdICogZVsyXSwgclswXSArPSByWzFdID4+PiAxNiwgclsxXSAmPSA2NTUzNSwgclsxXSArPSB0WzNdICogZVsxXSwgclswXSArPSByWzFdID4+PiAxNiwgclsxXSAmPSA2NTUzNSwgclswXSArPSB0WzBdICogZVszXSArIHRbMV0gKiBlWzJdICsgdFsyXSAqIGVbMV0gKyB0WzNdICogZVswXSwgclswXSAmPSA2NTUzNSwgW3JbMF0gPDwgMTYgfCByWzFdLCByWzJdIDw8IDE2IHwgclszXV07XG4gICAgICAgICAgICB9LCBvID0gZnVuY3Rpb24gbyh0LCBlKSB7XG4gICAgICAgICAgICAgIHJldHVybiAzMiA9PSAoZSAlPSA2NCkgPyBbdFsxXSwgdFswXV0gOiBlIDwgMzIgPyBbdFswXSA8PCBlIHwgdFsxXSA+Pj4gMzIgLSBlLCB0WzFdIDw8IGUgfCB0WzBdID4+PiAzMiAtIGVdIDogW3RbMV0gPDwgKGUgLT0gMzIpIHwgdFswXSA+Pj4gMzIgLSBlLCB0WzBdIDw8IGUgfCB0WzFdID4+PiAzMiAtIGVdO1xuICAgICAgICAgICAgfSwgaSA9IGZ1bmN0aW9uIGkodCwgZSkge1xuICAgICAgICAgICAgICByZXR1cm4gMCA9PSAoZSAlPSA2NCkgPyB0IDogZSA8IDMyID8gW3RbMF0gPDwgZSB8IHRbMV0gPj4+IDMyIC0gZSwgdFsxXSA8PCBlXSA6IFt0WzFdIDw8IGUgLSAzMiwgMF07XG4gICAgICAgICAgICB9LCBhID0gZnVuY3Rpb24gYSh0LCBlKSB7XG4gICAgICAgICAgICAgIHJldHVybiBbdFswXSBeIGVbMF0sIHRbMV0gXiBlWzFdXTtcbiAgICAgICAgICAgIH0sIHMgPSBmdW5jdGlvbiBzKHQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHQgPSBhKHQsIFswLCB0WzBdID4+PiAxXSksIHQgPSBuKHQsIFs0MjgzNTQzNTExLCAzOTgxODA2Nzk3XSksIHQgPSBhKHQsIFswLCB0WzBdID4+PiAxXSksIHQgPSBuKHQsIFszMzAxODgyMzY2LCA0NDQ5ODQ0MDNdKSwgYSh0LCBbMCwgdFswXSA+Pj4gMV0pO1xuICAgICAgICAgICAgfSwgYyA9ICh0ID0gdCB8fCBcIlwiKS5sZW5ndGggJSAxNiwgdSA9IHQubGVuZ3RoIC0gYywgbCA9IFswLCBlID0gZSB8fCAwXSwgaCA9IFswLCBlXSwgZiA9IFswLCAwXSwgcCA9IFswLCAwXSwgZCA9IFsyMjc3NzM1MzEzLCAyODk1NTk1MDldLCB2ID0gWzEyOTExNjkwOTEsIDY1ODg3MTE2N10sIHkgPSAwOyB5IDwgdTsgeSArPSAxNikge1xuICAgICAgICAgICAgICBmID0gWzI1NSAmIHQuY2hhckNvZGVBdCh5ICsgNCkgfCAoMjU1ICYgdC5jaGFyQ29kZUF0KHkgKyA1KSkgPDwgOCB8ICgyNTUgJiB0LmNoYXJDb2RlQXQoeSArIDYpKSA8PCAxNiB8ICgyNTUgJiB0LmNoYXJDb2RlQXQoeSArIDcpKSA8PCAyNCwgMjU1ICYgdC5jaGFyQ29kZUF0KHkpIHwgKDI1NSAmIHQuY2hhckNvZGVBdCh5ICsgMSkpIDw8IDggfCAoMjU1ICYgdC5jaGFyQ29kZUF0KHkgKyAyKSkgPDwgMTYgfCAoMjU1ICYgdC5jaGFyQ29kZUF0KHkgKyAzKSkgPDwgMjRdLCBwID0gWzI1NSAmIHQuY2hhckNvZGVBdCh5ICsgMTIpIHwgKDI1NSAmIHQuY2hhckNvZGVBdCh5ICsgMTMpKSA8PCA4IHwgKDI1NSAmIHQuY2hhckNvZGVBdCh5ICsgMTQpKSA8PCAxNiB8ICgyNTUgJiB0LmNoYXJDb2RlQXQoeSArIDE1KSkgPDwgMjQsIDI1NSAmIHQuY2hhckNvZGVBdCh5ICsgOCkgfCAoMjU1ICYgdC5jaGFyQ29kZUF0KHkgKyA5KSkgPDwgOCB8ICgyNTUgJiB0LmNoYXJDb2RlQXQoeSArIDEwKSkgPDwgMTYgfCAoMjU1ICYgdC5jaGFyQ29kZUF0KHkgKyAxMSkpIDw8IDI0XSwgZiA9IG8oZiA9IG4oZiwgZCksIDMxKSwgZiA9IG4oZiwgdiksIGwgPSByKGwgPSBvKGwgPSBhKGwsIGYpLCAyNyksIGgpLCBsID0gcihuKGwsIFswLCA1XSksIFswLCAxMzkwMjA4ODA5XSksIHAgPSBvKHAgPSBuKHAsIHYpLCAzMyksIHAgPSBuKHAsIGQpLCBoID0gcihoID0gbyhoID0gYShoLCBwKSwgMzEpLCBsKSwgaCA9IHIobihoLCBbMCwgNV0pLCBbMCwgOTQ0MzMxNDQ1XSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHN3aXRjaCAoZiA9IFswLCAwXSwgcCA9IFswLCAwXSwgYykge1xuICAgICAgICAgICAgICBjYXNlIDE1OlxuICAgICAgICAgICAgICAgIHAgPSBhKHAsIGkoWzAsIHQuY2hhckNvZGVBdCh5ICsgMTQpXSwgNDgpKTtcblxuICAgICAgICAgICAgICBjYXNlIDE0OlxuICAgICAgICAgICAgICAgIHAgPSBhKHAsIGkoWzAsIHQuY2hhckNvZGVBdCh5ICsgMTMpXSwgNDApKTtcblxuICAgICAgICAgICAgICBjYXNlIDEzOlxuICAgICAgICAgICAgICAgIHAgPSBhKHAsIGkoWzAsIHQuY2hhckNvZGVBdCh5ICsgMTIpXSwgMzIpKTtcblxuICAgICAgICAgICAgICBjYXNlIDEyOlxuICAgICAgICAgICAgICAgIHAgPSBhKHAsIGkoWzAsIHQuY2hhckNvZGVBdCh5ICsgMTEpXSwgMjQpKTtcblxuICAgICAgICAgICAgICBjYXNlIDExOlxuICAgICAgICAgICAgICAgIHAgPSBhKHAsIGkoWzAsIHQuY2hhckNvZGVBdCh5ICsgMTApXSwgMTYpKTtcblxuICAgICAgICAgICAgICBjYXNlIDEwOlxuICAgICAgICAgICAgICAgIHAgPSBhKHAsIGkoWzAsIHQuY2hhckNvZGVBdCh5ICsgOSldLCA4KSk7XG5cbiAgICAgICAgICAgICAgY2FzZSA5OlxuICAgICAgICAgICAgICAgIHAgPSBhKHAsIFswLCB0LmNoYXJDb2RlQXQoeSArIDgpXSksIHAgPSBvKHAgPSBuKHAsIHYpLCAzMyksIHAgPSBuKHAsIGQpLCBoID0gYShoLCBwKTtcblxuICAgICAgICAgICAgICBjYXNlIDg6XG4gICAgICAgICAgICAgICAgZiA9IGEoZiwgaShbMCwgdC5jaGFyQ29kZUF0KHkgKyA3KV0sIDU2KSk7XG5cbiAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgIGYgPSBhKGYsIGkoWzAsIHQuY2hhckNvZGVBdCh5ICsgNildLCA0OCkpO1xuXG4gICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICBmID0gYShmLCBpKFswLCB0LmNoYXJDb2RlQXQoeSArIDUpXSwgNDApKTtcblxuICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgZiA9IGEoZiwgaShbMCwgdC5jaGFyQ29kZUF0KHkgKyA0KV0sIDMyKSk7XG5cbiAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgIGYgPSBhKGYsIGkoWzAsIHQuY2hhckNvZGVBdCh5ICsgMyldLCAyNCkpO1xuXG4gICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICBmID0gYShmLCBpKFswLCB0LmNoYXJDb2RlQXQoeSArIDIpXSwgMTYpKTtcblxuICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgZiA9IGEoZiwgaShbMCwgdC5jaGFyQ29kZUF0KHkgKyAxKV0sIDgpKTtcblxuICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgZiA9IGEoZiwgW3QuY2hhckNvZGVBdCh5KV0pLCBmID0gbyhmID0gbihmLCBkKSwgMzEpLCBmID0gbihmLCB2KSwgbCA9IGEobCwgZik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBsID0gYShsLCBbMCwgdC5sZW5ndGhdKSwgaCA9IHIoaCA9IGEoaCwgWzAsIHQubGVuZ3RoXSksIGwgPSByKGwsIGgpKSwgbCA9IHMobCksIGggPSByKGggPSBzKGgpLCBsID0gcihsLCBoKSksIChcIjAwMDAwMDAwXCIgKyAobFswXSA+Pj4gMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtOCkgKyAoXCIwMDAwMDAwMFwiICsgKGxbMV0gPj4+IDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTgpICsgKFwiMDAwMDAwMDBcIiArIChoWzBdID4+PiAwKS50b1N0cmluZygxNikpLnNsaWNlKC04KSArIChcIjAwMDAwMDAwXCIgKyAoaFsxXSA+Pj4gMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtOCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XSkgJiYgZShvLnByb3RvdHlwZSwgaSksIHI7XG4gICAgICB9KCk7XG4gICAgfSgpO1xuICB9KSxcbiAgICAgIEggPSBcImxvZ2lkX3N0YXJ0XCIsXG4gICAgICB6ID0gXCI0LjUuNi13ZWJcIjtcblxuICByZXR1cm4gZnVuY3Rpb24gKHIpIHtcbiAgICBmdW5jdGlvbiBuKHQpIHtcbiAgICAgIHZhciBlID0gci5jYWxsKHRoaXMsIHQpIHx8IHRoaXM7XG4gICAgICBlLnFpbWVpMzYgPSBcIlwiLCBlLnVzZWxlc3NDeWNsZVRhc2tOdW0gPSAwLCBlLnVuZGVyV2Vha05ldCA9ICExLCBlLnNlbmQgPSBmdW5jdGlvbiAodCwgciwgbikge1xuICAgICAgICBlLnN0b3JhZ2Uuc2V0SXRlbShhLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpLCBlLm5ldHdvcmsucG9zdChlLnVwbG9hZFVybCB8fCBlLnN0cmF0ZWd5LmdldFVwbG9hZFVybCgpLCB0LmRhdGEpLnRoZW4oZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgICB2YXIgbztcbiAgICAgICAgICAxMDAgPT0gKG51bGwgPT09IChvID0gbnVsbCA9PSBuID8gdm9pZCAwIDogbi5kYXRhKSB8fCB2b2lkIDAgPT09IG8gPyB2b2lkIDAgOiBvLnJlc3VsdCkgPyBlLmRlbGF5VGltZSA9IDFlMyAqIG4uZGF0YS5kZWxheVRpbWUgOiBlLmRlbGF5VGltZSA9IDAsIHIgJiYgcih0LmRhdGEpLCB0LmRhdGEuZXZlbnRzLmZvckVhY2goZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIGUuc3RvcmUucmVtb3ZlRXZlbnQodCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGUucmVtb3ZlU2VuZGluZ0lkKHAodC5tYXBWYWx1ZSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSksIGUuZG9DdXN0b21DeWNsZVRhc2soKTtcbiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICB2YXIgbyA9IHQuZGF0YS5ldmVudHM7XG4gICAgICAgICAgZS5lcnJvclJlcG9ydC5yZXBvcnRFcnJvcihyLmNvZGUgPyByLmNvZGUudG9TdHJpbmcoKSA6IFwiNjAwXCIsIHIubWVzc2FnZSksIG4gJiYgbih0LmRhdGEpO1xuICAgICAgICAgIHZhciBpID0gSlNPTi5wYXJzZShlLnN0b3JhZ2UuZ2V0SXRlbShzKSk7XG4gICAgICAgICAgby5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICBpICYmIC0xICE9IGkuaW5kZXhPZihwKHQpKSAmJiBlLnN0b3JlLmluc2VydEV2ZW50KHQsIGZ1bmN0aW9uICh0LCByKSB7XG4gICAgICAgICAgICAgIHQgJiYgZS5lcnJvclJlcG9ydC5yZXBvcnRFcnJvcihcIjYwNFwiLCBcImluc2VydEV2ZW50IGZhaWwhXCIpO1xuICAgICAgICAgICAgfSksIGUucmVtb3ZlU2VuZGluZ0lkKHAodCkpO1xuICAgICAgICAgIH0pLCBlLm1vbml0b3JVcGxvYWRGYWlsZWQoKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIG4sXG4gICAgICAgICAgbyxcbiAgICAgICAgICBpID0gYigpO1xuICAgICAgcmV0dXJuIGUuaXNVbmRlcklFOCA9IGkgPiAwICYmIGkgPCA4LCBlLmlzVW5kZXJJRTggfHwgKGUuaXNVbmRlcklFID0gaSA+IDAsIHQubmVlZEluaXRRaW1laSAmJiBlLmluaXRRaW1laSh0LmFwcGtleSksIGUubmV0d29yayA9IG5ldyBRKHQpLCBlLnN0b3JhZ2UgPSBuZXcgSyh0LmFwcGtleSksIGUuaW5pdENvbW1vbkluZm8odCksIGUuc3RvcmUgPSBuZXcgXyh0LmFwcGtleSwgZS5zdG9yYWdlKSwgZS5lcnJvclJlcG9ydCA9IG5ldyB5KGUuY29uZmlnLCBlLmNvbW1vbkluZm8sIFwid2ViXCIsIGUubmV0d29yayksIGUuc3RyYXRlZ3kgPSBuZXcgZyhlLmNvbmZpZywgZS5jb21tb25JbmZvLCBlLnN0b3JhZ2UsIGUubmV0d29yayksIGUubG9naWRTdGFydFRpbWUgPSBlLnN0b3JhZ2UuZ2V0SXRlbShIKSwgZS5sb2dpZFN0YXJ0VGltZSB8fCAoZS5sb2dpZFN0YXJ0VGltZSA9IERhdGUubm93KCkudG9TdHJpbmcoKSwgZS5zdG9yYWdlLnNldEl0ZW0oSCwgZS5sb2dpZFN0YXJ0VGltZSkpLCBuID0gZS5sb2dpZFN0YXJ0VGltZSwgbyA9IERhdGUubm93KCkgLSBOdW1iZXIucGFyc2VGbG9hdChuKSwgTWF0aC5mbG9vcihvIC8gODY0ZTUpID49IDM2NSAmJiBlLnN0b3JhZ2UuY2xlYXIoKSwgZS5pbml0U2Vzc2lvbih0KSwgZS5vbkRpcmVjdFVzZXJBY3Rpb24oXCJycWRfanNfaW5pdFwiLCB7fSksIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZS5saWZlQ3ljbGUuZW1pdChcImluaXRcIik7XG4gICAgICB9LCAwKSwgZS5pbml0RGVsYXlUaW1lID0gdC5kZWxheSA/IHQuZGVsYXkgOiAxZTMsIGUuY3ljbGVUYXNrKGUuaW5pdERlbGF5VGltZSkpLCBlO1xuICAgIH1cblxuICAgIHJldHVybiBmdW5jdGlvbiAoZSwgcikge1xuICAgICAgaWYgKFwiZnVuY3Rpb25cIiAhPSB0eXBlb2YgciAmJiBudWxsICE9PSByKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhyKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XG5cbiAgICAgIGZ1bmN0aW9uIG4oKSB7XG4gICAgICAgIHRoaXMuY29uc3RydWN0b3IgPSBlO1xuICAgICAgfVxuXG4gICAgICBfdChlLCByKSwgZS5wcm90b3R5cGUgPSBudWxsID09PSByID8gT2JqZWN0LmNyZWF0ZShyKSA6IChuLnByb3RvdHlwZSA9IHIucHJvdG90eXBlLCBuZXcgbigpKTtcbiAgICB9KG4sIHIpLCBuLnByb3RvdHlwZS5pbml0UWltZWkgPSBmdW5jdGlvbiAodCkge1xuICAgICAgdmFyIGUgPSB0aGlzO1xuICAgICAgbmV3IFcoKS5nZXRRaW1laTM2KHQsIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIGUucWltZWkzNiA9IHQucTM2O1xuICAgICAgfSk7XG4gICAgfSwgbi5wcm90b3R5cGUuaW5pdFNlc3Npb24gPSBmdW5jdGlvbiAodCkge1xuICAgICAgdmFyIGUgPSAxOGU1O1xuICAgICAgdC5zZXNzaW9uRHVyYXRpb24gJiYgdC5zZXNzaW9uRHVyYXRpb24gPiAzZTQgJiYgKGUgPSB0LnNlc3Npb25EdXJhdGlvbiksIHRoaXMuYmVhY29uU2Vzc2lvbiA9IG5ldyB3KHRoaXMuc3RvcmFnZSwgZSwgdGhpcyk7XG4gICAgfSwgbi5wcm90b3R5cGUuaW5pdENvbW1vbkluZm8gPSBmdW5jdGlvbiAodCkge1xuICAgICAgdmFyIGUgPSBOdW1iZXIodGhpcy5zdG9yYWdlLmdldEl0ZW0oYSkpO1xuXG4gICAgICB0cnkge1xuICAgICAgICB2YXIgciA9IEpTT04ucGFyc2UodGhpcy5zdG9yYWdlLmdldEl0ZW0ocykpO1xuICAgICAgICAoRGF0ZS5ub3coKSAtIGUgPiAzZTQgfHwgIXIpICYmIHRoaXMuc3RvcmFnZS5zZXRJdGVtKHMsIEpTT04uc3RyaW5naWZ5KFtdKSk7XG4gICAgICB9IGNhdGNoICh0KSB7fVxuXG4gICAgICB0LnVwbG9hZFVybCAmJiAodGhpcy51cGxvYWRVcmwgPSB0LnVwbG9hZFVybCArIFwiP2FwcGtleT1cIiArIHQuYXBwa2V5KTtcbiAgICAgIHZhciBuID0gW3dpbmRvdy5zY3JlZW4ud2lkdGgsIHdpbmRvdy5zY3JlZW4uaGVpZ2h0XTtcbiAgICAgIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvICYmIG4ucHVzaCh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyksIHRoaXMuY29tbW9uSW5mbyA9IHtcbiAgICAgICAgZGV2aWNlSWQ6IHRoaXMuc3RvcmFnZS5jcmVhdGVEZXZpY2VJZCgpLFxuICAgICAgICBsYW5ndWFnZTogbmF2aWdhdG9yICYmIG5hdmlnYXRvci5sYW5ndWFnZSB8fCBcInpoX0NOXCIsXG4gICAgICAgIHF1ZXJ5OiB3aW5kb3cubG9jYXRpb24uc2VhcmNoLFxuICAgICAgICB1c2VyQWdlbnQ6IG5hdmlnYXRvci51c2VyQWdlbnQsXG4gICAgICAgIHBpeGVsOiBuLmpvaW4oXCIqXCIpLFxuICAgICAgICBjaGFubmVsSUQ6IHQuY2hhbm5lbElEID8gU3RyaW5nKHQuY2hhbm5lbElEKSA6IFwiXCIsXG4gICAgICAgIG9wZW5pZDogdC5vcGVuaWQgPyBTdHJpbmcodC5vcGVuaWQpIDogXCJcIixcbiAgICAgICAgdW5pZDogdC51bmlvbmlkID8gU3RyaW5nKHQudW5pb25pZCkgOiBcIlwiLFxuICAgICAgICBzZGtWZXJzaW9uOiB6XG4gICAgICB9LCB0aGlzLmNvbmZpZy5hcHBWZXJzaW9uID0gdC52ZXJzaW9uQ29kZSA/IFN0cmluZyh0LnZlcnNpb25Db2RlKSA6IFwiXCIsIHRoaXMuY29uZmlnLnN0cmljdE1vZGUgPSB0LnN0cmljdE1vZGU7XG4gICAgfSwgbi5wcm90b3R5cGUuY3ljbGVUYXNrID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHZhciBlID0gdGhpcztcbiAgICAgIHRoaXMuaW50ZXJ2YWxJRCA9IHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGUuc3RvcmUuZ2V0RXZlbnRzKCkudGhlbihmdW5jdGlvbiAodCkge1xuICAgICAgICAgIHZhciByID0gW10sXG4gICAgICAgICAgICAgIG4gPSBKU09OLnBhcnNlKGUuc3RvcmFnZS5nZXRJdGVtKHMpKTtcbiAgICAgICAgICBuIHx8IChuID0gW10pLCB0ICYmIHQuZm9yRWFjaChmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgdmFyIGUgPSBwKHQubWFwVmFsdWUpO1xuICAgICAgICAgICAgLTEgPT0gbi5pbmRleE9mKGUpICYmIChyLnB1c2godCksIG4ucHVzaChlKSk7XG4gICAgICAgICAgfSksIDAgIT0gci5sZW5ndGggJiYgKGUuc3RvcmFnZS5zZXRJdGVtKHMsIEpTT04uc3RyaW5naWZ5KG4pKSwgZS5fbm9ybWFsTG9nUGlwZWxpbmUoZS5hc3NlbWJsZURhdGEocikpKTtcbiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHQpIHt9KTtcbiAgICAgIH0sIHQpO1xuICAgIH0sIG4ucHJvdG90eXBlLm9uUmVwb3J0ID0gZnVuY3Rpb24gKHQsIGUsIHIpIHtcbiAgICAgIHZhciBuID0gdGhpcztcbiAgICAgIGlmICh0aGlzLmlzVW5kZXJJRTgpIHRoaXMuZXJyb3JSZXBvcnQucmVwb3J0RXJyb3IoXCI2MDFcIiwgXCJVbmRlcklFOFwiKTtlbHNlIHtcbiAgICAgICAgdmFyIG8gPSB0aGlzLmdlbmVyYXRlRGF0YSh0LCBlLCByKTtcbiAgICAgICAgaWYgKHIgJiYgMCA9PSB0aGlzLmRlbGF5VGltZSAmJiAhdGhpcy51bmRlcldlYWtOZXQpIHRoaXMuX25vcm1hbExvZ1BpcGVsaW5lKHRoaXMuYXNzZW1ibGVEYXRhKG8pKTtlbHNlIHtcbiAgICAgICAgICB2YXIgaSA9IG8uc2hpZnQoKTtcbiAgICAgICAgICBpICYmIHRoaXMuc3RvcmUuaW5zZXJ0RXZlbnQoaSwgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHQgJiYgbi5lcnJvclJlcG9ydC5yZXBvcnRFcnJvcihcIjYwNFwiLCBcImluc2VydEV2ZW50IGZhaWwhXCIpO1xuICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICBuLl9ub3JtYWxMb2dQaXBlbGluZShuLmFzc2VtYmxlRGF0YShvKSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LCBuLnByb3RvdHlwZS5vblNlbmRCZWFjb24gPSBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgaWYgKHRoaXMuaXNVbmRlcklFKSB0aGlzLmVycm9yUmVwb3J0LnJlcG9ydEVycm9yKFwiNjA1XCIsIFwiVW5kZXJJRVwiKTtlbHNlIHtcbiAgICAgICAgdmFyIHIgPSB0aGlzLmFzc2VtYmxlRGF0YSh0aGlzLmdlbmVyYXRlRGF0YSh0LCBlLCAhMCkpO1xuICAgICAgICBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIG5hdmlnYXRvci5zZW5kQmVhY29uICYmIG5hdmlnYXRvci5zZW5kQmVhY29uKHRoaXMudXBsb2FkVXJsIHx8IHRoaXMuc3RyYXRlZ3kuZ2V0VXBsb2FkVXJsKCksIEpTT04uc3RyaW5naWZ5KHIpKTtcbiAgICAgIH1cbiAgICB9LCBuLnByb3RvdHlwZS5nZW5lcmF0ZURhdGEgPSBmdW5jdGlvbiAodCwgciwgbikge1xuICAgICAgdmFyIG8gPSBbXSxcbiAgICAgICAgICBpID0gXCI0LjUuNi13ZWJfXCIgKyAobiA/IFwiZGlyZWN0X2xvZ19pZFwiIDogXCJub3JtYWxfbG9nX2lkXCIpLFxuICAgICAgICAgIGEgPSBOdW1iZXIodGhpcy5zdG9yYWdlLmdldEl0ZW0oaSkpO1xuICAgICAgcmV0dXJuIGEgPSBhIHx8IDEsIHIgPSBfZShfZSh7fSwgciksIHtcbiAgICAgICAgQTk5OiBuID8gXCJZXCIgOiBcIk5cIixcbiAgICAgICAgQTEwMDogYS50b1N0cmluZygpLFxuICAgICAgICBBNzI6IHosXG4gICAgICAgIEE4ODogdGhpcy5sb2dpZFN0YXJ0VGltZVxuICAgICAgfSksIGErKywgdGhpcy5zdG9yYWdlLnNldEl0ZW0oaSwgYS50b1N0cmluZygpKSwgby5wdXNoKHtcbiAgICAgICAgZXZlbnRDb2RlOiB0LFxuICAgICAgICBldmVudFRpbWU6IERhdGUubm93KCkudG9TdHJpbmcoKSxcbiAgICAgICAgbWFwVmFsdWU6IGgociwgdGhpcy5jb25maWcuc3RyaWN0TW9kZSlcbiAgICAgIH0pLCBvO1xuICAgIH0sIG4ucHJvdG90eXBlLmFzc2VtYmxlRGF0YSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICB2YXIgciA9IHRoaXMuYmVhY29uU2Vzc2lvbi5nZXRTZXNzaW9uKCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhcHBWZXJzaW9uOiB0aGlzLmNvbmZpZy5hcHBWZXJzaW9uID8gZih0aGlzLmNvbmZpZy5hcHBWZXJzaW9uKSA6IFwiXCIsXG4gICAgICAgIHNka0lkOiBcImpzXCIsXG4gICAgICAgIHNka1ZlcnNpb246IHosXG4gICAgICAgIG1haW5BcHBLZXk6IHRoaXMuY29uZmlnLmFwcGtleSxcbiAgICAgICAgcGxhdGZvcm1JZDogMyxcbiAgICAgICAgY29tbW9uOiBoKF9lKF9lKHt9LCB0aGlzLmFkZGl0aW9uYWxQYXJhbXMpLCB7XG4gICAgICAgICAgQTI6IHRoaXMuY29tbW9uSW5mby5kZXZpY2VJZCxcbiAgICAgICAgICBBODogdGhpcy5jb21tb25JbmZvLm9wZW5pZCxcbiAgICAgICAgICBBMTI6IHRoaXMuY29tbW9uSW5mby5sYW5ndWFnZSxcbiAgICAgICAgICBBMTc6IHRoaXMuY29tbW9uSW5mby5waXhlbCxcbiAgICAgICAgICBBMjM6IHRoaXMuY29tbW9uSW5mby5jaGFubmVsSUQsXG4gICAgICAgICAgQTUwOiB0aGlzLmNvbW1vbkluZm8udW5pZCxcbiAgICAgICAgICBBNzY6IHIuc2Vzc2lvbklkLFxuICAgICAgICAgIEExMDE6IHRoaXMuY29tbW9uSW5mby51c2VyQWdlbnQsXG4gICAgICAgICAgQTEwMjogd2luZG93LmxvY2F0aW9uLmhyZWYsXG4gICAgICAgICAgQTEwNDogZG9jdW1lbnQucmVmZXJyZXIsXG4gICAgICAgICAgQTExOTogdGhpcy5jb21tb25JbmZvLnF1ZXJ5LFxuICAgICAgICAgIEExNTM6IHRoaXMucWltZWkzNlxuICAgICAgICB9KSwgITEpLFxuICAgICAgICBldmVudHM6IHRcbiAgICAgIH07XG4gICAgfSwgbi5wcm90b3R5cGUubW9uaXRvclVwbG9hZEZhaWxlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMudXNlbGVzc0N5Y2xlVGFza051bSsrLCB0aGlzLnVzZWxlc3NDeWNsZVRhc2tOdW0gPj0gNSAmJiAod2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbElEKSwgdGhpcy5jeWNsZVRhc2soNmU0KSwgdGhpcy51bmRlcldlYWtOZXQgPSAhMCk7XG4gICAgfSwgbi5wcm90b3R5cGUuZG9DdXN0b21DeWNsZVRhc2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnVzZWxlc3NDeWNsZVRhc2tOdW0gPj0gNSAmJiAod2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbElEKSwgdGhpcy5jeWNsZVRhc2sodGhpcy5pbml0RGVsYXlUaW1lKSksIHRoaXMudXNlbGVzc0N5Y2xlVGFza051bSA9IDAsIHRoaXMudW5kZXJXZWFrTmV0ID0gITE7XG4gICAgfSwgbjtcbiAgfSh2KTtcbn0pOyIsInZhciBfdHlwZW9mID0gcmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mXCIpO1xuXG4vKlxuIENyeXB0b0pTIHYzLjEuMlxuIGNvZGUuZ29vZ2xlLmNvbS9wL2NyeXB0by1qc1xuIChjKSAyMDA5LTIwMTMgYnkgSmVmZiBNb3R0LiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuIGNvZGUuZ29vZ2xlLmNvbS9wL2NyeXB0by1qcy93aWtpL0xpY2Vuc2VcbiAqL1xudmFyIENyeXB0b0pTID0gQ3J5cHRvSlMgfHwgZnVuY3Rpb24gKGcsIGwpIHtcbiAgdmFyIGUgPSB7fSxcbiAgICAgIGQgPSBlLmxpYiA9IHt9LFxuICAgICAgbSA9IGZ1bmN0aW9uIG0oKSB7fSxcbiAgICAgIGsgPSBkLkJhc2UgPSB7XG4gICAgZXh0ZW5kOiBmdW5jdGlvbiBleHRlbmQoYSkge1xuICAgICAgbS5wcm90b3R5cGUgPSB0aGlzO1xuICAgICAgdmFyIGMgPSBuZXcgbSgpO1xuICAgICAgYSAmJiBjLm1peEluKGEpO1xuICAgICAgYy5oYXNPd25Qcm9wZXJ0eShcImluaXRcIikgfHwgKGMuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYy4kc3VwZXIuaW5pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgfSk7XG4gICAgICBjLmluaXQucHJvdG90eXBlID0gYztcbiAgICAgIGMuJHN1cGVyID0gdGhpcztcbiAgICAgIHJldHVybiBjO1xuICAgIH0sXG4gICAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgICB2YXIgYSA9IHRoaXMuZXh0ZW5kKCk7XG4gICAgICBhLmluaXQuYXBwbHkoYSwgYXJndW1lbnRzKTtcbiAgICAgIHJldHVybiBhO1xuICAgIH0sXG4gICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHt9LFxuICAgIG1peEluOiBmdW5jdGlvbiBtaXhJbihhKSB7XG4gICAgICBmb3IgKHZhciBjIGluIGEpIHtcbiAgICAgICAgYS5oYXNPd25Qcm9wZXJ0eShjKSAmJiAodGhpc1tjXSA9IGFbY10pO1xuICAgICAgfVxuXG4gICAgICBhLmhhc093blByb3BlcnR5KFwidG9TdHJpbmdcIikgJiYgKHRoaXMudG9TdHJpbmcgPSBhLnRvU3RyaW5nKTtcbiAgICB9LFxuICAgIGNsb25lOiBmdW5jdGlvbiBjbG9uZSgpIHtcbiAgICAgIHJldHVybiB0aGlzLmluaXQucHJvdG90eXBlLmV4dGVuZCh0aGlzKTtcbiAgICB9XG4gIH0sXG4gICAgICBwID0gZC5Xb3JkQXJyYXkgPSBrLmV4dGVuZCh7XG4gICAgaW5pdDogZnVuY3Rpb24gaW5pdChhLCBjKSB7XG4gICAgICBhID0gdGhpcy53b3JkcyA9IGEgfHwgW107XG4gICAgICB0aGlzLnNpZ0J5dGVzID0gYyAhPSBsID8gYyA6IDQgKiBhLmxlbmd0aDtcbiAgICB9LFxuICAgIHRvU3RyaW5nOiBmdW5jdGlvbiB0b1N0cmluZyhhKSB7XG4gICAgICByZXR1cm4gKGEgfHwgbikuc3RyaW5naWZ5KHRoaXMpO1xuICAgIH0sXG4gICAgY29uY2F0OiBmdW5jdGlvbiBjb25jYXQoYSkge1xuICAgICAgdmFyIGMgPSB0aGlzLndvcmRzLFxuICAgICAgICAgIHEgPSBhLndvcmRzLFxuICAgICAgICAgIGYgPSB0aGlzLnNpZ0J5dGVzO1xuICAgICAgYSA9IGEuc2lnQnl0ZXM7XG4gICAgICB0aGlzLmNsYW1wKCk7XG4gICAgICBpZiAoZiAlIDQpIGZvciAodmFyIGIgPSAwOyBiIDwgYTsgYisrKSB7XG4gICAgICAgIGNbZiArIGIgPj4+IDJdIHw9IChxW2IgPj4+IDJdID4+PiAyNCAtIDggKiAoYiAlIDQpICYgMjU1KSA8PCAyNCAtIDggKiAoKGYgKyBiKSAlIDQpO1xuICAgICAgfSBlbHNlIGlmICg2NTUzNSA8IHEubGVuZ3RoKSBmb3IgKGIgPSAwOyBiIDwgYTsgYiArPSA0KSB7XG4gICAgICAgIGNbZiArIGIgPj4+IDJdID0gcVtiID4+PiAyXTtcbiAgICAgIH0gZWxzZSBjLnB1c2guYXBwbHkoYywgcSk7XG4gICAgICB0aGlzLnNpZ0J5dGVzICs9IGE7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIGNsYW1wOiBmdW5jdGlvbiBjbGFtcCgpIHtcbiAgICAgIHZhciBhID0gdGhpcy53b3JkcyxcbiAgICAgICAgICBjID0gdGhpcy5zaWdCeXRlcztcbiAgICAgIGFbYyA+Pj4gMl0gJj0gNDI5NDk2NzI5NSA8PCAzMiAtIDggKiAoYyAlIDQpO1xuICAgICAgYS5sZW5ndGggPSBnLmNlaWwoYyAvIDQpO1xuICAgIH0sXG4gICAgY2xvbmU6IGZ1bmN0aW9uIGNsb25lKCkge1xuICAgICAgdmFyIGEgPSBrLmNsb25lLmNhbGwodGhpcyk7XG4gICAgICBhLndvcmRzID0gdGhpcy53b3Jkcy5zbGljZSgwKTtcbiAgICAgIHJldHVybiBhO1xuICAgIH0sXG4gICAgcmFuZG9tOiBmdW5jdGlvbiByYW5kb20oYSkge1xuICAgICAgZm9yICh2YXIgYyA9IFtdLCBiID0gMDsgYiA8IGE7IGIgKz0gNCkge1xuICAgICAgICBjLnB1c2goNDI5NDk2NzI5NiAqIGcucmFuZG9tKCkgfCAwKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5ldyBwLmluaXQoYywgYSk7XG4gICAgfVxuICB9KSxcbiAgICAgIGIgPSBlLmVuYyA9IHt9LFxuICAgICAgbiA9IGIuSGV4ID0ge1xuICAgIHN0cmluZ2lmeTogZnVuY3Rpb24gc3RyaW5naWZ5KGEpIHtcbiAgICAgIHZhciBjID0gYS53b3JkcztcbiAgICAgIGEgPSBhLnNpZ0J5dGVzO1xuXG4gICAgICBmb3IgKHZhciBiID0gW10sIGYgPSAwOyBmIDwgYTsgZisrKSB7XG4gICAgICAgIHZhciBkID0gY1tmID4+PiAyXSA+Pj4gMjQgLSA4ICogKGYgJSA0KSAmIDI1NTtcbiAgICAgICAgYi5wdXNoKChkID4+PiA0KS50b1N0cmluZygxNikpO1xuICAgICAgICBiLnB1c2goKGQgJiAxNSkudG9TdHJpbmcoMTYpKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGIuam9pbihcIlwiKTtcbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbiBwYXJzZShhKSB7XG4gICAgICBmb3IgKHZhciBjID0gYS5sZW5ndGgsIGIgPSBbXSwgZiA9IDA7IGYgPCBjOyBmICs9IDIpIHtcbiAgICAgICAgYltmID4+PiAzXSB8PSBwYXJzZUludChhLnN1YnN0cihmLCAyKSwgMTYpIDw8IDI0IC0gNCAqIChmICUgOCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBuZXcgcC5pbml0KGIsIGMgLyAyKTtcbiAgICB9XG4gIH0sXG4gICAgICBqID0gYi5MYXRpbjEgPSB7XG4gICAgc3RyaW5naWZ5OiBmdW5jdGlvbiBzdHJpbmdpZnkoYSkge1xuICAgICAgdmFyIGMgPSBhLndvcmRzO1xuICAgICAgYSA9IGEuc2lnQnl0ZXM7XG5cbiAgICAgIGZvciAodmFyIGIgPSBbXSwgZiA9IDA7IGYgPCBhOyBmKyspIHtcbiAgICAgICAgYi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY1tmID4+PiAyXSA+Pj4gMjQgLSA4ICogKGYgJSA0KSAmIDI1NSkpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYi5qb2luKFwiXCIpO1xuICAgIH0sXG4gICAgcGFyc2U6IGZ1bmN0aW9uIHBhcnNlKGEpIHtcbiAgICAgIGZvciAodmFyIGMgPSBhLmxlbmd0aCwgYiA9IFtdLCBmID0gMDsgZiA8IGM7IGYrKykge1xuICAgICAgICBiW2YgPj4+IDJdIHw9IChhLmNoYXJDb2RlQXQoZikgJiAyNTUpIDw8IDI0IC0gOCAqIChmICUgNCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBuZXcgcC5pbml0KGIsIGMpO1xuICAgIH1cbiAgfSxcbiAgICAgIGggPSBiLlV0ZjggPSB7XG4gICAgc3RyaW5naWZ5OiBmdW5jdGlvbiBzdHJpbmdpZnkoYSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUoai5zdHJpbmdpZnkoYSkpKTtcbiAgICAgIH0gY2F0Y2ggKGMpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXCJNYWxmb3JtZWQgVVRGLTggZGF0YVwiKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbiBwYXJzZShhKSB7XG4gICAgICByZXR1cm4gai5wYXJzZSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoYSkpKTtcbiAgICB9XG4gIH0sXG4gICAgICByID0gZC5CdWZmZXJlZEJsb2NrQWxnb3JpdGhtID0gay5leHRlbmQoe1xuICAgIHJlc2V0OiBmdW5jdGlvbiByZXNldCgpIHtcbiAgICAgIHRoaXMuX2RhdGEgPSBuZXcgcC5pbml0KCk7XG4gICAgICB0aGlzLl9uRGF0YUJ5dGVzID0gMDtcbiAgICB9LFxuICAgIF9hcHBlbmQ6IGZ1bmN0aW9uIF9hcHBlbmQoYSkge1xuICAgICAgXCJzdHJpbmdcIiA9PSB0eXBlb2YgYSAmJiAoYSA9IGgucGFyc2UoYSkpO1xuXG4gICAgICB0aGlzLl9kYXRhLmNvbmNhdChhKTtcblxuICAgICAgdGhpcy5fbkRhdGFCeXRlcyArPSBhLnNpZ0J5dGVzO1xuICAgIH0sXG4gICAgX3Byb2Nlc3M6IGZ1bmN0aW9uIF9wcm9jZXNzKGEpIHtcbiAgICAgIHZhciBjID0gdGhpcy5fZGF0YSxcbiAgICAgICAgICBiID0gYy53b3JkcyxcbiAgICAgICAgICBmID0gYy5zaWdCeXRlcyxcbiAgICAgICAgICBkID0gdGhpcy5ibG9ja1NpemUsXG4gICAgICAgICAgZSA9IGYgLyAoNCAqIGQpLFxuICAgICAgICAgIGUgPSBhID8gZy5jZWlsKGUpIDogZy5tYXgoKGUgfCAwKSAtIHRoaXMuX21pbkJ1ZmZlclNpemUsIDApO1xuICAgICAgYSA9IGUgKiBkO1xuICAgICAgZiA9IGcubWluKDQgKiBhLCBmKTtcblxuICAgICAgaWYgKGEpIHtcbiAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBhOyBrICs9IGQpIHtcbiAgICAgICAgICB0aGlzLl9kb1Byb2Nlc3NCbG9jayhiLCBrKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGsgPSBiLnNwbGljZSgwLCBhKTtcbiAgICAgICAgYy5zaWdCeXRlcyAtPSBmO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IHAuaW5pdChrLCBmKTtcbiAgICB9LFxuICAgIGNsb25lOiBmdW5jdGlvbiBjbG9uZSgpIHtcbiAgICAgIHZhciBhID0gay5jbG9uZS5jYWxsKHRoaXMpO1xuICAgICAgYS5fZGF0YSA9IHRoaXMuX2RhdGEuY2xvbmUoKTtcbiAgICAgIHJldHVybiBhO1xuICAgIH0sXG4gICAgX21pbkJ1ZmZlclNpemU6IDBcbiAgfSk7XG5cbiAgZC5IYXNoZXIgPSByLmV4dGVuZCh7XG4gICAgY2ZnOiBrLmV4dGVuZCgpLFxuICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoYSkge1xuICAgICAgdGhpcy5jZmcgPSB0aGlzLmNmZy5leHRlbmQoYSk7XG4gICAgICB0aGlzLnJlc2V0KCk7XG4gICAgfSxcbiAgICByZXNldDogZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgICByLnJlc2V0LmNhbGwodGhpcyk7XG5cbiAgICAgIHRoaXMuX2RvUmVzZXQoKTtcbiAgICB9LFxuICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKGEpIHtcbiAgICAgIHRoaXMuX2FwcGVuZChhKTtcblxuICAgICAgdGhpcy5fcHJvY2VzcygpO1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIGZpbmFsaXplOiBmdW5jdGlvbiBmaW5hbGl6ZShhKSB7XG4gICAgICBhICYmIHRoaXMuX2FwcGVuZChhKTtcbiAgICAgIHJldHVybiB0aGlzLl9kb0ZpbmFsaXplKCk7XG4gICAgfSxcbiAgICBibG9ja1NpemU6IDE2LFxuICAgIF9jcmVhdGVIZWxwZXI6IGZ1bmN0aW9uIF9jcmVhdGVIZWxwZXIoYSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChiLCBkKSB7XG4gICAgICAgIHJldHVybiBuZXcgYS5pbml0KGQpLmZpbmFsaXplKGIpO1xuICAgICAgfTtcbiAgICB9LFxuICAgIF9jcmVhdGVIbWFjSGVscGVyOiBmdW5jdGlvbiBfY3JlYXRlSG1hY0hlbHBlcihhKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGIsIGQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBzLkhNQUMuaW5pdChhLCBkKS5maW5hbGl6ZShiKTtcbiAgICAgIH07XG4gICAgfVxuICB9KTtcbiAgdmFyIHMgPSBlLmFsZ28gPSB7fTtcbiAgcmV0dXJuIGU7XG59KE1hdGgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgZyA9IENyeXB0b0pTLFxuICAgICAgbCA9IGcubGliLFxuICAgICAgZSA9IGwuV29yZEFycmF5LFxuICAgICAgZCA9IGwuSGFzaGVyLFxuICAgICAgbSA9IFtdLFxuICAgICAgbCA9IGcuYWxnby5TSEExID0gZC5leHRlbmQoe1xuICAgIF9kb1Jlc2V0OiBmdW5jdGlvbiBfZG9SZXNldCgpIHtcbiAgICAgIHRoaXMuX2hhc2ggPSBuZXcgZS5pbml0KFsxNzMyNTg0MTkzLCA0MDIzMjMzNDE3LCAyNTYyMzgzMTAyLCAyNzE3MzM4NzgsIDMyODUzNzc1MjBdKTtcbiAgICB9LFxuICAgIF9kb1Byb2Nlc3NCbG9jazogZnVuY3Rpb24gX2RvUHJvY2Vzc0Jsb2NrKGQsIGUpIHtcbiAgICAgIGZvciAodmFyIGIgPSB0aGlzLl9oYXNoLndvcmRzLCBuID0gYlswXSwgaiA9IGJbMV0sIGggPSBiWzJdLCBnID0gYlszXSwgbCA9IGJbNF0sIGEgPSAwOyA4MCA+IGE7IGErKykge1xuICAgICAgICBpZiAoMTYgPiBhKSBtW2FdID0gZFtlICsgYV0gfCAwO2Vsc2Uge1xuICAgICAgICAgIHZhciBjID0gbVthIC0gM10gXiBtW2EgLSA4XSBeIG1bYSAtIDE0XSBeIG1bYSAtIDE2XTtcbiAgICAgICAgICBtW2FdID0gYyA8PCAxIHwgYyA+Pj4gMzE7XG4gICAgICAgIH1cbiAgICAgICAgYyA9IChuIDw8IDUgfCBuID4+PiAyNykgKyBsICsgbVthXTtcbiAgICAgICAgYyA9IDIwID4gYSA/IGMgKyAoKGogJiBoIHwgfmogJiBnKSArIDE1MTg1MDAyNDkpIDogNDAgPiBhID8gYyArICgoaiBeIGggXiBnKSArIDE4NTk3NzUzOTMpIDogNjAgPiBhID8gYyArICgoaiAmIGggfCBqICYgZyB8IGggJiBnKSAtIDE4OTQwMDc1ODgpIDogYyArICgoaiBeIGggXiBnKSAtIDg5OTQ5NzUxNCk7XG4gICAgICAgIGwgPSBnO1xuICAgICAgICBnID0gaDtcbiAgICAgICAgaCA9IGogPDwgMzAgfCBqID4+PiAyO1xuICAgICAgICBqID0gbjtcbiAgICAgICAgbiA9IGM7XG4gICAgICB9XG5cbiAgICAgIGJbMF0gPSBiWzBdICsgbiB8IDA7XG4gICAgICBiWzFdID0gYlsxXSArIGogfCAwO1xuICAgICAgYlsyXSA9IGJbMl0gKyBoIHwgMDtcbiAgICAgIGJbM10gPSBiWzNdICsgZyB8IDA7XG4gICAgICBiWzRdID0gYls0XSArIGwgfCAwO1xuICAgIH0sXG4gICAgX2RvRmluYWxpemU6IGZ1bmN0aW9uIF9kb0ZpbmFsaXplKCkge1xuICAgICAgdmFyIGQgPSB0aGlzLl9kYXRhLFxuICAgICAgICAgIGUgPSBkLndvcmRzLFxuICAgICAgICAgIGIgPSA4ICogdGhpcy5fbkRhdGFCeXRlcyxcbiAgICAgICAgICBnID0gOCAqIGQuc2lnQnl0ZXM7XG4gICAgICBlW2cgPj4+IDVdIHw9IDEyOCA8PCAyNCAtIGcgJSAzMjtcbiAgICAgIGVbKGcgKyA2NCA+Pj4gOSA8PCA0KSArIDE0XSA9IE1hdGguZmxvb3IoYiAvIDQyOTQ5NjcyOTYpO1xuICAgICAgZVsoZyArIDY0ID4+PiA5IDw8IDQpICsgMTVdID0gYjtcbiAgICAgIGQuc2lnQnl0ZXMgPSA0ICogZS5sZW5ndGg7XG5cbiAgICAgIHRoaXMuX3Byb2Nlc3MoKTtcblxuICAgICAgcmV0dXJuIHRoaXMuX2hhc2g7XG4gICAgfSxcbiAgICBjbG9uZTogZnVuY3Rpb24gY2xvbmUoKSB7XG4gICAgICB2YXIgZSA9IGQuY2xvbmUuY2FsbCh0aGlzKTtcbiAgICAgIGUuX2hhc2ggPSB0aGlzLl9oYXNoLmNsb25lKCk7XG4gICAgICByZXR1cm4gZTtcbiAgICB9XG4gIH0pO1xuICBnLlNIQTEgPSBkLl9jcmVhdGVIZWxwZXIobCk7XG4gIGcuSG1hY1NIQTEgPSBkLl9jcmVhdGVIbWFjSGVscGVyKGwpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGcgPSBDcnlwdG9KUyxcbiAgICAgIGwgPSBnLmVuYy5VdGY4O1xuICBnLmFsZ28uSE1BQyA9IGcubGliLkJhc2UuZXh0ZW5kKHtcbiAgICBpbml0OiBmdW5jdGlvbiBpbml0KGUsIGQpIHtcbiAgICAgIGUgPSB0aGlzLl9oYXNoZXIgPSBuZXcgZS5pbml0KCk7XG4gICAgICBcInN0cmluZ1wiID09IHR5cGVvZiBkICYmIChkID0gbC5wYXJzZShkKSk7XG4gICAgICB2YXIgZyA9IGUuYmxvY2tTaXplLFxuICAgICAgICAgIGsgPSA0ICogZztcbiAgICAgIGQuc2lnQnl0ZXMgPiBrICYmIChkID0gZS5maW5hbGl6ZShkKSk7XG4gICAgICBkLmNsYW1wKCk7XG5cbiAgICAgIGZvciAodmFyIHAgPSB0aGlzLl9vS2V5ID0gZC5jbG9uZSgpLCBiID0gdGhpcy5faUtleSA9IGQuY2xvbmUoKSwgbiA9IHAud29yZHMsIGogPSBiLndvcmRzLCBoID0gMDsgaCA8IGc7IGgrKykge1xuICAgICAgICBuW2hdIF49IDE1NDk1NTY4MjgsIGpbaF0gXj0gOTA5NTIyNDg2O1xuICAgICAgfVxuXG4gICAgICBwLnNpZ0J5dGVzID0gYi5zaWdCeXRlcyA9IGs7XG4gICAgICB0aGlzLnJlc2V0KCk7XG4gICAgfSxcbiAgICByZXNldDogZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgICB2YXIgZSA9IHRoaXMuX2hhc2hlcjtcbiAgICAgIGUucmVzZXQoKTtcbiAgICAgIGUudXBkYXRlKHRoaXMuX2lLZXkpO1xuICAgIH0sXG4gICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUoZSkge1xuICAgICAgdGhpcy5faGFzaGVyLnVwZGF0ZShlKTtcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBmaW5hbGl6ZTogZnVuY3Rpb24gZmluYWxpemUoZSkge1xuICAgICAgdmFyIGQgPSB0aGlzLl9oYXNoZXI7XG4gICAgICBlID0gZC5maW5hbGl6ZShlKTtcbiAgICAgIGQucmVzZXQoKTtcbiAgICAgIHJldHVybiBkLmZpbmFsaXplKHRoaXMuX29LZXkuY2xvbmUoKS5jb25jYXQoZSkpO1xuICAgIH1cbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAvLyBTaG9ydGN1dHNcbiAgdmFyIEMgPSBDcnlwdG9KUztcbiAgdmFyIENfbGliID0gQy5saWI7XG4gIHZhciBXb3JkQXJyYXkgPSBDX2xpYi5Xb3JkQXJyYXk7XG4gIHZhciBDX2VuYyA9IEMuZW5jO1xuICAvKipcbiAgICogQmFzZTY0IGVuY29kaW5nIHN0cmF0ZWd5LlxuICAgKi9cblxuICB2YXIgQmFzZTY0ID0gQ19lbmMuQmFzZTY0ID0ge1xuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGEgd29yZCBhcnJheSB0byBhIEJhc2U2NCBzdHJpbmcuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1dvcmRBcnJheX0gd29yZEFycmF5IFRoZSB3b3JkIGFycmF5LlxuICAgICAqXG4gICAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgQmFzZTY0IHN0cmluZy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiAgICAgdmFyIGJhc2U2NFN0cmluZyA9IENyeXB0b0pTLmVuYy5CYXNlNjQuc3RyaW5naWZ5KHdvcmRBcnJheSk7XG4gICAgICovXG4gICAgc3RyaW5naWZ5OiBmdW5jdGlvbiBzdHJpbmdpZnkod29yZEFycmF5KSB7XG4gICAgICAvLyBTaG9ydGN1dHNcbiAgICAgIHZhciB3b3JkcyA9IHdvcmRBcnJheS53b3JkcztcbiAgICAgIHZhciBzaWdCeXRlcyA9IHdvcmRBcnJheS5zaWdCeXRlcztcbiAgICAgIHZhciBtYXAgPSB0aGlzLl9tYXA7IC8vIENsYW1wIGV4Y2VzcyBiaXRzXG5cbiAgICAgIHdvcmRBcnJheS5jbGFtcCgpOyAvLyBDb252ZXJ0XG5cbiAgICAgIHZhciBiYXNlNjRDaGFycyA9IFtdO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpZ0J5dGVzOyBpICs9IDMpIHtcbiAgICAgICAgdmFyIGJ5dGUxID0gd29yZHNbaSA+Pj4gMl0gPj4+IDI0IC0gaSAlIDQgKiA4ICYgMHhmZjtcbiAgICAgICAgdmFyIGJ5dGUyID0gd29yZHNbaSArIDEgPj4+IDJdID4+PiAyNCAtIChpICsgMSkgJSA0ICogOCAmIDB4ZmY7XG4gICAgICAgIHZhciBieXRlMyA9IHdvcmRzW2kgKyAyID4+PiAyXSA+Pj4gMjQgLSAoaSArIDIpICUgNCAqIDggJiAweGZmO1xuICAgICAgICB2YXIgdHJpcGxldCA9IGJ5dGUxIDw8IDE2IHwgYnl0ZTIgPDwgOCB8IGJ5dGUzO1xuXG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgNCAmJiBpICsgaiAqIDAuNzUgPCBzaWdCeXRlczsgaisrKSB7XG4gICAgICAgICAgYmFzZTY0Q2hhcnMucHVzaChtYXAuY2hhckF0KHRyaXBsZXQgPj4+IDYgKiAoMyAtIGopICYgMHgzZikpO1xuICAgICAgICB9XG4gICAgICB9IC8vIEFkZCBwYWRkaW5nXG5cblxuICAgICAgdmFyIHBhZGRpbmdDaGFyID0gbWFwLmNoYXJBdCg2NCk7XG5cbiAgICAgIGlmIChwYWRkaW5nQ2hhcikge1xuICAgICAgICB3aGlsZSAoYmFzZTY0Q2hhcnMubGVuZ3RoICUgNCkge1xuICAgICAgICAgIGJhc2U2NENoYXJzLnB1c2gocGFkZGluZ0NoYXIpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBiYXNlNjRDaGFycy5qb2luKCcnKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgYSBCYXNlNjQgc3RyaW5nIHRvIGEgd29yZCBhcnJheS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBiYXNlNjRTdHIgVGhlIEJhc2U2NCBzdHJpbmcuXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSB3b3JkIGFycmF5LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqICAgICB2YXIgd29yZEFycmF5ID0gQ3J5cHRvSlMuZW5jLkJhc2U2NC5wYXJzZShiYXNlNjRTdHJpbmcpO1xuICAgICAqL1xuICAgIHBhcnNlOiBmdW5jdGlvbiBwYXJzZShiYXNlNjRTdHIpIHtcbiAgICAgIC8vIFNob3J0Y3V0c1xuICAgICAgdmFyIGJhc2U2NFN0ckxlbmd0aCA9IGJhc2U2NFN0ci5sZW5ndGg7XG4gICAgICB2YXIgbWFwID0gdGhpcy5fbWFwOyAvLyBJZ25vcmUgcGFkZGluZ1xuXG4gICAgICB2YXIgcGFkZGluZ0NoYXIgPSBtYXAuY2hhckF0KDY0KTtcblxuICAgICAgaWYgKHBhZGRpbmdDaGFyKSB7XG4gICAgICAgIHZhciBwYWRkaW5nSW5kZXggPSBiYXNlNjRTdHIuaW5kZXhPZihwYWRkaW5nQ2hhcik7XG5cbiAgICAgICAgaWYgKHBhZGRpbmdJbmRleCAhPSAtMSkge1xuICAgICAgICAgIGJhc2U2NFN0ckxlbmd0aCA9IHBhZGRpbmdJbmRleDtcbiAgICAgICAgfVxuICAgICAgfSAvLyBDb252ZXJ0XG5cblxuICAgICAgdmFyIHdvcmRzID0gW107XG4gICAgICB2YXIgbkJ5dGVzID0gMDtcblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiYXNlNjRTdHJMZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoaSAlIDQpIHtcbiAgICAgICAgICB2YXIgYml0czEgPSBtYXAuaW5kZXhPZihiYXNlNjRTdHIuY2hhckF0KGkgLSAxKSkgPDwgaSAlIDQgKiAyO1xuICAgICAgICAgIHZhciBiaXRzMiA9IG1hcC5pbmRleE9mKGJhc2U2NFN0ci5jaGFyQXQoaSkpID4+PiA2IC0gaSAlIDQgKiAyO1xuICAgICAgICAgIHdvcmRzW25CeXRlcyA+Pj4gMl0gfD0gKGJpdHMxIHwgYml0czIpIDw8IDI0IC0gbkJ5dGVzICUgNCAqIDg7XG4gICAgICAgICAgbkJ5dGVzKys7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIFdvcmRBcnJheS5jcmVhdGUod29yZHMsIG5CeXRlcyk7XG4gICAgfSxcbiAgICBfbWFwOiAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0nXG4gIH07XG59KSgpO1xuXG5pZiAoKHR5cGVvZiBtb2R1bGUgPT09IFwidW5kZWZpbmVkXCIgPyBcInVuZGVmaW5lZFwiIDogX3R5cGVvZihtb2R1bGUpKSA9PT0gJ29iamVjdCcpIHtcbiAgbW9kdWxlLmV4cG9ydHMgPSBDcnlwdG9KUztcbn0gZWxzZSB7XG4gIHdpbmRvdy5DcnlwdG9KUyA9IENyeXB0b0pTO1xufSIsInZhciBfdHlwZW9mID0gcmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mXCIpO1xuXG4vL2NvcHlyaWdodCBSeWFuIERheSAyMDEwIDxodHRwOi8vcnlhbmRheS5vcmc+LCBKb3NjaGEgRmV0aCAyMDEzIDxodHRwOi8vd3d3LmZldGguY29tPiBbTUlUIExpY2Vuc2VkXVxudmFyIGVsZW1lbnRfc3RhcnRfY2hhciA9IFwiYS16QS1aX1xceEMwLVxceEQ2XFx4RDgtXFx4RjZcXHhGOC1cXHhGRlxcdTAzNzAtXFx1MDM3RFxcdTAzN0YtXFx1MUZGRlxcdTIwMEMtXFx1MjAwRFxcdTIwNzAtXFx1MjE4RlxcdTJDMDAtXFx1MkZGRlxcdTMwMDEtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZGRFwiO1xudmFyIGVsZW1lbnRfbm9uX3N0YXJ0X2NoYXIgPSBcIi0uMC05XFx4QjdcXHUwMzAwLVxcdTAzNkZcXHUyMDNGXFx1MjA0MFwiO1xudmFyIGVsZW1lbnRfcmVwbGFjZSA9IG5ldyBSZWdFeHAoXCJeKFteXCIgKyBlbGVtZW50X3N0YXJ0X2NoYXIgKyBcIl0pfF4oKHh8WCkobXxNKShsfEwpKXwoW15cIiArIGVsZW1lbnRfc3RhcnRfY2hhciArIGVsZW1lbnRfbm9uX3N0YXJ0X2NoYXIgKyBcIl0pXCIsIFwiZ1wiKTtcbnZhciBub3Rfc2FmZV9pbl94bWwgPSAvW15cXHgwOVxceDBBXFx4MERcXHgyMC1cXHhGRlxceDg1XFx4QTAtXFx1RDdGRlxcdUUwMDAtXFx1RkRDRlxcdUZERTAtXFx1RkZGRF0vZ207XG5cbnZhciBvYmpLZXlzID0gZnVuY3Rpb24gb2JqS2V5cyhvYmopIHtcbiAgdmFyIGwgPSBbXTtcblxuICBpZiAob2JqIGluc3RhbmNlb2YgT2JqZWN0KSB7XG4gICAgZm9yICh2YXIgayBpbiBvYmopIHtcbiAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoaykpIHtcbiAgICAgICAgbC5wdXNoKGspO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBsO1xufTtcblxudmFyIHByb2Nlc3NfdG9feG1sID0gZnVuY3Rpb24gcHJvY2Vzc190b194bWwobm9kZV9kYXRhLCBvcHRpb25zKSB7XG4gIHZhciBtYWtlTm9kZSA9IGZ1bmN0aW9uIG1ha2VOb2RlKG5hbWUsIGNvbnRlbnQsIGF0dHJpYnV0ZXMsIGxldmVsLCBoYXNTdWJOb2Rlcykge1xuICAgIHZhciBpbmRlbnRfdmFsdWUgPSBvcHRpb25zLmluZGVudCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5pbmRlbnQgOiBcIlxcdFwiO1xuICAgIHZhciBpbmRlbnQgPSBvcHRpb25zLnByZXR0eVByaW50ID8gJ1xcbicgKyBuZXcgQXJyYXkobGV2ZWwpLmpvaW4oaW5kZW50X3ZhbHVlKSA6ICcnO1xuXG4gICAgaWYgKG9wdGlvbnMucmVtb3ZlSWxsZWdhbE5hbWVDaGFyYWN0ZXJzKSB7XG4gICAgICBuYW1lID0gbmFtZS5yZXBsYWNlKGVsZW1lbnRfcmVwbGFjZSwgJ18nKTtcbiAgICB9XG5cbiAgICB2YXIgbm9kZSA9IFtpbmRlbnQsICc8JywgbmFtZSwgYXR0cmlidXRlcyB8fCAnJ107XG5cbiAgICBpZiAoY29udGVudCAmJiBjb250ZW50Lmxlbmd0aCA+IDApIHtcbiAgICAgIG5vZGUucHVzaCgnPicpO1xuICAgICAgbm9kZS5wdXNoKGNvbnRlbnQpO1xuICAgICAgaGFzU3ViTm9kZXMgJiYgbm9kZS5wdXNoKGluZGVudCk7XG4gICAgICBub2RlLnB1c2goJzwvJyk7XG4gICAgICBub2RlLnB1c2gobmFtZSk7XG4gICAgICBub2RlLnB1c2goJz4nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbm9kZS5wdXNoKCcvPicpO1xuICAgIH1cblxuICAgIHJldHVybiBub2RlLmpvaW4oJycpO1xuICB9O1xuXG4gIHJldHVybiBmdW5jdGlvbiBmbihub2RlX2RhdGEsIG5vZGVfZGVzY3JpcHRvciwgbGV2ZWwpIHtcbiAgICB2YXIgdHlwZSA9IF90eXBlb2Yobm9kZV9kYXRhKTtcblxuICAgIGlmIChBcnJheS5pc0FycmF5ID8gQXJyYXkuaXNBcnJheShub2RlX2RhdGEpIDogbm9kZV9kYXRhIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIHR5cGUgPSAnYXJyYXknO1xuICAgIH0gZWxzZSBpZiAobm9kZV9kYXRhIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgdHlwZSA9ICdkYXRlJztcbiAgICB9XG5cbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIC8vaWYgdmFsdWUgaXMgYW4gYXJyYXkgY3JlYXRlIGNoaWxkIG5vZGVzIGZyb20gdmFsdWVzXG4gICAgICBjYXNlICdhcnJheSc6XG4gICAgICAgIHZhciByZXQgPSBbXTtcbiAgICAgICAgbm9kZV9kYXRhLm1hcChmdW5jdGlvbiAodikge1xuICAgICAgICAgIHJldC5wdXNoKGZuKHYsIDEsIGxldmVsICsgMSkpOyAvL2VudHJpZXMgdGhhdCBhcmUgdmFsdWVzIG9mIGFuIGFycmF5IGFyZSB0aGUgb25seSBvbmVzIHRoYXQgY2FuIGJlIHNwZWNpYWwgbm9kZSBkZXNjcmlwdG9yc1xuICAgICAgICB9KTtcbiAgICAgICAgb3B0aW9ucy5wcmV0dHlQcmludCAmJiByZXQucHVzaCgnXFxuJyk7XG4gICAgICAgIHJldHVybiByZXQuam9pbignJyk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdkYXRlJzpcbiAgICAgICAgLy8gY2FzdCBkYXRlcyB0byBJU08gODYwMSBkYXRlIChzb2FwIGxpa2VzIGl0KVxuICAgICAgICByZXR1cm4gbm9kZV9kYXRhLnRvSlNPTiA/IG5vZGVfZGF0YS50b0pTT04oKSA6IG5vZGVfZGF0YSArICcnO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgdmFyIG5vZGVzID0gW107XG5cbiAgICAgICAgZm9yICh2YXIgbmFtZSBpbiBub2RlX2RhdGEpIHtcbiAgICAgICAgICBpZiAobm9kZV9kYXRhLmhhc093blByb3BlcnR5KG5hbWUpKSB7XG4gICAgICAgICAgICBpZiAobm9kZV9kYXRhW25hbWVdIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBub2RlX2RhdGFbbmFtZV0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZV9kYXRhW25hbWVdLmhhc093blByb3BlcnR5KGopKSB7XG4gICAgICAgICAgICAgICAgICBub2Rlcy5wdXNoKG1ha2VOb2RlKG5hbWUsIGZuKG5vZGVfZGF0YVtuYW1lXVtqXSwgMCwgbGV2ZWwgKyAxKSwgbnVsbCwgbGV2ZWwgKyAxLCBvYmpLZXlzKG5vZGVfZGF0YVtuYW1lXVtqXSkubGVuZ3RoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBub2Rlcy5wdXNoKG1ha2VOb2RlKG5hbWUsIGZuKG5vZGVfZGF0YVtuYW1lXSwgMCwgbGV2ZWwgKyAxKSwgbnVsbCwgbGV2ZWwgKyAxKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgb3B0aW9ucy5wcmV0dHlQcmludCAmJiBub2Rlcy5sZW5ndGggPiAwICYmIG5vZGVzLnB1c2goJ1xcbicpO1xuICAgICAgICByZXR1cm4gbm9kZXMuam9pbignJyk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdmdW5jdGlvbic6XG4gICAgICAgIHJldHVybiBub2RlX2RhdGEoKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBvcHRpb25zLmVzY2FwZSA/IGVzYyhub2RlX2RhdGEpIDogJycgKyBub2RlX2RhdGE7XG4gICAgfVxuICB9KG5vZGVfZGF0YSwgMCwgMCk7XG59O1xuXG52YXIgeG1sX2hlYWRlciA9IGZ1bmN0aW9uIHhtbF9oZWFkZXIoc3RhbmRhbG9uZSkge1xuICB2YXIgcmV0ID0gWyc8P3htbCB2ZXJzaW9uPVwiMS4wXCIgZW5jb2Rpbmc9XCJVVEYtOFwiJ107XG5cbiAgaWYgKHN0YW5kYWxvbmUpIHtcbiAgICByZXQucHVzaCgnIHN0YW5kYWxvbmU9XCJ5ZXNcIicpO1xuICB9XG5cbiAgcmV0LnB1c2goJz8+Jyk7XG4gIHJldHVybiByZXQuam9pbignJyk7XG59O1xuXG5mdW5jdGlvbiBlc2Moc3RyKSB7XG4gIHJldHVybiAoJycgKyBzdHIpLnJlcGxhY2UoLyYvZywgJyZhbXA7JykucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLz4vZywgJyZndDsnKS5yZXBsYWNlKC8nL2csICcmYXBvczsnKS5yZXBsYWNlKC9cIi9nLCAnJnF1b3Q7JykucmVwbGFjZShub3Rfc2FmZV9pbl94bWwsICcnKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob2JqLCBvcHRpb25zKSB7XG4gIGlmICghb3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSB7XG4gICAgICB4bWxIZWFkZXI6IHtcbiAgICAgICAgc3RhbmRhbG9uZTogdHJ1ZVxuICAgICAgfSxcbiAgICAgIHByZXR0eVByaW50OiB0cnVlLFxuICAgICAgaW5kZW50OiBcIiAgXCIsXG4gICAgICBlc2NhcGU6IHRydWVcbiAgICB9O1xuICB9XG5cbiAgaWYgKHR5cGVvZiBvYmogPT0gJ3N0cmluZycpIHtcbiAgICB0cnkge1xuICAgICAgb2JqID0gSlNPTi5wYXJzZShvYmoudG9TdHJpbmcoKSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHZhciB4bWxoZWFkZXIgPSAnJztcbiAgdmFyIGRvY1R5cGUgPSAnJztcblxuICBpZiAob3B0aW9ucykge1xuICAgIGlmIChfdHlwZW9mKG9wdGlvbnMpID09ICdvYmplY3QnKSB7XG4gICAgICAvLyBvdXIgY29uZmlnIGlzIGFuIG9iamVjdFxuICAgICAgaWYgKG9wdGlvbnMueG1sSGVhZGVyKSB7XG4gICAgICAgIC8vIHRoZSB1c2VyIHdhbnRzIGFuIHhtbCBoZWFkZXJcbiAgICAgICAgeG1saGVhZGVyID0geG1sX2hlYWRlcighIW9wdGlvbnMueG1sSGVhZGVyLnN0YW5kYWxvbmUpO1xuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIG9wdGlvbnMuZG9jVHlwZSAhPSAndW5kZWZpbmVkJykge1xuICAgICAgICBkb2NUeXBlID0gJzwhRE9DVFlQRSAnICsgb3B0aW9ucy5kb2NUeXBlICsgJz4nO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBvdXIgY29uZmlnIGlzIGEgYm9vbGVhbiB2YWx1ZSwgc28ganVzdCBhZGQgeG1sIGhlYWRlclxuICAgICAgeG1saGVhZGVyID0geG1sX2hlYWRlcigpO1xuICAgIH1cbiAgfVxuXG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICB2YXIgcmV0ID0gW3htbGhlYWRlciwgb3B0aW9ucy5wcmV0dHlQcmludCAmJiBkb2NUeXBlID8gJ1xcbicgOiAnJywgZG9jVHlwZSwgcHJvY2Vzc190b194bWwob2JqLCBvcHRpb25zKV07XG4gIHJldHVybiByZXQuam9pbignJykucmVwbGFjZSgvXFxuezIsfS9nLCAnXFxuJykucmVwbGFjZSgvXFxzKyQvZywgJycpO1xufTsiLCJ2YXIgX3R5cGVvZiA9IHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL3R5cGVvZlwiKTtcblxuLyogaHR0cHM6Ly9naXRodWIuY29tL2VtbjE3OC9qcy1tZDUgKi9cbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB2YXIgRVJST1IgPSAnaW5wdXQgaXMgaW52YWxpZCB0eXBlJztcbiAgdmFyIFdJTkRPVyA9ICh0eXBlb2Ygd2luZG93ID09PSBcInVuZGVmaW5lZFwiID8gXCJ1bmRlZmluZWRcIiA6IF90eXBlb2Yod2luZG93KSkgPT09ICdvYmplY3QnO1xuICB2YXIgcm9vdCA9IFdJTkRPVyA/IHdpbmRvdyA6IHt9O1xuXG4gIGlmIChyb290LkpTX01ENV9OT19XSU5ET1cpIHtcbiAgICBXSU5ET1cgPSBmYWxzZTtcbiAgfVxuXG4gIHZhciBXRUJfV09SS0VSID0gIVdJTkRPVyAmJiAodHlwZW9mIHNlbGYgPT09IFwidW5kZWZpbmVkXCIgPyBcInVuZGVmaW5lZFwiIDogX3R5cGVvZihzZWxmKSkgPT09ICdvYmplY3QnO1xuICB2YXIgTk9ERV9KUyA9ICFyb290LkpTX01ENV9OT19OT0RFX0pTICYmICh0eXBlb2YgcHJvY2VzcyA9PT0gXCJ1bmRlZmluZWRcIiA/IFwidW5kZWZpbmVkXCIgOiBfdHlwZW9mKHByb2Nlc3MpKSA9PT0gJ29iamVjdCcgJiYgcHJvY2Vzcy52ZXJzaW9ucyAmJiBwcm9jZXNzLnZlcnNpb25zLm5vZGU7XG5cbiAgaWYgKE5PREVfSlMpIHtcbiAgICByb290ID0gZ2xvYmFsO1xuICB9IGVsc2UgaWYgKFdFQl9XT1JLRVIpIHtcbiAgICByb290ID0gc2VsZjtcbiAgfVxuXG4gIHZhciBDT01NT05fSlMgPSAhcm9vdC5KU19NRDVfTk9fQ09NTU9OX0pTICYmICh0eXBlb2YgbW9kdWxlID09PSBcInVuZGVmaW5lZFwiID8gXCJ1bmRlZmluZWRcIiA6IF90eXBlb2YobW9kdWxlKSkgPT09ICdvYmplY3QnICYmIG1vZHVsZS5leHBvcnRzO1xuICB2YXIgQU1EID0gdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kO1xuICB2YXIgQVJSQVlfQlVGRkVSID0gIXJvb3QuSlNfTUQ1X05PX0FSUkFZX0JVRkZFUiAmJiB0eXBlb2YgQXJyYXlCdWZmZXIgIT09ICd1bmRlZmluZWQnO1xuICB2YXIgSEVYX0NIQVJTID0gJzAxMjM0NTY3ODlhYmNkZWYnLnNwbGl0KCcnKTtcbiAgdmFyIEVYVFJBID0gWzEyOCwgMzI3NjgsIDgzODg2MDgsIC0yMTQ3NDgzNjQ4XTtcbiAgdmFyIFNISUZUID0gWzAsIDgsIDE2LCAyNF07XG4gIHZhciBPVVRQVVRfVFlQRVMgPSBbJ2hleCcsICdhcnJheScsICdkaWdlc3QnLCAnYnVmZmVyJywgJ2FycmF5QnVmZmVyJywgJ2Jhc2U2NCddO1xuICB2YXIgQkFTRTY0X0VOQ09ERV9DSEFSID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky8nLnNwbGl0KCcnKTtcbiAgdmFyIGJsb2NrcyA9IFtdLFxuICAgICAgYnVmZmVyODtcblxuICBpZiAoQVJSQVlfQlVGRkVSKSB7XG4gICAgdmFyIGJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcig2OCk7XG4gICAgYnVmZmVyOCA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlcik7XG4gICAgYmxvY2tzID0gbmV3IFVpbnQzMkFycmF5KGJ1ZmZlcik7XG4gIH1cblxuICBpZiAocm9vdC5KU19NRDVfTk9fTk9ERV9KUyB8fCAhQXJyYXkuaXNBcnJheSkge1xuICAgIEFycmF5LmlzQXJyYXkgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikgPT09ICdbb2JqZWN0IEFycmF5XSc7XG4gICAgfTtcbiAgfVxuXG4gIGlmIChBUlJBWV9CVUZGRVIgJiYgKHJvb3QuSlNfTUQ1X05PX0FSUkFZX0JVRkZFUl9JU19WSUVXIHx8ICFBcnJheUJ1ZmZlci5pc1ZpZXcpKSB7XG4gICAgQXJyYXlCdWZmZXIuaXNWaWV3ID0gZnVuY3Rpb24gKG9iaikge1xuICAgICAgcmV0dXJuIF90eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcgJiYgb2JqLmJ1ZmZlciAmJiBvYmouYnVmZmVyLmNvbnN0cnVjdG9yID09PSBBcnJheUJ1ZmZlcjtcbiAgICB9O1xuICB9XG4gIC8qKlxyXG4gICAqIEBtZXRob2QgaGV4XHJcbiAgICogQG1lbWJlcm9mIG1kNVxyXG4gICAqIEBkZXNjcmlwdGlvbiBPdXRwdXQgaGFzaCBhcyBoZXggc3RyaW5nXHJcbiAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXl8VWludDhBcnJheXxBcnJheUJ1ZmZlcn0gbWVzc2FnZSBtZXNzYWdlIHRvIGhhc2hcclxuICAgKiBAcmV0dXJucyB7U3RyaW5nfSBIZXggc3RyaW5nXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBtZDUuaGV4KCdUaGUgcXVpY2sgYnJvd24gZm94IGp1bXBzIG92ZXIgdGhlIGxhenkgZG9nJyk7XHJcbiAgICogLy8gZXF1YWwgdG9cclxuICAgKiBtZDUoJ1RoZSBxdWljayBicm93biBmb3gganVtcHMgb3ZlciB0aGUgbGF6eSBkb2cnKTtcclxuICAgKi9cblxuICAvKipcclxuICAgKiBAbWV0aG9kIGRpZ2VzdFxyXG4gICAqIEBtZW1iZXJvZiBtZDVcclxuICAgKiBAZGVzY3JpcHRpb24gT3V0cHV0IGhhc2ggYXMgYnl0ZXMgYXJyYXlcclxuICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheXxVaW50OEFycmF5fEFycmF5QnVmZmVyfSBtZXNzYWdlIG1lc3NhZ2UgdG8gaGFzaFxyXG4gICAqIEByZXR1cm5zIHtBcnJheX0gQnl0ZXMgYXJyYXlcclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIG1kNS5kaWdlc3QoJ1RoZSBxdWljayBicm93biBmb3gganVtcHMgb3ZlciB0aGUgbGF6eSBkb2cnKTtcclxuICAgKi9cblxuICAvKipcclxuICAgKiBAbWV0aG9kIGFycmF5XHJcbiAgICogQG1lbWJlcm9mIG1kNVxyXG4gICAqIEBkZXNjcmlwdGlvbiBPdXRwdXQgaGFzaCBhcyBieXRlcyBhcnJheVxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfEFycmF5fFVpbnQ4QXJyYXl8QXJyYXlCdWZmZXJ9IG1lc3NhZ2UgbWVzc2FnZSB0byBoYXNoXHJcbiAgICogQHJldHVybnMge0FycmF5fSBCeXRlcyBhcnJheVxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogbWQ1LmFycmF5KCdUaGUgcXVpY2sgYnJvd24gZm94IGp1bXBzIG92ZXIgdGhlIGxhenkgZG9nJyk7XHJcbiAgICovXG5cbiAgLyoqXHJcbiAgICogQG1ldGhvZCBhcnJheUJ1ZmZlclxyXG4gICAqIEBtZW1iZXJvZiBtZDVcclxuICAgKiBAZGVzY3JpcHRpb24gT3V0cHV0IGhhc2ggYXMgQXJyYXlCdWZmZXJcclxuICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheXxVaW50OEFycmF5fEFycmF5QnVmZmVyfSBtZXNzYWdlIG1lc3NhZ2UgdG8gaGFzaFxyXG4gICAqIEByZXR1cm5zIHtBcnJheUJ1ZmZlcn0gQXJyYXlCdWZmZXJcclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIG1kNS5hcnJheUJ1ZmZlcignVGhlIHF1aWNrIGJyb3duIGZveCBqdW1wcyBvdmVyIHRoZSBsYXp5IGRvZycpO1xyXG4gICAqL1xuXG4gIC8qKlxyXG4gICAqIEBtZXRob2QgYnVmZmVyXHJcbiAgICogQGRlcHJlY2F0ZWQgVGhpcyBtYXliZSBjb25mdXNlIHdpdGggQnVmZmVyIGluIG5vZGUuanMuIFBsZWFzZSB1c2UgYXJyYXlCdWZmZXIgaW5zdGVhZC5cclxuICAgKiBAbWVtYmVyb2YgbWQ1XHJcbiAgICogQGRlc2NyaXB0aW9uIE91dHB1dCBoYXNoIGFzIEFycmF5QnVmZmVyXHJcbiAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXl8VWludDhBcnJheXxBcnJheUJ1ZmZlcn0gbWVzc2FnZSBtZXNzYWdlIHRvIGhhc2hcclxuICAgKiBAcmV0dXJucyB7QXJyYXlCdWZmZXJ9IEFycmF5QnVmZmVyXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBtZDUuYnVmZmVyKCdUaGUgcXVpY2sgYnJvd24gZm94IGp1bXBzIG92ZXIgdGhlIGxhenkgZG9nJyk7XHJcbiAgICovXG5cbiAgLyoqXHJcbiAgICogQG1ldGhvZCBiYXNlNjRcclxuICAgKiBAbWVtYmVyb2YgbWQ1XHJcbiAgICogQGRlc2NyaXB0aW9uIE91dHB1dCBoYXNoIGFzIGJhc2U2NCBzdHJpbmdcclxuICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheXxVaW50OEFycmF5fEFycmF5QnVmZmVyfSBtZXNzYWdlIG1lc3NhZ2UgdG8gaGFzaFxyXG4gICAqIEByZXR1cm5zIHtTdHJpbmd9IGJhc2U2NCBzdHJpbmdcclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIG1kNS5iYXNlNjQoJ1RoZSBxdWljayBicm93biBmb3gganVtcHMgb3ZlciB0aGUgbGF6eSBkb2cnKTtcclxuICAgKi9cblxuXG4gIHZhciBjcmVhdGVPdXRwdXRNZXRob2QgPSBmdW5jdGlvbiBjcmVhdGVPdXRwdXRNZXRob2Qob3V0cHV0VHlwZSkge1xuICAgIHJldHVybiBmdW5jdGlvbiAobWVzc2FnZSwgaXNCaW5TdHIpIHtcbiAgICAgIHJldHVybiBuZXcgTWQ1KHRydWUpLnVwZGF0ZShtZXNzYWdlLCBpc0JpblN0cilbb3V0cHV0VHlwZV0oKTtcbiAgICB9O1xuICB9O1xuICAvKipcclxuICAgKiBAbWV0aG9kIGNyZWF0ZVxyXG4gICAqIEBtZW1iZXJvZiBtZDVcclxuICAgKiBAZGVzY3JpcHRpb24gQ3JlYXRlIE1kNSBvYmplY3RcclxuICAgKiBAcmV0dXJucyB7TWQ1fSBNZDUgb2JqZWN0LlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogdmFyIGhhc2ggPSBtZDUuY3JlYXRlKCk7XHJcbiAgICovXG5cbiAgLyoqXHJcbiAgICogQG1ldGhvZCB1cGRhdGVcclxuICAgKiBAbWVtYmVyb2YgbWQ1XHJcbiAgICogQGRlc2NyaXB0aW9uIENyZWF0ZSBhbmQgdXBkYXRlIE1kNSBvYmplY3RcclxuICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheXxVaW50OEFycmF5fEFycmF5QnVmZmVyfSBtZXNzYWdlIG1lc3NhZ2UgdG8gaGFzaFxyXG4gICAqIEByZXR1cm5zIHtNZDV9IE1kNSBvYmplY3QuXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiB2YXIgaGFzaCA9IG1kNS51cGRhdGUoJ1RoZSBxdWljayBicm93biBmb3gganVtcHMgb3ZlciB0aGUgbGF6eSBkb2cnKTtcclxuICAgKiAvLyBlcXVhbCB0b1xyXG4gICAqIHZhciBoYXNoID0gbWQ1LmNyZWF0ZSgpO1xyXG4gICAqIGhhc2gudXBkYXRlKCdUaGUgcXVpY2sgYnJvd24gZm94IGp1bXBzIG92ZXIgdGhlIGxhenkgZG9nJyk7XHJcbiAgICovXG5cblxuICB2YXIgY3JlYXRlTWV0aG9kID0gZnVuY3Rpb24gY3JlYXRlTWV0aG9kKCkge1xuICAgIHZhciBtZXRob2QgPSBjcmVhdGVPdXRwdXRNZXRob2QoJ2hleCcpO1xuXG4gICAgaWYgKE5PREVfSlMpIHtcbiAgICAgIG1ldGhvZCA9IG5vZGVXcmFwKG1ldGhvZCk7XG4gICAgfVxuXG4gICAgbWV0aG9kLmdldEN0eCA9IG1ldGhvZC5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gbmV3IE1kNSgpO1xuICAgIH07XG5cbiAgICBtZXRob2QudXBkYXRlID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgIHJldHVybiBtZXRob2QuY3JlYXRlKCkudXBkYXRlKG1lc3NhZ2UpO1xuICAgIH07XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IE9VVFBVVF9UWVBFUy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIHR5cGUgPSBPVVRQVVRfVFlQRVNbaV07XG4gICAgICBtZXRob2RbdHlwZV0gPSBjcmVhdGVPdXRwdXRNZXRob2QodHlwZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1ldGhvZDtcbiAgfTtcblxuICB2YXIgbm9kZVdyYXAgPSBmdW5jdGlvbiBub2RlV3JhcChtZXRob2QpIHtcbiAgICB2YXIgY3J5cHRvID0gZXZhbChcInJlcXVpcmUoJ2NyeXB0bycpXCIpO1xuICAgIHZhciBCdWZmZXIgPSBldmFsKFwicmVxdWlyZSgnYnVmZmVyJykuQnVmZmVyXCIpO1xuXG4gICAgdmFyIG5vZGVNZXRob2QgPSBmdW5jdGlvbiBub2RlTWV0aG9kKG1lc3NhZ2UpIHtcbiAgICAgIGlmICh0eXBlb2YgbWVzc2FnZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIGNyeXB0by5jcmVhdGVIYXNoKCdtZDUnKS51cGRhdGUobWVzc2FnZSwgJ3V0ZjgnKS5kaWdlc3QoJ2hleCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKG1lc3NhZ2UgPT09IG51bGwgfHwgbWVzc2FnZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdGhyb3cgRVJST1I7XG4gICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5jb25zdHJ1Y3RvciA9PT0gQXJyYXlCdWZmZXIpIHtcbiAgICAgICAgICBtZXNzYWdlID0gbmV3IFVpbnQ4QXJyYXkobWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkobWVzc2FnZSkgfHwgQXJyYXlCdWZmZXIuaXNWaWV3KG1lc3NhZ2UpIHx8IG1lc3NhZ2UuY29uc3RydWN0b3IgPT09IEJ1ZmZlcikge1xuICAgICAgICByZXR1cm4gY3J5cHRvLmNyZWF0ZUhhc2goJ21kNScpLnVwZGF0ZShuZXcgQnVmZmVyKG1lc3NhZ2UpKS5kaWdlc3QoJ2hleCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG1ldGhvZChtZXNzYWdlKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIG5vZGVNZXRob2Q7XG4gIH07XG4gIC8qKlxyXG4gICAqIE1kNSBjbGFzc1xyXG4gICAqIEBjbGFzcyBNZDVcclxuICAgKiBAZGVzY3JpcHRpb24gVGhpcyBpcyBpbnRlcm5hbCBjbGFzcy5cclxuICAgKiBAc2VlIHtAbGluayBtZDUuY3JlYXRlfVxyXG4gICAqL1xuXG5cbiAgZnVuY3Rpb24gTWQ1KHNoYXJlZE1lbW9yeSkge1xuICAgIGlmIChzaGFyZWRNZW1vcnkpIHtcbiAgICAgIGJsb2Nrc1swXSA9IGJsb2Nrc1sxNl0gPSBibG9ja3NbMV0gPSBibG9ja3NbMl0gPSBibG9ja3NbM10gPSBibG9ja3NbNF0gPSBibG9ja3NbNV0gPSBibG9ja3NbNl0gPSBibG9ja3NbN10gPSBibG9ja3NbOF0gPSBibG9ja3NbOV0gPSBibG9ja3NbMTBdID0gYmxvY2tzWzExXSA9IGJsb2Nrc1sxMl0gPSBibG9ja3NbMTNdID0gYmxvY2tzWzE0XSA9IGJsb2Nrc1sxNV0gPSAwO1xuICAgICAgdGhpcy5ibG9ja3MgPSBibG9ja3M7XG4gICAgICB0aGlzLmJ1ZmZlcjggPSBidWZmZXI4O1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoQVJSQVlfQlVGRkVSKSB7XG4gICAgICAgIHZhciBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoNjgpO1xuICAgICAgICB0aGlzLmJ1ZmZlcjggPSBuZXcgVWludDhBcnJheShidWZmZXIpO1xuICAgICAgICB0aGlzLmJsb2NrcyA9IG5ldyBVaW50MzJBcnJheShidWZmZXIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5ibG9ja3MgPSBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF07XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5oMCA9IHRoaXMuaDEgPSB0aGlzLmgyID0gdGhpcy5oMyA9IHRoaXMuc3RhcnQgPSB0aGlzLmJ5dGVzID0gdGhpcy5oQnl0ZXMgPSAwO1xuICAgIHRoaXMuZmluYWxpemVkID0gdGhpcy5oYXNoZWQgPSBmYWxzZTtcbiAgICB0aGlzLmZpcnN0ID0gdHJ1ZTtcbiAgfVxuICAvKipcclxuICAgKiBAbWV0aG9kIHVwZGF0ZVxyXG4gICAqIEBtZW1iZXJvZiBNZDVcclxuICAgKiBAaW5zdGFuY2VcclxuICAgKiBAZGVzY3JpcHRpb24gVXBkYXRlIGhhc2hcclxuICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheXxVaW50OEFycmF5fEFycmF5QnVmZmVyfSBtZXNzYWdlIG1lc3NhZ2UgdG8gaGFzaFxyXG4gICAqIEByZXR1cm5zIHtNZDV9IE1kNSBvYmplY3QuXHJcbiAgICogQHNlZSB7QGxpbmsgbWQ1LnVwZGF0ZX1cclxuICAgKi9cblxuXG4gIE1kNS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKG1lc3NhZ2UsIGlzQmluU3RyKSB7XG4gICAgaWYgKHRoaXMuZmluYWxpemVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGNvZGUsXG4gICAgICAgIGluZGV4ID0gMCxcbiAgICAgICAgaSxcbiAgICAgICAgbGVuZ3RoID0gbWVzc2FnZS5sZW5ndGgsXG4gICAgICAgIGJsb2NrcyA9IHRoaXMuYmxvY2tzO1xuICAgIHZhciBidWZmZXI4ID0gdGhpcy5idWZmZXI4O1xuXG4gICAgd2hpbGUgKGluZGV4IDwgbGVuZ3RoKSB7XG4gICAgICBpZiAodGhpcy5oYXNoZWQpIHtcbiAgICAgICAgdGhpcy5oYXNoZWQgPSBmYWxzZTtcbiAgICAgICAgYmxvY2tzWzBdID0gYmxvY2tzWzE2XTtcbiAgICAgICAgYmxvY2tzWzE2XSA9IGJsb2Nrc1sxXSA9IGJsb2Nrc1syXSA9IGJsb2Nrc1szXSA9IGJsb2Nrc1s0XSA9IGJsb2Nrc1s1XSA9IGJsb2Nrc1s2XSA9IGJsb2Nrc1s3XSA9IGJsb2Nrc1s4XSA9IGJsb2Nrc1s5XSA9IGJsb2Nrc1sxMF0gPSBibG9ja3NbMTFdID0gYmxvY2tzWzEyXSA9IGJsb2Nrc1sxM10gPSBibG9ja3NbMTRdID0gYmxvY2tzWzE1XSA9IDA7XG4gICAgICB9XG5cbiAgICAgIGlmIChBUlJBWV9CVUZGRVIpIHtcbiAgICAgICAgZm9yIChpID0gdGhpcy5zdGFydDsgaW5kZXggPCBsZW5ndGggJiYgaSA8IDY0OyArK2luZGV4KSB7XG4gICAgICAgICAgY29kZSA9IG1lc3NhZ2UuY2hhckNvZGVBdChpbmRleCk7XG5cbiAgICAgICAgICBpZiAoaXNCaW5TdHIgfHwgY29kZSA8IDB4ODApIHtcbiAgICAgICAgICAgIGJ1ZmZlcjhbaSsrXSA9IGNvZGU7XG4gICAgICAgICAgfSBlbHNlIGlmIChjb2RlIDwgMHg4MDApIHtcbiAgICAgICAgICAgIGJ1ZmZlcjhbaSsrXSA9IDB4YzAgfCBjb2RlID4+IDY7XG4gICAgICAgICAgICBidWZmZXI4W2krK10gPSAweDgwIHwgY29kZSAmIDB4M2Y7XG4gICAgICAgICAgfSBlbHNlIGlmIChjb2RlIDwgMHhkODAwIHx8IGNvZGUgPj0gMHhlMDAwKSB7XG4gICAgICAgICAgICBidWZmZXI4W2krK10gPSAweGUwIHwgY29kZSA+PiAxMjtcbiAgICAgICAgICAgIGJ1ZmZlcjhbaSsrXSA9IDB4ODAgfCBjb2RlID4+IDYgJiAweDNmO1xuICAgICAgICAgICAgYnVmZmVyOFtpKytdID0gMHg4MCB8IGNvZGUgJiAweDNmO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb2RlID0gMHgxMDAwMCArICgoY29kZSAmIDB4M2ZmKSA8PCAxMCB8IG1lc3NhZ2UuY2hhckNvZGVBdCgrK2luZGV4KSAmIDB4M2ZmKTtcbiAgICAgICAgICAgIGJ1ZmZlcjhbaSsrXSA9IDB4ZjAgfCBjb2RlID4+IDE4O1xuICAgICAgICAgICAgYnVmZmVyOFtpKytdID0gMHg4MCB8IGNvZGUgPj4gMTIgJiAweDNmO1xuICAgICAgICAgICAgYnVmZmVyOFtpKytdID0gMHg4MCB8IGNvZGUgPj4gNiAmIDB4M2Y7XG4gICAgICAgICAgICBidWZmZXI4W2krK10gPSAweDgwIHwgY29kZSAmIDB4M2Y7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmb3IgKGkgPSB0aGlzLnN0YXJ0OyBpbmRleCA8IGxlbmd0aCAmJiBpIDwgNjQ7ICsraW5kZXgpIHtcbiAgICAgICAgICBjb2RlID0gbWVzc2FnZS5jaGFyQ29kZUF0KGluZGV4KTtcblxuICAgICAgICAgIGlmIChpc0JpblN0ciB8fCBjb2RlIDwgMHg4MCkge1xuICAgICAgICAgICAgYmxvY2tzW2kgPj4gMl0gfD0gY29kZSA8PCBTSElGVFtpKysgJiAzXTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPCAweDgwMCkge1xuICAgICAgICAgICAgYmxvY2tzW2kgPj4gMl0gfD0gKDB4YzAgfCBjb2RlID4+IDYpIDw8IFNISUZUW2krKyAmIDNdO1xuICAgICAgICAgICAgYmxvY2tzW2kgPj4gMl0gfD0gKDB4ODAgfCBjb2RlICYgMHgzZikgPDwgU0hJRlRbaSsrICYgM107XG4gICAgICAgICAgfSBlbHNlIGlmIChjb2RlIDwgMHhkODAwIHx8IGNvZGUgPj0gMHhlMDAwKSB7XG4gICAgICAgICAgICBibG9ja3NbaSA+PiAyXSB8PSAoMHhlMCB8IGNvZGUgPj4gMTIpIDw8IFNISUZUW2krKyAmIDNdO1xuICAgICAgICAgICAgYmxvY2tzW2kgPj4gMl0gfD0gKDB4ODAgfCBjb2RlID4+IDYgJiAweDNmKSA8PCBTSElGVFtpKysgJiAzXTtcbiAgICAgICAgICAgIGJsb2Nrc1tpID4+IDJdIHw9ICgweDgwIHwgY29kZSAmIDB4M2YpIDw8IFNISUZUW2krKyAmIDNdO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb2RlID0gMHgxMDAwMCArICgoY29kZSAmIDB4M2ZmKSA8PCAxMCB8IG1lc3NhZ2UuY2hhckNvZGVBdCgrK2luZGV4KSAmIDB4M2ZmKTtcbiAgICAgICAgICAgIGJsb2Nrc1tpID4+IDJdIHw9ICgweGYwIHwgY29kZSA+PiAxOCkgPDwgU0hJRlRbaSsrICYgM107XG4gICAgICAgICAgICBibG9ja3NbaSA+PiAyXSB8PSAoMHg4MCB8IGNvZGUgPj4gMTIgJiAweDNmKSA8PCBTSElGVFtpKysgJiAzXTtcbiAgICAgICAgICAgIGJsb2Nrc1tpID4+IDJdIHw9ICgweDgwIHwgY29kZSA+PiA2ICYgMHgzZikgPDwgU0hJRlRbaSsrICYgM107XG4gICAgICAgICAgICBibG9ja3NbaSA+PiAyXSB8PSAoMHg4MCB8IGNvZGUgJiAweDNmKSA8PCBTSElGVFtpKysgJiAzXTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5sYXN0Qnl0ZUluZGV4ID0gaTtcbiAgICAgIHRoaXMuYnl0ZXMgKz0gaSAtIHRoaXMuc3RhcnQ7XG5cbiAgICAgIGlmIChpID49IDY0KSB7XG4gICAgICAgIHRoaXMuc3RhcnQgPSBpIC0gNjQ7XG4gICAgICAgIHRoaXMuaGFzaCgpO1xuICAgICAgICB0aGlzLmhhc2hlZCA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnN0YXJ0ID0gaTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5ieXRlcyA+IDQyOTQ5NjcyOTUpIHtcbiAgICAgIHRoaXMuaEJ5dGVzICs9IHRoaXMuYnl0ZXMgLyA0Mjk0OTY3Mjk2IDw8IDA7XG4gICAgICB0aGlzLmJ5dGVzID0gdGhpcy5ieXRlcyAlIDQyOTQ5NjcyOTY7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgTWQ1LnByb3RvdHlwZS5maW5hbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5maW5hbGl6ZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmZpbmFsaXplZCA9IHRydWU7XG4gICAgdmFyIGJsb2NrcyA9IHRoaXMuYmxvY2tzLFxuICAgICAgICBpID0gdGhpcy5sYXN0Qnl0ZUluZGV4O1xuICAgIGJsb2Nrc1tpID4+IDJdIHw9IEVYVFJBW2kgJiAzXTtcblxuICAgIGlmIChpID49IDU2KSB7XG4gICAgICBpZiAoIXRoaXMuaGFzaGVkKSB7XG4gICAgICAgIHRoaXMuaGFzaCgpO1xuICAgICAgfVxuXG4gICAgICBibG9ja3NbMF0gPSBibG9ja3NbMTZdO1xuICAgICAgYmxvY2tzWzE2XSA9IGJsb2Nrc1sxXSA9IGJsb2Nrc1syXSA9IGJsb2Nrc1szXSA9IGJsb2Nrc1s0XSA9IGJsb2Nrc1s1XSA9IGJsb2Nrc1s2XSA9IGJsb2Nrc1s3XSA9IGJsb2Nrc1s4XSA9IGJsb2Nrc1s5XSA9IGJsb2Nrc1sxMF0gPSBibG9ja3NbMTFdID0gYmxvY2tzWzEyXSA9IGJsb2Nrc1sxM10gPSBibG9ja3NbMTRdID0gYmxvY2tzWzE1XSA9IDA7XG4gICAgfVxuXG4gICAgYmxvY2tzWzE0XSA9IHRoaXMuYnl0ZXMgPDwgMztcbiAgICBibG9ja3NbMTVdID0gdGhpcy5oQnl0ZXMgPDwgMyB8IHRoaXMuYnl0ZXMgPj4+IDI5O1xuICAgIHRoaXMuaGFzaCgpO1xuICB9O1xuXG4gIE1kNS5wcm90b3R5cGUuaGFzaCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgYSxcbiAgICAgICAgYixcbiAgICAgICAgYyxcbiAgICAgICAgZCxcbiAgICAgICAgYmMsXG4gICAgICAgIGRhLFxuICAgICAgICBibG9ja3MgPSB0aGlzLmJsb2NrcztcblxuICAgIGlmICh0aGlzLmZpcnN0KSB7XG4gICAgICBhID0gYmxvY2tzWzBdIC0gNjgwODc2OTM3O1xuICAgICAgYSA9IChhIDw8IDcgfCBhID4+PiAyNSkgLSAyNzE3MzM4NzkgPDwgMDtcbiAgICAgIGQgPSAoLTE3MzI1ODQxOTQgXiBhICYgMjAwNDMxODA3MSkgKyBibG9ja3NbMV0gLSAxMTc4MzA3MDg7XG4gICAgICBkID0gKGQgPDwgMTIgfCBkID4+PiAyMCkgKyBhIDw8IDA7XG4gICAgICBjID0gKC0yNzE3MzM4NzkgXiBkICYgKGEgXiAtMjcxNzMzODc5KSkgKyBibG9ja3NbMl0gLSAxMTI2NDc4Mzc1O1xuICAgICAgYyA9IChjIDw8IDE3IHwgYyA+Pj4gMTUpICsgZCA8PCAwO1xuICAgICAgYiA9IChhIF4gYyAmIChkIF4gYSkpICsgYmxvY2tzWzNdIC0gMTMxNjI1OTIwOTtcbiAgICAgIGIgPSAoYiA8PCAyMiB8IGIgPj4+IDEwKSArIGMgPDwgMDtcbiAgICB9IGVsc2Uge1xuICAgICAgYSA9IHRoaXMuaDA7XG4gICAgICBiID0gdGhpcy5oMTtcbiAgICAgIGMgPSB0aGlzLmgyO1xuICAgICAgZCA9IHRoaXMuaDM7XG4gICAgICBhICs9IChkIF4gYiAmIChjIF4gZCkpICsgYmxvY2tzWzBdIC0gNjgwODc2OTM2O1xuICAgICAgYSA9IChhIDw8IDcgfCBhID4+PiAyNSkgKyBiIDw8IDA7XG4gICAgICBkICs9IChjIF4gYSAmIChiIF4gYykpICsgYmxvY2tzWzFdIC0gMzg5NTY0NTg2O1xuICAgICAgZCA9IChkIDw8IDEyIHwgZCA+Pj4gMjApICsgYSA8PCAwO1xuICAgICAgYyArPSAoYiBeIGQgJiAoYSBeIGIpKSArIGJsb2Nrc1syXSArIDYwNjEwNTgxOTtcbiAgICAgIGMgPSAoYyA8PCAxNyB8IGMgPj4+IDE1KSArIGQgPDwgMDtcbiAgICAgIGIgKz0gKGEgXiBjICYgKGQgXiBhKSkgKyBibG9ja3NbM10gLSAxMDQ0NTI1MzMwO1xuICAgICAgYiA9IChiIDw8IDIyIHwgYiA+Pj4gMTApICsgYyA8PCAwO1xuICAgIH1cblxuICAgIGEgKz0gKGQgXiBiICYgKGMgXiBkKSkgKyBibG9ja3NbNF0gLSAxNzY0MTg4OTc7XG4gICAgYSA9IChhIDw8IDcgfCBhID4+PiAyNSkgKyBiIDw8IDA7XG4gICAgZCArPSAoYyBeIGEgJiAoYiBeIGMpKSArIGJsb2Nrc1s1XSArIDEyMDAwODA0MjY7XG4gICAgZCA9IChkIDw8IDEyIHwgZCA+Pj4gMjApICsgYSA8PCAwO1xuICAgIGMgKz0gKGIgXiBkICYgKGEgXiBiKSkgKyBibG9ja3NbNl0gLSAxNDczMjMxMzQxO1xuICAgIGMgPSAoYyA8PCAxNyB8IGMgPj4+IDE1KSArIGQgPDwgMDtcbiAgICBiICs9IChhIF4gYyAmIChkIF4gYSkpICsgYmxvY2tzWzddIC0gNDU3MDU5ODM7XG4gICAgYiA9IChiIDw8IDIyIHwgYiA+Pj4gMTApICsgYyA8PCAwO1xuICAgIGEgKz0gKGQgXiBiICYgKGMgXiBkKSkgKyBibG9ja3NbOF0gKyAxNzcwMDM1NDE2O1xuICAgIGEgPSAoYSA8PCA3IHwgYSA+Pj4gMjUpICsgYiA8PCAwO1xuICAgIGQgKz0gKGMgXiBhICYgKGIgXiBjKSkgKyBibG9ja3NbOV0gLSAxOTU4NDE0NDE3O1xuICAgIGQgPSAoZCA8PCAxMiB8IGQgPj4+IDIwKSArIGEgPDwgMDtcbiAgICBjICs9IChiIF4gZCAmIChhIF4gYikpICsgYmxvY2tzWzEwXSAtIDQyMDYzO1xuICAgIGMgPSAoYyA8PCAxNyB8IGMgPj4+IDE1KSArIGQgPDwgMDtcbiAgICBiICs9IChhIF4gYyAmIChkIF4gYSkpICsgYmxvY2tzWzExXSAtIDE5OTA0MDQxNjI7XG4gICAgYiA9IChiIDw8IDIyIHwgYiA+Pj4gMTApICsgYyA8PCAwO1xuICAgIGEgKz0gKGQgXiBiICYgKGMgXiBkKSkgKyBibG9ja3NbMTJdICsgMTgwNDYwMzY4MjtcbiAgICBhID0gKGEgPDwgNyB8IGEgPj4+IDI1KSArIGIgPDwgMDtcbiAgICBkICs9IChjIF4gYSAmIChiIF4gYykpICsgYmxvY2tzWzEzXSAtIDQwMzQxMTAxO1xuICAgIGQgPSAoZCA8PCAxMiB8IGQgPj4+IDIwKSArIGEgPDwgMDtcbiAgICBjICs9IChiIF4gZCAmIChhIF4gYikpICsgYmxvY2tzWzE0XSAtIDE1MDIwMDIyOTA7XG4gICAgYyA9IChjIDw8IDE3IHwgYyA+Pj4gMTUpICsgZCA8PCAwO1xuICAgIGIgKz0gKGEgXiBjICYgKGQgXiBhKSkgKyBibG9ja3NbMTVdICsgMTIzNjUzNTMyOTtcbiAgICBiID0gKGIgPDwgMjIgfCBiID4+PiAxMCkgKyBjIDw8IDA7XG4gICAgYSArPSAoYyBeIGQgJiAoYiBeIGMpKSArIGJsb2Nrc1sxXSAtIDE2NTc5NjUxMDtcbiAgICBhID0gKGEgPDwgNSB8IGEgPj4+IDI3KSArIGIgPDwgMDtcbiAgICBkICs9IChiIF4gYyAmIChhIF4gYikpICsgYmxvY2tzWzZdIC0gMTA2OTUwMTYzMjtcbiAgICBkID0gKGQgPDwgOSB8IGQgPj4+IDIzKSArIGEgPDwgMDtcbiAgICBjICs9IChhIF4gYiAmIChkIF4gYSkpICsgYmxvY2tzWzExXSArIDY0MzcxNzcxMztcbiAgICBjID0gKGMgPDwgMTQgfCBjID4+PiAxOCkgKyBkIDw8IDA7XG4gICAgYiArPSAoZCBeIGEgJiAoYyBeIGQpKSArIGJsb2Nrc1swXSAtIDM3Mzg5NzMwMjtcbiAgICBiID0gKGIgPDwgMjAgfCBiID4+PiAxMikgKyBjIDw8IDA7XG4gICAgYSArPSAoYyBeIGQgJiAoYiBeIGMpKSArIGJsb2Nrc1s1XSAtIDcwMTU1ODY5MTtcbiAgICBhID0gKGEgPDwgNSB8IGEgPj4+IDI3KSArIGIgPDwgMDtcbiAgICBkICs9IChiIF4gYyAmIChhIF4gYikpICsgYmxvY2tzWzEwXSArIDM4MDE2MDgzO1xuICAgIGQgPSAoZCA8PCA5IHwgZCA+Pj4gMjMpICsgYSA8PCAwO1xuICAgIGMgKz0gKGEgXiBiICYgKGQgXiBhKSkgKyBibG9ja3NbMTVdIC0gNjYwNDc4MzM1O1xuICAgIGMgPSAoYyA8PCAxNCB8IGMgPj4+IDE4KSArIGQgPDwgMDtcbiAgICBiICs9IChkIF4gYSAmIChjIF4gZCkpICsgYmxvY2tzWzRdIC0gNDA1NTM3ODQ4O1xuICAgIGIgPSAoYiA8PCAyMCB8IGIgPj4+IDEyKSArIGMgPDwgMDtcbiAgICBhICs9IChjIF4gZCAmIChiIF4gYykpICsgYmxvY2tzWzldICsgNTY4NDQ2NDM4O1xuICAgIGEgPSAoYSA8PCA1IHwgYSA+Pj4gMjcpICsgYiA8PCAwO1xuICAgIGQgKz0gKGIgXiBjICYgKGEgXiBiKSkgKyBibG9ja3NbMTRdIC0gMTAxOTgwMzY5MDtcbiAgICBkID0gKGQgPDwgOSB8IGQgPj4+IDIzKSArIGEgPDwgMDtcbiAgICBjICs9IChhIF4gYiAmIChkIF4gYSkpICsgYmxvY2tzWzNdIC0gMTg3MzYzOTYxO1xuICAgIGMgPSAoYyA8PCAxNCB8IGMgPj4+IDE4KSArIGQgPDwgMDtcbiAgICBiICs9IChkIF4gYSAmIChjIF4gZCkpICsgYmxvY2tzWzhdICsgMTE2MzUzMTUwMTtcbiAgICBiID0gKGIgPDwgMjAgfCBiID4+PiAxMikgKyBjIDw8IDA7XG4gICAgYSArPSAoYyBeIGQgJiAoYiBeIGMpKSArIGJsb2Nrc1sxM10gLSAxNDQ0NjgxNDY3O1xuICAgIGEgPSAoYSA8PCA1IHwgYSA+Pj4gMjcpICsgYiA8PCAwO1xuICAgIGQgKz0gKGIgXiBjICYgKGEgXiBiKSkgKyBibG9ja3NbMl0gLSA1MTQwMzc4NDtcbiAgICBkID0gKGQgPDwgOSB8IGQgPj4+IDIzKSArIGEgPDwgMDtcbiAgICBjICs9IChhIF4gYiAmIChkIF4gYSkpICsgYmxvY2tzWzddICsgMTczNTMyODQ3MztcbiAgICBjID0gKGMgPDwgMTQgfCBjID4+PiAxOCkgKyBkIDw8IDA7XG4gICAgYiArPSAoZCBeIGEgJiAoYyBeIGQpKSArIGJsb2Nrc1sxMl0gLSAxOTI2NjA3NzM0O1xuICAgIGIgPSAoYiA8PCAyMCB8IGIgPj4+IDEyKSArIGMgPDwgMDtcbiAgICBiYyA9IGIgXiBjO1xuICAgIGEgKz0gKGJjIF4gZCkgKyBibG9ja3NbNV0gLSAzNzg1NTg7XG4gICAgYSA9IChhIDw8IDQgfCBhID4+PiAyOCkgKyBiIDw8IDA7XG4gICAgZCArPSAoYmMgXiBhKSArIGJsb2Nrc1s4XSAtIDIwMjI1NzQ0NjM7XG4gICAgZCA9IChkIDw8IDExIHwgZCA+Pj4gMjEpICsgYSA8PCAwO1xuICAgIGRhID0gZCBeIGE7XG4gICAgYyArPSAoZGEgXiBiKSArIGJsb2Nrc1sxMV0gKyAxODM5MDMwNTYyO1xuICAgIGMgPSAoYyA8PCAxNiB8IGMgPj4+IDE2KSArIGQgPDwgMDtcbiAgICBiICs9IChkYSBeIGMpICsgYmxvY2tzWzE0XSAtIDM1MzA5NTU2O1xuICAgIGIgPSAoYiA8PCAyMyB8IGIgPj4+IDkpICsgYyA8PCAwO1xuICAgIGJjID0gYiBeIGM7XG4gICAgYSArPSAoYmMgXiBkKSArIGJsb2Nrc1sxXSAtIDE1MzA5OTIwNjA7XG4gICAgYSA9IChhIDw8IDQgfCBhID4+PiAyOCkgKyBiIDw8IDA7XG4gICAgZCArPSAoYmMgXiBhKSArIGJsb2Nrc1s0XSArIDEyNzI4OTMzNTM7XG4gICAgZCA9IChkIDw8IDExIHwgZCA+Pj4gMjEpICsgYSA8PCAwO1xuICAgIGRhID0gZCBeIGE7XG4gICAgYyArPSAoZGEgXiBiKSArIGJsb2Nrc1s3XSAtIDE1NTQ5NzYzMjtcbiAgICBjID0gKGMgPDwgMTYgfCBjID4+PiAxNikgKyBkIDw8IDA7XG4gICAgYiArPSAoZGEgXiBjKSArIGJsb2Nrc1sxMF0gLSAxMDk0NzMwNjQwO1xuICAgIGIgPSAoYiA8PCAyMyB8IGIgPj4+IDkpICsgYyA8PCAwO1xuICAgIGJjID0gYiBeIGM7XG4gICAgYSArPSAoYmMgXiBkKSArIGJsb2Nrc1sxM10gKyA2ODEyNzkxNzQ7XG4gICAgYSA9IChhIDw8IDQgfCBhID4+PiAyOCkgKyBiIDw8IDA7XG4gICAgZCArPSAoYmMgXiBhKSArIGJsb2Nrc1swXSAtIDM1ODUzNzIyMjtcbiAgICBkID0gKGQgPDwgMTEgfCBkID4+PiAyMSkgKyBhIDw8IDA7XG4gICAgZGEgPSBkIF4gYTtcbiAgICBjICs9IChkYSBeIGIpICsgYmxvY2tzWzNdIC0gNzIyNTIxOTc5O1xuICAgIGMgPSAoYyA8PCAxNiB8IGMgPj4+IDE2KSArIGQgPDwgMDtcbiAgICBiICs9IChkYSBeIGMpICsgYmxvY2tzWzZdICsgNzYwMjkxODk7XG4gICAgYiA9IChiIDw8IDIzIHwgYiA+Pj4gOSkgKyBjIDw8IDA7XG4gICAgYmMgPSBiIF4gYztcbiAgICBhICs9IChiYyBeIGQpICsgYmxvY2tzWzldIC0gNjQwMzY0NDg3O1xuICAgIGEgPSAoYSA8PCA0IHwgYSA+Pj4gMjgpICsgYiA8PCAwO1xuICAgIGQgKz0gKGJjIF4gYSkgKyBibG9ja3NbMTJdIC0gNDIxODE1ODM1O1xuICAgIGQgPSAoZCA8PCAxMSB8IGQgPj4+IDIxKSArIGEgPDwgMDtcbiAgICBkYSA9IGQgXiBhO1xuICAgIGMgKz0gKGRhIF4gYikgKyBibG9ja3NbMTVdICsgNTMwNzQyNTIwO1xuICAgIGMgPSAoYyA8PCAxNiB8IGMgPj4+IDE2KSArIGQgPDwgMDtcbiAgICBiICs9IChkYSBeIGMpICsgYmxvY2tzWzJdIC0gOTk1MzM4NjUxO1xuICAgIGIgPSAoYiA8PCAyMyB8IGIgPj4+IDkpICsgYyA8PCAwO1xuICAgIGEgKz0gKGMgXiAoYiB8IH5kKSkgKyBibG9ja3NbMF0gLSAxOTg2MzA4NDQ7XG4gICAgYSA9IChhIDw8IDYgfCBhID4+PiAyNikgKyBiIDw8IDA7XG4gICAgZCArPSAoYiBeIChhIHwgfmMpKSArIGJsb2Nrc1s3XSArIDExMjY4OTE0MTU7XG4gICAgZCA9IChkIDw8IDEwIHwgZCA+Pj4gMjIpICsgYSA8PCAwO1xuICAgIGMgKz0gKGEgXiAoZCB8IH5iKSkgKyBibG9ja3NbMTRdIC0gMTQxNjM1NDkwNTtcbiAgICBjID0gKGMgPDwgMTUgfCBjID4+PiAxNykgKyBkIDw8IDA7XG4gICAgYiArPSAoZCBeIChjIHwgfmEpKSArIGJsb2Nrc1s1XSAtIDU3NDM0MDU1O1xuICAgIGIgPSAoYiA8PCAyMSB8IGIgPj4+IDExKSArIGMgPDwgMDtcbiAgICBhICs9IChjIF4gKGIgfCB+ZCkpICsgYmxvY2tzWzEyXSArIDE3MDA0ODU1NzE7XG4gICAgYSA9IChhIDw8IDYgfCBhID4+PiAyNikgKyBiIDw8IDA7XG4gICAgZCArPSAoYiBeIChhIHwgfmMpKSArIGJsb2Nrc1szXSAtIDE4OTQ5ODY2MDY7XG4gICAgZCA9IChkIDw8IDEwIHwgZCA+Pj4gMjIpICsgYSA8PCAwO1xuICAgIGMgKz0gKGEgXiAoZCB8IH5iKSkgKyBibG9ja3NbMTBdIC0gMTA1MTUyMztcbiAgICBjID0gKGMgPDwgMTUgfCBjID4+PiAxNykgKyBkIDw8IDA7XG4gICAgYiArPSAoZCBeIChjIHwgfmEpKSArIGJsb2Nrc1sxXSAtIDIwNTQ5MjI3OTk7XG4gICAgYiA9IChiIDw8IDIxIHwgYiA+Pj4gMTEpICsgYyA8PCAwO1xuICAgIGEgKz0gKGMgXiAoYiB8IH5kKSkgKyBibG9ja3NbOF0gKyAxODczMzEzMzU5O1xuICAgIGEgPSAoYSA8PCA2IHwgYSA+Pj4gMjYpICsgYiA8PCAwO1xuICAgIGQgKz0gKGIgXiAoYSB8IH5jKSkgKyBibG9ja3NbMTVdIC0gMzA2MTE3NDQ7XG4gICAgZCA9IChkIDw8IDEwIHwgZCA+Pj4gMjIpICsgYSA8PCAwO1xuICAgIGMgKz0gKGEgXiAoZCB8IH5iKSkgKyBibG9ja3NbNl0gLSAxNTYwMTk4MzgwO1xuICAgIGMgPSAoYyA8PCAxNSB8IGMgPj4+IDE3KSArIGQgPDwgMDtcbiAgICBiICs9IChkIF4gKGMgfCB+YSkpICsgYmxvY2tzWzEzXSArIDEzMDkxNTE2NDk7XG4gICAgYiA9IChiIDw8IDIxIHwgYiA+Pj4gMTEpICsgYyA8PCAwO1xuICAgIGEgKz0gKGMgXiAoYiB8IH5kKSkgKyBibG9ja3NbNF0gLSAxNDU1MjMwNzA7XG4gICAgYSA9IChhIDw8IDYgfCBhID4+PiAyNikgKyBiIDw8IDA7XG4gICAgZCArPSAoYiBeIChhIHwgfmMpKSArIGJsb2Nrc1sxMV0gLSAxMTIwMjEwMzc5O1xuICAgIGQgPSAoZCA8PCAxMCB8IGQgPj4+IDIyKSArIGEgPDwgMDtcbiAgICBjICs9IChhIF4gKGQgfCB+YikpICsgYmxvY2tzWzJdICsgNzE4Nzg3MjU5O1xuICAgIGMgPSAoYyA8PCAxNSB8IGMgPj4+IDE3KSArIGQgPDwgMDtcbiAgICBiICs9IChkIF4gKGMgfCB+YSkpICsgYmxvY2tzWzldIC0gMzQzNDg1NTUxO1xuICAgIGIgPSAoYiA8PCAyMSB8IGIgPj4+IDExKSArIGMgPDwgMDtcblxuICAgIGlmICh0aGlzLmZpcnN0KSB7XG4gICAgICB0aGlzLmgwID0gYSArIDE3MzI1ODQxOTMgPDwgMDtcbiAgICAgIHRoaXMuaDEgPSBiIC0gMjcxNzMzODc5IDw8IDA7XG4gICAgICB0aGlzLmgyID0gYyAtIDE3MzI1ODQxOTQgPDwgMDtcbiAgICAgIHRoaXMuaDMgPSBkICsgMjcxNzMzODc4IDw8IDA7XG4gICAgICB0aGlzLmZpcnN0ID0gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaDAgPSB0aGlzLmgwICsgYSA8PCAwO1xuICAgICAgdGhpcy5oMSA9IHRoaXMuaDEgKyBiIDw8IDA7XG4gICAgICB0aGlzLmgyID0gdGhpcy5oMiArIGMgPDwgMDtcbiAgICAgIHRoaXMuaDMgPSB0aGlzLmgzICsgZCA8PCAwO1xuICAgIH1cbiAgfTtcbiAgLyoqXHJcbiAgICogQG1ldGhvZCBoZXhcclxuICAgKiBAbWVtYmVyb2YgTWQ1XHJcbiAgICogQGluc3RhbmNlXHJcbiAgICogQGRlc2NyaXB0aW9uIE91dHB1dCBoYXNoIGFzIGhleCBzdHJpbmdcclxuICAgKiBAcmV0dXJucyB7U3RyaW5nfSBIZXggc3RyaW5nXHJcbiAgICogQHNlZSB7QGxpbmsgbWQ1LmhleH1cclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIGhhc2guaGV4KCk7XHJcbiAgICovXG5cblxuICBNZDUucHJvdG90eXBlLmhleCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmZpbmFsaXplKCk7XG4gICAgdmFyIGgwID0gdGhpcy5oMCxcbiAgICAgICAgaDEgPSB0aGlzLmgxLFxuICAgICAgICBoMiA9IHRoaXMuaDIsXG4gICAgICAgIGgzID0gdGhpcy5oMztcbiAgICByZXR1cm4gSEVYX0NIQVJTW2gwID4+IDQgJiAweDBGXSArIEhFWF9DSEFSU1toMCAmIDB4MEZdICsgSEVYX0NIQVJTW2gwID4+IDEyICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDAgPj4gOCAmIDB4MEZdICsgSEVYX0NIQVJTW2gwID4+IDIwICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDAgPj4gMTYgJiAweDBGXSArIEhFWF9DSEFSU1toMCA+PiAyOCAmIDB4MEZdICsgSEVYX0NIQVJTW2gwID4+IDI0ICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDEgPj4gNCAmIDB4MEZdICsgSEVYX0NIQVJTW2gxICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDEgPj4gMTIgJiAweDBGXSArIEhFWF9DSEFSU1toMSA+PiA4ICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDEgPj4gMjAgJiAweDBGXSArIEhFWF9DSEFSU1toMSA+PiAxNiAmIDB4MEZdICsgSEVYX0NIQVJTW2gxID4+IDI4ICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDEgPj4gMjQgJiAweDBGXSArIEhFWF9DSEFSU1toMiA+PiA0ICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDIgJiAweDBGXSArIEhFWF9DSEFSU1toMiA+PiAxMiAmIDB4MEZdICsgSEVYX0NIQVJTW2gyID4+IDggJiAweDBGXSArIEhFWF9DSEFSU1toMiA+PiAyMCAmIDB4MEZdICsgSEVYX0NIQVJTW2gyID4+IDE2ICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDIgPj4gMjggJiAweDBGXSArIEhFWF9DSEFSU1toMiA+PiAyNCAmIDB4MEZdICsgSEVYX0NIQVJTW2gzID4+IDQgJiAweDBGXSArIEhFWF9DSEFSU1toMyAmIDB4MEZdICsgSEVYX0NIQVJTW2gzID4+IDEyICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDMgPj4gOCAmIDB4MEZdICsgSEVYX0NIQVJTW2gzID4+IDIwICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDMgPj4gMTYgJiAweDBGXSArIEhFWF9DSEFSU1toMyA+PiAyOCAmIDB4MEZdICsgSEVYX0NIQVJTW2gzID4+IDI0ICYgMHgwRl07XG4gIH07XG4gIC8qKlxyXG4gICAqIEBtZXRob2QgdG9TdHJpbmdcclxuICAgKiBAbWVtYmVyb2YgTWQ1XHJcbiAgICogQGluc3RhbmNlXHJcbiAgICogQGRlc2NyaXB0aW9uIE91dHB1dCBoYXNoIGFzIGhleCBzdHJpbmdcclxuICAgKiBAcmV0dXJucyB7U3RyaW5nfSBIZXggc3RyaW5nXHJcbiAgICogQHNlZSB7QGxpbmsgbWQ1LmhleH1cclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIGhhc2gudG9TdHJpbmcoKTtcclxuICAgKi9cblxuXG4gIE1kNS5wcm90b3R5cGUudG9TdHJpbmcgPSBNZDUucHJvdG90eXBlLmhleDtcbiAgLyoqXHJcbiAgICogQG1ldGhvZCBkaWdlc3RcclxuICAgKiBAbWVtYmVyb2YgTWQ1XHJcbiAgICogQGluc3RhbmNlXHJcbiAgICogQGRlc2NyaXB0aW9uIE91dHB1dCBoYXNoIGFzIGJ5dGVzIGFycmF5XHJcbiAgICogQHJldHVybnMge0FycmF5fSBCeXRlcyBhcnJheVxyXG4gICAqIEBzZWUge0BsaW5rIG1kNS5kaWdlc3R9XHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBoYXNoLmRpZ2VzdCgpO1xyXG4gICAqL1xuXG4gIE1kNS5wcm90b3R5cGUuZGlnZXN0ID0gZnVuY3Rpb24gKGZvcm1hdCkge1xuICAgIGlmIChmb3JtYXQgPT09ICdoZXgnKSByZXR1cm4gdGhpcy5oZXgoKTtcbiAgICB0aGlzLmZpbmFsaXplKCk7XG4gICAgdmFyIGgwID0gdGhpcy5oMCxcbiAgICAgICAgaDEgPSB0aGlzLmgxLFxuICAgICAgICBoMiA9IHRoaXMuaDIsXG4gICAgICAgIGgzID0gdGhpcy5oMztcbiAgICB2YXIgcmVzID0gW2gwICYgMHhGRiwgaDAgPj4gOCAmIDB4RkYsIGgwID4+IDE2ICYgMHhGRiwgaDAgPj4gMjQgJiAweEZGLCBoMSAmIDB4RkYsIGgxID4+IDggJiAweEZGLCBoMSA+PiAxNiAmIDB4RkYsIGgxID4+IDI0ICYgMHhGRiwgaDIgJiAweEZGLCBoMiA+PiA4ICYgMHhGRiwgaDIgPj4gMTYgJiAweEZGLCBoMiA+PiAyNCAmIDB4RkYsIGgzICYgMHhGRiwgaDMgPj4gOCAmIDB4RkYsIGgzID4+IDE2ICYgMHhGRiwgaDMgPj4gMjQgJiAweEZGXTtcbiAgICByZXR1cm4gcmVzO1xuICB9O1xuICAvKipcclxuICAgKiBAbWV0aG9kIGFycmF5XHJcbiAgICogQG1lbWJlcm9mIE1kNVxyXG4gICAqIEBpbnN0YW5jZVxyXG4gICAqIEBkZXNjcmlwdGlvbiBPdXRwdXQgaGFzaCBhcyBieXRlcyBhcnJheVxyXG4gICAqIEByZXR1cm5zIHtBcnJheX0gQnl0ZXMgYXJyYXlcclxuICAgKiBAc2VlIHtAbGluayBtZDUuYXJyYXl9XHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBoYXNoLmFycmF5KCk7XHJcbiAgICovXG5cblxuICBNZDUucHJvdG90eXBlLmFycmF5ID0gTWQ1LnByb3RvdHlwZS5kaWdlc3Q7XG4gIC8qKlxyXG4gICAqIEBtZXRob2QgYXJyYXlCdWZmZXJcclxuICAgKiBAbWVtYmVyb2YgTWQ1XHJcbiAgICogQGluc3RhbmNlXHJcbiAgICogQGRlc2NyaXB0aW9uIE91dHB1dCBoYXNoIGFzIEFycmF5QnVmZmVyXHJcbiAgICogQHJldHVybnMge0FycmF5QnVmZmVyfSBBcnJheUJ1ZmZlclxyXG4gICAqIEBzZWUge0BsaW5rIG1kNS5hcnJheUJ1ZmZlcn1cclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIGhhc2guYXJyYXlCdWZmZXIoKTtcclxuICAgKi9cblxuICBNZDUucHJvdG90eXBlLmFycmF5QnVmZmVyID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZmluYWxpemUoKTtcbiAgICB2YXIgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKDE2KTtcbiAgICB2YXIgYmxvY2tzID0gbmV3IFVpbnQzMkFycmF5KGJ1ZmZlcik7XG4gICAgYmxvY2tzWzBdID0gdGhpcy5oMDtcbiAgICBibG9ja3NbMV0gPSB0aGlzLmgxO1xuICAgIGJsb2Nrc1syXSA9IHRoaXMuaDI7XG4gICAgYmxvY2tzWzNdID0gdGhpcy5oMztcbiAgICByZXR1cm4gYnVmZmVyO1xuICB9O1xuICAvKipcclxuICAgKiBAbWV0aG9kIGJ1ZmZlclxyXG4gICAqIEBkZXByZWNhdGVkIFRoaXMgbWF5YmUgY29uZnVzZSB3aXRoIEJ1ZmZlciBpbiBub2RlLmpzLiBQbGVhc2UgdXNlIGFycmF5QnVmZmVyIGluc3RlYWQuXHJcbiAgICogQG1lbWJlcm9mIE1kNVxyXG4gICAqIEBpbnN0YW5jZVxyXG4gICAqIEBkZXNjcmlwdGlvbiBPdXRwdXQgaGFzaCBhcyBBcnJheUJ1ZmZlclxyXG4gICAqIEByZXR1cm5zIHtBcnJheUJ1ZmZlcn0gQXJyYXlCdWZmZXJcclxuICAgKiBAc2VlIHtAbGluayBtZDUuYnVmZmVyfVxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogaGFzaC5idWZmZXIoKTtcclxuICAgKi9cblxuXG4gIE1kNS5wcm90b3R5cGUuYnVmZmVyID0gTWQ1LnByb3RvdHlwZS5hcnJheUJ1ZmZlcjtcbiAgLyoqXHJcbiAgICogQG1ldGhvZCBiYXNlNjRcclxuICAgKiBAbWVtYmVyb2YgTWQ1XHJcbiAgICogQGluc3RhbmNlXHJcbiAgICogQGRlc2NyaXB0aW9uIE91dHB1dCBoYXNoIGFzIGJhc2U2NCBzdHJpbmdcclxuICAgKiBAcmV0dXJucyB7U3RyaW5nfSBiYXNlNjQgc3RyaW5nXHJcbiAgICogQHNlZSB7QGxpbmsgbWQ1LmJhc2U2NH1cclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIGhhc2guYmFzZTY0KCk7XHJcbiAgICovXG5cbiAgTWQ1LnByb3RvdHlwZS5iYXNlNjQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHYxLFxuICAgICAgICB2MixcbiAgICAgICAgdjMsXG4gICAgICAgIGJhc2U2NFN0ciA9ICcnLFxuICAgICAgICBieXRlcyA9IHRoaXMuYXJyYXkoKTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMTU7KSB7XG4gICAgICB2MSA9IGJ5dGVzW2krK107XG4gICAgICB2MiA9IGJ5dGVzW2krK107XG4gICAgICB2MyA9IGJ5dGVzW2krK107XG4gICAgICBiYXNlNjRTdHIgKz0gQkFTRTY0X0VOQ09ERV9DSEFSW3YxID4+PiAyXSArIEJBU0U2NF9FTkNPREVfQ0hBUlsodjEgPDwgNCB8IHYyID4+PiA0KSAmIDYzXSArIEJBU0U2NF9FTkNPREVfQ0hBUlsodjIgPDwgMiB8IHYzID4+PiA2KSAmIDYzXSArIEJBU0U2NF9FTkNPREVfQ0hBUlt2MyAmIDYzXTtcbiAgICB9XG5cbiAgICB2MSA9IGJ5dGVzW2ldO1xuICAgIGJhc2U2NFN0ciArPSBCQVNFNjRfRU5DT0RFX0NIQVJbdjEgPj4+IDJdICsgQkFTRTY0X0VOQ09ERV9DSEFSW3YxIDw8IDQgJiA2M10gKyAnPT0nO1xuICAgIHJldHVybiBiYXNlNjRTdHI7XG4gIH07XG5cbiAgdmFyIGV4cG9ydHMgPSBjcmVhdGVNZXRob2QoKTtcblxuICBpZiAoQ09NTU9OX0pTKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzO1xuICB9IGVsc2Uge1xuICAgIC8qKlxyXG4gICAgICogQG1ldGhvZCBtZDVcYlxyXG4gICAgICogQGRlc2NyaXB0aW9uIE1kNSBoYXNoIGZ1bmN0aW9uLCBleHBvcnQgdG8gZ2xvYmFsIGluIGJyb3dzZXJzLlxyXG4gICAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXl8VWludDhBcnJheXxBcnJheUJ1ZmZlcn0gbWVzc2FnZSBtZXNzYWdlIHRvIGhhc2hcclxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IG1kNSBoYXNoZXNcclxuICAgICAqIEBleGFtcGxlXHJcbiAgICAgKiBtZDUoJycpOyAvLyBkNDFkOGNkOThmMDBiMjA0ZTk4MDA5OThlY2Y4NDI3ZVxyXG4gICAgICogbWQ1KCdUaGUgcXVpY2sgYnJvd24gZm94IGp1bXBzIG92ZXIgdGhlIGxhenkgZG9nJyk7IC8vIDllMTA3ZDlkMzcyYmI2ODI2YmQ4MWQzNTQyYTQxOWQ2XHJcbiAgICAgKiBtZDUoJ1RoZSBxdWljayBicm93biBmb3gganVtcHMgb3ZlciB0aGUgbGF6eSBkb2cuJyk7IC8vIGU0ZDkwOWMyOTBkMGZiMWNhMDY4ZmZhZGRmMjJjYmQwXHJcbiAgICAgKlxyXG4gICAgICogLy8gSXQgYWxzbyBzdXBwb3J0cyBVVEYtOCBlbmNvZGluZ1xyXG4gICAgICogbWQ1KCfkuK3mlocnKTsgLy8gYTdiYWMyMjM5ZmNkY2IzYTA2NzkwM2Q4MDc3YzRhMDdcclxuICAgICAqXHJcbiAgICAgKiAvLyBJdCBhbHNvIHN1cHBvcnRzIGJ5dGUgYEFycmF5YCwgYFVpbnQ4QXJyYXlgLCBgQXJyYXlCdWZmZXJgXHJcbiAgICAgKiBtZDUoW10pOyAvLyBkNDFkOGNkOThmMDBiMjA0ZTk4MDA5OThlY2Y4NDI3ZVxyXG4gICAgICogbWQ1KG5ldyBVaW50OEFycmF5KFtdKSk7IC8vIGQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlXHJcbiAgICAgKi9cbiAgICByb290Lm1kNSA9IGV4cG9ydHM7XG5cbiAgICBpZiAoQU1EKSB7XG4gICAgICBkZWZpbmUoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZXhwb3J0cztcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufSkoKTsiLCJ2YXIgX3R5cGVvZiA9IHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL3R5cGVvZlwiKTtcblxudmFyIHN0cmluZ2lmeVByaW1pdGl2ZSA9IGZ1bmN0aW9uIHN0cmluZ2lmeVByaW1pdGl2ZSh2KSB7XG4gIHN3aXRjaCAoX3R5cGVvZih2KSkge1xuICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICByZXR1cm4gdjtcblxuICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgcmV0dXJuIHYgPyAndHJ1ZScgOiAnZmFsc2UnO1xuXG4gICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgIHJldHVybiBpc0Zpbml0ZSh2KSA/IHYgOiAnJztcblxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gJyc7XG4gIH1cbn07XG5cbnZhciBxdWVyeVN0cmluZ2lmeSA9IGZ1bmN0aW9uIHF1ZXJ5U3RyaW5naWZ5KG9iaiwgc2VwLCBlcSwgbmFtZSkge1xuICBzZXAgPSBzZXAgfHwgJyYnO1xuICBlcSA9IGVxIHx8ICc9JztcblxuICBpZiAob2JqID09PSBudWxsKSB7XG4gICAgb2JqID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgaWYgKF90eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXMob2JqKS5tYXAoZnVuY3Rpb24gKGspIHtcbiAgICAgIHZhciBrcyA9IGVuY29kZVVSSUNvbXBvbmVudChzdHJpbmdpZnlQcmltaXRpdmUoaykpICsgZXE7XG5cbiAgICAgIGlmIChBcnJheS5pc0FycmF5KG9ialtrXSkpIHtcbiAgICAgICAgcmV0dXJuIG9ialtrXS5tYXAoZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICByZXR1cm4ga3MgKyBlbmNvZGVVUklDb21wb25lbnQoc3RyaW5naWZ5UHJpbWl0aXZlKHYpKTtcbiAgICAgICAgfSkuam9pbihzZXApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGtzICsgZW5jb2RlVVJJQ29tcG9uZW50KHN0cmluZ2lmeVByaW1pdGl2ZShvYmpba10pKTtcbiAgICAgIH1cbiAgICB9KS5maWx0ZXIoQm9vbGVhbikuam9pbihzZXApO1xuICB9XG5cbiAgaWYgKCFuYW1lKSByZXR1cm4gJyc7XG4gIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQoc3RyaW5naWZ5UHJpbWl0aXZlKG5hbWUpKSArIGVxICsgZW5jb2RlVVJJQ29tcG9uZW50KHN0cmluZ2lmeVByaW1pdGl2ZShvYmopKTtcbn07XG5cbnZhciB4aHJSZXMgPSBmdW5jdGlvbiB4aHJSZXMoZXJyLCB4aHIsIGJvZHkpIHtcbiAgdmFyIGhlYWRlcnMgPSB7fTtcbiAgeGhyLmdldEFsbFJlc3BvbnNlSGVhZGVycygpLnRyaW0oKS5zcGxpdCgnXFxuJykuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGlmIChpdGVtKSB7XG4gICAgICB2YXIgaW5kZXggPSBpdGVtLmluZGV4T2YoJzonKTtcbiAgICAgIHZhciBrZXkgPSBpdGVtLnN1YnN0cigwLCBpbmRleCkudHJpbSgpLnRvTG93ZXJDYXNlKCk7XG4gICAgICB2YXIgdmFsID0gaXRlbS5zdWJzdHIoaW5kZXggKyAxKS50cmltKCk7XG4gICAgICBoZWFkZXJzW2tleV0gPSB2YWw7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHtcbiAgICBlcnJvcjogZXJyLFxuICAgIHN0YXR1c0NvZGU6IHhoci5zdGF0dXMsXG4gICAgc3RhdHVzTWVzc2FnZTogeGhyLnN0YXR1c1RleHQsXG4gICAgaGVhZGVyczogaGVhZGVycyxcbiAgICBib2R5OiBib2R5XG4gIH07XG59O1xuXG52YXIgeGhyQm9keSA9IGZ1bmN0aW9uIHhockJvZHkoeGhyLCBkYXRhVHlwZSkge1xuICByZXR1cm4gIWRhdGFUeXBlICYmIGRhdGFUeXBlID09PSAndGV4dCcgPyB4aHIucmVzcG9uc2VUZXh0IDogeGhyLnJlc3BvbnNlO1xufTtcblxudmFyIHJlcXVlc3QgPSBmdW5jdGlvbiByZXF1ZXN0KG9wdCwgY2FsbGJhY2spIHtcbiAgLy8gbWV0aG9kXG4gIHZhciBtZXRob2QgPSAob3B0Lm1ldGhvZCB8fCAnR0VUJykudG9VcHBlckNhc2UoKTsgLy8gdXJs44CBcXNcblxuICB2YXIgdXJsID0gb3B0LnVybDtcblxuICBpZiAob3B0LnFzKSB7XG4gICAgdmFyIHFzU3RyID0gcXVlcnlTdHJpbmdpZnkob3B0LnFzKTtcblxuICAgIGlmIChxc1N0cikge1xuICAgICAgdXJsICs9ICh1cmwuaW5kZXhPZignPycpID09PSAtMSA/ICc/JyA6ICcmJykgKyBxc1N0cjtcbiAgICB9XG4gIH0gLy8g5Yib5bu6IGFqYXgg5a6e5L6LXG5cblxuICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gIHhoci5vcGVuKG1ldGhvZCwgdXJsLCB0cnVlKTtcbiAgeGhyLnJlc3BvbnNlVHlwZSA9IG9wdC5kYXRhVHlwZSB8fCAndGV4dCc7IC8vIOWkhOeQhiB4aHJGaWVsZHMg5bGe5oCnXG5cbiAgaWYgKG9wdC54aHJGaWVsZHMpIHtcbiAgICBmb3IgKHZhciB4aHJGaWVsZCBpbiBvcHQueGhyRmllbGRzKSB7XG4gICAgICB4aHJbeGhyRmllbGRdID0gb3B0LnhockZpZWxkc1t4aHJGaWVsZF07XG4gICAgfVxuICB9IC8vIOWkhOeQhiBoZWFkZXJzXG5cblxuICB2YXIgaGVhZGVycyA9IG9wdC5oZWFkZXJzO1xuXG4gIGlmIChoZWFkZXJzKSB7XG4gICAgZm9yICh2YXIga2V5IGluIGhlYWRlcnMpIHtcbiAgICAgIGlmIChoZWFkZXJzLmhhc093blByb3BlcnR5KGtleSkgJiYga2V5LnRvTG93ZXJDYXNlKCkgIT09ICdjb250ZW50LWxlbmd0aCcgJiYga2V5LnRvTG93ZXJDYXNlKCkgIT09ICd1c2VyLWFnZW50JyAmJiBrZXkudG9Mb3dlckNhc2UoKSAhPT0gJ29yaWdpbicgJiYga2V5LnRvTG93ZXJDYXNlKCkgIT09ICdob3N0Jykge1xuICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihrZXksIGhlYWRlcnNba2V5XSk7XG4gICAgICB9XG4gICAgfVxuICB9IC8vIG9ucHJvZ3Jlc3NcblxuXG4gIGlmIChvcHQub25Qcm9ncmVzcyAmJiB4aHIudXBsb2FkKSB4aHIudXBsb2FkLm9ucHJvZ3Jlc3MgPSBvcHQub25Qcm9ncmVzcztcbiAgaWYgKG9wdC5vbkRvd25sb2FkUHJvZ3Jlc3MpIHhoci5vbnByb2dyZXNzID0gb3B0Lm9uRG93bmxvYWRQcm9ncmVzczsgLy8gdGltZW91dFxuXG4gIGlmIChvcHQudGltZW91dCkgeGhyLnRpbWVvdXQgPSBvcHQudGltZW91dDtcblxuICB4aHIub250aW1lb3V0ID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgdmFyIGVycm9yID0gbmV3IEVycm9yKCd0aW1lb3V0Jyk7XG4gICAgY2FsbGJhY2soeGhyUmVzKGVycm9yLCB4aHIpKTtcbiAgfTsgLy8gc3VjY2VzcyAyeHgvM3h4LzR4eFxuXG5cbiAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjYWxsYmFjayh4aHJSZXMobnVsbCwgeGhyLCB4aHJCb2R5KHhociwgb3B0LmRhdGFUeXBlKSkpO1xuICB9OyAvLyBlcnJvciA1eHgvMCAo572R57uc6ZSZ6K+v44CB6Leo5Z+f5oql6ZSZ44CBSHR0cHMgY29ubmVjdC1zcmMg6ZmQ5Yi255qE5oql6ZSZ5pe2IHN0YXR1c0NvZGUg5Li6IDApXG5cblxuICB4aHIub25lcnJvciA9IGZ1bmN0aW9uIChlcnIpIHtcbiAgICB2YXIgYm9keSA9IHhockJvZHkoeGhyLCBvcHQuZGF0YVR5cGUpO1xuXG4gICAgaWYgKGJvZHkpIHtcbiAgICAgIC8vIDV4eFxuICAgICAgY2FsbGJhY2soeGhyUmVzKG51bGwsIHhociwgYm9keSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyAwXG4gICAgICB2YXIgZXJyb3IgPSB4aHIuc3RhdHVzVGV4dDtcbiAgICAgIGlmICghZXJyb3IgJiYgeGhyLnN0YXR1cyA9PT0gMCkgZXJyb3IgPSBuZXcgRXJyb3IoJ0NPUlMgYmxvY2tlZCBvciBuZXR3b3JrIGVycm9yJyk7XG4gICAgICBjYWxsYmFjayh4aHJSZXMoZXJyb3IsIHhociwgYm9keSkpO1xuICAgIH1cbiAgfTsgLy8gc2VuZFxuXG5cbiAgeGhyLnNlbmQob3B0LmJvZHkgfHwgJycpOyAvLyDov5Tlm54gYWpheCDlrp7kvovvvIznlKjkuo7lpJbpg6josIPnlKggeGhyLmFib3J0XG5cbiAgcmV0dXJuIHhocjtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gcmVxdWVzdDsiLCIvKiBDb3B5cmlnaHQgMjAxNSBXaWxsaWFtIFN1bW1lcnMsIE1ldGFUcmliYWwgTExDXHJcbiAqIGFkYXB0ZWQgZnJvbSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL0pYT05cclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICAgIGh0dHBzOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXG5cbi8qKlxyXG4gKiBAYXV0aG9yIFdpbGxpYW0gU3VtbWVyc1xyXG4gKiBodHRwczovL2dpdGh1Yi5jb20vbWV0YXRyaWJhbC94bWxUb0pTT05cclxuICovXG52YXIgRE9NUGFyc2VyID0gcmVxdWlyZSgnQHhtbGRvbS94bWxkb20nKS5ET01QYXJzZXI7XG5cbnZhciB4bWxUb0pTT04gPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMudmVyc2lvbiA9IFwiMS4zLjVcIjtcbiAgdmFyIG9wdGlvbnMgPSB7XG4gICAgLy8gc2V0IHVwIHRoZSBkZWZhdWx0IG9wdGlvbnNcbiAgICBtZXJnZUNEQVRBOiB0cnVlLFxuICAgIC8vIGV4dHJhY3QgY2RhdGEgYW5kIG1lcmdlIHdpdGggdGV4dFxuICAgIG5vcm1hbGl6ZTogdHJ1ZSxcbiAgICAvLyBjb2xsYXBzZSBtdWx0aXBsZSBzcGFjZXMgdG8gc2luZ2xlIHNwYWNlXG4gICAgc3RyaXBFbGVtUHJlZml4OiB0cnVlIC8vIGZvciBlbGVtZW50cyBvZiBzYW1lIG5hbWUgaW4gZGlmZiBuYW1lc3BhY2VzLCB5b3UgY2FuIGVuYWJsZSBuYW1lc3BhY2VzIGFuZCBhY2Nlc3MgdGhlIG5za2V5IHByb3BlcnR5XG5cbiAgfTtcbiAgdmFyIHByZWZpeE1hdGNoID0gbmV3IFJlZ0V4cCgvKD8heG1sbnMpXi4qOi8pO1xuICB2YXIgdHJpbU1hdGNoID0gbmV3IFJlZ0V4cCgvXlxccyt8XFxzKyQvZyk7XG5cbiAgdGhpcy5ncm9rVHlwZSA9IGZ1bmN0aW9uIChzVmFsdWUpIHtcbiAgICBpZiAoL15cXHMqJC8udGVzdChzVmFsdWUpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoL14oPzp0cnVlfGZhbHNlKSQvaS50ZXN0KHNWYWx1ZSkpIHtcbiAgICAgIHJldHVybiBzVmFsdWUudG9Mb3dlckNhc2UoKSA9PT0gXCJ0cnVlXCI7XG4gICAgfVxuXG4gICAgaWYgKGlzRmluaXRlKHNWYWx1ZSkpIHtcbiAgICAgIHJldHVybiBwYXJzZUZsb2F0KHNWYWx1ZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNWYWx1ZTtcbiAgfTtcblxuICB0aGlzLnBhcnNlU3RyaW5nID0gZnVuY3Rpb24gKHhtbFN0cmluZywgb3B0KSB7XG4gICAgaWYgKHhtbFN0cmluZykge1xuICAgICAgdmFyIHhtbCA9IHRoaXMuc3RyaW5nVG9YTUwoeG1sU3RyaW5nKTtcblxuICAgICAgaWYgKHhtbC5nZXRFbGVtZW50c0J5VGFnTmFtZSgncGFyc2VyZXJyb3InKS5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJzZVhNTCh4bWwsIG9wdCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfTtcblxuICB0aGlzLnBhcnNlWE1MID0gZnVuY3Rpb24gKG9YTUxQYXJlbnQsIG9wdCkge1xuICAgIC8vIGluaXRpYWxpemUgb3B0aW9uc1xuICAgIGZvciAodmFyIGtleSBpbiBvcHQpIHtcbiAgICAgIG9wdGlvbnNba2V5XSA9IG9wdFtrZXldO1xuICAgIH1cblxuICAgIHZhciB2UmVzdWx0ID0ge30sXG4gICAgICAgIG5MZW5ndGggPSAwLFxuICAgICAgICBzQ29sbGVjdGVkVHh0ID0gXCJcIjsgLy8gaXRlcmF0ZSBvdmVyIHRoZSBjaGlsZHJlblxuXG4gICAgdmFyIGNoaWxkTnVtID0gb1hNTFBhcmVudC5jaGlsZE5vZGVzLmxlbmd0aDtcblxuICAgIGlmIChjaGlsZE51bSkge1xuICAgICAgZm9yICh2YXIgb05vZGUsIHNQcm9wLCB2Q29udGVudCwgbkl0ZW0gPSAwOyBuSXRlbSA8IG9YTUxQYXJlbnQuY2hpbGROb2Rlcy5sZW5ndGg7IG5JdGVtKyspIHtcbiAgICAgICAgb05vZGUgPSBvWE1MUGFyZW50LmNoaWxkTm9kZXMuaXRlbShuSXRlbSk7XG5cbiAgICAgICAgaWYgKG9Ob2RlLm5vZGVUeXBlID09PSA0KSB7XG4gICAgICAgICAgaWYgKG9wdGlvbnMubWVyZ2VDREFUQSkge1xuICAgICAgICAgICAgc0NvbGxlY3RlZFR4dCArPSBvTm9kZS5ub2RlVmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8qIG5vZGVUeXBlIGlzIFwiQ0RBVEFTZWN0aW9uXCIgKDQpICovXG4gICAgICAgIGVsc2UgaWYgKG9Ob2RlLm5vZGVUeXBlID09PSAzKSB7XG4gICAgICAgICAgc0NvbGxlY3RlZFR4dCArPSBvTm9kZS5ub2RlVmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgLyogbm9kZVR5cGUgaXMgXCJUZXh0XCIgKDMpICovXG4gICAgICAgIGVsc2UgaWYgKG9Ob2RlLm5vZGVUeXBlID09PSAxKSB7XG4gICAgICAgICAgLyogbm9kZVR5cGUgaXMgXCJFbGVtZW50XCIgKDEpICovXG4gICAgICAgICAgaWYgKG5MZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHZSZXN1bHQgPSB7fTtcbiAgICAgICAgICB9IC8vIHVzaW5nIG5vZGVOYW1lIHRvIHN1cHBvcnQgYnJvd3NlciAoSUUpIGltcGxlbWVudGF0aW9uIHdpdGggbm8gJ2xvY2FsTmFtZScgcHJvcGVydHlcblxuXG4gICAgICAgICAgaWYgKG9wdGlvbnMuc3RyaXBFbGVtUHJlZml4KSB7XG4gICAgICAgICAgICBzUHJvcCA9IG9Ob2RlLm5vZGVOYW1lLnJlcGxhY2UocHJlZml4TWF0Y2gsICcnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc1Byb3AgPSBvTm9kZS5ub2RlTmFtZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2Q29udGVudCA9IHhtbFRvSlNPTi5wYXJzZVhNTChvTm9kZSk7XG5cbiAgICAgICAgICBpZiAodlJlc3VsdC5oYXNPd25Qcm9wZXJ0eShzUHJvcCkpIHtcbiAgICAgICAgICAgIGlmICh2UmVzdWx0W3NQcm9wXS5jb25zdHJ1Y3RvciAhPT0gQXJyYXkpIHtcbiAgICAgICAgICAgICAgdlJlc3VsdFtzUHJvcF0gPSBbdlJlc3VsdFtzUHJvcF1dO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2UmVzdWx0W3NQcm9wXS5wdXNoKHZDb250ZW50KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdlJlc3VsdFtzUHJvcF0gPSB2Q29udGVudDtcbiAgICAgICAgICAgIG5MZW5ndGgrKztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIU9iamVjdC5rZXlzKHZSZXN1bHQpLmxlbmd0aCkge1xuICAgICAgLy8gdlJlc3VsdCA9IHNDb2xsZWN0ZWRUeHQucmVwbGFjZSh0cmltTWF0Y2gsICcnKSB8fCAnJzsgLy8gYnkgY2Fyc29ueHUg5L+u5aSNIGdldEJ1Y2tldOi/lOWbnueahCBLZXkg5pivIFwiIC9cIiDov5nnp43lnLrmma9cbiAgICAgIHZSZXN1bHQgPSBzQ29sbGVjdGVkVHh0IHx8ICcnO1xuICAgIH1cblxuICAgIHJldHVybiB2UmVzdWx0O1xuICB9OyAvLyBDb252ZXJ0IHhtbERvY3VtZW50IHRvIGEgc3RyaW5nXG4gIC8vIFJldHVybnMgbnVsbCBvbiBmYWlsdXJlXG5cblxuICB0aGlzLnhtbFRvU3RyaW5nID0gZnVuY3Rpb24gKHhtbERvYykge1xuICAgIHRyeSB7XG4gICAgICB2YXIgeG1sU3RyaW5nID0geG1sRG9jLnhtbCA/IHhtbERvYy54bWwgOiBuZXcgWE1MU2VyaWFsaXplcigpLnNlcmlhbGl6ZVRvU3RyaW5nKHhtbERvYyk7XG4gICAgICByZXR1cm4geG1sU3RyaW5nO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9OyAvLyBDb252ZXJ0IGEgc3RyaW5nIHRvIFhNTCBOb2RlIFN0cnVjdHVyZVxuICAvLyBSZXR1cm5zIG51bGwgb24gZmFpbHVyZVxuXG5cbiAgdGhpcy5zdHJpbmdUb1hNTCA9IGZ1bmN0aW9uICh4bWxTdHJpbmcpIHtcbiAgICB0cnkge1xuICAgICAgdmFyIHhtbERvYyA9IG51bGw7XG5cbiAgICAgIGlmICh3aW5kb3cuRE9NUGFyc2VyKSB7XG4gICAgICAgIHZhciBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7XG4gICAgICAgIHhtbERvYyA9IHBhcnNlci5wYXJzZUZyb21TdHJpbmcoeG1sU3RyaW5nLCBcInRleHQveG1sXCIpO1xuICAgICAgICByZXR1cm4geG1sRG9jO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgeG1sRG9jID0gbmV3IEFjdGl2ZVhPYmplY3QoXCJNaWNyb3NvZnQuWE1MRE9NXCIpO1xuICAgICAgICB4bWxEb2MuYXN5bmMgPSBmYWxzZTtcbiAgICAgICAgeG1sRG9jLmxvYWRYTUwoeG1sU3RyaW5nKTtcbiAgICAgICAgcmV0dXJuIHhtbERvYztcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIHRoaXM7XG59LmNhbGwoe30pO1xuXG52YXIgeG1sMmpzb24gPSBmdW5jdGlvbiB4bWwyanNvbih4bWxTdHJpbmcpIHtcbiAgcmV0dXJuIHhtbFRvSlNPTi5wYXJzZVN0cmluZyh4bWxTdHJpbmcpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSB4bWwyanNvbjsiLCJmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7XG4gIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IF9jbGFzc0NhbGxDaGVjaywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWUsIG1vZHVsZS5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IG1vZHVsZS5leHBvcnRzOyIsImZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07XG4gICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO1xuICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtcbiAgICBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7XG4gIGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpO1xuICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgXCJwcm90b3R5cGVcIiwge1xuICAgIHdyaXRhYmxlOiBmYWxzZVxuICB9KTtcbiAgcmV0dXJuIENvbnN0cnVjdG9yO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IF9jcmVhdGVDbGFzcywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWUsIG1vZHVsZS5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IG1vZHVsZS5leHBvcnRzOyIsImZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7XG4gIFwiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2ZcIjtcblxuICByZXR1cm4gKG1vZHVsZS5leHBvcnRzID0gX3R5cGVvZiA9IFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgU3ltYm9sICYmIFwic3ltYm9sXCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvYmopIHtcbiAgICByZXR1cm4gdHlwZW9mIG9iajtcbiAgfSA6IGZ1bmN0aW9uIChvYmopIHtcbiAgICByZXR1cm4gb2JqICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgU3ltYm9sICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqO1xuICB9LCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZSwgbW9kdWxlLmV4cG9ydHNbXCJkZWZhdWx0XCJdID0gbW9kdWxlLmV4cG9ydHMpLCBfdHlwZW9mKG9iaik7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gX3R5cGVvZiwgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWUsIG1vZHVsZS5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IG1vZHVsZS5leHBvcnRzOyIsIid1c2Ugc3RyaWN0J1xuXG4vKipcbiAqIFwiU2hhbGxvdyBmcmVlemVzXCIgYW4gb2JqZWN0IHRvIHJlbmRlciBpdCBpbW11dGFibGUuXG4gKiBVc2VzIGBPYmplY3QuZnJlZXplYCBpZiBhdmFpbGFibGUsXG4gKiBvdGhlcndpc2UgdGhlIGltbXV0YWJpbGl0eSBpcyBvbmx5IGluIHRoZSB0eXBlLlxuICpcbiAqIElzIHVzZWQgdG8gY3JlYXRlIFwiZW51bSBsaWtlXCIgb2JqZWN0cy5cbiAqXG4gKiBAdGVtcGxhdGUgVFxuICogQHBhcmFtIHtUfSBvYmplY3QgdGhlIG9iamVjdCB0byBmcmVlemVcbiAqIEBwYXJhbSB7UGljazxPYmplY3RDb25zdHJ1Y3RvciwgJ2ZyZWV6ZSc+ID0gT2JqZWN0fSBvYyBgT2JqZWN0YCBieSBkZWZhdWx0LFxuICogXHRcdFx0XHRhbGxvd3MgdG8gaW5qZWN0IGN1c3RvbSBvYmplY3QgY29uc3RydWN0b3IgZm9yIHRlc3RzXG4gKiBAcmV0dXJucyB7UmVhZG9ubHk8VD59XG4gKlxuICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9PYmplY3QvZnJlZXplXG4gKi9cbmZ1bmN0aW9uIGZyZWV6ZShvYmplY3QsIG9jKSB7XG5cdGlmIChvYyA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0b2MgPSBPYmplY3Rcblx0fVxuXHRyZXR1cm4gb2MgJiYgdHlwZW9mIG9jLmZyZWV6ZSA9PT0gJ2Z1bmN0aW9uJyA/IG9jLmZyZWV6ZShvYmplY3QpIDogb2JqZWN0XG59XG5cbi8qKlxuICogU2luY2Ugd2UgY2FuIG5vdCByZWx5IG9uIGBPYmplY3QuYXNzaWduYCB3ZSBwcm92aWRlIGEgc2ltcGxpZmllZCB2ZXJzaW9uXG4gKiB0aGF0IGlzIHN1ZmZpY2llbnQgZm9yIG91ciBuZWVkcy5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0XG4gKiBAcGFyYW0ge09iamVjdCB8IG51bGwgfCB1bmRlZmluZWR9IHNvdXJjZVxuICpcbiAqIEByZXR1cm5zIHtPYmplY3R9IHRhcmdldFxuICogQHRocm93cyBUeXBlRXJyb3IgaWYgdGFyZ2V0IGlzIG5vdCBhbiBvYmplY3RcbiAqXG4gKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL09iamVjdC9hc3NpZ25cbiAqIEBzZWUgaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvbXVsdGlwYWdlL2Z1bmRhbWVudGFsLW9iamVjdHMuaHRtbCNzZWMtb2JqZWN0LmFzc2lnblxuICovXG5mdW5jdGlvbiBhc3NpZ24odGFyZ2V0LCBzb3VyY2UpIHtcblx0aWYgKHRhcmdldCA9PT0gbnVsbCB8fCB0eXBlb2YgdGFyZ2V0ICE9PSAnb2JqZWN0Jykge1xuXHRcdHRocm93IG5ldyBUeXBlRXJyb3IoJ3RhcmdldCBpcyBub3QgYW4gb2JqZWN0Jylcblx0fVxuXHRmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHtcblx0XHRcdHRhcmdldFtrZXldID0gc291cmNlW2tleV1cblx0XHR9XG5cdH1cblx0cmV0dXJuIHRhcmdldFxufVxuXG4vKipcbiAqIEFsbCBtaW1lIHR5cGVzIHRoYXQgYXJlIGFsbG93ZWQgYXMgaW5wdXQgdG8gYERPTVBhcnNlci5wYXJzZUZyb21TdHJpbmdgXG4gKlxuICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRE9NUGFyc2VyL3BhcnNlRnJvbVN0cmluZyNBcmd1bWVudDAyIE1ETlxuICogQHNlZSBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9keW5hbWljLW1hcmt1cC1pbnNlcnRpb24uaHRtbCNkb21wYXJzZXJzdXBwb3J0ZWR0eXBlIFdIQVRXRyBIVE1MIFNwZWNcbiAqIEBzZWUgRE9NUGFyc2VyLnByb3RvdHlwZS5wYXJzZUZyb21TdHJpbmdcbiAqL1xudmFyIE1JTUVfVFlQRSA9IGZyZWV6ZSh7XG5cdC8qKlxuXHQgKiBgdGV4dC9odG1sYCwgdGhlIG9ubHkgbWltZSB0eXBlIHRoYXQgdHJpZ2dlcnMgdHJlYXRpbmcgYW4gWE1MIGRvY3VtZW50IGFzIEhUTUwuXG5cdCAqXG5cdCAqIEBzZWUgRE9NUGFyc2VyLlN1cHBvcnRlZFR5cGUuaXNIVE1MXG5cdCAqIEBzZWUgaHR0cHM6Ly93d3cuaWFuYS5vcmcvYXNzaWdubWVudHMvbWVkaWEtdHlwZXMvdGV4dC9odG1sIElBTkEgTWltZVR5cGUgcmVnaXN0cmF0aW9uXG5cdCAqIEBzZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSFRNTCBXaWtpcGVkaWFcblx0ICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRE9NUGFyc2VyL3BhcnNlRnJvbVN0cmluZyBNRE5cblx0ICogQHNlZSBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9keW5hbWljLW1hcmt1cC1pbnNlcnRpb24uaHRtbCNkb20tZG9tcGFyc2VyLXBhcnNlZnJvbXN0cmluZyBXSEFUV0cgSFRNTCBTcGVjXG5cdCAqL1xuXHRIVE1MOiAndGV4dC9odG1sJyxcblxuXHQvKipcblx0ICogSGVscGVyIG1ldGhvZCB0byBjaGVjayBhIG1pbWUgdHlwZSBpZiBpdCBpbmRpY2F0ZXMgYW4gSFRNTCBkb2N1bWVudFxuXHQgKlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gW3ZhbHVlXVxuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn1cblx0ICpcblx0ICogQHNlZSBodHRwczovL3d3dy5pYW5hLm9yZy9hc3NpZ25tZW50cy9tZWRpYS10eXBlcy90ZXh0L2h0bWwgSUFOQSBNaW1lVHlwZSByZWdpc3RyYXRpb25cblx0ICogQHNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9IVE1MIFdpa2lwZWRpYVxuXHQgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9ET01QYXJzZXIvcGFyc2VGcm9tU3RyaW5nIE1ETlxuXHQgKiBAc2VlIGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvbXVsdGlwYWdlL2R5bmFtaWMtbWFya3VwLWluc2VydGlvbi5odG1sI2RvbS1kb21wYXJzZXItcGFyc2Vmcm9tc3RyaW5nIFx0ICovXG5cdGlzSFRNTDogZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0cmV0dXJuIHZhbHVlID09PSBNSU1FX1RZUEUuSFRNTFxuXHR9LFxuXG5cdC8qKlxuXHQgKiBgYXBwbGljYXRpb24veG1sYCwgdGhlIHN0YW5kYXJkIG1pbWUgdHlwZSBmb3IgWE1MIGRvY3VtZW50cy5cblx0ICpcblx0ICogQHNlZSBodHRwczovL3d3dy5pYW5hLm9yZy9hc3NpZ25tZW50cy9tZWRpYS10eXBlcy9hcHBsaWNhdGlvbi94bWwgSUFOQSBNaW1lVHlwZSByZWdpc3RyYXRpb25cblx0ICogQHNlZSBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNzMwMyNzZWN0aW9uLTkuMSBSRkMgNzMwM1xuXHQgKiBAc2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1hNTF9hbmRfTUlNRSBXaWtpcGVkaWFcblx0ICovXG5cdFhNTF9BUFBMSUNBVElPTjogJ2FwcGxpY2F0aW9uL3htbCcsXG5cblx0LyoqXG5cdCAqIGB0ZXh0L2h0bWxgLCBhbiBhbGlhcyBmb3IgYGFwcGxpY2F0aW9uL3htbGAuXG5cdCAqXG5cdCAqIEBzZWUgaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzczMDMjc2VjdGlvbi05LjIgUkZDIDczMDNcblx0ICogQHNlZSBodHRwczovL3d3dy5pYW5hLm9yZy9hc3NpZ25tZW50cy9tZWRpYS10eXBlcy90ZXh0L3htbCBJQU5BIE1pbWVUeXBlIHJlZ2lzdHJhdGlvblxuXHQgKiBAc2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1hNTF9hbmRfTUlNRSBXaWtpcGVkaWFcblx0ICovXG5cdFhNTF9URVhUOiAndGV4dC94bWwnLFxuXG5cdC8qKlxuXHQgKiBgYXBwbGljYXRpb24veGh0bWwreG1sYCwgaW5kaWNhdGVzIGFuIFhNTCBkb2N1bWVudCB0aGF0IGhhcyB0aGUgZGVmYXVsdCBIVE1MIG5hbWVzcGFjZSxcblx0ICogYnV0IGlzIHBhcnNlZCBhcyBhbiBYTUwgZG9jdW1lbnQuXG5cdCAqXG5cdCAqIEBzZWUgaHR0cHM6Ly93d3cuaWFuYS5vcmcvYXNzaWdubWVudHMvbWVkaWEtdHlwZXMvYXBwbGljYXRpb24veGh0bWwreG1sIElBTkEgTWltZVR5cGUgcmVnaXN0cmF0aW9uXG5cdCAqIEBzZWUgaHR0cHM6Ly9kb20uc3BlYy53aGF0d2cub3JnLyNkb20tZG9taW1wbGVtZW50YXRpb24tY3JlYXRlZG9jdW1lbnQgV0hBVFdHIERPTSBTcGVjXG5cdCAqIEBzZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvWEhUTUwgV2lraXBlZGlhXG5cdCAqL1xuXHRYTUxfWEhUTUxfQVBQTElDQVRJT046ICdhcHBsaWNhdGlvbi94aHRtbCt4bWwnLFxuXG5cdC8qKlxuXHQgKiBgaW1hZ2Uvc3ZnK3htbGAsXG5cdCAqXG5cdCAqIEBzZWUgaHR0cHM6Ly93d3cuaWFuYS5vcmcvYXNzaWdubWVudHMvbWVkaWEtdHlwZXMvaW1hZ2Uvc3ZnK3htbCBJQU5BIE1pbWVUeXBlIHJlZ2lzdHJhdGlvblxuXHQgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9TVkcxMS8gVzNDIFNWRyAxLjFcblx0ICogQHNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9TY2FsYWJsZV9WZWN0b3JfR3JhcGhpY3MgV2lraXBlZGlhXG5cdCAqL1xuXHRYTUxfU1ZHX0lNQUdFOiAnaW1hZ2Uvc3ZnK3htbCcsXG59KVxuXG4vKipcbiAqIE5hbWVzcGFjZXMgdGhhdCBhcmUgdXNlZCBpbiB0aGlzIGNvZGUgYmFzZS5cbiAqXG4gKiBAc2VlIGh0dHA6Ly93d3cudzMub3JnL1RSL1JFQy14bWwtbmFtZXNcbiAqL1xudmFyIE5BTUVTUEFDRSA9IGZyZWV6ZSh7XG5cdC8qKlxuXHQgKiBUaGUgWEhUTUwgbmFtZXNwYWNlLlxuXHQgKlxuXHQgKiBAc2VlIGh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWxcblx0ICovXG5cdEhUTUw6ICdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sJyxcblxuXHQvKipcblx0ICogQ2hlY2tzIGlmIGB1cmlgIGVxdWFscyBgTkFNRVNQQUNFLkhUTUxgLlxuXHQgKlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gW3VyaV1cblx0ICpcblx0ICogQHNlZSBOQU1FU1BBQ0UuSFRNTFxuXHQgKi9cblx0aXNIVE1MOiBmdW5jdGlvbiAodXJpKSB7XG5cdFx0cmV0dXJuIHVyaSA9PT0gTkFNRVNQQUNFLkhUTUxcblx0fSxcblxuXHQvKipcblx0ICogVGhlIFNWRyBuYW1lc3BhY2UuXG5cdCAqXG5cdCAqIEBzZWUgaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcblx0ICovXG5cdFNWRzogJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyxcblxuXHQvKipcblx0ICogVGhlIGB4bWw6YCBuYW1lc3BhY2UuXG5cdCAqXG5cdCAqIEBzZWUgaHR0cDovL3d3dy53My5vcmcvWE1MLzE5OTgvbmFtZXNwYWNlXG5cdCAqL1xuXHRYTUw6ICdodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UnLFxuXG5cdC8qKlxuXHQgKiBUaGUgYHhtbG5zOmAgbmFtZXNwYWNlXG5cdCAqXG5cdCAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnLzIwMDAveG1sbnMvXG5cdCAqL1xuXHRYTUxOUzogJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAveG1sbnMvJyxcbn0pXG5cbmV4cG9ydHMuYXNzaWduID0gYXNzaWduO1xuZXhwb3J0cy5mcmVlemUgPSBmcmVlemU7XG5leHBvcnRzLk1JTUVfVFlQRSA9IE1JTUVfVFlQRTtcbmV4cG9ydHMuTkFNRVNQQUNFID0gTkFNRVNQQUNFO1xuIiwidmFyIGNvbnZlbnRpb25zID0gcmVxdWlyZShcIi4vY29udmVudGlvbnNcIik7XG52YXIgZG9tID0gcmVxdWlyZSgnLi9kb20nKVxudmFyIGVudGl0aWVzID0gcmVxdWlyZSgnLi9lbnRpdGllcycpO1xudmFyIHNheCA9IHJlcXVpcmUoJy4vc2F4Jyk7XG5cbnZhciBET01JbXBsZW1lbnRhdGlvbiA9IGRvbS5ET01JbXBsZW1lbnRhdGlvbjtcblxudmFyIE5BTUVTUEFDRSA9IGNvbnZlbnRpb25zLk5BTUVTUEFDRTtcblxudmFyIFBhcnNlRXJyb3IgPSBzYXguUGFyc2VFcnJvcjtcbnZhciBYTUxSZWFkZXIgPSBzYXguWE1MUmVhZGVyO1xuXG4vKipcbiAqIE5vcm1hbGl6ZXMgbGluZSBlbmRpbmcgYWNjb3JkaW5nIHRvIGh0dHBzOi8vd3d3LnczLm9yZy9UUi94bWwxMS8jc2VjLWxpbmUtZW5kczpcbiAqXG4gKiA+IFhNTCBwYXJzZWQgZW50aXRpZXMgYXJlIG9mdGVuIHN0b3JlZCBpbiBjb21wdXRlciBmaWxlcyB3aGljaCxcbiAqID4gZm9yIGVkaXRpbmcgY29udmVuaWVuY2UsIGFyZSBvcmdhbml6ZWQgaW50byBsaW5lcy5cbiAqID4gVGhlc2UgbGluZXMgYXJlIHR5cGljYWxseSBzZXBhcmF0ZWQgYnkgc29tZSBjb21iaW5hdGlvblxuICogPiBvZiB0aGUgY2hhcmFjdGVycyBDQVJSSUFHRSBSRVRVUk4gKCN4RCkgYW5kIExJTkUgRkVFRCAoI3hBKS5cbiAqID5cbiAqID4gVG8gc2ltcGxpZnkgdGhlIHRhc2tzIG9mIGFwcGxpY2F0aW9ucywgdGhlIFhNTCBwcm9jZXNzb3IgbXVzdCBiZWhhdmVcbiAqID4gYXMgaWYgaXQgbm9ybWFsaXplZCBhbGwgbGluZSBicmVha3MgaW4gZXh0ZXJuYWwgcGFyc2VkIGVudGl0aWVzIChpbmNsdWRpbmcgdGhlIGRvY3VtZW50IGVudGl0eSlcbiAqID4gb24gaW5wdXQsIGJlZm9yZSBwYXJzaW5nLCBieSB0cmFuc2xhdGluZyBhbGwgb2YgdGhlIGZvbGxvd2luZyB0byBhIHNpbmdsZSAjeEEgY2hhcmFjdGVyOlxuICogPlxuICogPiAxLiB0aGUgdHdvLWNoYXJhY3RlciBzZXF1ZW5jZSAjeEQgI3hBXG4gKiA+IDIuIHRoZSB0d28tY2hhcmFjdGVyIHNlcXVlbmNlICN4RCAjeDg1XG4gKiA+IDMuIHRoZSBzaW5nbGUgY2hhcmFjdGVyICN4ODVcbiAqID4gNC4gdGhlIHNpbmdsZSBjaGFyYWN0ZXIgI3gyMDI4XG4gKiA+IDUuIGFueSAjeEQgY2hhcmFjdGVyIHRoYXQgaXMgbm90IGltbWVkaWF0ZWx5IGZvbGxvd2VkIGJ5ICN4QSBvciAjeDg1LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBpbnB1dFxuICogQHJldHVybnMge3N0cmluZ31cbiAqL1xuZnVuY3Rpb24gbm9ybWFsaXplTGluZUVuZGluZ3MoaW5wdXQpIHtcblx0cmV0dXJuIGlucHV0XG5cdFx0LnJlcGxhY2UoL1xccltcXG5cXHUwMDg1XS9nLCAnXFxuJylcblx0XHQucmVwbGFjZSgvW1xcclxcdTAwODVcXHUyMDI4XS9nLCAnXFxuJylcbn1cblxuLyoqXG4gKiBAdHlwZWRlZiBMb2NhdG9yXG4gKiBAcHJvcGVydHkge251bWJlcn0gW2NvbHVtbk51bWJlcl1cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbbGluZU51bWJlcl1cbiAqL1xuXG4vKipcbiAqIEB0eXBlZGVmIERPTVBhcnNlck9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7RE9NSGFuZGxlcn0gW2RvbUJ1aWxkZXJdXG4gKiBAcHJvcGVydHkge0Z1bmN0aW9ufSBbZXJyb3JIYW5kbGVyXVxuICogQHByb3BlcnR5IHsoc3RyaW5nKSA9PiBzdHJpbmd9IFtub3JtYWxpemVMaW5lRW5kaW5nc10gdXNlZCB0byByZXBsYWNlIGxpbmUgZW5kaW5ncyBiZWZvcmUgcGFyc2luZ1xuICogXHRcdFx0XHRcdFx0ZGVmYXVsdHMgdG8gYG5vcm1hbGl6ZUxpbmVFbmRpbmdzYFxuICogQHByb3BlcnR5IHtMb2NhdG9yfSBbbG9jYXRvcl1cbiAqIEBwcm9wZXJ0eSB7UmVjb3JkPHN0cmluZywgc3RyaW5nPn0gW3htbG5zXVxuICpcbiAqIEBzZWUgbm9ybWFsaXplTGluZUVuZGluZ3NcbiAqL1xuXG4vKipcbiAqIFRoZSBET01QYXJzZXIgaW50ZXJmYWNlIHByb3ZpZGVzIHRoZSBhYmlsaXR5IHRvIHBhcnNlIFhNTCBvciBIVE1MIHNvdXJjZSBjb2RlXG4gKiBmcm9tIGEgc3RyaW5nIGludG8gYSBET00gYERvY3VtZW50YC5cbiAqXG4gKiBfeG1sZG9tIGlzIGRpZmZlcmVudCBmcm9tIHRoZSBzcGVjIGluIHRoYXQgaXQgYWxsb3dzIGFuIGBvcHRpb25zYCBwYXJhbWV0ZXIsXG4gKiB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBiZWhhdmlvci5fXG4gKlxuICogQHBhcmFtIHtET01QYXJzZXJPcHRpb25zfSBbb3B0aW9uc11cbiAqIEBjb25zdHJ1Y3RvclxuICpcbiAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0RPTVBhcnNlclxuICogQHNlZSBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9keW5hbWljLW1hcmt1cC1pbnNlcnRpb24uaHRtbCNkb20tcGFyc2luZy1hbmQtc2VyaWFsaXphdGlvblxuICovXG5mdW5jdGlvbiBET01QYXJzZXIob3B0aW9ucyl7XG5cdHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgfHx7bG9jYXRvcjp7fX07XG59XG5cbkRPTVBhcnNlci5wcm90b3R5cGUucGFyc2VGcm9tU3RyaW5nID0gZnVuY3Rpb24oc291cmNlLG1pbWVUeXBlKXtcblx0dmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG5cdHZhciBzYXggPSAgbmV3IFhNTFJlYWRlcigpO1xuXHR2YXIgZG9tQnVpbGRlciA9IG9wdGlvbnMuZG9tQnVpbGRlciB8fCBuZXcgRE9NSGFuZGxlcigpOy8vY29udGVudEhhbmRsZXIgYW5kIExleGljYWxIYW5kbGVyXG5cdHZhciBlcnJvckhhbmRsZXIgPSBvcHRpb25zLmVycm9ySGFuZGxlcjtcblx0dmFyIGxvY2F0b3IgPSBvcHRpb25zLmxvY2F0b3I7XG5cdHZhciBkZWZhdWx0TlNNYXAgPSBvcHRpb25zLnhtbG5zfHx7fTtcblx0dmFyIGlzSFRNTCA9IC9cXC94P2h0bWw/JC8udGVzdChtaW1lVHlwZSk7Ly9taW1lVHlwZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ2h0bWwnKSA+IC0xO1xuICBcdHZhciBlbnRpdHlNYXAgPSBpc0hUTUwgPyBlbnRpdGllcy5IVE1MX0VOVElUSUVTIDogZW50aXRpZXMuWE1MX0VOVElUSUVTO1xuXHRpZihsb2NhdG9yKXtcblx0XHRkb21CdWlsZGVyLnNldERvY3VtZW50TG9jYXRvcihsb2NhdG9yKVxuXHR9XG5cblx0c2F4LmVycm9ySGFuZGxlciA9IGJ1aWxkRXJyb3JIYW5kbGVyKGVycm9ySGFuZGxlcixkb21CdWlsZGVyLGxvY2F0b3IpO1xuXHRzYXguZG9tQnVpbGRlciA9IG9wdGlvbnMuZG9tQnVpbGRlciB8fCBkb21CdWlsZGVyO1xuXHRpZihpc0hUTUwpe1xuXHRcdGRlZmF1bHROU01hcFsnJ10gPSBOQU1FU1BBQ0UuSFRNTDtcblx0fVxuXHRkZWZhdWx0TlNNYXAueG1sID0gZGVmYXVsdE5TTWFwLnhtbCB8fCBOQU1FU1BBQ0UuWE1MO1xuXHR2YXIgbm9ybWFsaXplID0gb3B0aW9ucy5ub3JtYWxpemVMaW5lRW5kaW5ncyB8fCBub3JtYWxpemVMaW5lRW5kaW5ncztcblx0aWYgKHNvdXJjZSAmJiB0eXBlb2Ygc291cmNlID09PSAnc3RyaW5nJykge1xuXHRcdHNheC5wYXJzZShcblx0XHRcdG5vcm1hbGl6ZShzb3VyY2UpLFxuXHRcdFx0ZGVmYXVsdE5TTWFwLFxuXHRcdFx0ZW50aXR5TWFwXG5cdFx0KVxuXHR9IGVsc2Uge1xuXHRcdHNheC5lcnJvckhhbmRsZXIuZXJyb3IoJ2ludmFsaWQgZG9jIHNvdXJjZScpXG5cdH1cblx0cmV0dXJuIGRvbUJ1aWxkZXIuZG9jO1xufVxuZnVuY3Rpb24gYnVpbGRFcnJvckhhbmRsZXIoZXJyb3JJbXBsLGRvbUJ1aWxkZXIsbG9jYXRvcil7XG5cdGlmKCFlcnJvckltcGwpe1xuXHRcdGlmKGRvbUJ1aWxkZXIgaW5zdGFuY2VvZiBET01IYW5kbGVyKXtcblx0XHRcdHJldHVybiBkb21CdWlsZGVyO1xuXHRcdH1cblx0XHRlcnJvckltcGwgPSBkb21CdWlsZGVyIDtcblx0fVxuXHR2YXIgZXJyb3JIYW5kbGVyID0ge31cblx0dmFyIGlzQ2FsbGJhY2sgPSBlcnJvckltcGwgaW5zdGFuY2VvZiBGdW5jdGlvbjtcblx0bG9jYXRvciA9IGxvY2F0b3J8fHt9XG5cdGZ1bmN0aW9uIGJ1aWxkKGtleSl7XG5cdFx0dmFyIGZuID0gZXJyb3JJbXBsW2tleV07XG5cdFx0aWYoIWZuICYmIGlzQ2FsbGJhY2spe1xuXHRcdFx0Zm4gPSBlcnJvckltcGwubGVuZ3RoID09IDI/ZnVuY3Rpb24obXNnKXtlcnJvckltcGwoa2V5LG1zZyl9OmVycm9ySW1wbDtcblx0XHR9XG5cdFx0ZXJyb3JIYW5kbGVyW2tleV0gPSBmbiAmJiBmdW5jdGlvbihtc2cpe1xuXHRcdFx0Zm4oJ1t4bWxkb20gJytrZXkrJ11cXHQnK21zZytfbG9jYXRvcihsb2NhdG9yKSk7XG5cdFx0fXx8ZnVuY3Rpb24oKXt9O1xuXHR9XG5cdGJ1aWxkKCd3YXJuaW5nJyk7XG5cdGJ1aWxkKCdlcnJvcicpO1xuXHRidWlsZCgnZmF0YWxFcnJvcicpO1xuXHRyZXR1cm4gZXJyb3JIYW5kbGVyO1xufVxuXG4vL2NvbnNvbGUubG9nKCcjXFxuXFxuXFxuXFxuXFxuXFxuXFxuIyMjIycpXG4vKipcbiAqICtDb250ZW50SGFuZGxlcitFcnJvckhhbmRsZXJcbiAqICtMZXhpY2FsSGFuZGxlcitFbnRpdHlSZXNvbHZlcjJcbiAqIC1EZWNsSGFuZGxlci1EVERIYW5kbGVyXG4gKlxuICogRGVmYXVsdEhhbmRsZXI6RW50aXR5UmVzb2x2ZXIsIERUREhhbmRsZXIsIENvbnRlbnRIYW5kbGVyLCBFcnJvckhhbmRsZXJcbiAqIERlZmF1bHRIYW5kbGVyMjpEZWZhdWx0SGFuZGxlcixMZXhpY2FsSGFuZGxlciwgRGVjbEhhbmRsZXIsIEVudGl0eVJlc29sdmVyMlxuICogQGxpbmsgaHR0cDovL3d3dy5zYXhwcm9qZWN0Lm9yZy9hcGlkb2Mvb3JnL3htbC9zYXgvaGVscGVycy9EZWZhdWx0SGFuZGxlci5odG1sXG4gKi9cbmZ1bmN0aW9uIERPTUhhbmRsZXIoKSB7XG4gICAgdGhpcy5jZGF0YSA9IGZhbHNlO1xufVxuZnVuY3Rpb24gcG9zaXRpb24obG9jYXRvcixub2RlKXtcblx0bm9kZS5saW5lTnVtYmVyID0gbG9jYXRvci5saW5lTnVtYmVyO1xuXHRub2RlLmNvbHVtbk51bWJlciA9IGxvY2F0b3IuY29sdW1uTnVtYmVyO1xufVxuLyoqXG4gKiBAc2VlIG9yZy54bWwuc2F4LkNvbnRlbnRIYW5kbGVyI3N0YXJ0RG9jdW1lbnRcbiAqIEBsaW5rIGh0dHA6Ly93d3cuc2F4cHJvamVjdC5vcmcvYXBpZG9jL29yZy94bWwvc2F4L0NvbnRlbnRIYW5kbGVyLmh0bWxcbiAqL1xuRE9NSGFuZGxlci5wcm90b3R5cGUgPSB7XG5cdHN0YXJ0RG9jdW1lbnQgOiBmdW5jdGlvbigpIHtcbiAgICBcdHRoaXMuZG9jID0gbmV3IERPTUltcGxlbWVudGF0aW9uKCkuY3JlYXRlRG9jdW1lbnQobnVsbCwgbnVsbCwgbnVsbCk7XG4gICAgXHRpZiAodGhpcy5sb2NhdG9yKSB7XG4gICAgICAgIFx0dGhpcy5kb2MuZG9jdW1lbnRVUkkgPSB0aGlzLmxvY2F0b3Iuc3lzdGVtSWQ7XG4gICAgXHR9XG5cdH0sXG5cdHN0YXJ0RWxlbWVudDpmdW5jdGlvbihuYW1lc3BhY2VVUkksIGxvY2FsTmFtZSwgcU5hbWUsIGF0dHJzKSB7XG5cdFx0dmFyIGRvYyA9IHRoaXMuZG9jO1xuXHQgICAgdmFyIGVsID0gZG9jLmNyZWF0ZUVsZW1lbnROUyhuYW1lc3BhY2VVUkksIHFOYW1lfHxsb2NhbE5hbWUpO1xuXHQgICAgdmFyIGxlbiA9IGF0dHJzLmxlbmd0aDtcblx0ICAgIGFwcGVuZEVsZW1lbnQodGhpcywgZWwpO1xuXHQgICAgdGhpcy5jdXJyZW50RWxlbWVudCA9IGVsO1xuXG5cdFx0dGhpcy5sb2NhdG9yICYmIHBvc2l0aW9uKHRoaXMubG9jYXRvcixlbClcblx0ICAgIGZvciAodmFyIGkgPSAwIDsgaSA8IGxlbjsgaSsrKSB7XG5cdCAgICAgICAgdmFyIG5hbWVzcGFjZVVSSSA9IGF0dHJzLmdldFVSSShpKTtcblx0ICAgICAgICB2YXIgdmFsdWUgPSBhdHRycy5nZXRWYWx1ZShpKTtcblx0ICAgICAgICB2YXIgcU5hbWUgPSBhdHRycy5nZXRRTmFtZShpKTtcblx0XHRcdHZhciBhdHRyID0gZG9jLmNyZWF0ZUF0dHJpYnV0ZU5TKG5hbWVzcGFjZVVSSSwgcU5hbWUpO1xuXHRcdFx0dGhpcy5sb2NhdG9yICYmcG9zaXRpb24oYXR0cnMuZ2V0TG9jYXRvcihpKSxhdHRyKTtcblx0XHRcdGF0dHIudmFsdWUgPSBhdHRyLm5vZGVWYWx1ZSA9IHZhbHVlO1xuXHRcdFx0ZWwuc2V0QXR0cmlidXRlTm9kZShhdHRyKVxuXHQgICAgfVxuXHR9LFxuXHRlbmRFbGVtZW50OmZ1bmN0aW9uKG5hbWVzcGFjZVVSSSwgbG9jYWxOYW1lLCBxTmFtZSkge1xuXHRcdHZhciBjdXJyZW50ID0gdGhpcy5jdXJyZW50RWxlbWVudFxuXHRcdHZhciB0YWdOYW1lID0gY3VycmVudC50YWdOYW1lO1xuXHRcdHRoaXMuY3VycmVudEVsZW1lbnQgPSBjdXJyZW50LnBhcmVudE5vZGU7XG5cdH0sXG5cdHN0YXJ0UHJlZml4TWFwcGluZzpmdW5jdGlvbihwcmVmaXgsIHVyaSkge1xuXHR9LFxuXHRlbmRQcmVmaXhNYXBwaW5nOmZ1bmN0aW9uKHByZWZpeCkge1xuXHR9LFxuXHRwcm9jZXNzaW5nSW5zdHJ1Y3Rpb246ZnVuY3Rpb24odGFyZ2V0LCBkYXRhKSB7XG5cdCAgICB2YXIgaW5zID0gdGhpcy5kb2MuY3JlYXRlUHJvY2Vzc2luZ0luc3RydWN0aW9uKHRhcmdldCwgZGF0YSk7XG5cdCAgICB0aGlzLmxvY2F0b3IgJiYgcG9zaXRpb24odGhpcy5sb2NhdG9yLGlucylcblx0ICAgIGFwcGVuZEVsZW1lbnQodGhpcywgaW5zKTtcblx0fSxcblx0aWdub3JhYmxlV2hpdGVzcGFjZTpmdW5jdGlvbihjaCwgc3RhcnQsIGxlbmd0aCkge1xuXHR9LFxuXHRjaGFyYWN0ZXJzOmZ1bmN0aW9uKGNoYXJzLCBzdGFydCwgbGVuZ3RoKSB7XG5cdFx0Y2hhcnMgPSBfdG9TdHJpbmcuYXBwbHkodGhpcyxhcmd1bWVudHMpXG5cdFx0Ly9jb25zb2xlLmxvZyhjaGFycylcblx0XHRpZihjaGFycyl7XG5cdFx0XHRpZiAodGhpcy5jZGF0YSkge1xuXHRcdFx0XHR2YXIgY2hhck5vZGUgPSB0aGlzLmRvYy5jcmVhdGVDREFUQVNlY3Rpb24oY2hhcnMpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dmFyIGNoYXJOb2RlID0gdGhpcy5kb2MuY3JlYXRlVGV4dE5vZGUoY2hhcnMpO1xuXHRcdFx0fVxuXHRcdFx0aWYodGhpcy5jdXJyZW50RWxlbWVudCl7XG5cdFx0XHRcdHRoaXMuY3VycmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoY2hhck5vZGUpO1xuXHRcdFx0fWVsc2UgaWYoL15cXHMqJC8udGVzdChjaGFycykpe1xuXHRcdFx0XHR0aGlzLmRvYy5hcHBlbmRDaGlsZChjaGFyTm9kZSk7XG5cdFx0XHRcdC8vcHJvY2VzcyB4bWxcblx0XHRcdH1cblx0XHRcdHRoaXMubG9jYXRvciAmJiBwb3NpdGlvbih0aGlzLmxvY2F0b3IsY2hhck5vZGUpXG5cdFx0fVxuXHR9LFxuXHRza2lwcGVkRW50aXR5OmZ1bmN0aW9uKG5hbWUpIHtcblx0fSxcblx0ZW5kRG9jdW1lbnQ6ZnVuY3Rpb24oKSB7XG5cdFx0dGhpcy5kb2Mubm9ybWFsaXplKCk7XG5cdH0sXG5cdHNldERvY3VtZW50TG9jYXRvcjpmdW5jdGlvbiAobG9jYXRvcikge1xuXHQgICAgaWYodGhpcy5sb2NhdG9yID0gbG9jYXRvcil7Ly8gJiYgISgnbGluZU51bWJlcicgaW4gbG9jYXRvcikpe1xuXHQgICAgXHRsb2NhdG9yLmxpbmVOdW1iZXIgPSAwO1xuXHQgICAgfVxuXHR9LFxuXHQvL0xleGljYWxIYW5kbGVyXG5cdGNvbW1lbnQ6ZnVuY3Rpb24oY2hhcnMsIHN0YXJ0LCBsZW5ndGgpIHtcblx0XHRjaGFycyA9IF90b1N0cmluZy5hcHBseSh0aGlzLGFyZ3VtZW50cylcblx0ICAgIHZhciBjb21tID0gdGhpcy5kb2MuY3JlYXRlQ29tbWVudChjaGFycyk7XG5cdCAgICB0aGlzLmxvY2F0b3IgJiYgcG9zaXRpb24odGhpcy5sb2NhdG9yLGNvbW0pXG5cdCAgICBhcHBlbmRFbGVtZW50KHRoaXMsIGNvbW0pO1xuXHR9LFxuXG5cdHN0YXJ0Q0RBVEE6ZnVuY3Rpb24oKSB7XG5cdCAgICAvL3VzZWQgaW4gY2hhcmFjdGVycygpIG1ldGhvZHNcblx0ICAgIHRoaXMuY2RhdGEgPSB0cnVlO1xuXHR9LFxuXHRlbmRDREFUQTpmdW5jdGlvbigpIHtcblx0ICAgIHRoaXMuY2RhdGEgPSBmYWxzZTtcblx0fSxcblxuXHRzdGFydERURDpmdW5jdGlvbihuYW1lLCBwdWJsaWNJZCwgc3lzdGVtSWQpIHtcblx0XHR2YXIgaW1wbCA9IHRoaXMuZG9jLmltcGxlbWVudGF0aW9uO1xuXHQgICAgaWYgKGltcGwgJiYgaW1wbC5jcmVhdGVEb2N1bWVudFR5cGUpIHtcblx0ICAgICAgICB2YXIgZHQgPSBpbXBsLmNyZWF0ZURvY3VtZW50VHlwZShuYW1lLCBwdWJsaWNJZCwgc3lzdGVtSWQpO1xuXHQgICAgICAgIHRoaXMubG9jYXRvciAmJiBwb3NpdGlvbih0aGlzLmxvY2F0b3IsZHQpXG5cdCAgICAgICAgYXBwZW5kRWxlbWVudCh0aGlzLCBkdCk7XG5cdFx0XHRcdFx0dGhpcy5kb2MuZG9jdHlwZSA9IGR0O1xuXHQgICAgfVxuXHR9LFxuXHQvKipcblx0ICogQHNlZSBvcmcueG1sLnNheC5FcnJvckhhbmRsZXJcblx0ICogQGxpbmsgaHR0cDovL3d3dy5zYXhwcm9qZWN0Lm9yZy9hcGlkb2Mvb3JnL3htbC9zYXgvRXJyb3JIYW5kbGVyLmh0bWxcblx0ICovXG5cdHdhcm5pbmc6ZnVuY3Rpb24oZXJyb3IpIHtcblx0XHRjb25zb2xlLndhcm4oJ1t4bWxkb20gd2FybmluZ11cXHQnK2Vycm9yLF9sb2NhdG9yKHRoaXMubG9jYXRvcikpO1xuXHR9LFxuXHRlcnJvcjpmdW5jdGlvbihlcnJvcikge1xuXHRcdGNvbnNvbGUuZXJyb3IoJ1t4bWxkb20gZXJyb3JdXFx0JytlcnJvcixfbG9jYXRvcih0aGlzLmxvY2F0b3IpKTtcblx0fSxcblx0ZmF0YWxFcnJvcjpmdW5jdGlvbihlcnJvcikge1xuXHRcdHRocm93IG5ldyBQYXJzZUVycm9yKGVycm9yLCB0aGlzLmxvY2F0b3IpO1xuXHR9XG59XG5mdW5jdGlvbiBfbG9jYXRvcihsKXtcblx0aWYobCl7XG5cdFx0cmV0dXJuICdcXG5AJysobC5zeXN0ZW1JZCB8fCcnKSsnI1tsaW5lOicrbC5saW5lTnVtYmVyKycsY29sOicrbC5jb2x1bW5OdW1iZXIrJ10nXG5cdH1cbn1cbmZ1bmN0aW9uIF90b1N0cmluZyhjaGFycyxzdGFydCxsZW5ndGgpe1xuXHRpZih0eXBlb2YgY2hhcnMgPT0gJ3N0cmluZycpe1xuXHRcdHJldHVybiBjaGFycy5zdWJzdHIoc3RhcnQsbGVuZ3RoKVxuXHR9ZWxzZXsvL2phdmEgc2F4IGNvbm5lY3Qgd2lkdGggeG1sZG9tIG9uIHJoaW5vKHdoYXQgYWJvdXQ6IFwiPyAmJiAhKGNoYXJzIGluc3RhbmNlb2YgU3RyaW5nKVwiKVxuXHRcdGlmKGNoYXJzLmxlbmd0aCA+PSBzdGFydCtsZW5ndGggfHwgc3RhcnQpe1xuXHRcdFx0cmV0dXJuIG5ldyBqYXZhLmxhbmcuU3RyaW5nKGNoYXJzLHN0YXJ0LGxlbmd0aCkrJyc7XG5cdFx0fVxuXHRcdHJldHVybiBjaGFycztcblx0fVxufVxuXG4vKlxuICogQGxpbmsgaHR0cDovL3d3dy5zYXhwcm9qZWN0Lm9yZy9hcGlkb2Mvb3JnL3htbC9zYXgvZXh0L0xleGljYWxIYW5kbGVyLmh0bWxcbiAqIHVzZWQgbWV0aG9kIG9mIG9yZy54bWwuc2F4LmV4dC5MZXhpY2FsSGFuZGxlcjpcbiAqICAjY29tbWVudChjaGFycywgc3RhcnQsIGxlbmd0aClcbiAqICAjc3RhcnRDREFUQSgpXG4gKiAgI2VuZENEQVRBKClcbiAqICAjc3RhcnREVEQobmFtZSwgcHVibGljSWQsIHN5c3RlbUlkKVxuICpcbiAqXG4gKiBJR05PUkVEIG1ldGhvZCBvZiBvcmcueG1sLnNheC5leHQuTGV4aWNhbEhhbmRsZXI6XG4gKiAgI2VuZERURCgpXG4gKiAgI3N0YXJ0RW50aXR5KG5hbWUpXG4gKiAgI2VuZEVudGl0eShuYW1lKVxuICpcbiAqXG4gKiBAbGluayBodHRwOi8vd3d3LnNheHByb2plY3Qub3JnL2FwaWRvYy9vcmcveG1sL3NheC9leHQvRGVjbEhhbmRsZXIuaHRtbFxuICogSUdOT1JFRCBtZXRob2Qgb2Ygb3JnLnhtbC5zYXguZXh0LkRlY2xIYW5kbGVyXG4gKiBcdCNhdHRyaWJ1dGVEZWNsKGVOYW1lLCBhTmFtZSwgdHlwZSwgbW9kZSwgdmFsdWUpXG4gKiAgI2VsZW1lbnREZWNsKG5hbWUsIG1vZGVsKVxuICogICNleHRlcm5hbEVudGl0eURlY2wobmFtZSwgcHVibGljSWQsIHN5c3RlbUlkKVxuICogICNpbnRlcm5hbEVudGl0eURlY2wobmFtZSwgdmFsdWUpXG4gKiBAbGluayBodHRwOi8vd3d3LnNheHByb2plY3Qub3JnL2FwaWRvYy9vcmcveG1sL3NheC9leHQvRW50aXR5UmVzb2x2ZXIyLmh0bWxcbiAqIElHTk9SRUQgbWV0aG9kIG9mIG9yZy54bWwuc2F4LkVudGl0eVJlc29sdmVyMlxuICogICNyZXNvbHZlRW50aXR5KFN0cmluZyBuYW1lLFN0cmluZyBwdWJsaWNJZCxTdHJpbmcgYmFzZVVSSSxTdHJpbmcgc3lzdGVtSWQpXG4gKiAgI3Jlc29sdmVFbnRpdHkocHVibGljSWQsIHN5c3RlbUlkKVxuICogICNnZXRFeHRlcm5hbFN1YnNldChuYW1lLCBiYXNlVVJJKVxuICogQGxpbmsgaHR0cDovL3d3dy5zYXhwcm9qZWN0Lm9yZy9hcGlkb2Mvb3JnL3htbC9zYXgvRFRESGFuZGxlci5odG1sXG4gKiBJR05PUkVEIG1ldGhvZCBvZiBvcmcueG1sLnNheC5EVERIYW5kbGVyXG4gKiAgI25vdGF0aW9uRGVjbChuYW1lLCBwdWJsaWNJZCwgc3lzdGVtSWQpIHt9O1xuICogICN1bnBhcnNlZEVudGl0eURlY2wobmFtZSwgcHVibGljSWQsIHN5c3RlbUlkLCBub3RhdGlvbk5hbWUpIHt9O1xuICovXG5cImVuZERURCxzdGFydEVudGl0eSxlbmRFbnRpdHksYXR0cmlidXRlRGVjbCxlbGVtZW50RGVjbCxleHRlcm5hbEVudGl0eURlY2wsaW50ZXJuYWxFbnRpdHlEZWNsLHJlc29sdmVFbnRpdHksZ2V0RXh0ZXJuYWxTdWJzZXQsbm90YXRpb25EZWNsLHVucGFyc2VkRW50aXR5RGVjbFwiLnJlcGxhY2UoL1xcdysvZyxmdW5jdGlvbihrZXkpe1xuXHRET01IYW5kbGVyLnByb3RvdHlwZVtrZXldID0gZnVuY3Rpb24oKXtyZXR1cm4gbnVsbH1cbn0pXG5cbi8qIFByaXZhdGUgc3RhdGljIGhlbHBlcnMgdHJlYXRlZCBiZWxvdyBhcyBwcml2YXRlIGluc3RhbmNlIG1ldGhvZHMsIHNvIGRvbid0IG5lZWQgdG8gYWRkIHRoZXNlIHRvIHRoZSBwdWJsaWMgQVBJOyB3ZSBtaWdodCB1c2UgYSBSZWxhdG9yIHRvIGFsc28gZ2V0IHJpZCBvZiBub24tc3RhbmRhcmQgcHVibGljIHByb3BlcnRpZXMgKi9cbmZ1bmN0aW9uIGFwcGVuZEVsZW1lbnQgKGhhbmRlcixub2RlKSB7XG4gICAgaWYgKCFoYW5kZXIuY3VycmVudEVsZW1lbnQpIHtcbiAgICAgICAgaGFuZGVyLmRvYy5hcHBlbmRDaGlsZChub2RlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBoYW5kZXIuY3VycmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQobm9kZSk7XG4gICAgfVxufS8vYXBwZW5kQ2hpbGQgYW5kIHNldEF0dHJpYnV0ZU5TIGFyZSBwcmVmb3JtYW5jZSBrZXlcblxuZXhwb3J0cy5fX0RPTUhhbmRsZXIgPSBET01IYW5kbGVyO1xuZXhwb3J0cy5ub3JtYWxpemVMaW5lRW5kaW5ncyA9IG5vcm1hbGl6ZUxpbmVFbmRpbmdzO1xuZXhwb3J0cy5ET01QYXJzZXIgPSBET01QYXJzZXI7XG4iLCJ2YXIgY29udmVudGlvbnMgPSByZXF1aXJlKFwiLi9jb252ZW50aW9uc1wiKTtcblxudmFyIE5BTUVTUEFDRSA9IGNvbnZlbnRpb25zLk5BTUVTUEFDRTtcblxuLyoqXG4gKiBBIHByZXJlcXVpc2l0ZSBmb3IgYFtdLmZpbHRlcmAsIHRvIGRyb3AgZWxlbWVudHMgdGhhdCBhcmUgZW1wdHlcbiAqIEBwYXJhbSB7c3RyaW5nfSBpbnB1dFxuICogQHJldHVybnMge2Jvb2xlYW59XG4gKi9cbmZ1bmN0aW9uIG5vdEVtcHR5U3RyaW5nIChpbnB1dCkge1xuXHRyZXR1cm4gaW5wdXQgIT09ICcnXG59XG4vKipcbiAqIEBzZWUgaHR0cHM6Ly9pbmZyYS5zcGVjLndoYXR3Zy5vcmcvI3NwbGl0LW9uLWFzY2lpLXdoaXRlc3BhY2VcbiAqIEBzZWUgaHR0cHM6Ly9pbmZyYS5zcGVjLndoYXR3Zy5vcmcvI2FzY2lpLXdoaXRlc3BhY2VcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gaW5wdXRcbiAqIEByZXR1cm5zIHtzdHJpbmdbXX0gKGNhbiBiZSBlbXB0eSlcbiAqL1xuZnVuY3Rpb24gc3BsaXRPbkFTQ0lJV2hpdGVzcGFjZShpbnB1dCkge1xuXHQvLyBVKzAwMDkgVEFCLCBVKzAwMEEgTEYsIFUrMDAwQyBGRiwgVSswMDBEIENSLCBVKzAwMjAgU1BBQ0Vcblx0cmV0dXJuIGlucHV0ID8gaW5wdXQuc3BsaXQoL1tcXHRcXG5cXGZcXHIgXSsvKS5maWx0ZXIobm90RW1wdHlTdHJpbmcpIDogW11cbn1cblxuLyoqXG4gKiBBZGRzIGVsZW1lbnQgYXMgYSBrZXkgdG8gY3VycmVudCBpZiBpdCBpcyBub3QgYWxyZWFkeSBwcmVzZW50LlxuICpcbiAqIEBwYXJhbSB7UmVjb3JkPHN0cmluZywgYm9vbGVhbiB8IHVuZGVmaW5lZD59IGN1cnJlbnRcbiAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50XG4gKiBAcmV0dXJucyB7UmVjb3JkPHN0cmluZywgYm9vbGVhbiB8IHVuZGVmaW5lZD59XG4gKi9cbmZ1bmN0aW9uIG9yZGVyZWRTZXRSZWR1Y2VyIChjdXJyZW50LCBlbGVtZW50KSB7XG5cdGlmICghY3VycmVudC5oYXNPd25Qcm9wZXJ0eShlbGVtZW50KSkge1xuXHRcdGN1cnJlbnRbZWxlbWVudF0gPSB0cnVlO1xuXHR9XG5cdHJldHVybiBjdXJyZW50O1xufVxuXG4vKipcbiAqIEBzZWUgaHR0cHM6Ly9pbmZyYS5zcGVjLndoYXR3Zy5vcmcvI29yZGVyZWQtc2V0XG4gKiBAcGFyYW0ge3N0cmluZ30gaW5wdXRcbiAqIEByZXR1cm5zIHtzdHJpbmdbXX1cbiAqL1xuZnVuY3Rpb24gdG9PcmRlcmVkU2V0KGlucHV0KSB7XG5cdGlmICghaW5wdXQpIHJldHVybiBbXTtcblx0dmFyIGxpc3QgPSBzcGxpdE9uQVNDSUlXaGl0ZXNwYWNlKGlucHV0KTtcblx0cmV0dXJuIE9iamVjdC5rZXlzKGxpc3QucmVkdWNlKG9yZGVyZWRTZXRSZWR1Y2VyLCB7fSkpXG59XG5cbi8qKlxuICogVXNlcyBgbGlzdC5pbmRleE9mYCB0byBpbXBsZW1lbnQgc29tZXRoaW5nIGxpa2UgYEFycmF5LnByb3RvdHlwZS5pbmNsdWRlc2AsXG4gKiB3aGljaCB3ZSBjYW4gbm90IHJlbHkgb24gYmVpbmcgYXZhaWxhYmxlLlxuICpcbiAqIEBwYXJhbSB7YW55W119IGxpc3RcbiAqIEByZXR1cm5zIHtmdW5jdGlvbihhbnkpOiBib29sZWFufVxuICovXG5mdW5jdGlvbiBhcnJheUluY2x1ZGVzIChsaXN0KSB7XG5cdHJldHVybiBmdW5jdGlvbihlbGVtZW50KSB7XG5cdFx0cmV0dXJuIGxpc3QgJiYgbGlzdC5pbmRleE9mKGVsZW1lbnQpICE9PSAtMTtcblx0fVxufVxuXG5mdW5jdGlvbiBjb3B5KHNyYyxkZXN0KXtcblx0Zm9yKHZhciBwIGluIHNyYyl7XG5cdFx0ZGVzdFtwXSA9IHNyY1twXTtcblx0fVxufVxuXG4vKipcbl5cXHcrXFwucHJvdG90eXBlXFwuKFtfXFx3XSspXFxzKj1cXHMqKCg/Oi4qXFx7XFxzKj9bXFxyXFxuXVtcXHNcXFNdKj9efSl8XFxTLio/KD89WztcXHJcXG5dKSk7P1xuXlxcdytcXC5wcm90b3R5cGVcXC4oW19cXHddKylcXHMqPVxccyooXFxTLio/KD89WztcXHJcXG5dKSk7P1xuICovXG5mdW5jdGlvbiBfZXh0ZW5kcyhDbGFzcyxTdXBlcil7XG5cdHZhciBwdCA9IENsYXNzLnByb3RvdHlwZTtcblx0aWYoIShwdCBpbnN0YW5jZW9mIFN1cGVyKSl7XG5cdFx0ZnVuY3Rpb24gdCgpe307XG5cdFx0dC5wcm90b3R5cGUgPSBTdXBlci5wcm90b3R5cGU7XG5cdFx0dCA9IG5ldyB0KCk7XG5cdFx0Y29weShwdCx0KTtcblx0XHRDbGFzcy5wcm90b3R5cGUgPSBwdCA9IHQ7XG5cdH1cblx0aWYocHQuY29uc3RydWN0b3IgIT0gQ2xhc3Mpe1xuXHRcdGlmKHR5cGVvZiBDbGFzcyAhPSAnZnVuY3Rpb24nKXtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJ1bmtub3duIENsYXNzOlwiK0NsYXNzKVxuXHRcdH1cblx0XHRwdC5jb25zdHJ1Y3RvciA9IENsYXNzXG5cdH1cbn1cblxuLy8gTm9kZSBUeXBlc1xudmFyIE5vZGVUeXBlID0ge31cbnZhciBFTEVNRU5UX05PREUgICAgICAgICAgICAgICAgPSBOb2RlVHlwZS5FTEVNRU5UX05PREUgICAgICAgICAgICAgICAgPSAxO1xudmFyIEFUVFJJQlVURV9OT0RFICAgICAgICAgICAgICA9IE5vZGVUeXBlLkFUVFJJQlVURV9OT0RFICAgICAgICAgICAgICA9IDI7XG52YXIgVEVYVF9OT0RFICAgICAgICAgICAgICAgICAgID0gTm9kZVR5cGUuVEVYVF9OT0RFICAgICAgICAgICAgICAgICAgID0gMztcbnZhciBDREFUQV9TRUNUSU9OX05PREUgICAgICAgICAgPSBOb2RlVHlwZS5DREFUQV9TRUNUSU9OX05PREUgICAgICAgICAgPSA0O1xudmFyIEVOVElUWV9SRUZFUkVOQ0VfTk9ERSAgICAgICA9IE5vZGVUeXBlLkVOVElUWV9SRUZFUkVOQ0VfTk9ERSAgICAgICA9IDU7XG52YXIgRU5USVRZX05PREUgICAgICAgICAgICAgICAgID0gTm9kZVR5cGUuRU5USVRZX05PREUgICAgICAgICAgICAgICAgID0gNjtcbnZhciBQUk9DRVNTSU5HX0lOU1RSVUNUSU9OX05PREUgPSBOb2RlVHlwZS5QUk9DRVNTSU5HX0lOU1RSVUNUSU9OX05PREUgPSA3O1xudmFyIENPTU1FTlRfTk9ERSAgICAgICAgICAgICAgICA9IE5vZGVUeXBlLkNPTU1FTlRfTk9ERSAgICAgICAgICAgICAgICA9IDg7XG52YXIgRE9DVU1FTlRfTk9ERSAgICAgICAgICAgICAgID0gTm9kZVR5cGUuRE9DVU1FTlRfTk9ERSAgICAgICAgICAgICAgID0gOTtcbnZhciBET0NVTUVOVF9UWVBFX05PREUgICAgICAgICAgPSBOb2RlVHlwZS5ET0NVTUVOVF9UWVBFX05PREUgICAgICAgICAgPSAxMDtcbnZhciBET0NVTUVOVF9GUkFHTUVOVF9OT0RFICAgICAgPSBOb2RlVHlwZS5ET0NVTUVOVF9GUkFHTUVOVF9OT0RFICAgICAgPSAxMTtcbnZhciBOT1RBVElPTl9OT0RFICAgICAgICAgICAgICAgPSBOb2RlVHlwZS5OT1RBVElPTl9OT0RFICAgICAgICAgICAgICAgPSAxMjtcblxuLy8gRXhjZXB0aW9uQ29kZVxudmFyIEV4Y2VwdGlvbkNvZGUgPSB7fVxudmFyIEV4Y2VwdGlvbk1lc3NhZ2UgPSB7fTtcbnZhciBJTkRFWF9TSVpFX0VSUiAgICAgICAgICAgICAgPSBFeGNlcHRpb25Db2RlLklOREVYX1NJWkVfRVJSICAgICAgICAgICAgICA9ICgoRXhjZXB0aW9uTWVzc2FnZVsxXT1cIkluZGV4IHNpemUgZXJyb3JcIiksMSk7XG52YXIgRE9NU1RSSU5HX1NJWkVfRVJSICAgICAgICAgID0gRXhjZXB0aW9uQ29kZS5ET01TVFJJTkdfU0laRV9FUlIgICAgICAgICAgPSAoKEV4Y2VwdGlvbk1lc3NhZ2VbMl09XCJET01TdHJpbmcgc2l6ZSBlcnJvclwiKSwyKTtcbnZhciBISUVSQVJDSFlfUkVRVUVTVF9FUlIgICAgICAgPSBFeGNlcHRpb25Db2RlLkhJRVJBUkNIWV9SRVFVRVNUX0VSUiAgICAgICA9ICgoRXhjZXB0aW9uTWVzc2FnZVszXT1cIkhpZXJhcmNoeSByZXF1ZXN0IGVycm9yXCIpLDMpO1xudmFyIFdST05HX0RPQ1VNRU5UX0VSUiAgICAgICAgICA9IEV4Y2VwdGlvbkNvZGUuV1JPTkdfRE9DVU1FTlRfRVJSICAgICAgICAgID0gKChFeGNlcHRpb25NZXNzYWdlWzRdPVwiV3JvbmcgZG9jdW1lbnRcIiksNCk7XG52YXIgSU5WQUxJRF9DSEFSQUNURVJfRVJSICAgICAgID0gRXhjZXB0aW9uQ29kZS5JTlZBTElEX0NIQVJBQ1RFUl9FUlIgICAgICAgPSAoKEV4Y2VwdGlvbk1lc3NhZ2VbNV09XCJJbnZhbGlkIGNoYXJhY3RlclwiKSw1KTtcbnZhciBOT19EQVRBX0FMTE9XRURfRVJSICAgICAgICAgPSBFeGNlcHRpb25Db2RlLk5PX0RBVEFfQUxMT1dFRF9FUlIgICAgICAgICA9ICgoRXhjZXB0aW9uTWVzc2FnZVs2XT1cIk5vIGRhdGEgYWxsb3dlZFwiKSw2KTtcbnZhciBOT19NT0RJRklDQVRJT05fQUxMT1dFRF9FUlIgPSBFeGNlcHRpb25Db2RlLk5PX01PRElGSUNBVElPTl9BTExPV0VEX0VSUiA9ICgoRXhjZXB0aW9uTWVzc2FnZVs3XT1cIk5vIG1vZGlmaWNhdGlvbiBhbGxvd2VkXCIpLDcpO1xudmFyIE5PVF9GT1VORF9FUlIgICAgICAgICAgICAgICA9IEV4Y2VwdGlvbkNvZGUuTk9UX0ZPVU5EX0VSUiAgICAgICAgICAgICAgID0gKChFeGNlcHRpb25NZXNzYWdlWzhdPVwiTm90IGZvdW5kXCIpLDgpO1xudmFyIE5PVF9TVVBQT1JURURfRVJSICAgICAgICAgICA9IEV4Y2VwdGlvbkNvZGUuTk9UX1NVUFBPUlRFRF9FUlIgICAgICAgICAgID0gKChFeGNlcHRpb25NZXNzYWdlWzldPVwiTm90IHN1cHBvcnRlZFwiKSw5KTtcbnZhciBJTlVTRV9BVFRSSUJVVEVfRVJSICAgICAgICAgPSBFeGNlcHRpb25Db2RlLklOVVNFX0FUVFJJQlVURV9FUlIgICAgICAgICA9ICgoRXhjZXB0aW9uTWVzc2FnZVsxMF09XCJBdHRyaWJ1dGUgaW4gdXNlXCIpLDEwKTtcbi8vbGV2ZWwyXG52YXIgSU5WQUxJRF9TVEFURV9FUlIgICAgICAgIFx0PSBFeGNlcHRpb25Db2RlLklOVkFMSURfU1RBVEVfRVJSICAgICAgICBcdD0gKChFeGNlcHRpb25NZXNzYWdlWzExXT1cIkludmFsaWQgc3RhdGVcIiksMTEpO1xudmFyIFNZTlRBWF9FUlIgICAgICAgICAgICAgICBcdD0gRXhjZXB0aW9uQ29kZS5TWU5UQVhfRVJSICAgICAgICAgICAgICAgXHQ9ICgoRXhjZXB0aW9uTWVzc2FnZVsxMl09XCJTeW50YXggZXJyb3JcIiksMTIpO1xudmFyIElOVkFMSURfTU9ESUZJQ0FUSU9OX0VSUiBcdD0gRXhjZXB0aW9uQ29kZS5JTlZBTElEX01PRElGSUNBVElPTl9FUlIgXHQ9ICgoRXhjZXB0aW9uTWVzc2FnZVsxM109XCJJbnZhbGlkIG1vZGlmaWNhdGlvblwiKSwxMyk7XG52YXIgTkFNRVNQQUNFX0VSUiAgICAgICAgICAgIFx0PSBFeGNlcHRpb25Db2RlLk5BTUVTUEFDRV9FUlIgICAgICAgICAgIFx0PSAoKEV4Y2VwdGlvbk1lc3NhZ2VbMTRdPVwiSW52YWxpZCBuYW1lc3BhY2VcIiksMTQpO1xudmFyIElOVkFMSURfQUNDRVNTX0VSUiAgICAgICBcdD0gRXhjZXB0aW9uQ29kZS5JTlZBTElEX0FDQ0VTU19FUlIgICAgICBcdD0gKChFeGNlcHRpb25NZXNzYWdlWzE1XT1cIkludmFsaWQgYWNjZXNzXCIpLDE1KTtcblxuLyoqXG4gKiBET00gTGV2ZWwgMlxuICogT2JqZWN0IERPTUV4Y2VwdGlvblxuICogQHNlZSBodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAwL1JFQy1ET00tTGV2ZWwtMi1Db3JlLTIwMDAxMTEzL2VjbWEtc2NyaXB0LWJpbmRpbmcuaHRtbFxuICogQHNlZSBodHRwOi8vd3d3LnczLm9yZy9UUi9SRUMtRE9NLUxldmVsLTEvZWNtYS1zY3JpcHQtbGFuZ3VhZ2UtYmluZGluZy5odG1sXG4gKi9cbmZ1bmN0aW9uIERPTUV4Y2VwdGlvbihjb2RlLCBtZXNzYWdlKSB7XG5cdGlmKG1lc3NhZ2UgaW5zdGFuY2VvZiBFcnJvcil7XG5cdFx0dmFyIGVycm9yID0gbWVzc2FnZTtcblx0fWVsc2V7XG5cdFx0ZXJyb3IgPSB0aGlzO1xuXHRcdEVycm9yLmNhbGwodGhpcywgRXhjZXB0aW9uTWVzc2FnZVtjb2RlXSk7XG5cdFx0dGhpcy5tZXNzYWdlID0gRXhjZXB0aW9uTWVzc2FnZVtjb2RlXTtcblx0XHRpZihFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSkgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgRE9NRXhjZXB0aW9uKTtcblx0fVxuXHRlcnJvci5jb2RlID0gY29kZTtcblx0aWYobWVzc2FnZSkgdGhpcy5tZXNzYWdlID0gdGhpcy5tZXNzYWdlICsgXCI6IFwiICsgbWVzc2FnZTtcblx0cmV0dXJuIGVycm9yO1xufTtcbkRPTUV4Y2VwdGlvbi5wcm90b3R5cGUgPSBFcnJvci5wcm90b3R5cGU7XG5jb3B5KEV4Y2VwdGlvbkNvZGUsRE9NRXhjZXB0aW9uKVxuXG4vKipcbiAqIEBzZWUgaHR0cDovL3d3dy53My5vcmcvVFIvMjAwMC9SRUMtRE9NLUxldmVsLTItQ29yZS0yMDAwMTExMy9jb3JlLmh0bWwjSUQtNTM2Mjk3MTc3XG4gKiBUaGUgTm9kZUxpc3QgaW50ZXJmYWNlIHByb3ZpZGVzIHRoZSBhYnN0cmFjdGlvbiBvZiBhbiBvcmRlcmVkIGNvbGxlY3Rpb24gb2Ygbm9kZXMsIHdpdGhvdXQgZGVmaW5pbmcgb3IgY29uc3RyYWluaW5nIGhvdyB0aGlzIGNvbGxlY3Rpb24gaXMgaW1wbGVtZW50ZWQuIE5vZGVMaXN0IG9iamVjdHMgaW4gdGhlIERPTSBhcmUgbGl2ZS5cbiAqIFRoZSBpdGVtcyBpbiB0aGUgTm9kZUxpc3QgYXJlIGFjY2Vzc2libGUgdmlhIGFuIGludGVncmFsIGluZGV4LCBzdGFydGluZyBmcm9tIDAuXG4gKi9cbmZ1bmN0aW9uIE5vZGVMaXN0KCkge1xufTtcbk5vZGVMaXN0LnByb3RvdHlwZSA9IHtcblx0LyoqXG5cdCAqIFRoZSBudW1iZXIgb2Ygbm9kZXMgaW4gdGhlIGxpc3QuIFRoZSByYW5nZSBvZiB2YWxpZCBjaGlsZCBub2RlIGluZGljZXMgaXMgMCB0byBsZW5ndGgtMSBpbmNsdXNpdmUuXG5cdCAqIEBzdGFuZGFyZCBsZXZlbDFcblx0ICovXG5cdGxlbmd0aDowLCBcblx0LyoqXG5cdCAqIFJldHVybnMgdGhlIGluZGV4dGggaXRlbSBpbiB0aGUgY29sbGVjdGlvbi4gSWYgaW5kZXggaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHRoZSBudW1iZXIgb2Ygbm9kZXMgaW4gdGhlIGxpc3QsIHRoaXMgcmV0dXJucyBudWxsLlxuXHQgKiBAc3RhbmRhcmQgbGV2ZWwxXG5cdCAqIEBwYXJhbSBpbmRleCAgdW5zaWduZWQgbG9uZyBcblx0ICogICBJbmRleCBpbnRvIHRoZSBjb2xsZWN0aW9uLlxuXHQgKiBAcmV0dXJuIE5vZGVcblx0ICogXHRUaGUgbm9kZSBhdCB0aGUgaW5kZXh0aCBwb3NpdGlvbiBpbiB0aGUgTm9kZUxpc3QsIG9yIG51bGwgaWYgdGhhdCBpcyBub3QgYSB2YWxpZCBpbmRleC4gXG5cdCAqL1xuXHRpdGVtOiBmdW5jdGlvbihpbmRleCkge1xuXHRcdHJldHVybiB0aGlzW2luZGV4XSB8fCBudWxsO1xuXHR9LFxuXHR0b1N0cmluZzpmdW5jdGlvbihpc0hUTUwsbm9kZUZpbHRlcil7XG5cdFx0Zm9yKHZhciBidWYgPSBbXSwgaSA9IDA7aTx0aGlzLmxlbmd0aDtpKyspe1xuXHRcdFx0c2VyaWFsaXplVG9TdHJpbmcodGhpc1tpXSxidWYsaXNIVE1MLG5vZGVGaWx0ZXIpO1xuXHRcdH1cblx0XHRyZXR1cm4gYnVmLmpvaW4oJycpO1xuXHR9XG59O1xuXG5mdW5jdGlvbiBMaXZlTm9kZUxpc3Qobm9kZSxyZWZyZXNoKXtcblx0dGhpcy5fbm9kZSA9IG5vZGU7XG5cdHRoaXMuX3JlZnJlc2ggPSByZWZyZXNoXG5cdF91cGRhdGVMaXZlTGlzdCh0aGlzKTtcbn1cbmZ1bmN0aW9uIF91cGRhdGVMaXZlTGlzdChsaXN0KXtcblx0dmFyIGluYyA9IGxpc3QuX25vZGUuX2luYyB8fCBsaXN0Ll9ub2RlLm93bmVyRG9jdW1lbnQuX2luYztcblx0aWYobGlzdC5faW5jICE9IGluYyl7XG5cdFx0dmFyIGxzID0gbGlzdC5fcmVmcmVzaChsaXN0Ll9ub2RlKTtcblx0XHQvL2NvbnNvbGUubG9nKGxzLmxlbmd0aClcblx0XHRfX3NldF9fKGxpc3QsJ2xlbmd0aCcsbHMubGVuZ3RoKTtcblx0XHRjb3B5KGxzLGxpc3QpO1xuXHRcdGxpc3QuX2luYyA9IGluYztcblx0fVxufVxuTGl2ZU5vZGVMaXN0LnByb3RvdHlwZS5pdGVtID0gZnVuY3Rpb24oaSl7XG5cdF91cGRhdGVMaXZlTGlzdCh0aGlzKTtcblx0cmV0dXJuIHRoaXNbaV07XG59XG5cbl9leHRlbmRzKExpdmVOb2RlTGlzdCxOb2RlTGlzdCk7XG5cbi8qKlxuICogT2JqZWN0cyBpbXBsZW1lbnRpbmcgdGhlIE5hbWVkTm9kZU1hcCBpbnRlcmZhY2UgYXJlIHVzZWRcbiAqIHRvIHJlcHJlc2VudCBjb2xsZWN0aW9ucyBvZiBub2RlcyB0aGF0IGNhbiBiZSBhY2Nlc3NlZCBieSBuYW1lLlxuICogTm90ZSB0aGF0IE5hbWVkTm9kZU1hcCBkb2VzIG5vdCBpbmhlcml0IGZyb20gTm9kZUxpc3Q7XG4gKiBOYW1lZE5vZGVNYXBzIGFyZSBub3QgbWFpbnRhaW5lZCBpbiBhbnkgcGFydGljdWxhciBvcmRlci5cbiAqIE9iamVjdHMgY29udGFpbmVkIGluIGFuIG9iamVjdCBpbXBsZW1lbnRpbmcgTmFtZWROb2RlTWFwIG1heSBhbHNvIGJlIGFjY2Vzc2VkIGJ5IGFuIG9yZGluYWwgaW5kZXgsXG4gKiBidXQgdGhpcyBpcyBzaW1wbHkgdG8gYWxsb3cgY29udmVuaWVudCBlbnVtZXJhdGlvbiBvZiB0aGUgY29udGVudHMgb2YgYSBOYW1lZE5vZGVNYXAsXG4gKiBhbmQgZG9lcyBub3QgaW1wbHkgdGhhdCB0aGUgRE9NIHNwZWNpZmllcyBhbiBvcmRlciB0byB0aGVzZSBOb2Rlcy5cbiAqIE5hbWVkTm9kZU1hcCBvYmplY3RzIGluIHRoZSBET00gYXJlIGxpdmUuXG4gKiB1c2VkIGZvciBhdHRyaWJ1dGVzIG9yIERvY3VtZW50VHlwZSBlbnRpdGllcyBcbiAqL1xuZnVuY3Rpb24gTmFtZWROb2RlTWFwKCkge1xufTtcblxuZnVuY3Rpb24gX2ZpbmROb2RlSW5kZXgobGlzdCxub2RlKXtcblx0dmFyIGkgPSBsaXN0Lmxlbmd0aDtcblx0d2hpbGUoaS0tKXtcblx0XHRpZihsaXN0W2ldID09PSBub2RlKXtyZXR1cm4gaX1cblx0fVxufVxuXG5mdW5jdGlvbiBfYWRkTmFtZWROb2RlKGVsLGxpc3QsbmV3QXR0cixvbGRBdHRyKXtcblx0aWYob2xkQXR0cil7XG5cdFx0bGlzdFtfZmluZE5vZGVJbmRleChsaXN0LG9sZEF0dHIpXSA9IG5ld0F0dHI7XG5cdH1lbHNle1xuXHRcdGxpc3RbbGlzdC5sZW5ndGgrK10gPSBuZXdBdHRyO1xuXHR9XG5cdGlmKGVsKXtcblx0XHRuZXdBdHRyLm93bmVyRWxlbWVudCA9IGVsO1xuXHRcdHZhciBkb2MgPSBlbC5vd25lckRvY3VtZW50O1xuXHRcdGlmKGRvYyl7XG5cdFx0XHRvbGRBdHRyICYmIF9vblJlbW92ZUF0dHJpYnV0ZShkb2MsZWwsb2xkQXR0cik7XG5cdFx0XHRfb25BZGRBdHRyaWJ1dGUoZG9jLGVsLG5ld0F0dHIpO1xuXHRcdH1cblx0fVxufVxuZnVuY3Rpb24gX3JlbW92ZU5hbWVkTm9kZShlbCxsaXN0LGF0dHIpe1xuXHQvL2NvbnNvbGUubG9nKCdyZW1vdmUgYXR0cjonK2F0dHIpXG5cdHZhciBpID0gX2ZpbmROb2RlSW5kZXgobGlzdCxhdHRyKTtcblx0aWYoaT49MCl7XG5cdFx0dmFyIGxhc3RJbmRleCA9IGxpc3QubGVuZ3RoLTFcblx0XHR3aGlsZShpPGxhc3RJbmRleCl7XG5cdFx0XHRsaXN0W2ldID0gbGlzdFsrK2ldXG5cdFx0fVxuXHRcdGxpc3QubGVuZ3RoID0gbGFzdEluZGV4O1xuXHRcdGlmKGVsKXtcblx0XHRcdHZhciBkb2MgPSBlbC5vd25lckRvY3VtZW50O1xuXHRcdFx0aWYoZG9jKXtcblx0XHRcdFx0X29uUmVtb3ZlQXR0cmlidXRlKGRvYyxlbCxhdHRyKTtcblx0XHRcdFx0YXR0ci5vd25lckVsZW1lbnQgPSBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0fWVsc2V7XG5cdFx0dGhyb3cgRE9NRXhjZXB0aW9uKE5PVF9GT1VORF9FUlIsbmV3IEVycm9yKGVsLnRhZ05hbWUrJ0AnK2F0dHIpKVxuXHR9XG59XG5OYW1lZE5vZGVNYXAucHJvdG90eXBlID0ge1xuXHRsZW5ndGg6MCxcblx0aXRlbTpOb2RlTGlzdC5wcm90b3R5cGUuaXRlbSxcblx0Z2V0TmFtZWRJdGVtOiBmdW5jdGlvbihrZXkpIHtcbi8vXHRcdGlmKGtleS5pbmRleE9mKCc6Jyk+MCB8fCBrZXkgPT0gJ3htbG5zJyl7XG4vL1x0XHRcdHJldHVybiBudWxsO1xuLy9cdFx0fVxuXHRcdC8vY29uc29sZS5sb2coKVxuXHRcdHZhciBpID0gdGhpcy5sZW5ndGg7XG5cdFx0d2hpbGUoaS0tKXtcblx0XHRcdHZhciBhdHRyID0gdGhpc1tpXTtcblx0XHRcdC8vY29uc29sZS5sb2coYXR0ci5ub2RlTmFtZSxrZXkpXG5cdFx0XHRpZihhdHRyLm5vZGVOYW1lID09IGtleSl7XG5cdFx0XHRcdHJldHVybiBhdHRyO1xuXHRcdFx0fVxuXHRcdH1cblx0fSxcblx0c2V0TmFtZWRJdGVtOiBmdW5jdGlvbihhdHRyKSB7XG5cdFx0dmFyIGVsID0gYXR0ci5vd25lckVsZW1lbnQ7XG5cdFx0aWYoZWwgJiYgZWwhPXRoaXMuX293bmVyRWxlbWVudCl7XG5cdFx0XHR0aHJvdyBuZXcgRE9NRXhjZXB0aW9uKElOVVNFX0FUVFJJQlVURV9FUlIpO1xuXHRcdH1cblx0XHR2YXIgb2xkQXR0ciA9IHRoaXMuZ2V0TmFtZWRJdGVtKGF0dHIubm9kZU5hbWUpO1xuXHRcdF9hZGROYW1lZE5vZGUodGhpcy5fb3duZXJFbGVtZW50LHRoaXMsYXR0cixvbGRBdHRyKTtcblx0XHRyZXR1cm4gb2xkQXR0cjtcblx0fSxcblx0LyogcmV0dXJucyBOb2RlICovXG5cdHNldE5hbWVkSXRlbU5TOiBmdW5jdGlvbihhdHRyKSB7Ly8gcmFpc2VzOiBXUk9OR19ET0NVTUVOVF9FUlIsTk9fTU9ESUZJQ0FUSU9OX0FMTE9XRURfRVJSLElOVVNFX0FUVFJJQlVURV9FUlJcblx0XHR2YXIgZWwgPSBhdHRyLm93bmVyRWxlbWVudCwgb2xkQXR0cjtcblx0XHRpZihlbCAmJiBlbCE9dGhpcy5fb3duZXJFbGVtZW50KXtcblx0XHRcdHRocm93IG5ldyBET01FeGNlcHRpb24oSU5VU0VfQVRUUklCVVRFX0VSUik7XG5cdFx0fVxuXHRcdG9sZEF0dHIgPSB0aGlzLmdldE5hbWVkSXRlbU5TKGF0dHIubmFtZXNwYWNlVVJJLGF0dHIubG9jYWxOYW1lKTtcblx0XHRfYWRkTmFtZWROb2RlKHRoaXMuX293bmVyRWxlbWVudCx0aGlzLGF0dHIsb2xkQXR0cik7XG5cdFx0cmV0dXJuIG9sZEF0dHI7XG5cdH0sXG5cblx0LyogcmV0dXJucyBOb2RlICovXG5cdHJlbW92ZU5hbWVkSXRlbTogZnVuY3Rpb24oa2V5KSB7XG5cdFx0dmFyIGF0dHIgPSB0aGlzLmdldE5hbWVkSXRlbShrZXkpO1xuXHRcdF9yZW1vdmVOYW1lZE5vZGUodGhpcy5fb3duZXJFbGVtZW50LHRoaXMsYXR0cik7XG5cdFx0cmV0dXJuIGF0dHI7XG5cdFx0XG5cdFx0XG5cdH0sLy8gcmFpc2VzOiBOT1RfRk9VTkRfRVJSLE5PX01PRElGSUNBVElPTl9BTExPV0VEX0VSUlxuXHRcblx0Ly9mb3IgbGV2ZWwyXG5cdHJlbW92ZU5hbWVkSXRlbU5TOmZ1bmN0aW9uKG5hbWVzcGFjZVVSSSxsb2NhbE5hbWUpe1xuXHRcdHZhciBhdHRyID0gdGhpcy5nZXROYW1lZEl0ZW1OUyhuYW1lc3BhY2VVUkksbG9jYWxOYW1lKTtcblx0XHRfcmVtb3ZlTmFtZWROb2RlKHRoaXMuX293bmVyRWxlbWVudCx0aGlzLGF0dHIpO1xuXHRcdHJldHVybiBhdHRyO1xuXHR9LFxuXHRnZXROYW1lZEl0ZW1OUzogZnVuY3Rpb24obmFtZXNwYWNlVVJJLCBsb2NhbE5hbWUpIHtcblx0XHR2YXIgaSA9IHRoaXMubGVuZ3RoO1xuXHRcdHdoaWxlKGktLSl7XG5cdFx0XHR2YXIgbm9kZSA9IHRoaXNbaV07XG5cdFx0XHRpZihub2RlLmxvY2FsTmFtZSA9PSBsb2NhbE5hbWUgJiYgbm9kZS5uYW1lc3BhY2VVUkkgPT0gbmFtZXNwYWNlVVJJKXtcblx0XHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiBudWxsO1xuXHR9XG59O1xuXG4vKipcbiAqIFRoZSBET01JbXBsZW1lbnRhdGlvbiBpbnRlcmZhY2UgcmVwcmVzZW50cyBhbiBvYmplY3QgcHJvdmlkaW5nIG1ldGhvZHNcbiAqIHdoaWNoIGFyZSBub3QgZGVwZW5kZW50IG9uIGFueSBwYXJ0aWN1bGFyIGRvY3VtZW50LlxuICogU3VjaCBhbiBvYmplY3QgaXMgcmV0dXJuZWQgYnkgdGhlIGBEb2N1bWVudC5pbXBsZW1lbnRhdGlvbmAgcHJvcGVydHkuXG4gKlxuICogX19UaGUgaW5kaXZpZHVhbCBtZXRob2RzIGRlc2NyaWJlIHRoZSBkaWZmZXJlbmNlcyBjb21wYXJlZCB0byB0aGUgc3BlY3MuX19cbiAqXG4gKiBAY29uc3RydWN0b3JcbiAqXG4gKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9ET01JbXBsZW1lbnRhdGlvbiBNRE5cbiAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSL1JFQy1ET00tTGV2ZWwtMS9sZXZlbC1vbmUtY29yZS5odG1sI0lELTEwMjE2MTQ5MCBET00gTGV2ZWwgMSBDb3JlIChJbml0aWFsKVxuICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvRE9NLUxldmVsLTItQ29yZS9jb3JlLmh0bWwjSUQtMTAyMTYxNDkwIERPTSBMZXZlbCAyIENvcmVcbiAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSL0RPTS1MZXZlbC0zLUNvcmUvY29yZS5odG1sI0lELTEwMjE2MTQ5MCBET00gTGV2ZWwgMyBDb3JlXG4gKiBAc2VlIGh0dHBzOi8vZG9tLnNwZWMud2hhdHdnLm9yZy8jZG9taW1wbGVtZW50YXRpb24gRE9NIExpdmluZyBTdGFuZGFyZFxuICovXG5mdW5jdGlvbiBET01JbXBsZW1lbnRhdGlvbigpIHtcbn1cblxuRE9NSW1wbGVtZW50YXRpb24ucHJvdG90eXBlID0ge1xuXHQvKipcblx0ICogVGhlIERPTUltcGxlbWVudGF0aW9uLmhhc0ZlYXR1cmUoKSBtZXRob2QgcmV0dXJucyBhIEJvb2xlYW4gZmxhZyBpbmRpY2F0aW5nIGlmIGEgZ2l2ZW4gZmVhdHVyZSBpcyBzdXBwb3J0ZWQuXG5cdCAqIFRoZSBkaWZmZXJlbnQgaW1wbGVtZW50YXRpb25zIGZhaXJseSBkaXZlcmdlZCBpbiB3aGF0IGtpbmQgb2YgZmVhdHVyZXMgd2VyZSByZXBvcnRlZC5cblx0ICogVGhlIGxhdGVzdCB2ZXJzaW9uIG9mIHRoZSBzcGVjIHNldHRsZWQgdG8gZm9yY2UgdGhpcyBtZXRob2QgdG8gYWx3YXlzIHJldHVybiB0cnVlLCB3aGVyZSB0aGUgZnVuY3Rpb25hbGl0eSB3YXMgYWNjdXJhdGUgYW5kIGluIHVzZS5cblx0ICpcblx0ICogQGRlcHJlY2F0ZWQgSXQgaXMgZGVwcmVjYXRlZCBhbmQgbW9kZXJuIGJyb3dzZXJzIHJldHVybiB0cnVlIGluIGFsbCBjYXNlcy5cblx0ICpcblx0ICogQHBhcmFtIHtzdHJpbmd9IGZlYXR1cmVcblx0ICogQHBhcmFtIHtzdHJpbmd9IFt2ZXJzaW9uXVxuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn0gYWx3YXlzIHRydWVcblx0ICpcblx0ICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRE9NSW1wbGVtZW50YXRpb24vaGFzRmVhdHVyZSBNRE5cblx0ICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvUkVDLURPTS1MZXZlbC0xL2xldmVsLW9uZS1jb3JlLmh0bWwjSUQtNUNFRDk0RDcgRE9NIExldmVsIDEgQ29yZVxuXHQgKiBAc2VlIGh0dHBzOi8vZG9tLnNwZWMud2hhdHdnLm9yZy8jZG9tLWRvbWltcGxlbWVudGF0aW9uLWhhc2ZlYXR1cmUgRE9NIExpdmluZyBTdGFuZGFyZFxuXHQgKi9cblx0aGFzRmVhdHVyZTogZnVuY3Rpb24oZmVhdHVyZSwgdmVyc2lvbikge1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdH0sXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGFuIFhNTCBEb2N1bWVudCBvYmplY3Qgb2YgdGhlIHNwZWNpZmllZCB0eXBlIHdpdGggaXRzIGRvY3VtZW50IGVsZW1lbnQuXG5cdCAqXG5cdCAqIF9fSXQgYmVoYXZlcyBzbGlnaHRseSBkaWZmZXJlbnQgZnJvbSB0aGUgZGVzY3JpcHRpb24gaW4gdGhlIGxpdmluZyBzdGFuZGFyZF9fOlxuXHQgKiAtIFRoZXJlIGlzIG5vIGludGVyZmFjZS9jbGFzcyBgWE1MRG9jdW1lbnRgLCBpdCByZXR1cm5zIGEgYERvY3VtZW50YCBpbnN0YW5jZS5cblx0ICogLSBgY29udGVudFR5cGVgLCBgZW5jb2RpbmdgLCBgbW9kZWAsIGBvcmlnaW5gLCBgdXJsYCBmaWVsZHMgYXJlIGN1cnJlbnRseSBub3QgZGVjbGFyZWQuXG5cdCAqIC0gdGhpcyBpbXBsZW1lbnRhdGlvbiBpcyBub3QgdmFsaWRhdGluZyBuYW1lcyBvciBxdWFsaWZpZWQgbmFtZXNcblx0ICogICAod2hlbiBwYXJzaW5nIFhNTCBzdHJpbmdzLCB0aGUgU0FYIHBhcnNlciB0YWtlcyBjYXJlIG9mIHRoYXQpXG5cdCAqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfG51bGx9IG5hbWVzcGFjZVVSSVxuXHQgKiBAcGFyYW0ge3N0cmluZ30gcXVhbGlmaWVkTmFtZVxuXHQgKiBAcGFyYW0ge0RvY3VtZW50VHlwZT1udWxsfSBkb2N0eXBlXG5cdCAqIEByZXR1cm5zIHtEb2N1bWVudH1cblx0ICpcblx0ICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRE9NSW1wbGVtZW50YXRpb24vY3JlYXRlRG9jdW1lbnQgTUROXG5cdCAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSL0RPTS1MZXZlbC0yLUNvcmUvY29yZS5odG1sI0xldmVsLTItQ29yZS1ET00tY3JlYXRlRG9jdW1lbnQgRE9NIExldmVsIDIgQ29yZSAoaW5pdGlhbClcblx0ICogQHNlZSBodHRwczovL2RvbS5zcGVjLndoYXR3Zy5vcmcvI2RvbS1kb21pbXBsZW1lbnRhdGlvbi1jcmVhdGVkb2N1bWVudCAgRE9NIExldmVsIDIgQ29yZVxuXHQgKlxuXHQgKiBAc2VlIGh0dHBzOi8vZG9tLnNwZWMud2hhdHdnLm9yZy8jdmFsaWRhdGUtYW5kLWV4dHJhY3QgRE9NOiBWYWxpZGF0ZSBhbmQgZXh0cmFjdFxuXHQgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi94bWwvI05ULU5hbWVTdGFydENoYXIgWE1MIFNwZWM6IE5hbWVzXG5cdCAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSL3htbC1uYW1lcy8jbnMtcXVhbG5hbWVzIFhNTCBOYW1lc3BhY2VzOiBRdWFsaWZpZWQgbmFtZXNcblx0ICovXG5cdGNyZWF0ZURvY3VtZW50OiBmdW5jdGlvbihuYW1lc3BhY2VVUkksICBxdWFsaWZpZWROYW1lLCBkb2N0eXBlKXtcblx0XHR2YXIgZG9jID0gbmV3IERvY3VtZW50KCk7XG5cdFx0ZG9jLmltcGxlbWVudGF0aW9uID0gdGhpcztcblx0XHRkb2MuY2hpbGROb2RlcyA9IG5ldyBOb2RlTGlzdCgpO1xuXHRcdGRvYy5kb2N0eXBlID0gZG9jdHlwZSB8fCBudWxsO1xuXHRcdGlmIChkb2N0eXBlKXtcblx0XHRcdGRvYy5hcHBlbmRDaGlsZChkb2N0eXBlKTtcblx0XHR9XG5cdFx0aWYgKHF1YWxpZmllZE5hbWUpe1xuXHRcdFx0dmFyIHJvb3QgPSBkb2MuY3JlYXRlRWxlbWVudE5TKG5hbWVzcGFjZVVSSSwgcXVhbGlmaWVkTmFtZSk7XG5cdFx0XHRkb2MuYXBwZW5kQ2hpbGQocm9vdCk7XG5cdFx0fVxuXHRcdHJldHVybiBkb2M7XG5cdH0sXG5cdC8qKlxuXHQgKiBSZXR1cm5zIGEgZG9jdHlwZSwgd2l0aCB0aGUgZ2l2ZW4gYHF1YWxpZmllZE5hbWVgLCBgcHVibGljSWRgLCBhbmQgYHN5c3RlbUlkYC5cblx0ICpcblx0ICogX19UaGlzIGJlaGF2aW9yIGlzIHNsaWdodGx5IGRpZmZlcmVudCBmcm9tIHRoZSBpbiB0aGUgc3BlY3NfXzpcblx0ICogLSB0aGlzIGltcGxlbWVudGF0aW9uIGlzIG5vdCB2YWxpZGF0aW5nIG5hbWVzIG9yIHF1YWxpZmllZCBuYW1lc1xuXHQgKiAgICh3aGVuIHBhcnNpbmcgWE1MIHN0cmluZ3MsIHRoZSBTQVggcGFyc2VyIHRha2VzIGNhcmUgb2YgdGhhdClcblx0ICpcblx0ICogQHBhcmFtIHtzdHJpbmd9IHF1YWxpZmllZE5hbWVcblx0ICogQHBhcmFtIHtzdHJpbmd9IFtwdWJsaWNJZF1cblx0ICogQHBhcmFtIHtzdHJpbmd9IFtzeXN0ZW1JZF1cblx0ICogQHJldHVybnMge0RvY3VtZW50VHlwZX0gd2hpY2ggY2FuIGVpdGhlciBiZSB1c2VkIHdpdGggYERPTUltcGxlbWVudGF0aW9uLmNyZWF0ZURvY3VtZW50YCB1cG9uIGRvY3VtZW50IGNyZWF0aW9uXG5cdCAqIFx0XHRcdFx0ICBvciBjYW4gYmUgcHV0IGludG8gdGhlIGRvY3VtZW50IHZpYSBtZXRob2RzIGxpa2UgYE5vZGUuaW5zZXJ0QmVmb3JlKClgIG9yIGBOb2RlLnJlcGxhY2VDaGlsZCgpYFxuXHQgKlxuXHQgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9ET01JbXBsZW1lbnRhdGlvbi9jcmVhdGVEb2N1bWVudFR5cGUgTUROXG5cdCAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSL0RPTS1MZXZlbC0yLUNvcmUvY29yZS5odG1sI0xldmVsLTItQ29yZS1ET00tY3JlYXRlRG9jVHlwZSBET00gTGV2ZWwgMiBDb3JlXG5cdCAqIEBzZWUgaHR0cHM6Ly9kb20uc3BlYy53aGF0d2cub3JnLyNkb20tZG9taW1wbGVtZW50YXRpb24tY3JlYXRlZG9jdW1lbnR0eXBlIERPTSBMaXZpbmcgU3RhbmRhcmRcblx0ICpcblx0ICogQHNlZSBodHRwczovL2RvbS5zcGVjLndoYXR3Zy5vcmcvI3ZhbGlkYXRlLWFuZC1leHRyYWN0IERPTTogVmFsaWRhdGUgYW5kIGV4dHJhY3Rcblx0ICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIveG1sLyNOVC1OYW1lU3RhcnRDaGFyIFhNTCBTcGVjOiBOYW1lc1xuXHQgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi94bWwtbmFtZXMvI25zLXF1YWxuYW1lcyBYTUwgTmFtZXNwYWNlczogUXVhbGlmaWVkIG5hbWVzXG5cdCAqL1xuXHRjcmVhdGVEb2N1bWVudFR5cGU6IGZ1bmN0aW9uKHF1YWxpZmllZE5hbWUsIHB1YmxpY0lkLCBzeXN0ZW1JZCl7XG5cdFx0dmFyIG5vZGUgPSBuZXcgRG9jdW1lbnRUeXBlKCk7XG5cdFx0bm9kZS5uYW1lID0gcXVhbGlmaWVkTmFtZTtcblx0XHRub2RlLm5vZGVOYW1lID0gcXVhbGlmaWVkTmFtZTtcblx0XHRub2RlLnB1YmxpY0lkID0gcHVibGljSWQgfHwgJyc7XG5cdFx0bm9kZS5zeXN0ZW1JZCA9IHN5c3RlbUlkIHx8ICcnO1xuXG5cdFx0cmV0dXJuIG5vZGU7XG5cdH1cbn07XG5cblxuLyoqXG4gKiBAc2VlIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMDAvUkVDLURPTS1MZXZlbC0yLUNvcmUtMjAwMDExMTMvY29yZS5odG1sI0lELTE5NTA2NDEyNDdcbiAqL1xuXG5mdW5jdGlvbiBOb2RlKCkge1xufTtcblxuTm9kZS5wcm90b3R5cGUgPSB7XG5cdGZpcnN0Q2hpbGQgOiBudWxsLFxuXHRsYXN0Q2hpbGQgOiBudWxsLFxuXHRwcmV2aW91c1NpYmxpbmcgOiBudWxsLFxuXHRuZXh0U2libGluZyA6IG51bGwsXG5cdGF0dHJpYnV0ZXMgOiBudWxsLFxuXHRwYXJlbnROb2RlIDogbnVsbCxcblx0Y2hpbGROb2RlcyA6IG51bGwsXG5cdG93bmVyRG9jdW1lbnQgOiBudWxsLFxuXHRub2RlVmFsdWUgOiBudWxsLFxuXHRuYW1lc3BhY2VVUkkgOiBudWxsLFxuXHRwcmVmaXggOiBudWxsLFxuXHRsb2NhbE5hbWUgOiBudWxsLFxuXHQvLyBNb2RpZmllZCBpbiBET00gTGV2ZWwgMjpcblx0aW5zZXJ0QmVmb3JlOmZ1bmN0aW9uKG5ld0NoaWxkLCByZWZDaGlsZCl7Ly9yYWlzZXMgXG5cdFx0cmV0dXJuIF9pbnNlcnRCZWZvcmUodGhpcyxuZXdDaGlsZCxyZWZDaGlsZCk7XG5cdH0sXG5cdHJlcGxhY2VDaGlsZDpmdW5jdGlvbihuZXdDaGlsZCwgb2xkQ2hpbGQpey8vcmFpc2VzIFxuXHRcdHRoaXMuaW5zZXJ0QmVmb3JlKG5ld0NoaWxkLG9sZENoaWxkKTtcblx0XHRpZihvbGRDaGlsZCl7XG5cdFx0XHR0aGlzLnJlbW92ZUNoaWxkKG9sZENoaWxkKTtcblx0XHR9XG5cdH0sXG5cdHJlbW92ZUNoaWxkOmZ1bmN0aW9uKG9sZENoaWxkKXtcblx0XHRyZXR1cm4gX3JlbW92ZUNoaWxkKHRoaXMsb2xkQ2hpbGQpO1xuXHR9LFxuXHRhcHBlbmRDaGlsZDpmdW5jdGlvbihuZXdDaGlsZCl7XG5cdFx0cmV0dXJuIHRoaXMuaW5zZXJ0QmVmb3JlKG5ld0NoaWxkLG51bGwpO1xuXHR9LFxuXHRoYXNDaGlsZE5vZGVzOmZ1bmN0aW9uKCl7XG5cdFx0cmV0dXJuIHRoaXMuZmlyc3RDaGlsZCAhPSBudWxsO1xuXHR9LFxuXHRjbG9uZU5vZGU6ZnVuY3Rpb24oZGVlcCl7XG5cdFx0cmV0dXJuIGNsb25lTm9kZSh0aGlzLm93bmVyRG9jdW1lbnR8fHRoaXMsdGhpcyxkZWVwKTtcblx0fSxcblx0Ly8gTW9kaWZpZWQgaW4gRE9NIExldmVsIDI6XG5cdG5vcm1hbGl6ZTpmdW5jdGlvbigpe1xuXHRcdHZhciBjaGlsZCA9IHRoaXMuZmlyc3RDaGlsZDtcblx0XHR3aGlsZShjaGlsZCl7XG5cdFx0XHR2YXIgbmV4dCA9IGNoaWxkLm5leHRTaWJsaW5nO1xuXHRcdFx0aWYobmV4dCAmJiBuZXh0Lm5vZGVUeXBlID09IFRFWFRfTk9ERSAmJiBjaGlsZC5ub2RlVHlwZSA9PSBURVhUX05PREUpe1xuXHRcdFx0XHR0aGlzLnJlbW92ZUNoaWxkKG5leHQpO1xuXHRcdFx0XHRjaGlsZC5hcHBlbmREYXRhKG5leHQuZGF0YSk7XG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0Y2hpbGQubm9ybWFsaXplKCk7XG5cdFx0XHRcdGNoaWxkID0gbmV4dDtcblx0XHRcdH1cblx0XHR9XG5cdH0sXG4gIFx0Ly8gSW50cm9kdWNlZCBpbiBET00gTGV2ZWwgMjpcblx0aXNTdXBwb3J0ZWQ6ZnVuY3Rpb24oZmVhdHVyZSwgdmVyc2lvbil7XG5cdFx0cmV0dXJuIHRoaXMub3duZXJEb2N1bWVudC5pbXBsZW1lbnRhdGlvbi5oYXNGZWF0dXJlKGZlYXR1cmUsdmVyc2lvbik7XG5cdH0sXG4gICAgLy8gSW50cm9kdWNlZCBpbiBET00gTGV2ZWwgMjpcbiAgICBoYXNBdHRyaWJ1dGVzOmZ1bmN0aW9uKCl7XG4gICAgXHRyZXR1cm4gdGhpcy5hdHRyaWJ1dGVzLmxlbmd0aD4wO1xuICAgIH0sXG5cdC8qKlxuXHQgKiBMb29rIHVwIHRoZSBwcmVmaXggYXNzb2NpYXRlZCB0byB0aGUgZ2l2ZW4gbmFtZXNwYWNlIFVSSSwgc3RhcnRpbmcgZnJvbSB0aGlzIG5vZGUuXG5cdCAqICoqVGhlIGRlZmF1bHQgbmFtZXNwYWNlIGRlY2xhcmF0aW9ucyBhcmUgaWdub3JlZCBieSB0aGlzIG1ldGhvZC4qKlxuXHQgKiBTZWUgTmFtZXNwYWNlIFByZWZpeCBMb29rdXAgZm9yIGRldGFpbHMgb24gdGhlIGFsZ29yaXRobSB1c2VkIGJ5IHRoaXMgbWV0aG9kLlxuXHQgKlxuXHQgKiBfTm90ZTogVGhlIGltcGxlbWVudGF0aW9uIHNlZW1zIHRvIGJlIGluY29tcGxldGUgd2hlbiBjb21wYXJlZCB0byB0aGUgYWxnb3JpdGhtIGRlc2NyaWJlZCBpbiB0aGUgc3BlY3MuX1xuXHQgKlxuXHQgKiBAcGFyYW0ge3N0cmluZyB8IG51bGx9IG5hbWVzcGFjZVVSSVxuXHQgKiBAcmV0dXJucyB7c3RyaW5nIHwgbnVsbH1cblx0ICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvRE9NLUxldmVsLTMtQ29yZS9jb3JlLmh0bWwjTm9kZTMtbG9va3VwTmFtZXNwYWNlUHJlZml4XG5cdCAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSL0RPTS1MZXZlbC0zLUNvcmUvbmFtZXNwYWNlcy1hbGdvcml0aG1zLmh0bWwjbG9va3VwTmFtZXNwYWNlUHJlZml4QWxnb1xuXHQgKiBAc2VlIGh0dHBzOi8vZG9tLnNwZWMud2hhdHdnLm9yZy8jZG9tLW5vZGUtbG9va3VwcHJlZml4XG5cdCAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3htbGRvbS94bWxkb20vaXNzdWVzLzMyMlxuXHQgKi9cbiAgICBsb29rdXBQcmVmaXg6ZnVuY3Rpb24obmFtZXNwYWNlVVJJKXtcbiAgICBcdHZhciBlbCA9IHRoaXM7XG4gICAgXHR3aGlsZShlbCl7XG4gICAgXHRcdHZhciBtYXAgPSBlbC5fbnNNYXA7XG4gICAgXHRcdC8vY29uc29sZS5kaXIobWFwKVxuICAgIFx0XHRpZihtYXApe1xuICAgIFx0XHRcdGZvcih2YXIgbiBpbiBtYXApe1xuICAgIFx0XHRcdFx0aWYobWFwW25dID09IG5hbWVzcGFjZVVSSSl7XG4gICAgXHRcdFx0XHRcdHJldHVybiBuO1xuICAgIFx0XHRcdFx0fVxuICAgIFx0XHRcdH1cbiAgICBcdFx0fVxuICAgIFx0XHRlbCA9IGVsLm5vZGVUeXBlID09IEFUVFJJQlVURV9OT0RFP2VsLm93bmVyRG9jdW1lbnQgOiBlbC5wYXJlbnROb2RlO1xuICAgIFx0fVxuICAgIFx0cmV0dXJuIG51bGw7XG4gICAgfSxcbiAgICAvLyBJbnRyb2R1Y2VkIGluIERPTSBMZXZlbCAzOlxuICAgIGxvb2t1cE5hbWVzcGFjZVVSSTpmdW5jdGlvbihwcmVmaXgpe1xuICAgIFx0dmFyIGVsID0gdGhpcztcbiAgICBcdHdoaWxlKGVsKXtcbiAgICBcdFx0dmFyIG1hcCA9IGVsLl9uc01hcDtcbiAgICBcdFx0Ly9jb25zb2xlLmRpcihtYXApXG4gICAgXHRcdGlmKG1hcCl7XG4gICAgXHRcdFx0aWYocHJlZml4IGluIG1hcCl7XG4gICAgXHRcdFx0XHRyZXR1cm4gbWFwW3ByZWZpeF0gO1xuICAgIFx0XHRcdH1cbiAgICBcdFx0fVxuICAgIFx0XHRlbCA9IGVsLm5vZGVUeXBlID09IEFUVFJJQlVURV9OT0RFP2VsLm93bmVyRG9jdW1lbnQgOiBlbC5wYXJlbnROb2RlO1xuICAgIFx0fVxuICAgIFx0cmV0dXJuIG51bGw7XG4gICAgfSxcbiAgICAvLyBJbnRyb2R1Y2VkIGluIERPTSBMZXZlbCAzOlxuICAgIGlzRGVmYXVsdE5hbWVzcGFjZTpmdW5jdGlvbihuYW1lc3BhY2VVUkkpe1xuICAgIFx0dmFyIHByZWZpeCA9IHRoaXMubG9va3VwUHJlZml4KG5hbWVzcGFjZVVSSSk7XG4gICAgXHRyZXR1cm4gcHJlZml4ID09IG51bGw7XG4gICAgfVxufTtcblxuXG5mdW5jdGlvbiBfeG1sRW5jb2RlcihjKXtcblx0cmV0dXJuIGMgPT0gJzwnICYmICcmbHQ7JyB8fFxuICAgICAgICAgYyA9PSAnPicgJiYgJyZndDsnIHx8XG4gICAgICAgICBjID09ICcmJyAmJiAnJmFtcDsnIHx8XG4gICAgICAgICBjID09ICdcIicgJiYgJyZxdW90OycgfHxcbiAgICAgICAgICcmIycrYy5jaGFyQ29kZUF0KCkrJzsnXG59XG5cblxuY29weShOb2RlVHlwZSxOb2RlKTtcbmNvcHkoTm9kZVR5cGUsTm9kZS5wcm90b3R5cGUpO1xuXG4vKipcbiAqIEBwYXJhbSBjYWxsYmFjayByZXR1cm4gdHJ1ZSBmb3IgY29udGludWUsZmFsc2UgZm9yIGJyZWFrXG4gKiBAcmV0dXJuIGJvb2xlYW4gdHJ1ZTogYnJlYWsgdmlzaXQ7XG4gKi9cbmZ1bmN0aW9uIF92aXNpdE5vZGUobm9kZSxjYWxsYmFjayl7XG5cdGlmKGNhbGxiYWNrKG5vZGUpKXtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXHRpZihub2RlID0gbm9kZS5maXJzdENoaWxkKXtcblx0XHRkb3tcblx0XHRcdGlmKF92aXNpdE5vZGUobm9kZSxjYWxsYmFjaykpe3JldHVybiB0cnVlfVxuICAgICAgICB9d2hpbGUobm9kZT1ub2RlLm5leHRTaWJsaW5nKVxuICAgIH1cbn1cblxuXG5cbmZ1bmN0aW9uIERvY3VtZW50KCl7XG59XG5cbmZ1bmN0aW9uIF9vbkFkZEF0dHJpYnV0ZShkb2MsZWwsbmV3QXR0cil7XG5cdGRvYyAmJiBkb2MuX2luYysrO1xuXHR2YXIgbnMgPSBuZXdBdHRyLm5hbWVzcGFjZVVSSSA7XG5cdGlmKG5zID09PSBOQU1FU1BBQ0UuWE1MTlMpe1xuXHRcdC8vdXBkYXRlIG5hbWVzcGFjZVxuXHRcdGVsLl9uc01hcFtuZXdBdHRyLnByZWZpeD9uZXdBdHRyLmxvY2FsTmFtZTonJ10gPSBuZXdBdHRyLnZhbHVlXG5cdH1cbn1cblxuZnVuY3Rpb24gX29uUmVtb3ZlQXR0cmlidXRlKGRvYyxlbCxuZXdBdHRyLHJlbW92ZSl7XG5cdGRvYyAmJiBkb2MuX2luYysrO1xuXHR2YXIgbnMgPSBuZXdBdHRyLm5hbWVzcGFjZVVSSSA7XG5cdGlmKG5zID09PSBOQU1FU1BBQ0UuWE1MTlMpe1xuXHRcdC8vdXBkYXRlIG5hbWVzcGFjZVxuXHRcdGRlbGV0ZSBlbC5fbnNNYXBbbmV3QXR0ci5wcmVmaXg/bmV3QXR0ci5sb2NhbE5hbWU6JyddXG5cdH1cbn1cblxuLyoqXG4gKiBVcGRhdGVzIGBlbC5jaGlsZE5vZGVzYCwgdXBkYXRpbmcgdGhlIGluZGV4ZWQgaXRlbXMgYW5kIGl0J3MgYGxlbmd0aGAuXG4gKiBQYXNzaW5nIGBuZXdDaGlsZGAgbWVhbnMgaXQgd2lsbCBiZSBhcHBlbmRlZC5cbiAqIE90aGVyd2lzZSBpdCdzIGFzc3VtZWQgdGhhdCBhbiBpdGVtIGhhcyBiZWVuIHJlbW92ZWQsXG4gKiBhbmQgYGVsLmZpcnN0Tm9kZWAgYW5kIGl0J3MgYC5uZXh0U2libGluZ2AgYXJlIHVzZWRcbiAqIHRvIHdhbGsgdGhlIGN1cnJlbnQgbGlzdCBvZiBjaGlsZCBub2Rlcy5cbiAqXG4gKiBAcGFyYW0ge0RvY3VtZW50fSBkb2NcbiAqIEBwYXJhbSB7Tm9kZX0gZWxcbiAqIEBwYXJhbSB7Tm9kZX0gW25ld0NoaWxkXVxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gX29uVXBkYXRlQ2hpbGQgKGRvYywgZWwsIG5ld0NoaWxkKSB7XG5cdGlmKGRvYyAmJiBkb2MuX2luYyl7XG5cdFx0ZG9jLl9pbmMrKztcblx0XHQvL3VwZGF0ZSBjaGlsZE5vZGVzXG5cdFx0dmFyIGNzID0gZWwuY2hpbGROb2Rlcztcblx0XHRpZiAobmV3Q2hpbGQpIHtcblx0XHRcdGNzW2NzLmxlbmd0aCsrXSA9IG5ld0NoaWxkO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR2YXIgY2hpbGQgPSBlbC5maXJzdENoaWxkO1xuXHRcdFx0dmFyIGkgPSAwO1xuXHRcdFx0d2hpbGUgKGNoaWxkKSB7XG5cdFx0XHRcdGNzW2krK10gPSBjaGlsZDtcblx0XHRcdFx0Y2hpbGQgPSBjaGlsZC5uZXh0U2libGluZztcblx0XHRcdH1cblx0XHRcdGNzLmxlbmd0aCA9IGk7XG5cdFx0XHRkZWxldGUgY3NbY3MubGVuZ3RoXTtcblx0XHR9XG5cdH1cbn1cblxuLyoqXG4gKiBSZW1vdmVzIHRoZSBjb25uZWN0aW9ucyBiZXR3ZWVuIGBwYXJlbnROb2RlYCBhbmQgYGNoaWxkYFxuICogYW5kIGFueSBleGlzdGluZyBgY2hpbGQucHJldmlvdXNTaWJsaW5nYCBvciBgY2hpbGQubmV4dFNpYmxpbmdgLlxuICpcbiAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3htbGRvbS94bWxkb20vaXNzdWVzLzEzNVxuICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20veG1sZG9tL3htbGRvbS9pc3N1ZXMvMTQ1XG4gKlxuICogQHBhcmFtIHtOb2RlfSBwYXJlbnROb2RlXG4gKiBAcGFyYW0ge05vZGV9IGNoaWxkXG4gKiBAcmV0dXJucyB7Tm9kZX0gdGhlIGNoaWxkIHRoYXQgd2FzIHJlbW92ZWQuXG4gKiBAcHJpdmF0ZVxuICovXG5mdW5jdGlvbiBfcmVtb3ZlQ2hpbGQgKHBhcmVudE5vZGUsIGNoaWxkKSB7XG5cdHZhciBwcmV2aW91cyA9IGNoaWxkLnByZXZpb3VzU2libGluZztcblx0dmFyIG5leHQgPSBjaGlsZC5uZXh0U2libGluZztcblx0aWYgKHByZXZpb3VzKSB7XG5cdFx0cHJldmlvdXMubmV4dFNpYmxpbmcgPSBuZXh0O1xuXHR9IGVsc2Uge1xuXHRcdHBhcmVudE5vZGUuZmlyc3RDaGlsZCA9IG5leHQ7XG5cdH1cblx0aWYgKG5leHQpIHtcblx0XHRuZXh0LnByZXZpb3VzU2libGluZyA9IHByZXZpb3VzO1xuXHR9IGVsc2Uge1xuXHRcdHBhcmVudE5vZGUubGFzdENoaWxkID0gcHJldmlvdXM7XG5cdH1cblx0Y2hpbGQucGFyZW50Tm9kZSA9IG51bGw7XG5cdGNoaWxkLnByZXZpb3VzU2libGluZyA9IG51bGw7XG5cdGNoaWxkLm5leHRTaWJsaW5nID0gbnVsbDtcblx0X29uVXBkYXRlQ2hpbGQocGFyZW50Tm9kZS5vd25lckRvY3VtZW50LCBwYXJlbnROb2RlKTtcblx0cmV0dXJuIGNoaWxkO1xufVxuLyoqXG4gKiBwcmVmb3JtYW5jZSBrZXkocmVmQ2hpbGQgPT0gbnVsbClcbiAqL1xuZnVuY3Rpb24gX2luc2VydEJlZm9yZShwYXJlbnROb2RlLG5ld0NoaWxkLG5leHRDaGlsZCl7XG5cdHZhciBjcCA9IG5ld0NoaWxkLnBhcmVudE5vZGU7XG5cdGlmKGNwKXtcblx0XHRjcC5yZW1vdmVDaGlsZChuZXdDaGlsZCk7Ly9yZW1vdmUgYW5kIHVwZGF0ZVxuXHR9XG5cdGlmKG5ld0NoaWxkLm5vZGVUeXBlID09PSBET0NVTUVOVF9GUkFHTUVOVF9OT0RFKXtcblx0XHR2YXIgbmV3Rmlyc3QgPSBuZXdDaGlsZC5maXJzdENoaWxkO1xuXHRcdGlmIChuZXdGaXJzdCA9PSBudWxsKSB7XG5cdFx0XHRyZXR1cm4gbmV3Q2hpbGQ7XG5cdFx0fVxuXHRcdHZhciBuZXdMYXN0ID0gbmV3Q2hpbGQubGFzdENoaWxkO1xuXHR9ZWxzZXtcblx0XHRuZXdGaXJzdCA9IG5ld0xhc3QgPSBuZXdDaGlsZDtcblx0fVxuXHR2YXIgcHJlID0gbmV4dENoaWxkID8gbmV4dENoaWxkLnByZXZpb3VzU2libGluZyA6IHBhcmVudE5vZGUubGFzdENoaWxkO1xuXG5cdG5ld0ZpcnN0LnByZXZpb3VzU2libGluZyA9IHByZTtcblx0bmV3TGFzdC5uZXh0U2libGluZyA9IG5leHRDaGlsZDtcblx0XG5cdFxuXHRpZihwcmUpe1xuXHRcdHByZS5uZXh0U2libGluZyA9IG5ld0ZpcnN0O1xuXHR9ZWxzZXtcblx0XHRwYXJlbnROb2RlLmZpcnN0Q2hpbGQgPSBuZXdGaXJzdDtcblx0fVxuXHRpZihuZXh0Q2hpbGQgPT0gbnVsbCl7XG5cdFx0cGFyZW50Tm9kZS5sYXN0Q2hpbGQgPSBuZXdMYXN0O1xuXHR9ZWxzZXtcblx0XHRuZXh0Q2hpbGQucHJldmlvdXNTaWJsaW5nID0gbmV3TGFzdDtcblx0fVxuXHRkb3tcblx0XHRuZXdGaXJzdC5wYXJlbnROb2RlID0gcGFyZW50Tm9kZTtcblx0fXdoaWxlKG5ld0ZpcnN0ICE9PSBuZXdMYXN0ICYmIChuZXdGaXJzdD0gbmV3Rmlyc3QubmV4dFNpYmxpbmcpKVxuXHRfb25VcGRhdGVDaGlsZChwYXJlbnROb2RlLm93bmVyRG9jdW1lbnR8fHBhcmVudE5vZGUscGFyZW50Tm9kZSk7XG5cdC8vY29uc29sZS5sb2cocGFyZW50Tm9kZS5sYXN0Q2hpbGQubmV4dFNpYmxpbmcgPT0gbnVsbClcblx0aWYgKG5ld0NoaWxkLm5vZGVUeXBlID09IERPQ1VNRU5UX0ZSQUdNRU5UX05PREUpIHtcblx0XHRuZXdDaGlsZC5maXJzdENoaWxkID0gbmV3Q2hpbGQubGFzdENoaWxkID0gbnVsbDtcblx0fVxuXHRyZXR1cm4gbmV3Q2hpbGQ7XG59XG5cbi8qKlxuICogQXBwZW5kcyBgbmV3Q2hpbGRgIHRvIGBwYXJlbnROb2RlYC5cbiAqIElmIGBuZXdDaGlsZGAgaXMgYWxyZWFkeSBjb25uZWN0ZWQgdG8gYSBgcGFyZW50Tm9kZWAgaXQgaXMgZmlyc3QgcmVtb3ZlZCBmcm9tIGl0LlxuICpcbiAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3htbGRvbS94bWxkb20vaXNzdWVzLzEzNVxuICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20veG1sZG9tL3htbGRvbS9pc3N1ZXMvMTQ1XG4gKiBAcGFyYW0ge05vZGV9IHBhcmVudE5vZGVcbiAqIEBwYXJhbSB7Tm9kZX0gbmV3Q2hpbGRcbiAqIEByZXR1cm5zIHtOb2RlfVxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gX2FwcGVuZFNpbmdsZUNoaWxkIChwYXJlbnROb2RlLCBuZXdDaGlsZCkge1xuXHRpZiAobmV3Q2hpbGQucGFyZW50Tm9kZSkge1xuXHRcdG5ld0NoaWxkLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobmV3Q2hpbGQpO1xuXHR9XG5cdG5ld0NoaWxkLnBhcmVudE5vZGUgPSBwYXJlbnROb2RlO1xuXHRuZXdDaGlsZC5wcmV2aW91c1NpYmxpbmcgPSBwYXJlbnROb2RlLmxhc3RDaGlsZDtcblx0bmV3Q2hpbGQubmV4dFNpYmxpbmcgPSBudWxsO1xuXHRpZiAobmV3Q2hpbGQucHJldmlvdXNTaWJsaW5nKSB7XG5cdFx0bmV3Q2hpbGQucHJldmlvdXNTaWJsaW5nLm5leHRTaWJsaW5nID0gbmV3Q2hpbGQ7XG5cdH0gZWxzZSB7XG5cdFx0cGFyZW50Tm9kZS5maXJzdENoaWxkID0gbmV3Q2hpbGQ7XG5cdH1cblx0cGFyZW50Tm9kZS5sYXN0Q2hpbGQgPSBuZXdDaGlsZDtcblx0X29uVXBkYXRlQ2hpbGQocGFyZW50Tm9kZS5vd25lckRvY3VtZW50LCBwYXJlbnROb2RlLCBuZXdDaGlsZCk7XG5cdHJldHVybiBuZXdDaGlsZDtcbn1cblxuRG9jdW1lbnQucHJvdG90eXBlID0ge1xuXHQvL2ltcGxlbWVudGF0aW9uIDogbnVsbCxcblx0bm9kZU5hbWUgOiAgJyNkb2N1bWVudCcsXG5cdG5vZGVUeXBlIDogIERPQ1VNRU5UX05PREUsXG5cdC8qKlxuXHQgKiBUaGUgRG9jdW1lbnRUeXBlIG5vZGUgb2YgdGhlIGRvY3VtZW50LlxuXHQgKlxuXHQgKiBAcmVhZG9ubHlcblx0ICogQHR5cGUgRG9jdW1lbnRUeXBlXG5cdCAqL1xuXHRkb2N0eXBlIDogIG51bGwsXG5cdGRvY3VtZW50RWxlbWVudCA6ICBudWxsLFxuXHRfaW5jIDogMSxcblxuXHRpbnNlcnRCZWZvcmUgOiAgZnVuY3Rpb24obmV3Q2hpbGQsIHJlZkNoaWxkKXsvL3JhaXNlc1xuXHRcdGlmKG5ld0NoaWxkLm5vZGVUeXBlID09IERPQ1VNRU5UX0ZSQUdNRU5UX05PREUpe1xuXHRcdFx0dmFyIGNoaWxkID0gbmV3Q2hpbGQuZmlyc3RDaGlsZDtcblx0XHRcdHdoaWxlKGNoaWxkKXtcblx0XHRcdFx0dmFyIG5leHQgPSBjaGlsZC5uZXh0U2libGluZztcblx0XHRcdFx0dGhpcy5pbnNlcnRCZWZvcmUoY2hpbGQscmVmQ2hpbGQpO1xuXHRcdFx0XHRjaGlsZCA9IG5leHQ7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gbmV3Q2hpbGQ7XG5cdFx0fVxuXHRcdGlmKHRoaXMuZG9jdW1lbnRFbGVtZW50ID09IG51bGwgJiYgbmV3Q2hpbGQubm9kZVR5cGUgPT0gRUxFTUVOVF9OT0RFKXtcblx0XHRcdHRoaXMuZG9jdW1lbnRFbGVtZW50ID0gbmV3Q2hpbGQ7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIF9pbnNlcnRCZWZvcmUodGhpcyxuZXdDaGlsZCxyZWZDaGlsZCksKG5ld0NoaWxkLm93bmVyRG9jdW1lbnQgPSB0aGlzKSxuZXdDaGlsZDtcblx0fSxcblx0cmVtb3ZlQ2hpbGQgOiAgZnVuY3Rpb24ob2xkQ2hpbGQpe1xuXHRcdGlmKHRoaXMuZG9jdW1lbnRFbGVtZW50ID09IG9sZENoaWxkKXtcblx0XHRcdHRoaXMuZG9jdW1lbnRFbGVtZW50ID0gbnVsbDtcblx0XHR9XG5cdFx0cmV0dXJuIF9yZW1vdmVDaGlsZCh0aGlzLG9sZENoaWxkKTtcblx0fSxcblx0Ly8gSW50cm9kdWNlZCBpbiBET00gTGV2ZWwgMjpcblx0aW1wb3J0Tm9kZSA6IGZ1bmN0aW9uKGltcG9ydGVkTm9kZSxkZWVwKXtcblx0XHRyZXR1cm4gaW1wb3J0Tm9kZSh0aGlzLGltcG9ydGVkTm9kZSxkZWVwKTtcblx0fSxcblx0Ly8gSW50cm9kdWNlZCBpbiBET00gTGV2ZWwgMjpcblx0Z2V0RWxlbWVudEJ5SWQgOlx0ZnVuY3Rpb24oaWQpe1xuXHRcdHZhciBydHYgPSBudWxsO1xuXHRcdF92aXNpdE5vZGUodGhpcy5kb2N1bWVudEVsZW1lbnQsZnVuY3Rpb24obm9kZSl7XG5cdFx0XHRpZihub2RlLm5vZGVUeXBlID09IEVMRU1FTlRfTk9ERSl7XG5cdFx0XHRcdGlmKG5vZGUuZ2V0QXR0cmlidXRlKCdpZCcpID09IGlkKXtcblx0XHRcdFx0XHRydHYgPSBub2RlO1xuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSlcblx0XHRyZXR1cm4gcnR2O1xuXHR9LFxuXG5cdC8qKlxuXHQgKiBUaGUgYGdldEVsZW1lbnRzQnlDbGFzc05hbWVgIG1ldGhvZCBvZiBgRG9jdW1lbnRgIGludGVyZmFjZSByZXR1cm5zIGFuIGFycmF5LWxpa2Ugb2JqZWN0XG5cdCAqIG9mIGFsbCBjaGlsZCBlbGVtZW50cyB3aGljaCBoYXZlICoqYWxsKiogb2YgdGhlIGdpdmVuIGNsYXNzIG5hbWUocykuXG5cdCAqXG5cdCAqIFJldHVybnMgYW4gZW1wdHkgbGlzdCBpZiBgY2xhc3NlTmFtZXNgIGlzIGFuIGVtcHR5IHN0cmluZyBvciBvbmx5IGNvbnRhaW5zIEhUTUwgd2hpdGUgc3BhY2UgY2hhcmFjdGVycy5cblx0ICpcblx0ICpcblx0ICogV2FybmluZzogVGhpcyBpcyBhIGxpdmUgTGl2ZU5vZGVMaXN0LlxuXHQgKiBDaGFuZ2VzIGluIHRoZSBET00gd2lsbCByZWZsZWN0IGluIHRoZSBhcnJheSBhcyB0aGUgY2hhbmdlcyBvY2N1ci5cblx0ICogSWYgYW4gZWxlbWVudCBzZWxlY3RlZCBieSB0aGlzIGFycmF5IG5vIGxvbmdlciBxdWFsaWZpZXMgZm9yIHRoZSBzZWxlY3Rvcixcblx0ICogaXQgd2lsbCBhdXRvbWF0aWNhbGx5IGJlIHJlbW92ZWQuIEJlIGF3YXJlIG9mIHRoaXMgZm9yIGl0ZXJhdGlvbiBwdXJwb3Nlcy5cblx0ICpcblx0ICogQHBhcmFtIHtzdHJpbmd9IGNsYXNzTmFtZXMgaXMgYSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBjbGFzcyBuYW1lKHMpIHRvIG1hdGNoOyBtdWx0aXBsZSBjbGFzcyBuYW1lcyBhcmUgc2VwYXJhdGVkIGJ5IChBU0NJSS0pd2hpdGVzcGFjZVxuXHQgKlxuXHQgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9Eb2N1bWVudC9nZXRFbGVtZW50c0J5Q2xhc3NOYW1lXG5cdCAqIEBzZWUgaHR0cHM6Ly9kb20uc3BlYy53aGF0d2cub3JnLyNjb25jZXB0LWdldGVsZW1lbnRzYnljbGFzc25hbWVcblx0ICovXG5cdGdldEVsZW1lbnRzQnlDbGFzc05hbWU6IGZ1bmN0aW9uKGNsYXNzTmFtZXMpIHtcblx0XHR2YXIgY2xhc3NOYW1lc1NldCA9IHRvT3JkZXJlZFNldChjbGFzc05hbWVzKVxuXHRcdHJldHVybiBuZXcgTGl2ZU5vZGVMaXN0KHRoaXMsIGZ1bmN0aW9uKGJhc2UpIHtcblx0XHRcdHZhciBscyA9IFtdO1xuXHRcdFx0aWYgKGNsYXNzTmFtZXNTZXQubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRfdmlzaXROb2RlKGJhc2UuZG9jdW1lbnRFbGVtZW50LCBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRcdFx0aWYobm9kZSAhPT0gYmFzZSAmJiBub2RlLm5vZGVUeXBlID09PSBFTEVNRU5UX05PREUpIHtcblx0XHRcdFx0XHRcdHZhciBub2RlQ2xhc3NOYW1lcyA9IG5vZGUuZ2V0QXR0cmlidXRlKCdjbGFzcycpXG5cdFx0XHRcdFx0XHQvLyBjYW4gYmUgbnVsbCBpZiB0aGUgYXR0cmlidXRlIGRvZXMgbm90IGV4aXN0XG5cdFx0XHRcdFx0XHRpZiAobm9kZUNsYXNzTmFtZXMpIHtcblx0XHRcdFx0XHRcdFx0Ly8gYmVmb3JlIHNwbGl0dGluZyBhbmQgaXRlcmF0aW5nIGp1c3QgY29tcGFyZSB0aGVtIGZvciB0aGUgbW9zdCBjb21tb24gY2FzZVxuXHRcdFx0XHRcdFx0XHR2YXIgbWF0Y2hlcyA9IGNsYXNzTmFtZXMgPT09IG5vZGVDbGFzc05hbWVzO1xuXHRcdFx0XHRcdFx0XHRpZiAoIW1hdGNoZXMpIHtcblx0XHRcdFx0XHRcdFx0XHR2YXIgbm9kZUNsYXNzTmFtZXNTZXQgPSB0b09yZGVyZWRTZXQobm9kZUNsYXNzTmFtZXMpXG5cdFx0XHRcdFx0XHRcdFx0bWF0Y2hlcyA9IGNsYXNzTmFtZXNTZXQuZXZlcnkoYXJyYXlJbmNsdWRlcyhub2RlQ2xhc3NOYW1lc1NldCkpXG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0aWYobWF0Y2hlcykge1xuXHRcdFx0XHRcdFx0XHRcdGxzLnB1c2gobm9kZSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIGxzO1xuXHRcdH0pO1xuXHR9LFxuXG5cdC8vZG9jdW1lbnQgZmFjdG9yeSBtZXRob2Q6XG5cdGNyZWF0ZUVsZW1lbnQgOlx0ZnVuY3Rpb24odGFnTmFtZSl7XG5cdFx0dmFyIG5vZGUgPSBuZXcgRWxlbWVudCgpO1xuXHRcdG5vZGUub3duZXJEb2N1bWVudCA9IHRoaXM7XG5cdFx0bm9kZS5ub2RlTmFtZSA9IHRhZ05hbWU7XG5cdFx0bm9kZS50YWdOYW1lID0gdGFnTmFtZTtcblx0XHRub2RlLmxvY2FsTmFtZSA9IHRhZ05hbWU7XG5cdFx0bm9kZS5jaGlsZE5vZGVzID0gbmV3IE5vZGVMaXN0KCk7XG5cdFx0dmFyIGF0dHJzXHQ9IG5vZGUuYXR0cmlidXRlcyA9IG5ldyBOYW1lZE5vZGVNYXAoKTtcblx0XHRhdHRycy5fb3duZXJFbGVtZW50ID0gbm9kZTtcblx0XHRyZXR1cm4gbm9kZTtcblx0fSxcblx0Y3JlYXRlRG9jdW1lbnRGcmFnbWVudCA6XHRmdW5jdGlvbigpe1xuXHRcdHZhciBub2RlID0gbmV3IERvY3VtZW50RnJhZ21lbnQoKTtcblx0XHRub2RlLm93bmVyRG9jdW1lbnQgPSB0aGlzO1xuXHRcdG5vZGUuY2hpbGROb2RlcyA9IG5ldyBOb2RlTGlzdCgpO1xuXHRcdHJldHVybiBub2RlO1xuXHR9LFxuXHRjcmVhdGVUZXh0Tm9kZSA6XHRmdW5jdGlvbihkYXRhKXtcblx0XHR2YXIgbm9kZSA9IG5ldyBUZXh0KCk7XG5cdFx0bm9kZS5vd25lckRvY3VtZW50ID0gdGhpcztcblx0XHRub2RlLmFwcGVuZERhdGEoZGF0YSlcblx0XHRyZXR1cm4gbm9kZTtcblx0fSxcblx0Y3JlYXRlQ29tbWVudCA6XHRmdW5jdGlvbihkYXRhKXtcblx0XHR2YXIgbm9kZSA9IG5ldyBDb21tZW50KCk7XG5cdFx0bm9kZS5vd25lckRvY3VtZW50ID0gdGhpcztcblx0XHRub2RlLmFwcGVuZERhdGEoZGF0YSlcblx0XHRyZXR1cm4gbm9kZTtcblx0fSxcblx0Y3JlYXRlQ0RBVEFTZWN0aW9uIDpcdGZ1bmN0aW9uKGRhdGEpe1xuXHRcdHZhciBub2RlID0gbmV3IENEQVRBU2VjdGlvbigpO1xuXHRcdG5vZGUub3duZXJEb2N1bWVudCA9IHRoaXM7XG5cdFx0bm9kZS5hcHBlbmREYXRhKGRhdGEpXG5cdFx0cmV0dXJuIG5vZGU7XG5cdH0sXG5cdGNyZWF0ZVByb2Nlc3NpbmdJbnN0cnVjdGlvbiA6XHRmdW5jdGlvbih0YXJnZXQsZGF0YSl7XG5cdFx0dmFyIG5vZGUgPSBuZXcgUHJvY2Vzc2luZ0luc3RydWN0aW9uKCk7XG5cdFx0bm9kZS5vd25lckRvY3VtZW50ID0gdGhpcztcblx0XHRub2RlLnRhZ05hbWUgPSBub2RlLnRhcmdldCA9IHRhcmdldDtcblx0XHRub2RlLm5vZGVWYWx1ZT0gbm9kZS5kYXRhID0gZGF0YTtcblx0XHRyZXR1cm4gbm9kZTtcblx0fSxcblx0Y3JlYXRlQXR0cmlidXRlIDpcdGZ1bmN0aW9uKG5hbWUpe1xuXHRcdHZhciBub2RlID0gbmV3IEF0dHIoKTtcblx0XHRub2RlLm93bmVyRG9jdW1lbnRcdD0gdGhpcztcblx0XHRub2RlLm5hbWUgPSBuYW1lO1xuXHRcdG5vZGUubm9kZU5hbWVcdD0gbmFtZTtcblx0XHRub2RlLmxvY2FsTmFtZSA9IG5hbWU7XG5cdFx0bm9kZS5zcGVjaWZpZWQgPSB0cnVlO1xuXHRcdHJldHVybiBub2RlO1xuXHR9LFxuXHRjcmVhdGVFbnRpdHlSZWZlcmVuY2UgOlx0ZnVuY3Rpb24obmFtZSl7XG5cdFx0dmFyIG5vZGUgPSBuZXcgRW50aXR5UmVmZXJlbmNlKCk7XG5cdFx0bm9kZS5vd25lckRvY3VtZW50XHQ9IHRoaXM7XG5cdFx0bm9kZS5ub2RlTmFtZVx0PSBuYW1lO1xuXHRcdHJldHVybiBub2RlO1xuXHR9LFxuXHQvLyBJbnRyb2R1Y2VkIGluIERPTSBMZXZlbCAyOlxuXHRjcmVhdGVFbGVtZW50TlMgOlx0ZnVuY3Rpb24obmFtZXNwYWNlVVJJLHF1YWxpZmllZE5hbWUpe1xuXHRcdHZhciBub2RlID0gbmV3IEVsZW1lbnQoKTtcblx0XHR2YXIgcGwgPSBxdWFsaWZpZWROYW1lLnNwbGl0KCc6Jyk7XG5cdFx0dmFyIGF0dHJzXHQ9IG5vZGUuYXR0cmlidXRlcyA9IG5ldyBOYW1lZE5vZGVNYXAoKTtcblx0XHRub2RlLmNoaWxkTm9kZXMgPSBuZXcgTm9kZUxpc3QoKTtcblx0XHRub2RlLm93bmVyRG9jdW1lbnQgPSB0aGlzO1xuXHRcdG5vZGUubm9kZU5hbWUgPSBxdWFsaWZpZWROYW1lO1xuXHRcdG5vZGUudGFnTmFtZSA9IHF1YWxpZmllZE5hbWU7XG5cdFx0bm9kZS5uYW1lc3BhY2VVUkkgPSBuYW1lc3BhY2VVUkk7XG5cdFx0aWYocGwubGVuZ3RoID09IDIpe1xuXHRcdFx0bm9kZS5wcmVmaXggPSBwbFswXTtcblx0XHRcdG5vZGUubG9jYWxOYW1lID0gcGxbMV07XG5cdFx0fWVsc2V7XG5cdFx0XHQvL2VsLnByZWZpeCA9IG51bGw7XG5cdFx0XHRub2RlLmxvY2FsTmFtZSA9IHF1YWxpZmllZE5hbWU7XG5cdFx0fVxuXHRcdGF0dHJzLl9vd25lckVsZW1lbnQgPSBub2RlO1xuXHRcdHJldHVybiBub2RlO1xuXHR9LFxuXHQvLyBJbnRyb2R1Y2VkIGluIERPTSBMZXZlbCAyOlxuXHRjcmVhdGVBdHRyaWJ1dGVOUyA6XHRmdW5jdGlvbihuYW1lc3BhY2VVUkkscXVhbGlmaWVkTmFtZSl7XG5cdFx0dmFyIG5vZGUgPSBuZXcgQXR0cigpO1xuXHRcdHZhciBwbCA9IHF1YWxpZmllZE5hbWUuc3BsaXQoJzonKTtcblx0XHRub2RlLm93bmVyRG9jdW1lbnQgPSB0aGlzO1xuXHRcdG5vZGUubm9kZU5hbWUgPSBxdWFsaWZpZWROYW1lO1xuXHRcdG5vZGUubmFtZSA9IHF1YWxpZmllZE5hbWU7XG5cdFx0bm9kZS5uYW1lc3BhY2VVUkkgPSBuYW1lc3BhY2VVUkk7XG5cdFx0bm9kZS5zcGVjaWZpZWQgPSB0cnVlO1xuXHRcdGlmKHBsLmxlbmd0aCA9PSAyKXtcblx0XHRcdG5vZGUucHJlZml4ID0gcGxbMF07XG5cdFx0XHRub2RlLmxvY2FsTmFtZSA9IHBsWzFdO1xuXHRcdH1lbHNle1xuXHRcdFx0Ly9lbC5wcmVmaXggPSBudWxsO1xuXHRcdFx0bm9kZS5sb2NhbE5hbWUgPSBxdWFsaWZpZWROYW1lO1xuXHRcdH1cblx0XHRyZXR1cm4gbm9kZTtcblx0fVxufTtcbl9leHRlbmRzKERvY3VtZW50LE5vZGUpO1xuXG5cbmZ1bmN0aW9uIEVsZW1lbnQoKSB7XG5cdHRoaXMuX25zTWFwID0ge307XG59O1xuRWxlbWVudC5wcm90b3R5cGUgPSB7XG5cdG5vZGVUeXBlIDogRUxFTUVOVF9OT0RFLFxuXHRoYXNBdHRyaWJ1dGUgOiBmdW5jdGlvbihuYW1lKXtcblx0XHRyZXR1cm4gdGhpcy5nZXRBdHRyaWJ1dGVOb2RlKG5hbWUpIT1udWxsO1xuXHR9LFxuXHRnZXRBdHRyaWJ1dGUgOiBmdW5jdGlvbihuYW1lKXtcblx0XHR2YXIgYXR0ciA9IHRoaXMuZ2V0QXR0cmlidXRlTm9kZShuYW1lKTtcblx0XHRyZXR1cm4gYXR0ciAmJiBhdHRyLnZhbHVlIHx8ICcnO1xuXHR9LFxuXHRnZXRBdHRyaWJ1dGVOb2RlIDogZnVuY3Rpb24obmFtZSl7XG5cdFx0cmV0dXJuIHRoaXMuYXR0cmlidXRlcy5nZXROYW1lZEl0ZW0obmFtZSk7XG5cdH0sXG5cdHNldEF0dHJpYnV0ZSA6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKXtcblx0XHR2YXIgYXR0ciA9IHRoaXMub3duZXJEb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUobmFtZSk7XG5cdFx0YXR0ci52YWx1ZSA9IGF0dHIubm9kZVZhbHVlID0gXCJcIiArIHZhbHVlO1xuXHRcdHRoaXMuc2V0QXR0cmlidXRlTm9kZShhdHRyKVxuXHR9LFxuXHRyZW1vdmVBdHRyaWJ1dGUgOiBmdW5jdGlvbihuYW1lKXtcblx0XHR2YXIgYXR0ciA9IHRoaXMuZ2V0QXR0cmlidXRlTm9kZShuYW1lKVxuXHRcdGF0dHIgJiYgdGhpcy5yZW1vdmVBdHRyaWJ1dGVOb2RlKGF0dHIpO1xuXHR9LFxuXHRcblx0Ly9mb3VyIHJlYWwgb3BlYXJ0aW9uIG1ldGhvZFxuXHRhcHBlbmRDaGlsZDpmdW5jdGlvbihuZXdDaGlsZCl7XG5cdFx0aWYobmV3Q2hpbGQubm9kZVR5cGUgPT09IERPQ1VNRU5UX0ZSQUdNRU5UX05PREUpe1xuXHRcdFx0cmV0dXJuIHRoaXMuaW5zZXJ0QmVmb3JlKG5ld0NoaWxkLG51bGwpO1xuXHRcdH1lbHNle1xuXHRcdFx0cmV0dXJuIF9hcHBlbmRTaW5nbGVDaGlsZCh0aGlzLG5ld0NoaWxkKTtcblx0XHR9XG5cdH0sXG5cdHNldEF0dHJpYnV0ZU5vZGUgOiBmdW5jdGlvbihuZXdBdHRyKXtcblx0XHRyZXR1cm4gdGhpcy5hdHRyaWJ1dGVzLnNldE5hbWVkSXRlbShuZXdBdHRyKTtcblx0fSxcblx0c2V0QXR0cmlidXRlTm9kZU5TIDogZnVuY3Rpb24obmV3QXR0cil7XG5cdFx0cmV0dXJuIHRoaXMuYXR0cmlidXRlcy5zZXROYW1lZEl0ZW1OUyhuZXdBdHRyKTtcblx0fSxcblx0cmVtb3ZlQXR0cmlidXRlTm9kZSA6IGZ1bmN0aW9uKG9sZEF0dHIpe1xuXHRcdC8vY29uc29sZS5sb2codGhpcyA9PSBvbGRBdHRyLm93bmVyRWxlbWVudClcblx0XHRyZXR1cm4gdGhpcy5hdHRyaWJ1dGVzLnJlbW92ZU5hbWVkSXRlbShvbGRBdHRyLm5vZGVOYW1lKTtcblx0fSxcblx0Ly9nZXQgcmVhbCBhdHRyaWJ1dGUgbmFtZSxhbmQgcmVtb3ZlIGl0IGJ5IHJlbW92ZUF0dHJpYnV0ZU5vZGVcblx0cmVtb3ZlQXR0cmlidXRlTlMgOiBmdW5jdGlvbihuYW1lc3BhY2VVUkksIGxvY2FsTmFtZSl7XG5cdFx0dmFyIG9sZCA9IHRoaXMuZ2V0QXR0cmlidXRlTm9kZU5TKG5hbWVzcGFjZVVSSSwgbG9jYWxOYW1lKTtcblx0XHRvbGQgJiYgdGhpcy5yZW1vdmVBdHRyaWJ1dGVOb2RlKG9sZCk7XG5cdH0sXG5cdFxuXHRoYXNBdHRyaWJ1dGVOUyA6IGZ1bmN0aW9uKG5hbWVzcGFjZVVSSSwgbG9jYWxOYW1lKXtcblx0XHRyZXR1cm4gdGhpcy5nZXRBdHRyaWJ1dGVOb2RlTlMobmFtZXNwYWNlVVJJLCBsb2NhbE5hbWUpIT1udWxsO1xuXHR9LFxuXHRnZXRBdHRyaWJ1dGVOUyA6IGZ1bmN0aW9uKG5hbWVzcGFjZVVSSSwgbG9jYWxOYW1lKXtcblx0XHR2YXIgYXR0ciA9IHRoaXMuZ2V0QXR0cmlidXRlTm9kZU5TKG5hbWVzcGFjZVVSSSwgbG9jYWxOYW1lKTtcblx0XHRyZXR1cm4gYXR0ciAmJiBhdHRyLnZhbHVlIHx8ICcnO1xuXHR9LFxuXHRzZXRBdHRyaWJ1dGVOUyA6IGZ1bmN0aW9uKG5hbWVzcGFjZVVSSSwgcXVhbGlmaWVkTmFtZSwgdmFsdWUpe1xuXHRcdHZhciBhdHRyID0gdGhpcy5vd25lckRvY3VtZW50LmNyZWF0ZUF0dHJpYnV0ZU5TKG5hbWVzcGFjZVVSSSwgcXVhbGlmaWVkTmFtZSk7XG5cdFx0YXR0ci52YWx1ZSA9IGF0dHIubm9kZVZhbHVlID0gXCJcIiArIHZhbHVlO1xuXHRcdHRoaXMuc2V0QXR0cmlidXRlTm9kZShhdHRyKVxuXHR9LFxuXHRnZXRBdHRyaWJ1dGVOb2RlTlMgOiBmdW5jdGlvbihuYW1lc3BhY2VVUkksIGxvY2FsTmFtZSl7XG5cdFx0cmV0dXJuIHRoaXMuYXR0cmlidXRlcy5nZXROYW1lZEl0ZW1OUyhuYW1lc3BhY2VVUkksIGxvY2FsTmFtZSk7XG5cdH0sXG5cdFxuXHRnZXRFbGVtZW50c0J5VGFnTmFtZSA6IGZ1bmN0aW9uKHRhZ05hbWUpe1xuXHRcdHJldHVybiBuZXcgTGl2ZU5vZGVMaXN0KHRoaXMsZnVuY3Rpb24oYmFzZSl7XG5cdFx0XHR2YXIgbHMgPSBbXTtcblx0XHRcdF92aXNpdE5vZGUoYmFzZSxmdW5jdGlvbihub2RlKXtcblx0XHRcdFx0aWYobm9kZSAhPT0gYmFzZSAmJiBub2RlLm5vZGVUeXBlID09IEVMRU1FTlRfTk9ERSAmJiAodGFnTmFtZSA9PT0gJyonIHx8IG5vZGUudGFnTmFtZSA9PSB0YWdOYW1lKSl7XG5cdFx0XHRcdFx0bHMucHVzaChub2RlKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gbHM7XG5cdFx0fSk7XG5cdH0sXG5cdGdldEVsZW1lbnRzQnlUYWdOYW1lTlMgOiBmdW5jdGlvbihuYW1lc3BhY2VVUkksIGxvY2FsTmFtZSl7XG5cdFx0cmV0dXJuIG5ldyBMaXZlTm9kZUxpc3QodGhpcyxmdW5jdGlvbihiYXNlKXtcblx0XHRcdHZhciBscyA9IFtdO1xuXHRcdFx0X3Zpc2l0Tm9kZShiYXNlLGZ1bmN0aW9uKG5vZGUpe1xuXHRcdFx0XHRpZihub2RlICE9PSBiYXNlICYmIG5vZGUubm9kZVR5cGUgPT09IEVMRU1FTlRfTk9ERSAmJiAobmFtZXNwYWNlVVJJID09PSAnKicgfHwgbm9kZS5uYW1lc3BhY2VVUkkgPT09IG5hbWVzcGFjZVVSSSkgJiYgKGxvY2FsTmFtZSA9PT0gJyonIHx8IG5vZGUubG9jYWxOYW1lID09IGxvY2FsTmFtZSkpe1xuXHRcdFx0XHRcdGxzLnB1c2gobm9kZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIGxzO1xuXHRcdFx0XG5cdFx0fSk7XG5cdH1cbn07XG5Eb2N1bWVudC5wcm90b3R5cGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUgPSBFbGVtZW50LnByb3RvdHlwZS5nZXRFbGVtZW50c0J5VGFnTmFtZTtcbkRvY3VtZW50LnByb3RvdHlwZS5nZXRFbGVtZW50c0J5VGFnTmFtZU5TID0gRWxlbWVudC5wcm90b3R5cGUuZ2V0RWxlbWVudHNCeVRhZ05hbWVOUztcblxuXG5fZXh0ZW5kcyhFbGVtZW50LE5vZGUpO1xuZnVuY3Rpb24gQXR0cigpIHtcbn07XG5BdHRyLnByb3RvdHlwZS5ub2RlVHlwZSA9IEFUVFJJQlVURV9OT0RFO1xuX2V4dGVuZHMoQXR0cixOb2RlKTtcblxuXG5mdW5jdGlvbiBDaGFyYWN0ZXJEYXRhKCkge1xufTtcbkNoYXJhY3RlckRhdGEucHJvdG90eXBlID0ge1xuXHRkYXRhIDogJycsXG5cdHN1YnN0cmluZ0RhdGEgOiBmdW5jdGlvbihvZmZzZXQsIGNvdW50KSB7XG5cdFx0cmV0dXJuIHRoaXMuZGF0YS5zdWJzdHJpbmcob2Zmc2V0LCBvZmZzZXQrY291bnQpO1xuXHR9LFxuXHRhcHBlbmREYXRhOiBmdW5jdGlvbih0ZXh0KSB7XG5cdFx0dGV4dCA9IHRoaXMuZGF0YSt0ZXh0O1xuXHRcdHRoaXMubm9kZVZhbHVlID0gdGhpcy5kYXRhID0gdGV4dDtcblx0XHR0aGlzLmxlbmd0aCA9IHRleHQubGVuZ3RoO1xuXHR9LFxuXHRpbnNlcnREYXRhOiBmdW5jdGlvbihvZmZzZXQsdGV4dCkge1xuXHRcdHRoaXMucmVwbGFjZURhdGEob2Zmc2V0LDAsdGV4dCk7XG5cdFxuXHR9LFxuXHRhcHBlbmRDaGlsZDpmdW5jdGlvbihuZXdDaGlsZCl7XG5cdFx0dGhyb3cgbmV3IEVycm9yKEV4Y2VwdGlvbk1lc3NhZ2VbSElFUkFSQ0hZX1JFUVVFU1RfRVJSXSlcblx0fSxcblx0ZGVsZXRlRGF0YTogZnVuY3Rpb24ob2Zmc2V0LCBjb3VudCkge1xuXHRcdHRoaXMucmVwbGFjZURhdGEob2Zmc2V0LGNvdW50LFwiXCIpO1xuXHR9LFxuXHRyZXBsYWNlRGF0YTogZnVuY3Rpb24ob2Zmc2V0LCBjb3VudCwgdGV4dCkge1xuXHRcdHZhciBzdGFydCA9IHRoaXMuZGF0YS5zdWJzdHJpbmcoMCxvZmZzZXQpO1xuXHRcdHZhciBlbmQgPSB0aGlzLmRhdGEuc3Vic3RyaW5nKG9mZnNldCtjb3VudCk7XG5cdFx0dGV4dCA9IHN0YXJ0ICsgdGV4dCArIGVuZDtcblx0XHR0aGlzLm5vZGVWYWx1ZSA9IHRoaXMuZGF0YSA9IHRleHQ7XG5cdFx0dGhpcy5sZW5ndGggPSB0ZXh0Lmxlbmd0aDtcblx0fVxufVxuX2V4dGVuZHMoQ2hhcmFjdGVyRGF0YSxOb2RlKTtcbmZ1bmN0aW9uIFRleHQoKSB7XG59O1xuVGV4dC5wcm90b3R5cGUgPSB7XG5cdG5vZGVOYW1lIDogXCIjdGV4dFwiLFxuXHRub2RlVHlwZSA6IFRFWFRfTk9ERSxcblx0c3BsaXRUZXh0IDogZnVuY3Rpb24ob2Zmc2V0KSB7XG5cdFx0dmFyIHRleHQgPSB0aGlzLmRhdGE7XG5cdFx0dmFyIG5ld1RleHQgPSB0ZXh0LnN1YnN0cmluZyhvZmZzZXQpO1xuXHRcdHRleHQgPSB0ZXh0LnN1YnN0cmluZygwLCBvZmZzZXQpO1xuXHRcdHRoaXMuZGF0YSA9IHRoaXMubm9kZVZhbHVlID0gdGV4dDtcblx0XHR0aGlzLmxlbmd0aCA9IHRleHQubGVuZ3RoO1xuXHRcdHZhciBuZXdOb2RlID0gdGhpcy5vd25lckRvY3VtZW50LmNyZWF0ZVRleHROb2RlKG5ld1RleHQpO1xuXHRcdGlmKHRoaXMucGFyZW50Tm9kZSl7XG5cdFx0XHR0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5ld05vZGUsIHRoaXMubmV4dFNpYmxpbmcpO1xuXHRcdH1cblx0XHRyZXR1cm4gbmV3Tm9kZTtcblx0fVxufVxuX2V4dGVuZHMoVGV4dCxDaGFyYWN0ZXJEYXRhKTtcbmZ1bmN0aW9uIENvbW1lbnQoKSB7XG59O1xuQ29tbWVudC5wcm90b3R5cGUgPSB7XG5cdG5vZGVOYW1lIDogXCIjY29tbWVudFwiLFxuXHRub2RlVHlwZSA6IENPTU1FTlRfTk9ERVxufVxuX2V4dGVuZHMoQ29tbWVudCxDaGFyYWN0ZXJEYXRhKTtcblxuZnVuY3Rpb24gQ0RBVEFTZWN0aW9uKCkge1xufTtcbkNEQVRBU2VjdGlvbi5wcm90b3R5cGUgPSB7XG5cdG5vZGVOYW1lIDogXCIjY2RhdGEtc2VjdGlvblwiLFxuXHRub2RlVHlwZSA6IENEQVRBX1NFQ1RJT05fTk9ERVxufVxuX2V4dGVuZHMoQ0RBVEFTZWN0aW9uLENoYXJhY3RlckRhdGEpO1xuXG5cbmZ1bmN0aW9uIERvY3VtZW50VHlwZSgpIHtcbn07XG5Eb2N1bWVudFR5cGUucHJvdG90eXBlLm5vZGVUeXBlID0gRE9DVU1FTlRfVFlQRV9OT0RFO1xuX2V4dGVuZHMoRG9jdW1lbnRUeXBlLE5vZGUpO1xuXG5mdW5jdGlvbiBOb3RhdGlvbigpIHtcbn07XG5Ob3RhdGlvbi5wcm90b3R5cGUubm9kZVR5cGUgPSBOT1RBVElPTl9OT0RFO1xuX2V4dGVuZHMoTm90YXRpb24sTm9kZSk7XG5cbmZ1bmN0aW9uIEVudGl0eSgpIHtcbn07XG5FbnRpdHkucHJvdG90eXBlLm5vZGVUeXBlID0gRU5USVRZX05PREU7XG5fZXh0ZW5kcyhFbnRpdHksTm9kZSk7XG5cbmZ1bmN0aW9uIEVudGl0eVJlZmVyZW5jZSgpIHtcbn07XG5FbnRpdHlSZWZlcmVuY2UucHJvdG90eXBlLm5vZGVUeXBlID0gRU5USVRZX1JFRkVSRU5DRV9OT0RFO1xuX2V4dGVuZHMoRW50aXR5UmVmZXJlbmNlLE5vZGUpO1xuXG5mdW5jdGlvbiBEb2N1bWVudEZyYWdtZW50KCkge1xufTtcbkRvY3VtZW50RnJhZ21lbnQucHJvdG90eXBlLm5vZGVOYW1lID1cdFwiI2RvY3VtZW50LWZyYWdtZW50XCI7XG5Eb2N1bWVudEZyYWdtZW50LnByb3RvdHlwZS5ub2RlVHlwZSA9XHRET0NVTUVOVF9GUkFHTUVOVF9OT0RFO1xuX2V4dGVuZHMoRG9jdW1lbnRGcmFnbWVudCxOb2RlKTtcblxuXG5mdW5jdGlvbiBQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24oKSB7XG59XG5Qcm9jZXNzaW5nSW5zdHJ1Y3Rpb24ucHJvdG90eXBlLm5vZGVUeXBlID0gUFJPQ0VTU0lOR19JTlNUUlVDVElPTl9OT0RFO1xuX2V4dGVuZHMoUHJvY2Vzc2luZ0luc3RydWN0aW9uLE5vZGUpO1xuZnVuY3Rpb24gWE1MU2VyaWFsaXplcigpe31cblhNTFNlcmlhbGl6ZXIucHJvdG90eXBlLnNlcmlhbGl6ZVRvU3RyaW5nID0gZnVuY3Rpb24obm9kZSxpc0h0bWwsbm9kZUZpbHRlcil7XG5cdHJldHVybiBub2RlU2VyaWFsaXplVG9TdHJpbmcuY2FsbChub2RlLGlzSHRtbCxub2RlRmlsdGVyKTtcbn1cbk5vZGUucHJvdG90eXBlLnRvU3RyaW5nID0gbm9kZVNlcmlhbGl6ZVRvU3RyaW5nO1xuZnVuY3Rpb24gbm9kZVNlcmlhbGl6ZVRvU3RyaW5nKGlzSHRtbCxub2RlRmlsdGVyKXtcblx0dmFyIGJ1ZiA9IFtdO1xuXHR2YXIgcmVmTm9kZSA9IHRoaXMubm9kZVR5cGUgPT0gOSAmJiB0aGlzLmRvY3VtZW50RWxlbWVudCB8fCB0aGlzO1xuXHR2YXIgcHJlZml4ID0gcmVmTm9kZS5wcmVmaXg7XG5cdHZhciB1cmkgPSByZWZOb2RlLm5hbWVzcGFjZVVSSTtcblx0XG5cdGlmKHVyaSAmJiBwcmVmaXggPT0gbnVsbCl7XG5cdFx0Ly9jb25zb2xlLmxvZyhwcmVmaXgpXG5cdFx0dmFyIHByZWZpeCA9IHJlZk5vZGUubG9va3VwUHJlZml4KHVyaSk7XG5cdFx0aWYocHJlZml4ID09IG51bGwpe1xuXHRcdFx0Ly9pc0hUTUwgPSB0cnVlO1xuXHRcdFx0dmFyIHZpc2libGVOYW1lc3BhY2VzPVtcblx0XHRcdHtuYW1lc3BhY2U6dXJpLHByZWZpeDpudWxsfVxuXHRcdFx0Ly97bmFtZXNwYWNlOnVyaSxwcmVmaXg6Jyd9XG5cdFx0XHRdXG5cdFx0fVxuXHR9XG5cdHNlcmlhbGl6ZVRvU3RyaW5nKHRoaXMsYnVmLGlzSHRtbCxub2RlRmlsdGVyLHZpc2libGVOYW1lc3BhY2VzKTtcblx0Ly9jb25zb2xlLmxvZygnIyMjJyx0aGlzLm5vZGVUeXBlLHVyaSxwcmVmaXgsYnVmLmpvaW4oJycpKVxuXHRyZXR1cm4gYnVmLmpvaW4oJycpO1xufVxuXG5mdW5jdGlvbiBuZWVkTmFtZXNwYWNlRGVmaW5lKG5vZGUsIGlzSFRNTCwgdmlzaWJsZU5hbWVzcGFjZXMpIHtcblx0dmFyIHByZWZpeCA9IG5vZGUucHJlZml4IHx8ICcnO1xuXHR2YXIgdXJpID0gbm9kZS5uYW1lc3BhY2VVUkk7XG5cdC8vIEFjY29yZGluZyB0byBbTmFtZXNwYWNlcyBpbiBYTUwgMS4wXShodHRwczovL3d3dy53My5vcmcvVFIvUkVDLXhtbC1uYW1lcy8jbnMtdXNpbmcpICxcblx0Ly8gYW5kIG1vcmUgc3BlY2lmaWNhbGx5IGh0dHBzOi8vd3d3LnczLm9yZy9UUi9SRUMteG1sLW5hbWVzLyNuc2MtTm9QcmVmaXhVbmRlY2wgOlxuXHQvLyA+IEluIGEgbmFtZXNwYWNlIGRlY2xhcmF0aW9uIGZvciBhIHByZWZpeCBbLi4uXSwgdGhlIGF0dHJpYnV0ZSB2YWx1ZSBNVVNUIE5PVCBiZSBlbXB0eS5cblx0Ly8gaW4gYSBzaW1pbGFyIG1hbm5lciBbTmFtZXNwYWNlcyBpbiBYTUwgMS4xXShodHRwczovL3d3dy53My5vcmcvVFIveG1sLW5hbWVzMTEvI25zLXVzaW5nKVxuXHQvLyBhbmQgbW9yZSBzcGVjaWZpY2FsbHkgaHR0cHM6Ly93d3cudzMub3JnL1RSL3htbC1uYW1lczExLyNuc2MtTlNEZWNsYXJlZCA6XG5cdC8vID4gWy4uLl0gRnVydGhlcm1vcmUsIHRoZSBhdHRyaWJ1dGUgdmFsdWUgWy4uLl0gbXVzdCBub3QgYmUgYW4gZW1wdHkgc3RyaW5nLlxuXHQvLyBzbyBzZXJpYWxpemluZyBlbXB0eSBuYW1lc3BhY2UgdmFsdWUgbGlrZSB4bWxuczpkcz1cIlwiIHdvdWxkIHByb2R1Y2UgYW4gaW52YWxpZCBYTUwgZG9jdW1lbnQuXG5cdGlmICghdXJpKSB7XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cdGlmIChwcmVmaXggPT09IFwieG1sXCIgJiYgdXJpID09PSBOQU1FU1BBQ0UuWE1MIHx8IHVyaSA9PT0gTkFNRVNQQUNFLlhNTE5TKSB7XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cdFxuXHR2YXIgaSA9IHZpc2libGVOYW1lc3BhY2VzLmxlbmd0aCBcblx0d2hpbGUgKGktLSkge1xuXHRcdHZhciBucyA9IHZpc2libGVOYW1lc3BhY2VzW2ldO1xuXHRcdC8vIGdldCBuYW1lc3BhY2UgcHJlZml4XG5cdFx0aWYgKG5zLnByZWZpeCA9PT0gcHJlZml4KSB7XG5cdFx0XHRyZXR1cm4gbnMubmFtZXNwYWNlICE9PSB1cmk7XG5cdFx0fVxuXHR9XG5cdHJldHVybiB0cnVlO1xufVxuLyoqXG4gKiBXZWxsLWZvcm1lZCBjb25zdHJhaW50OiBObyA8IGluIEF0dHJpYnV0ZSBWYWx1ZXNcbiAqID4gVGhlIHJlcGxhY2VtZW50IHRleHQgb2YgYW55IGVudGl0eSByZWZlcnJlZCB0byBkaXJlY3RseSBvciBpbmRpcmVjdGx5XG4gKiA+IGluIGFuIGF0dHJpYnV0ZSB2YWx1ZSBtdXN0IG5vdCBjb250YWluIGEgPC5cbiAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSL3htbDExLyNDbGVhbkF0dHJWYWxzXG4gKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi94bWwxMS8jTlQtQXR0VmFsdWVcbiAqXG4gKiBMaXRlcmFsIHdoaXRlc3BhY2Ugb3RoZXIgdGhhbiBzcGFjZSB0aGF0IGFwcGVhciBpbiBhdHRyaWJ1dGUgdmFsdWVzXG4gKiBhcmUgc2VyaWFsaXplZCBhcyB0aGVpciBlbnRpdHkgcmVmZXJlbmNlcywgc28gdGhleSB3aWxsIGJlIHByZXNlcnZlZC5cbiAqIChJbiBjb250cmFzdCB0byB3aGl0ZXNwYWNlIGxpdGVyYWxzIGluIHRoZSBpbnB1dCB3aGljaCBhcmUgbm9ybWFsaXplZCB0byBzcGFjZXMpXG4gKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi94bWwxMS8jQVZOb3JtYWxpemVcbiAqIEBzZWUgaHR0cHM6Ly93M2MuZ2l0aHViLmlvL0RPTS1QYXJzaW5nLyNzZXJpYWxpemluZy1hbi1lbGVtZW50LXMtYXR0cmlidXRlc1xuICovXG5mdW5jdGlvbiBhZGRTZXJpYWxpemVkQXR0cmlidXRlKGJ1ZiwgcXVhbGlmaWVkTmFtZSwgdmFsdWUpIHtcblx0YnVmLnB1c2goJyAnLCBxdWFsaWZpZWROYW1lLCAnPVwiJywgdmFsdWUucmVwbGFjZSgvWzw+JlwiXFx0XFxuXFxyXS9nLCBfeG1sRW5jb2RlciksICdcIicpXG59XG5cbmZ1bmN0aW9uIHNlcmlhbGl6ZVRvU3RyaW5nKG5vZGUsYnVmLGlzSFRNTCxub2RlRmlsdGVyLHZpc2libGVOYW1lc3BhY2VzKXtcblx0aWYgKCF2aXNpYmxlTmFtZXNwYWNlcykge1xuXHRcdHZpc2libGVOYW1lc3BhY2VzID0gW107XG5cdH1cblxuXHRpZihub2RlRmlsdGVyKXtcblx0XHRub2RlID0gbm9kZUZpbHRlcihub2RlKTtcblx0XHRpZihub2RlKXtcblx0XHRcdGlmKHR5cGVvZiBub2RlID09ICdzdHJpbmcnKXtcblx0XHRcdFx0YnVmLnB1c2gobm9kZSk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHR9ZWxzZXtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0Ly9idWYuc29ydC5hcHBseShhdHRycywgYXR0cmlidXRlU29ydGVyKTtcblx0fVxuXG5cdHN3aXRjaChub2RlLm5vZGVUeXBlKXtcblx0Y2FzZSBFTEVNRU5UX05PREU6XG5cdFx0dmFyIGF0dHJzID0gbm9kZS5hdHRyaWJ1dGVzO1xuXHRcdHZhciBsZW4gPSBhdHRycy5sZW5ndGg7XG5cdFx0dmFyIGNoaWxkID0gbm9kZS5maXJzdENoaWxkO1xuXHRcdHZhciBub2RlTmFtZSA9IG5vZGUudGFnTmFtZTtcblx0XHRcblx0XHRpc0hUTUwgPSBOQU1FU1BBQ0UuaXNIVE1MKG5vZGUubmFtZXNwYWNlVVJJKSB8fCBpc0hUTUxcblxuXHRcdHZhciBwcmVmaXhlZE5vZGVOYW1lID0gbm9kZU5hbWVcblx0XHRpZiAoIWlzSFRNTCAmJiAhbm9kZS5wcmVmaXggJiYgbm9kZS5uYW1lc3BhY2VVUkkpIHtcblx0XHRcdHZhciBkZWZhdWx0TlNcblx0XHRcdC8vIGxvb2t1cCBjdXJyZW50IGRlZmF1bHQgbnMgZnJvbSBgeG1sbnNgIGF0dHJpYnV0ZVxuXHRcdFx0Zm9yICh2YXIgYWkgPSAwOyBhaSA8IGF0dHJzLmxlbmd0aDsgYWkrKykge1xuXHRcdFx0XHRpZiAoYXR0cnMuaXRlbShhaSkubmFtZSA9PT0gJ3htbG5zJykge1xuXHRcdFx0XHRcdGRlZmF1bHROUyA9IGF0dHJzLml0ZW0oYWkpLnZhbHVlXG5cdFx0XHRcdFx0YnJlYWtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0aWYgKCFkZWZhdWx0TlMpIHtcblx0XHRcdFx0Ly8gbG9va3VwIGN1cnJlbnQgZGVmYXVsdCBucyBpbiB2aXNpYmxlTmFtZXNwYWNlc1xuXHRcdFx0XHRmb3IgKHZhciBuc2kgPSB2aXNpYmxlTmFtZXNwYWNlcy5sZW5ndGggLSAxOyBuc2kgPj0gMDsgbnNpLS0pIHtcblx0XHRcdFx0XHR2YXIgbmFtZXNwYWNlID0gdmlzaWJsZU5hbWVzcGFjZXNbbnNpXVxuXHRcdFx0XHRcdGlmIChuYW1lc3BhY2UucHJlZml4ID09PSAnJyAmJiBuYW1lc3BhY2UubmFtZXNwYWNlID09PSBub2RlLm5hbWVzcGFjZVVSSSkge1xuXHRcdFx0XHRcdFx0ZGVmYXVsdE5TID0gbmFtZXNwYWNlLm5hbWVzcGFjZVxuXHRcdFx0XHRcdFx0YnJlYWtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGlmIChkZWZhdWx0TlMgIT09IG5vZGUubmFtZXNwYWNlVVJJKSB7XG5cdFx0XHRcdGZvciAodmFyIG5zaSA9IHZpc2libGVOYW1lc3BhY2VzLmxlbmd0aCAtIDE7IG5zaSA+PSAwOyBuc2ktLSkge1xuXHRcdFx0XHRcdHZhciBuYW1lc3BhY2UgPSB2aXNpYmxlTmFtZXNwYWNlc1tuc2ldXG5cdFx0XHRcdFx0aWYgKG5hbWVzcGFjZS5uYW1lc3BhY2UgPT09IG5vZGUubmFtZXNwYWNlVVJJKSB7XG5cdFx0XHRcdFx0XHRpZiAobmFtZXNwYWNlLnByZWZpeCkge1xuXHRcdFx0XHRcdFx0XHRwcmVmaXhlZE5vZGVOYW1lID0gbmFtZXNwYWNlLnByZWZpeCArICc6JyArIG5vZGVOYW1lXG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRicmVha1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGJ1Zi5wdXNoKCc8JywgcHJlZml4ZWROb2RlTmFtZSk7XG5cblx0XHRmb3IodmFyIGk9MDtpPGxlbjtpKyspe1xuXHRcdFx0Ly8gYWRkIG5hbWVzcGFjZXMgZm9yIGF0dHJpYnV0ZXNcblx0XHRcdHZhciBhdHRyID0gYXR0cnMuaXRlbShpKTtcblx0XHRcdGlmIChhdHRyLnByZWZpeCA9PSAneG1sbnMnKSB7XG5cdFx0XHRcdHZpc2libGVOYW1lc3BhY2VzLnB1c2goeyBwcmVmaXg6IGF0dHIubG9jYWxOYW1lLCBuYW1lc3BhY2U6IGF0dHIudmFsdWUgfSk7XG5cdFx0XHR9ZWxzZSBpZihhdHRyLm5vZGVOYW1lID09ICd4bWxucycpe1xuXHRcdFx0XHR2aXNpYmxlTmFtZXNwYWNlcy5wdXNoKHsgcHJlZml4OiAnJywgbmFtZXNwYWNlOiBhdHRyLnZhbHVlIH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZvcih2YXIgaT0wO2k8bGVuO2krKyl7XG5cdFx0XHR2YXIgYXR0ciA9IGF0dHJzLml0ZW0oaSk7XG5cdFx0XHRpZiAobmVlZE5hbWVzcGFjZURlZmluZShhdHRyLGlzSFRNTCwgdmlzaWJsZU5hbWVzcGFjZXMpKSB7XG5cdFx0XHRcdHZhciBwcmVmaXggPSBhdHRyLnByZWZpeHx8Jyc7XG5cdFx0XHRcdHZhciB1cmkgPSBhdHRyLm5hbWVzcGFjZVVSSTtcblx0XHRcdFx0YWRkU2VyaWFsaXplZEF0dHJpYnV0ZShidWYsIHByZWZpeCA/ICd4bWxuczonICsgcHJlZml4IDogXCJ4bWxuc1wiLCB1cmkpO1xuXHRcdFx0XHR2aXNpYmxlTmFtZXNwYWNlcy5wdXNoKHsgcHJlZml4OiBwcmVmaXgsIG5hbWVzcGFjZTp1cmkgfSk7XG5cdFx0XHR9XG5cdFx0XHRzZXJpYWxpemVUb1N0cmluZyhhdHRyLGJ1Zixpc0hUTUwsbm9kZUZpbHRlcix2aXNpYmxlTmFtZXNwYWNlcyk7XG5cdFx0fVxuXG5cdFx0Ly8gYWRkIG5hbWVzcGFjZSBmb3IgY3VycmVudCBub2RlXHRcdFxuXHRcdGlmIChub2RlTmFtZSA9PT0gcHJlZml4ZWROb2RlTmFtZSAmJiBuZWVkTmFtZXNwYWNlRGVmaW5lKG5vZGUsIGlzSFRNTCwgdmlzaWJsZU5hbWVzcGFjZXMpKSB7XG5cdFx0XHR2YXIgcHJlZml4ID0gbm9kZS5wcmVmaXh8fCcnO1xuXHRcdFx0dmFyIHVyaSA9IG5vZGUubmFtZXNwYWNlVVJJO1xuXHRcdFx0YWRkU2VyaWFsaXplZEF0dHJpYnV0ZShidWYsIHByZWZpeCA/ICd4bWxuczonICsgcHJlZml4IDogXCJ4bWxuc1wiLCB1cmkpO1xuXHRcdFx0dmlzaWJsZU5hbWVzcGFjZXMucHVzaCh7IHByZWZpeDogcHJlZml4LCBuYW1lc3BhY2U6dXJpIH0pO1xuXHRcdH1cblx0XHRcblx0XHRpZihjaGlsZCB8fCBpc0hUTUwgJiYgIS9eKD86bWV0YXxsaW5rfGltZ3xicnxocnxpbnB1dCkkL2kudGVzdChub2RlTmFtZSkpe1xuXHRcdFx0YnVmLnB1c2goJz4nKTtcblx0XHRcdC8vaWYgaXMgY2RhdGEgY2hpbGQgbm9kZVxuXHRcdFx0aWYoaXNIVE1MICYmIC9ec2NyaXB0JC9pLnRlc3Qobm9kZU5hbWUpKXtcblx0XHRcdFx0d2hpbGUoY2hpbGQpe1xuXHRcdFx0XHRcdGlmKGNoaWxkLmRhdGEpe1xuXHRcdFx0XHRcdFx0YnVmLnB1c2goY2hpbGQuZGF0YSk7XG5cdFx0XHRcdFx0fWVsc2V7XG5cdFx0XHRcdFx0XHRzZXJpYWxpemVUb1N0cmluZyhjaGlsZCwgYnVmLCBpc0hUTUwsIG5vZGVGaWx0ZXIsIHZpc2libGVOYW1lc3BhY2VzLnNsaWNlKCkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRjaGlsZCA9IGNoaWxkLm5leHRTaWJsaW5nO1xuXHRcdFx0XHR9XG5cdFx0XHR9ZWxzZVxuXHRcdFx0e1xuXHRcdFx0XHR3aGlsZShjaGlsZCl7XG5cdFx0XHRcdFx0c2VyaWFsaXplVG9TdHJpbmcoY2hpbGQsIGJ1ZiwgaXNIVE1MLCBub2RlRmlsdGVyLCB2aXNpYmxlTmFtZXNwYWNlcy5zbGljZSgpKTtcblx0XHRcdFx0XHRjaGlsZCA9IGNoaWxkLm5leHRTaWJsaW5nO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRidWYucHVzaCgnPC8nLHByZWZpeGVkTm9kZU5hbWUsJz4nKTtcblx0XHR9ZWxzZXtcblx0XHRcdGJ1Zi5wdXNoKCcvPicpO1xuXHRcdH1cblx0XHQvLyByZW1vdmUgYWRkZWQgdmlzaWJsZSBuYW1lc3BhY2VzXG5cdFx0Ly92aXNpYmxlTmFtZXNwYWNlcy5sZW5ndGggPSBzdGFydFZpc2libGVOYW1lc3BhY2VzO1xuXHRcdHJldHVybjtcblx0Y2FzZSBET0NVTUVOVF9OT0RFOlxuXHRjYXNlIERPQ1VNRU5UX0ZSQUdNRU5UX05PREU6XG5cdFx0dmFyIGNoaWxkID0gbm9kZS5maXJzdENoaWxkO1xuXHRcdHdoaWxlKGNoaWxkKXtcblx0XHRcdHNlcmlhbGl6ZVRvU3RyaW5nKGNoaWxkLCBidWYsIGlzSFRNTCwgbm9kZUZpbHRlciwgdmlzaWJsZU5hbWVzcGFjZXMuc2xpY2UoKSk7XG5cdFx0XHRjaGlsZCA9IGNoaWxkLm5leHRTaWJsaW5nO1xuXHRcdH1cblx0XHRyZXR1cm47XG5cdGNhc2UgQVRUUklCVVRFX05PREU6XG5cdFx0cmV0dXJuIGFkZFNlcmlhbGl6ZWRBdHRyaWJ1dGUoYnVmLCBub2RlLm5hbWUsIG5vZGUudmFsdWUpO1xuXHRjYXNlIFRFWFRfTk9ERTpcblx0XHQvKipcblx0XHQgKiBUaGUgYW1wZXJzYW5kIGNoYXJhY3RlciAoJikgYW5kIHRoZSBsZWZ0IGFuZ2xlIGJyYWNrZXQgKDwpIG11c3Qgbm90IGFwcGVhciBpbiB0aGVpciBsaXRlcmFsIGZvcm0sXG5cdFx0ICogZXhjZXB0IHdoZW4gdXNlZCBhcyBtYXJrdXAgZGVsaW1pdGVycywgb3Igd2l0aGluIGEgY29tbWVudCwgYSBwcm9jZXNzaW5nIGluc3RydWN0aW9uLCBvciBhIENEQVRBIHNlY3Rpb24uXG5cdFx0ICogSWYgdGhleSBhcmUgbmVlZGVkIGVsc2V3aGVyZSwgdGhleSBtdXN0IGJlIGVzY2FwZWQgdXNpbmcgZWl0aGVyIG51bWVyaWMgY2hhcmFjdGVyIHJlZmVyZW5jZXMgb3IgdGhlIHN0cmluZ3Ncblx0XHQgKiBgJmFtcDtgIGFuZCBgJmx0O2AgcmVzcGVjdGl2ZWx5LlxuXHRcdCAqIFRoZSByaWdodCBhbmdsZSBicmFja2V0ICg+KSBtYXkgYmUgcmVwcmVzZW50ZWQgdXNpbmcgdGhlIHN0cmluZyBcIiAmZ3Q7IFwiLCBhbmQgbXVzdCwgZm9yIGNvbXBhdGliaWxpdHksXG5cdFx0ICogYmUgZXNjYXBlZCB1c2luZyBlaXRoZXIgYCZndDtgIG9yIGEgY2hhcmFjdGVyIHJlZmVyZW5jZSB3aGVuIGl0IGFwcGVhcnMgaW4gdGhlIHN0cmluZyBgXV0+YCBpbiBjb250ZW50LFxuXHRcdCAqIHdoZW4gdGhhdCBzdHJpbmcgaXMgbm90IG1hcmtpbmcgdGhlIGVuZCBvZiBhIENEQVRBIHNlY3Rpb24uXG5cdFx0ICpcblx0XHQgKiBJbiB0aGUgY29udGVudCBvZiBlbGVtZW50cywgY2hhcmFjdGVyIGRhdGEgaXMgYW55IHN0cmluZyBvZiBjaGFyYWN0ZXJzXG5cdFx0ICogd2hpY2ggZG9lcyBub3QgY29udGFpbiB0aGUgc3RhcnQtZGVsaW1pdGVyIG9mIGFueSBtYXJrdXBcblx0XHQgKiBhbmQgZG9lcyBub3QgaW5jbHVkZSB0aGUgQ0RBVEEtc2VjdGlvbi1jbG9zZSBkZWxpbWl0ZXIsIGBdXT5gLlxuXHRcdCAqXG5cdFx0ICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIveG1sLyNOVC1DaGFyRGF0YVxuXHRcdCAqIEBzZWUgaHR0cHM6Ly93M2MuZ2l0aHViLmlvL0RPTS1QYXJzaW5nLyN4bWwtc2VyaWFsaXppbmctYS10ZXh0LW5vZGVcblx0XHQgKi9cblx0XHRyZXR1cm4gYnVmLnB1c2gobm9kZS5kYXRhXG5cdFx0XHQucmVwbGFjZSgvWzwmPl0vZyxfeG1sRW5jb2Rlcilcblx0XHQpO1xuXHRjYXNlIENEQVRBX1NFQ1RJT05fTk9ERTpcblx0XHRyZXR1cm4gYnVmLnB1c2goICc8IVtDREFUQVsnLG5vZGUuZGF0YSwnXV0+Jyk7XG5cdGNhc2UgQ09NTUVOVF9OT0RFOlxuXHRcdHJldHVybiBidWYucHVzaCggXCI8IS0tXCIsbm9kZS5kYXRhLFwiLS0+XCIpO1xuXHRjYXNlIERPQ1VNRU5UX1RZUEVfTk9ERTpcblx0XHR2YXIgcHViaWQgPSBub2RlLnB1YmxpY0lkO1xuXHRcdHZhciBzeXNpZCA9IG5vZGUuc3lzdGVtSWQ7XG5cdFx0YnVmLnB1c2goJzwhRE9DVFlQRSAnLG5vZGUubmFtZSk7XG5cdFx0aWYocHViaWQpe1xuXHRcdFx0YnVmLnB1c2goJyBQVUJMSUMgJywgcHViaWQpO1xuXHRcdFx0aWYgKHN5c2lkICYmIHN5c2lkIT0nLicpIHtcblx0XHRcdFx0YnVmLnB1c2goJyAnLCBzeXNpZCk7XG5cdFx0XHR9XG5cdFx0XHRidWYucHVzaCgnPicpO1xuXHRcdH1lbHNlIGlmKHN5c2lkICYmIHN5c2lkIT0nLicpe1xuXHRcdFx0YnVmLnB1c2goJyBTWVNURU0gJywgc3lzaWQsICc+Jyk7XG5cdFx0fWVsc2V7XG5cdFx0XHR2YXIgc3ViID0gbm9kZS5pbnRlcm5hbFN1YnNldDtcblx0XHRcdGlmKHN1Yil7XG5cdFx0XHRcdGJ1Zi5wdXNoKFwiIFtcIixzdWIsXCJdXCIpO1xuXHRcdFx0fVxuXHRcdFx0YnVmLnB1c2goXCI+XCIpO1xuXHRcdH1cblx0XHRyZXR1cm47XG5cdGNhc2UgUFJPQ0VTU0lOR19JTlNUUlVDVElPTl9OT0RFOlxuXHRcdHJldHVybiBidWYucHVzaCggXCI8P1wiLG5vZGUudGFyZ2V0LFwiIFwiLG5vZGUuZGF0YSxcIj8+XCIpO1xuXHRjYXNlIEVOVElUWV9SRUZFUkVOQ0VfTk9ERTpcblx0XHRyZXR1cm4gYnVmLnB1c2goICcmJyxub2RlLm5vZGVOYW1lLCc7Jyk7XG5cdC8vY2FzZSBFTlRJVFlfTk9ERTpcblx0Ly9jYXNlIE5PVEFUSU9OX05PREU6XG5cdGRlZmF1bHQ6XG5cdFx0YnVmLnB1c2goJz8/Jyxub2RlLm5vZGVOYW1lKTtcblx0fVxufVxuZnVuY3Rpb24gaW1wb3J0Tm9kZShkb2Msbm9kZSxkZWVwKXtcblx0dmFyIG5vZGUyO1xuXHRzd2l0Y2ggKG5vZGUubm9kZVR5cGUpIHtcblx0Y2FzZSBFTEVNRU5UX05PREU6XG5cdFx0bm9kZTIgPSBub2RlLmNsb25lTm9kZShmYWxzZSk7XG5cdFx0bm9kZTIub3duZXJEb2N1bWVudCA9IGRvYztcblx0XHQvL3ZhciBhdHRycyA9IG5vZGUyLmF0dHJpYnV0ZXM7XG5cdFx0Ly92YXIgbGVuID0gYXR0cnMubGVuZ3RoO1xuXHRcdC8vZm9yKHZhciBpPTA7aTxsZW47aSsrKXtcblx0XHRcdC8vbm9kZTIuc2V0QXR0cmlidXRlTm9kZU5TKGltcG9ydE5vZGUoZG9jLGF0dHJzLml0ZW0oaSksZGVlcCkpO1xuXHRcdC8vfVxuXHRjYXNlIERPQ1VNRU5UX0ZSQUdNRU5UX05PREU6XG5cdFx0YnJlYWs7XG5cdGNhc2UgQVRUUklCVVRFX05PREU6XG5cdFx0ZGVlcCA9IHRydWU7XG5cdFx0YnJlYWs7XG5cdC8vY2FzZSBFTlRJVFlfUkVGRVJFTkNFX05PREU6XG5cdC8vY2FzZSBQUk9DRVNTSU5HX0lOU1RSVUNUSU9OX05PREU6XG5cdC8vLy9jYXNlIFRFWFRfTk9ERTpcblx0Ly9jYXNlIENEQVRBX1NFQ1RJT05fTk9ERTpcblx0Ly9jYXNlIENPTU1FTlRfTk9ERTpcblx0Ly9cdGRlZXAgPSBmYWxzZTtcblx0Ly9cdGJyZWFrO1xuXHQvL2Nhc2UgRE9DVU1FTlRfTk9ERTpcblx0Ly9jYXNlIERPQ1VNRU5UX1RZUEVfTk9ERTpcblx0Ly9jYW5ub3QgYmUgaW1wb3J0ZWQuXG5cdC8vY2FzZSBFTlRJVFlfTk9ERTpcblx0Ly9jYXNlIE5PVEFUSU9OX05PREXvvJpcblx0Ly9jYW4gbm90IGhpdCBpbiBsZXZlbDNcblx0Ly9kZWZhdWx0OnRocm93IGU7XG5cdH1cblx0aWYoIW5vZGUyKXtcblx0XHRub2RlMiA9IG5vZGUuY2xvbmVOb2RlKGZhbHNlKTsvL2ZhbHNlXG5cdH1cblx0bm9kZTIub3duZXJEb2N1bWVudCA9IGRvYztcblx0bm9kZTIucGFyZW50Tm9kZSA9IG51bGw7XG5cdGlmKGRlZXApe1xuXHRcdHZhciBjaGlsZCA9IG5vZGUuZmlyc3RDaGlsZDtcblx0XHR3aGlsZShjaGlsZCl7XG5cdFx0XHRub2RlMi5hcHBlbmRDaGlsZChpbXBvcnROb2RlKGRvYyxjaGlsZCxkZWVwKSk7XG5cdFx0XHRjaGlsZCA9IGNoaWxkLm5leHRTaWJsaW5nO1xuXHRcdH1cblx0fVxuXHRyZXR1cm4gbm9kZTI7XG59XG4vL1xuLy92YXIgX3JlbGF0aW9uTWFwID0ge2ZpcnN0Q2hpbGQ6MSxsYXN0Q2hpbGQ6MSxwcmV2aW91c1NpYmxpbmc6MSxuZXh0U2libGluZzoxLFxuLy9cdFx0XHRcdFx0YXR0cmlidXRlczoxLGNoaWxkTm9kZXM6MSxwYXJlbnROb2RlOjEsZG9jdW1lbnRFbGVtZW50OjEsZG9jdHlwZSx9O1xuZnVuY3Rpb24gY2xvbmVOb2RlKGRvYyxub2RlLGRlZXApe1xuXHR2YXIgbm9kZTIgPSBuZXcgbm9kZS5jb25zdHJ1Y3RvcigpO1xuXHRmb3IodmFyIG4gaW4gbm9kZSl7XG5cdFx0dmFyIHYgPSBub2RlW25dO1xuXHRcdGlmKHR5cGVvZiB2ICE9ICdvYmplY3QnICl7XG5cdFx0XHRpZih2ICE9IG5vZGUyW25dKXtcblx0XHRcdFx0bm9kZTJbbl0gPSB2O1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRpZihub2RlLmNoaWxkTm9kZXMpe1xuXHRcdG5vZGUyLmNoaWxkTm9kZXMgPSBuZXcgTm9kZUxpc3QoKTtcblx0fVxuXHRub2RlMi5vd25lckRvY3VtZW50ID0gZG9jO1xuXHRzd2l0Y2ggKG5vZGUyLm5vZGVUeXBlKSB7XG5cdGNhc2UgRUxFTUVOVF9OT0RFOlxuXHRcdHZhciBhdHRyc1x0PSBub2RlLmF0dHJpYnV0ZXM7XG5cdFx0dmFyIGF0dHJzMlx0PSBub2RlMi5hdHRyaWJ1dGVzID0gbmV3IE5hbWVkTm9kZU1hcCgpO1xuXHRcdHZhciBsZW4gPSBhdHRycy5sZW5ndGhcblx0XHRhdHRyczIuX293bmVyRWxlbWVudCA9IG5vZGUyO1xuXHRcdGZvcih2YXIgaT0wO2k8bGVuO2krKyl7XG5cdFx0XHRub2RlMi5zZXRBdHRyaWJ1dGVOb2RlKGNsb25lTm9kZShkb2MsYXR0cnMuaXRlbShpKSx0cnVlKSk7XG5cdFx0fVxuXHRcdGJyZWFrOztcblx0Y2FzZSBBVFRSSUJVVEVfTk9ERTpcblx0XHRkZWVwID0gdHJ1ZTtcblx0fVxuXHRpZihkZWVwKXtcblx0XHR2YXIgY2hpbGQgPSBub2RlLmZpcnN0Q2hpbGQ7XG5cdFx0d2hpbGUoY2hpbGQpe1xuXHRcdFx0bm9kZTIuYXBwZW5kQ2hpbGQoY2xvbmVOb2RlKGRvYyxjaGlsZCxkZWVwKSk7XG5cdFx0XHRjaGlsZCA9IGNoaWxkLm5leHRTaWJsaW5nO1xuXHRcdH1cblx0fVxuXHRyZXR1cm4gbm9kZTI7XG59XG5cbmZ1bmN0aW9uIF9fc2V0X18ob2JqZWN0LGtleSx2YWx1ZSl7XG5cdG9iamVjdFtrZXldID0gdmFsdWVcbn1cbi8vZG8gZHluYW1pY1xudHJ5e1xuXHRpZihPYmplY3QuZGVmaW5lUHJvcGVydHkpe1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShMaXZlTm9kZUxpc3QucHJvdG90eXBlLCdsZW5ndGgnLHtcblx0XHRcdGdldDpmdW5jdGlvbigpe1xuXHRcdFx0XHRfdXBkYXRlTGl2ZUxpc3QodGhpcyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLiQkbGVuZ3RoO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KE5vZGUucHJvdG90eXBlLCd0ZXh0Q29udGVudCcse1xuXHRcdFx0Z2V0OmZ1bmN0aW9uKCl7XG5cdFx0XHRcdHJldHVybiBnZXRUZXh0Q29udGVudCh0aGlzKTtcblx0XHRcdH0sXG5cblx0XHRcdHNldDpmdW5jdGlvbihkYXRhKXtcblx0XHRcdFx0c3dpdGNoKHRoaXMubm9kZVR5cGUpe1xuXHRcdFx0XHRjYXNlIEVMRU1FTlRfTk9ERTpcblx0XHRcdFx0Y2FzZSBET0NVTUVOVF9GUkFHTUVOVF9OT0RFOlxuXHRcdFx0XHRcdHdoaWxlKHRoaXMuZmlyc3RDaGlsZCl7XG5cdFx0XHRcdFx0XHR0aGlzLnJlbW92ZUNoaWxkKHRoaXMuZmlyc3RDaGlsZCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmKGRhdGEgfHwgU3RyaW5nKGRhdGEpKXtcblx0XHRcdFx0XHRcdHRoaXMuYXBwZW5kQ2hpbGQodGhpcy5vd25lckRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGRhdGEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHR0aGlzLmRhdGEgPSBkYXRhO1xuXHRcdFx0XHRcdHRoaXMudmFsdWUgPSBkYXRhO1xuXHRcdFx0XHRcdHRoaXMubm9kZVZhbHVlID0gZGF0YTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pXG5cdFx0XG5cdFx0ZnVuY3Rpb24gZ2V0VGV4dENvbnRlbnQobm9kZSl7XG5cdFx0XHRzd2l0Y2gobm9kZS5ub2RlVHlwZSl7XG5cdFx0XHRjYXNlIEVMRU1FTlRfTk9ERTpcblx0XHRcdGNhc2UgRE9DVU1FTlRfRlJBR01FTlRfTk9ERTpcblx0XHRcdFx0dmFyIGJ1ZiA9IFtdO1xuXHRcdFx0XHRub2RlID0gbm9kZS5maXJzdENoaWxkO1xuXHRcdFx0XHR3aGlsZShub2RlKXtcblx0XHRcdFx0XHRpZihub2RlLm5vZGVUeXBlIT09NyAmJiBub2RlLm5vZGVUeXBlICE9PTgpe1xuXHRcdFx0XHRcdFx0YnVmLnB1c2goZ2V0VGV4dENvbnRlbnQobm9kZSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRub2RlID0gbm9kZS5uZXh0U2libGluZztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gYnVmLmpvaW4oJycpO1xuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0cmV0dXJuIG5vZGUubm9kZVZhbHVlO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdF9fc2V0X18gPSBmdW5jdGlvbihvYmplY3Qsa2V5LHZhbHVlKXtcblx0XHRcdC8vY29uc29sZS5sb2codmFsdWUpXG5cdFx0XHRvYmplY3RbJyQkJytrZXldID0gdmFsdWVcblx0XHR9XG5cdH1cbn1jYXRjaChlKXsvL2llOFxufVxuXG4vL2lmKHR5cGVvZiByZXF1aXJlID09ICdmdW5jdGlvbicpe1xuXHRleHBvcnRzLkRvY3VtZW50VHlwZSA9IERvY3VtZW50VHlwZTtcblx0ZXhwb3J0cy5ET01FeGNlcHRpb24gPSBET01FeGNlcHRpb247XG5cdGV4cG9ydHMuRE9NSW1wbGVtZW50YXRpb24gPSBET01JbXBsZW1lbnRhdGlvbjtcblx0ZXhwb3J0cy5FbGVtZW50ID0gRWxlbWVudDtcblx0ZXhwb3J0cy5Ob2RlID0gTm9kZTtcblx0ZXhwb3J0cy5Ob2RlTGlzdCA9IE5vZGVMaXN0O1xuXHRleHBvcnRzLlhNTFNlcmlhbGl6ZXIgPSBYTUxTZXJpYWxpemVyO1xuLy99XG4iLCJ2YXIgZnJlZXplID0gcmVxdWlyZSgnLi9jb252ZW50aW9ucycpLmZyZWV6ZTtcblxuLyoqXG4gKiBUaGUgZW50aXRpZXMgdGhhdCBhcmUgcHJlZGVmaW5lZCBpbiBldmVyeSBYTUwgZG9jdW1lbnQuXG4gKlxuICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwNi9SRUMteG1sMTEtMjAwNjA4MTYvI3NlYy1wcmVkZWZpbmVkLWVudCBXM0MgWE1MIDEuMVxuICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwOC9SRUMteG1sLTIwMDgxMTI2LyNzZWMtcHJlZGVmaW5lZC1lbnQgVzNDIFhNTCAxLjBcbiAqIEBzZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9YTUxfYW5kX0hUTUxfY2hhcmFjdGVyX2VudGl0eV9yZWZlcmVuY2VzI1ByZWRlZmluZWRfZW50aXRpZXNfaW5fWE1MIFdpa2lwZWRpYVxuICovXG5leHBvcnRzLlhNTF9FTlRJVElFUyA9IGZyZWV6ZSh7YW1wOicmJywgYXBvczpcIidcIiwgZ3Q6Jz4nLCBsdDonPCcsIHF1b3Q6J1wiJ30pXG5cbi8qKlxuICogQSBtYXAgb2YgY3VycmVudGx5IDI0MSBlbnRpdGllcyB0aGF0IGFyZSBkZXRlY3RlZCBpbiBhbiBIVE1MIGRvY3VtZW50LlxuICogVGhleSBjb250YWluIGFsbCBlbnRyaWVzIGZyb20gYFhNTF9FTlRJVElFU2AuXG4gKlxuICogQHNlZSBYTUxfRU5USVRJRVNcbiAqIEBzZWUgRE9NUGFyc2VyLnBhcnNlRnJvbVN0cmluZ1xuICogQHNlZSBET01JbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUuY3JlYXRlSFRNTERvY3VtZW50XG4gKiBAc2VlIGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvI25hbWVkLWNoYXJhY3Rlci1yZWZlcmVuY2VzIFdIQVRXRyBIVE1MKDUpIFNwZWNcbiAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSL3htbC1lbnRpdHktbmFtZXMvIFczQyBYTUwgRW50aXR5IE5hbWVzXG4gKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9odG1sNC9zZ21sL2VudGl0aWVzLmh0bWwgVzNDIEhUTUw0L1NHTUxcbiAqIEBzZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9YTUxfYW5kX0hUTUxfY2hhcmFjdGVyX2VudGl0eV9yZWZlcmVuY2VzI0NoYXJhY3Rlcl9lbnRpdHlfcmVmZXJlbmNlc19pbl9IVE1MIFdpa2lwZWRpYSAoSFRNTClcbiAqIEBzZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9YTUxfYW5kX0hUTUxfY2hhcmFjdGVyX2VudGl0eV9yZWZlcmVuY2VzI0VudGl0aWVzX3JlcHJlc2VudGluZ19zcGVjaWFsX2NoYXJhY3RlcnNfaW5fWEhUTUwgV2lrcGVkaWEgKFhIVE1MKVxuICovXG5leHBvcnRzLkhUTUxfRU5USVRJRVMgPSBmcmVlemUoe1xuICAgICAgIGx0OiAnPCcsXG4gICAgICAgZ3Q6ICc+JyxcbiAgICAgICBhbXA6ICcmJyxcbiAgICAgICBxdW90OiAnXCInLFxuICAgICAgIGFwb3M6IFwiJ1wiLFxuICAgICAgIEFncmF2ZTogXCLDgFwiLFxuICAgICAgIEFhY3V0ZTogXCLDgVwiLFxuICAgICAgIEFjaXJjOiBcIsOCXCIsXG4gICAgICAgQXRpbGRlOiBcIsODXCIsXG4gICAgICAgQXVtbDogXCLDhFwiLFxuICAgICAgIEFyaW5nOiBcIsOFXCIsXG4gICAgICAgQUVsaWc6IFwiw4ZcIixcbiAgICAgICBDY2VkaWw6IFwiw4dcIixcbiAgICAgICBFZ3JhdmU6IFwiw4hcIixcbiAgICAgICBFYWN1dGU6IFwiw4lcIixcbiAgICAgICBFY2lyYzogXCLDilwiLFxuICAgICAgIEV1bWw6IFwiw4tcIixcbiAgICAgICBJZ3JhdmU6IFwiw4xcIixcbiAgICAgICBJYWN1dGU6IFwiw41cIixcbiAgICAgICBJY2lyYzogXCLDjlwiLFxuICAgICAgIEl1bWw6IFwiw49cIixcbiAgICAgICBFVEg6IFwiw5BcIixcbiAgICAgICBOdGlsZGU6IFwiw5FcIixcbiAgICAgICBPZ3JhdmU6IFwiw5JcIixcbiAgICAgICBPYWN1dGU6IFwiw5NcIixcbiAgICAgICBPY2lyYzogXCLDlFwiLFxuICAgICAgIE90aWxkZTogXCLDlVwiLFxuICAgICAgIE91bWw6IFwiw5ZcIixcbiAgICAgICBPc2xhc2g6IFwiw5hcIixcbiAgICAgICBVZ3JhdmU6IFwiw5lcIixcbiAgICAgICBVYWN1dGU6IFwiw5pcIixcbiAgICAgICBVY2lyYzogXCLDm1wiLFxuICAgICAgIFV1bWw6IFwiw5xcIixcbiAgICAgICBZYWN1dGU6IFwiw51cIixcbiAgICAgICBUSE9STjogXCLDnlwiLFxuICAgICAgIHN6bGlnOiBcIsOfXCIsXG4gICAgICAgYWdyYXZlOiBcIsOgXCIsXG4gICAgICAgYWFjdXRlOiBcIsOhXCIsXG4gICAgICAgYWNpcmM6IFwiw6JcIixcbiAgICAgICBhdGlsZGU6IFwiw6NcIixcbiAgICAgICBhdW1sOiBcIsOkXCIsXG4gICAgICAgYXJpbmc6IFwiw6VcIixcbiAgICAgICBhZWxpZzogXCLDplwiLFxuICAgICAgIGNjZWRpbDogXCLDp1wiLFxuICAgICAgIGVncmF2ZTogXCLDqFwiLFxuICAgICAgIGVhY3V0ZTogXCLDqVwiLFxuICAgICAgIGVjaXJjOiBcIsOqXCIsXG4gICAgICAgZXVtbDogXCLDq1wiLFxuICAgICAgIGlncmF2ZTogXCLDrFwiLFxuICAgICAgIGlhY3V0ZTogXCLDrVwiLFxuICAgICAgIGljaXJjOiBcIsOuXCIsXG4gICAgICAgaXVtbDogXCLDr1wiLFxuICAgICAgIGV0aDogXCLDsFwiLFxuICAgICAgIG50aWxkZTogXCLDsVwiLFxuICAgICAgIG9ncmF2ZTogXCLDslwiLFxuICAgICAgIG9hY3V0ZTogXCLDs1wiLFxuICAgICAgIG9jaXJjOiBcIsO0XCIsXG4gICAgICAgb3RpbGRlOiBcIsO1XCIsXG4gICAgICAgb3VtbDogXCLDtlwiLFxuICAgICAgIG9zbGFzaDogXCLDuFwiLFxuICAgICAgIHVncmF2ZTogXCLDuVwiLFxuICAgICAgIHVhY3V0ZTogXCLDulwiLFxuICAgICAgIHVjaXJjOiBcIsO7XCIsXG4gICAgICAgdXVtbDogXCLDvFwiLFxuICAgICAgIHlhY3V0ZTogXCLDvVwiLFxuICAgICAgIHRob3JuOiBcIsO+XCIsXG4gICAgICAgeXVtbDogXCLDv1wiLFxuICAgICAgIG5ic3A6IFwiXFx1MDBhMFwiLFxuICAgICAgIGlleGNsOiBcIsKhXCIsXG4gICAgICAgY2VudDogXCLColwiLFxuICAgICAgIHBvdW5kOiBcIsKjXCIsXG4gICAgICAgY3VycmVuOiBcIsKkXCIsXG4gICAgICAgeWVuOiBcIsKlXCIsXG4gICAgICAgYnJ2YmFyOiBcIsKmXCIsXG4gICAgICAgc2VjdDogXCLCp1wiLFxuICAgICAgIHVtbDogXCLCqFwiLFxuICAgICAgIGNvcHk6IFwiwqlcIixcbiAgICAgICBvcmRmOiBcIsKqXCIsXG4gICAgICAgbGFxdW86IFwiwqtcIixcbiAgICAgICBub3Q6IFwiwqxcIixcbiAgICAgICBzaHk6IFwiwq3CrVwiLFxuICAgICAgIHJlZzogXCLCrlwiLFxuICAgICAgIG1hY3I6IFwiwq9cIixcbiAgICAgICBkZWc6IFwiwrBcIixcbiAgICAgICBwbHVzbW46IFwiwrFcIixcbiAgICAgICBzdXAyOiBcIsKyXCIsXG4gICAgICAgc3VwMzogXCLCs1wiLFxuICAgICAgIGFjdXRlOiBcIsK0XCIsXG4gICAgICAgbWljcm86IFwiwrVcIixcbiAgICAgICBwYXJhOiBcIsK2XCIsXG4gICAgICAgbWlkZG90OiBcIsK3XCIsXG4gICAgICAgY2VkaWw6IFwiwrhcIixcbiAgICAgICBzdXAxOiBcIsK5XCIsXG4gICAgICAgb3JkbTogXCLCulwiLFxuICAgICAgIHJhcXVvOiBcIsK7XCIsXG4gICAgICAgZnJhYzE0OiBcIsK8XCIsXG4gICAgICAgZnJhYzEyOiBcIsK9XCIsXG4gICAgICAgZnJhYzM0OiBcIsK+XCIsXG4gICAgICAgaXF1ZXN0OiBcIsK/XCIsXG4gICAgICAgdGltZXM6IFwiw5dcIixcbiAgICAgICBkaXZpZGU6IFwiw7dcIixcbiAgICAgICBmb3JhbGw6IFwi4oiAXCIsXG4gICAgICAgcGFydDogXCLiiIJcIixcbiAgICAgICBleGlzdDogXCLiiINcIixcbiAgICAgICBlbXB0eTogXCLiiIVcIixcbiAgICAgICBuYWJsYTogXCLiiIdcIixcbiAgICAgICBpc2luOiBcIuKIiFwiLFxuICAgICAgIG5vdGluOiBcIuKIiVwiLFxuICAgICAgIG5pOiBcIuKIi1wiLFxuICAgICAgIHByb2Q6IFwi4oiPXCIsXG4gICAgICAgc3VtOiBcIuKIkVwiLFxuICAgICAgIG1pbnVzOiBcIuKIklwiLFxuICAgICAgIGxvd2FzdDogXCLiiJdcIixcbiAgICAgICByYWRpYzogXCLiiJpcIixcbiAgICAgICBwcm9wOiBcIuKInVwiLFxuICAgICAgIGluZmluOiBcIuKInlwiLFxuICAgICAgIGFuZzogXCLiiKBcIixcbiAgICAgICBhbmQ6IFwi4oinXCIsXG4gICAgICAgb3I6IFwi4oioXCIsXG4gICAgICAgY2FwOiBcIuKIqVwiLFxuICAgICAgIGN1cDogXCLiiKpcIixcbiAgICAgICAnaW50JzogXCLiiKtcIixcbiAgICAgICB0aGVyZTQ6IFwi4oi0XCIsXG4gICAgICAgc2ltOiBcIuKIvFwiLFxuICAgICAgIGNvbmc6IFwi4omFXCIsXG4gICAgICAgYXN5bXA6IFwi4omIXCIsXG4gICAgICAgbmU6IFwi4omgXCIsXG4gICAgICAgZXF1aXY6IFwi4omhXCIsXG4gICAgICAgbGU6IFwi4omkXCIsXG4gICAgICAgZ2U6IFwi4omlXCIsXG4gICAgICAgc3ViOiBcIuKKglwiLFxuICAgICAgIHN1cDogXCLiioNcIixcbiAgICAgICBuc3ViOiBcIuKKhFwiLFxuICAgICAgIHN1YmU6IFwi4oqGXCIsXG4gICAgICAgc3VwZTogXCLiiodcIixcbiAgICAgICBvcGx1czogXCLiipVcIixcbiAgICAgICBvdGltZXM6IFwi4oqXXCIsXG4gICAgICAgcGVycDogXCLiiqVcIixcbiAgICAgICBzZG90OiBcIuKLhVwiLFxuICAgICAgIEFscGhhOiBcIs6RXCIsXG4gICAgICAgQmV0YTogXCLOklwiLFxuICAgICAgIEdhbW1hOiBcIs6TXCIsXG4gICAgICAgRGVsdGE6IFwizpRcIixcbiAgICAgICBFcHNpbG9uOiBcIs6VXCIsXG4gICAgICAgWmV0YTogXCLOllwiLFxuICAgICAgIEV0YTogXCLOl1wiLFxuICAgICAgIFRoZXRhOiBcIs6YXCIsXG4gICAgICAgSW90YTogXCLOmVwiLFxuICAgICAgIEthcHBhOiBcIs6aXCIsXG4gICAgICAgTGFtYmRhOiBcIs6bXCIsXG4gICAgICAgTXU6IFwizpxcIixcbiAgICAgICBOdTogXCLOnVwiLFxuICAgICAgIFhpOiBcIs6eXCIsXG4gICAgICAgT21pY3JvbjogXCLOn1wiLFxuICAgICAgIFBpOiBcIs6gXCIsXG4gICAgICAgUmhvOiBcIs6hXCIsXG4gICAgICAgU2lnbWE6IFwizqNcIixcbiAgICAgICBUYXU6IFwizqRcIixcbiAgICAgICBVcHNpbG9uOiBcIs6lXCIsXG4gICAgICAgUGhpOiBcIs6mXCIsXG4gICAgICAgQ2hpOiBcIs6nXCIsXG4gICAgICAgUHNpOiBcIs6oXCIsXG4gICAgICAgT21lZ2E6IFwizqlcIixcbiAgICAgICBhbHBoYTogXCLOsVwiLFxuICAgICAgIGJldGE6IFwizrJcIixcbiAgICAgICBnYW1tYTogXCLOs1wiLFxuICAgICAgIGRlbHRhOiBcIs60XCIsXG4gICAgICAgZXBzaWxvbjogXCLOtVwiLFxuICAgICAgIHpldGE6IFwizrZcIixcbiAgICAgICBldGE6IFwizrdcIixcbiAgICAgICB0aGV0YTogXCLOuFwiLFxuICAgICAgIGlvdGE6IFwizrlcIixcbiAgICAgICBrYXBwYTogXCLOulwiLFxuICAgICAgIGxhbWJkYTogXCLOu1wiLFxuICAgICAgIG11OiBcIs68XCIsXG4gICAgICAgbnU6IFwizr1cIixcbiAgICAgICB4aTogXCLOvlwiLFxuICAgICAgIG9taWNyb246IFwizr9cIixcbiAgICAgICBwaTogXCLPgFwiLFxuICAgICAgIHJobzogXCLPgVwiLFxuICAgICAgIHNpZ21hZjogXCLPglwiLFxuICAgICAgIHNpZ21hOiBcIs+DXCIsXG4gICAgICAgdGF1OiBcIs+EXCIsXG4gICAgICAgdXBzaWxvbjogXCLPhVwiLFxuICAgICAgIHBoaTogXCLPhlwiLFxuICAgICAgIGNoaTogXCLPh1wiLFxuICAgICAgIHBzaTogXCLPiFwiLFxuICAgICAgIG9tZWdhOiBcIs+JXCIsXG4gICAgICAgdGhldGFzeW06IFwiz5FcIixcbiAgICAgICB1cHNpaDogXCLPklwiLFxuICAgICAgIHBpdjogXCLPllwiLFxuICAgICAgIE9FbGlnOiBcIsWSXCIsXG4gICAgICAgb2VsaWc6IFwixZNcIixcbiAgICAgICBTY2Fyb246IFwixaBcIixcbiAgICAgICBzY2Fyb246IFwixaFcIixcbiAgICAgICBZdW1sOiBcIsW4XCIsXG4gICAgICAgZm5vZjogXCLGklwiLFxuICAgICAgIGNpcmM6IFwiy4ZcIixcbiAgICAgICB0aWxkZTogXCLLnFwiLFxuICAgICAgIGVuc3A6IFwi4oCCXCIsXG4gICAgICAgZW1zcDogXCLigINcIixcbiAgICAgICB0aGluc3A6IFwi4oCJXCIsXG4gICAgICAgenduajogXCLigIxcIixcbiAgICAgICB6d2o6IFwi4oCNXCIsXG4gICAgICAgbHJtOiBcIuKAjlwiLFxuICAgICAgIHJsbTogXCLigI9cIixcbiAgICAgICBuZGFzaDogXCLigJNcIixcbiAgICAgICBtZGFzaDogXCLigJRcIixcbiAgICAgICBsc3F1bzogXCLigJhcIixcbiAgICAgICByc3F1bzogXCLigJlcIixcbiAgICAgICBzYnF1bzogXCLigJpcIixcbiAgICAgICBsZHF1bzogXCLigJxcIixcbiAgICAgICByZHF1bzogXCLigJ1cIixcbiAgICAgICBiZHF1bzogXCLigJ5cIixcbiAgICAgICBkYWdnZXI6IFwi4oCgXCIsXG4gICAgICAgRGFnZ2VyOiBcIuKAoVwiLFxuICAgICAgIGJ1bGw6IFwi4oCiXCIsXG4gICAgICAgaGVsbGlwOiBcIuKAplwiLFxuICAgICAgIHBlcm1pbDogXCLigLBcIixcbiAgICAgICBwcmltZTogXCLigLJcIixcbiAgICAgICBQcmltZTogXCLigLNcIixcbiAgICAgICBsc2FxdW86IFwi4oC5XCIsXG4gICAgICAgcnNhcXVvOiBcIuKAulwiLFxuICAgICAgIG9saW5lOiBcIuKAvlwiLFxuICAgICAgIGV1cm86IFwi4oKsXCIsXG4gICAgICAgdHJhZGU6IFwi4oSiXCIsXG4gICAgICAgbGFycjogXCLihpBcIixcbiAgICAgICB1YXJyOiBcIuKGkVwiLFxuICAgICAgIHJhcnI6IFwi4oaSXCIsXG4gICAgICAgZGFycjogXCLihpNcIixcbiAgICAgICBoYXJyOiBcIuKGlFwiLFxuICAgICAgIGNyYXJyOiBcIuKGtVwiLFxuICAgICAgIGxjZWlsOiBcIuKMiFwiLFxuICAgICAgIHJjZWlsOiBcIuKMiVwiLFxuICAgICAgIGxmbG9vcjogXCLijIpcIixcbiAgICAgICByZmxvb3I6IFwi4oyLXCIsXG4gICAgICAgbG96OiBcIuKXilwiLFxuICAgICAgIHNwYWRlczogXCLimaBcIixcbiAgICAgICBjbHViczogXCLimaNcIixcbiAgICAgICBoZWFydHM6IFwi4pmlXCIsXG4gICAgICAgZGlhbXM6IFwi4pmmXCJcbn0pO1xuXG4vKipcbiAqIEBkZXByZWNhdGVkIHVzZSBgSFRNTF9FTlRJVElFU2AgaW5zdGVhZFxuICogQHNlZSBIVE1MX0VOVElUSUVTXG4gKi9cbmV4cG9ydHMuZW50aXR5TWFwID0gZXhwb3J0cy5IVE1MX0VOVElUSUVTXG4iLCJ2YXIgZG9tID0gcmVxdWlyZSgnLi9kb20nKVxuZXhwb3J0cy5ET01JbXBsZW1lbnRhdGlvbiA9IGRvbS5ET01JbXBsZW1lbnRhdGlvblxuZXhwb3J0cy5YTUxTZXJpYWxpemVyID0gZG9tLlhNTFNlcmlhbGl6ZXJcbmV4cG9ydHMuRE9NUGFyc2VyID0gcmVxdWlyZSgnLi9kb20tcGFyc2VyJykuRE9NUGFyc2VyXG4iLCJ2YXIgTkFNRVNQQUNFID0gcmVxdWlyZShcIi4vY29udmVudGlvbnNcIikuTkFNRVNQQUNFO1xuXG4vL1s0XSAgIFx0TmFtZVN0YXJ0Q2hhclx0ICAgOjo9ICAgXHRcIjpcIiB8IFtBLVpdIHwgXCJfXCIgfCBbYS16XSB8IFsjeEMwLSN4RDZdIHwgWyN4RDgtI3hGNl0gfCBbI3hGOC0jeDJGRl0gfCBbI3gzNzAtI3gzN0RdIHwgWyN4MzdGLSN4MUZGRl0gfCBbI3gyMDBDLSN4MjAwRF0gfCBbI3gyMDcwLSN4MjE4Rl0gfCBbI3gyQzAwLSN4MkZFRl0gfCBbI3gzMDAxLSN4RDdGRl0gfCBbI3hGOTAwLSN4RkRDRl0gfCBbI3hGREYwLSN4RkZGRF0gfCBbI3gxMDAwMC0jeEVGRkZGXVxuLy9bNGFdICAgXHROYW1lQ2hhclx0ICAgOjo9ICAgXHROYW1lU3RhcnRDaGFyIHwgXCItXCIgfCBcIi5cIiB8IFswLTldIHwgI3hCNyB8IFsjeDAzMDAtI3gwMzZGXSB8IFsjeDIwM0YtI3gyMDQwXVxuLy9bNV0gICBcdE5hbWVcdCAgIDo6PSAgIFx0TmFtZVN0YXJ0Q2hhciAoTmFtZUNoYXIpKlxudmFyIG5hbWVTdGFydENoYXIgPSAvW0EtWl9hLXpcXHhDMC1cXHhENlxceEQ4LVxceEY2XFx1MDBGOC1cXHUwMkZGXFx1MDM3MC1cXHUwMzdEXFx1MDM3Ri1cXHUxRkZGXFx1MjAwQy1cXHUyMDBEXFx1MjA3MC1cXHUyMThGXFx1MkMwMC1cXHUyRkVGXFx1MzAwMS1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkZEXS8vL1xcdTEwMDAwLVxcdUVGRkZGXG52YXIgbmFtZUNoYXIgPSBuZXcgUmVnRXhwKFwiW1xcXFwtXFxcXC4wLTlcIituYW1lU3RhcnRDaGFyLnNvdXJjZS5zbGljZSgxLC0xKStcIlxcXFx1MDBCN1xcXFx1MDMwMC1cXFxcdTAzNkZcXFxcdTIwM0YtXFxcXHUyMDQwXVwiKTtcbnZhciB0YWdOYW1lUGF0dGVybiA9IG5ldyBSZWdFeHAoJ14nK25hbWVTdGFydENoYXIuc291cmNlK25hbWVDaGFyLnNvdXJjZSsnKig/OlxcOicrbmFtZVN0YXJ0Q2hhci5zb3VyY2UrbmFtZUNoYXIuc291cmNlKycqKT8kJyk7XG4vL3ZhciB0YWdOYW1lUGF0dGVybiA9IC9eW2EtekEtWl9dW1xcd1xcLVxcLl0qKD86XFw6W2EtekEtWl9dW1xcd1xcLVxcLl0qKT8kL1xuLy92YXIgaGFuZGxlcnMgPSAncmVzb2x2ZUVudGl0eSxnZXRFeHRlcm5hbFN1YnNldCxjaGFyYWN0ZXJzLGVuZERvY3VtZW50LGVuZEVsZW1lbnQsZW5kUHJlZml4TWFwcGluZyxpZ25vcmFibGVXaGl0ZXNwYWNlLHByb2Nlc3NpbmdJbnN0cnVjdGlvbixzZXREb2N1bWVudExvY2F0b3Isc2tpcHBlZEVudGl0eSxzdGFydERvY3VtZW50LHN0YXJ0RWxlbWVudCxzdGFydFByZWZpeE1hcHBpbmcsbm90YXRpb25EZWNsLHVucGFyc2VkRW50aXR5RGVjbCxlcnJvcixmYXRhbEVycm9yLHdhcm5pbmcsYXR0cmlidXRlRGVjbCxlbGVtZW50RGVjbCxleHRlcm5hbEVudGl0eURlY2wsaW50ZXJuYWxFbnRpdHlEZWNsLGNvbW1lbnQsZW5kQ0RBVEEsZW5kRFRELGVuZEVudGl0eSxzdGFydENEQVRBLHN0YXJ0RFRELHN0YXJ0RW50aXR5Jy5zcGxpdCgnLCcpXG5cbi8vU19UQUcsXHRTX0FUVFIsXHRTX0VRLFx0U19BVFRSX05PUVVPVF9WQUxVRVxuLy9TX0FUVFJfU1BBQ0UsXHRTX0FUVFJfRU5ELFx0U19UQUdfU1BBQ0UsIFNfVEFHX0NMT1NFXG52YXIgU19UQUcgPSAwOy8vdGFnIG5hbWUgb2ZmZXJyaW5nXG52YXIgU19BVFRSID0gMTsvL2F0dHIgbmFtZSBvZmZlcnJpbmdcbnZhciBTX0FUVFJfU1BBQ0U9MjsvL2F0dHIgbmFtZSBlbmQgYW5kIHNwYWNlIG9mZmVyXG52YXIgU19FUSA9IDM7Ly89c3BhY2U/XG52YXIgU19BVFRSX05PUVVPVF9WQUxVRSA9IDQ7Ly9hdHRyIHZhbHVlKG5vIHF1b3QgdmFsdWUgb25seSlcbnZhciBTX0FUVFJfRU5EID0gNTsvL2F0dHIgdmFsdWUgZW5kIGFuZCBubyBzcGFjZShxdW90IGVuZClcbnZhciBTX1RBR19TUEFDRSA9IDY7Ly8oYXR0ciB2YWx1ZSBlbmQgfHwgdGFnIGVuZCApICYmIChzcGFjZSBvZmZlcilcbnZhciBTX1RBR19DTE9TRSA9IDc7Ly9jbG9zZWQgZWw8ZWwgLz5cblxuLyoqXG4gKiBDcmVhdGVzIGFuIGVycm9yIHRoYXQgd2lsbCBub3QgYmUgY2F1Z2h0IGJ5IFhNTFJlYWRlciBha2EgdGhlIFNBWCBwYXJzZXIuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2VcbiAqIEBwYXJhbSB7YW55P30gbG9jYXRvciBPcHRpb25hbCwgY2FuIHByb3ZpZGUgZGV0YWlscyBhYm91dCB0aGUgbG9jYXRpb24gaW4gdGhlIHNvdXJjZVxuICogQGNvbnN0cnVjdG9yXG4gKi9cbmZ1bmN0aW9uIFBhcnNlRXJyb3IobWVzc2FnZSwgbG9jYXRvcikge1xuXHR0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlXG5cdHRoaXMubG9jYXRvciA9IGxvY2F0b3Jcblx0aWYoRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UpIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKHRoaXMsIFBhcnNlRXJyb3IpO1xufVxuUGFyc2VFcnJvci5wcm90b3R5cGUgPSBuZXcgRXJyb3IoKTtcblBhcnNlRXJyb3IucHJvdG90eXBlLm5hbWUgPSBQYXJzZUVycm9yLm5hbWVcblxuZnVuY3Rpb24gWE1MUmVhZGVyKCl7XG5cbn1cblxuWE1MUmVhZGVyLnByb3RvdHlwZSA9IHtcblx0cGFyc2U6ZnVuY3Rpb24oc291cmNlLGRlZmF1bHROU01hcCxlbnRpdHlNYXApe1xuXHRcdHZhciBkb21CdWlsZGVyID0gdGhpcy5kb21CdWlsZGVyO1xuXHRcdGRvbUJ1aWxkZXIuc3RhcnREb2N1bWVudCgpO1xuXHRcdF9jb3B5KGRlZmF1bHROU01hcCAsZGVmYXVsdE5TTWFwID0ge30pXG5cdFx0cGFyc2Uoc291cmNlLGRlZmF1bHROU01hcCxlbnRpdHlNYXAsXG5cdFx0XHRcdGRvbUJ1aWxkZXIsdGhpcy5lcnJvckhhbmRsZXIpO1xuXHRcdGRvbUJ1aWxkZXIuZW5kRG9jdW1lbnQoKTtcblx0fVxufVxuZnVuY3Rpb24gcGFyc2Uoc291cmNlLGRlZmF1bHROU01hcENvcHksZW50aXR5TWFwLGRvbUJ1aWxkZXIsZXJyb3JIYW5kbGVyKXtcblx0ZnVuY3Rpb24gZml4ZWRGcm9tQ2hhckNvZGUoY29kZSkge1xuXHRcdC8vIFN0cmluZy5wcm90b3R5cGUuZnJvbUNoYXJDb2RlIGRvZXMgbm90IHN1cHBvcnRzXG5cdFx0Ly8gPiAyIGJ5dGVzIHVuaWNvZGUgY2hhcnMgZGlyZWN0bHlcblx0XHRpZiAoY29kZSA+IDB4ZmZmZikge1xuXHRcdFx0Y29kZSAtPSAweDEwMDAwO1xuXHRcdFx0dmFyIHN1cnJvZ2F0ZTEgPSAweGQ4MDAgKyAoY29kZSA+PiAxMClcblx0XHRcdFx0LCBzdXJyb2dhdGUyID0gMHhkYzAwICsgKGNvZGUgJiAweDNmZik7XG5cblx0XHRcdHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKHN1cnJvZ2F0ZTEsIHN1cnJvZ2F0ZTIpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKTtcblx0XHR9XG5cdH1cblx0ZnVuY3Rpb24gZW50aXR5UmVwbGFjZXIoYSl7XG5cdFx0dmFyIGsgPSBhLnNsaWNlKDEsLTEpO1xuXHRcdGlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChlbnRpdHlNYXAsIGspKSB7XG5cdFx0XHRyZXR1cm4gZW50aXR5TWFwW2tdO1xuXHRcdH1lbHNlIGlmKGsuY2hhckF0KDApID09PSAnIycpe1xuXHRcdFx0cmV0dXJuIGZpeGVkRnJvbUNoYXJDb2RlKHBhcnNlSW50KGsuc3Vic3RyKDEpLnJlcGxhY2UoJ3gnLCcweCcpKSlcblx0XHR9ZWxzZXtcblx0XHRcdGVycm9ySGFuZGxlci5lcnJvcignZW50aXR5IG5vdCBmb3VuZDonK2EpO1xuXHRcdFx0cmV0dXJuIGE7XG5cdFx0fVxuXHR9XG5cdGZ1bmN0aW9uIGFwcGVuZFRleHQoZW5kKXsvL2hhcyBzb21lIGJ1Z3Ncblx0XHRpZihlbmQ+c3RhcnQpe1xuXHRcdFx0dmFyIHh0ID0gc291cmNlLnN1YnN0cmluZyhzdGFydCxlbmQpLnJlcGxhY2UoLyYjP1xcdys7L2csZW50aXR5UmVwbGFjZXIpO1xuXHRcdFx0bG9jYXRvciYmcG9zaXRpb24oc3RhcnQpO1xuXHRcdFx0ZG9tQnVpbGRlci5jaGFyYWN0ZXJzKHh0LDAsZW5kLXN0YXJ0KTtcblx0XHRcdHN0YXJ0ID0gZW5kXG5cdFx0fVxuXHR9XG5cdGZ1bmN0aW9uIHBvc2l0aW9uKHAsbSl7XG5cdFx0d2hpbGUocD49bGluZUVuZCAmJiAobSA9IGxpbmVQYXR0ZXJuLmV4ZWMoc291cmNlKSkpe1xuXHRcdFx0bGluZVN0YXJ0ID0gbS5pbmRleDtcblx0XHRcdGxpbmVFbmQgPSBsaW5lU3RhcnQgKyBtWzBdLmxlbmd0aDtcblx0XHRcdGxvY2F0b3IubGluZU51bWJlcisrO1xuXHRcdFx0Ly9jb25zb2xlLmxvZygnbGluZSsrOicsbG9jYXRvcixzdGFydFBvcyxlbmRQb3MpXG5cdFx0fVxuXHRcdGxvY2F0b3IuY29sdW1uTnVtYmVyID0gcC1saW5lU3RhcnQrMTtcblx0fVxuXHR2YXIgbGluZVN0YXJ0ID0gMDtcblx0dmFyIGxpbmVFbmQgPSAwO1xuXHR2YXIgbGluZVBhdHRlcm4gPSAvLiooPzpcXHJcXG4/fFxcbil8LiokL2dcblx0dmFyIGxvY2F0b3IgPSBkb21CdWlsZGVyLmxvY2F0b3I7XG5cblx0dmFyIHBhcnNlU3RhY2sgPSBbe2N1cnJlbnROU01hcDpkZWZhdWx0TlNNYXBDb3B5fV1cblx0dmFyIGNsb3NlTWFwID0ge307XG5cdHZhciBzdGFydCA9IDA7XG5cdHdoaWxlKHRydWUpe1xuXHRcdHRyeXtcblx0XHRcdHZhciB0YWdTdGFydCA9IHNvdXJjZS5pbmRleE9mKCc8JyxzdGFydCk7XG5cdFx0XHRpZih0YWdTdGFydDwwKXtcblx0XHRcdFx0aWYoIXNvdXJjZS5zdWJzdHIoc3RhcnQpLm1hdGNoKC9eXFxzKiQvKSl7XG5cdFx0XHRcdFx0dmFyIGRvYyA9IGRvbUJ1aWxkZXIuZG9jO1xuXHQgICAgXHRcdFx0dmFyIHRleHQgPSBkb2MuY3JlYXRlVGV4dE5vZGUoc291cmNlLnN1YnN0cihzdGFydCkpO1xuXHQgICAgXHRcdFx0ZG9jLmFwcGVuZENoaWxkKHRleHQpO1xuXHQgICAgXHRcdFx0ZG9tQnVpbGRlci5jdXJyZW50RWxlbWVudCA9IHRleHQ7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0aWYodGFnU3RhcnQ+c3RhcnQpe1xuXHRcdFx0XHRhcHBlbmRUZXh0KHRhZ1N0YXJ0KTtcblx0XHRcdH1cblx0XHRcdHN3aXRjaChzb3VyY2UuY2hhckF0KHRhZ1N0YXJ0KzEpKXtcblx0XHRcdGNhc2UgJy8nOlxuXHRcdFx0XHR2YXIgZW5kID0gc291cmNlLmluZGV4T2YoJz4nLHRhZ1N0YXJ0KzMpO1xuXHRcdFx0XHR2YXIgdGFnTmFtZSA9IHNvdXJjZS5zdWJzdHJpbmcodGFnU3RhcnQgKyAyLCBlbmQpLnJlcGxhY2UoL1sgXFx0XFxuXFxyXSskL2csICcnKTtcblx0XHRcdFx0dmFyIGNvbmZpZyA9IHBhcnNlU3RhY2sucG9wKCk7XG5cdFx0XHRcdGlmKGVuZDwwKXtcblxuXHQgICAgICAgIFx0XHR0YWdOYW1lID0gc291cmNlLnN1YnN0cmluZyh0YWdTdGFydCsyKS5yZXBsYWNlKC9bXFxzPF0uKi8sJycpO1xuXHQgICAgICAgIFx0XHRlcnJvckhhbmRsZXIuZXJyb3IoXCJlbmQgdGFnIG5hbWU6IFwiK3RhZ05hbWUrJyBpcyBub3QgY29tcGxldGU6Jytjb25maWcudGFnTmFtZSk7XG5cdCAgICAgICAgXHRcdGVuZCA9IHRhZ1N0YXJ0KzErdGFnTmFtZS5sZW5ndGg7XG5cdCAgICAgICAgXHR9ZWxzZSBpZih0YWdOYW1lLm1hdGNoKC9cXHM8Lykpe1xuXHQgICAgICAgIFx0XHR0YWdOYW1lID0gdGFnTmFtZS5yZXBsYWNlKC9bXFxzPF0uKi8sJycpO1xuXHQgICAgICAgIFx0XHRlcnJvckhhbmRsZXIuZXJyb3IoXCJlbmQgdGFnIG5hbWU6IFwiK3RhZ05hbWUrJyBtYXliZSBub3QgY29tcGxldGUnKTtcblx0ICAgICAgICBcdFx0ZW5kID0gdGFnU3RhcnQrMSt0YWdOYW1lLmxlbmd0aDtcblx0XHRcdFx0fVxuXHRcdFx0XHR2YXIgbG9jYWxOU01hcCA9IGNvbmZpZy5sb2NhbE5TTWFwO1xuXHRcdFx0XHR2YXIgZW5kTWF0Y2ggPSBjb25maWcudGFnTmFtZSA9PSB0YWdOYW1lO1xuXHRcdFx0XHR2YXIgZW5kSWdub3JlQ2FzZU1hY2ggPSBlbmRNYXRjaCB8fCBjb25maWcudGFnTmFtZSYmY29uZmlnLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PSB0YWdOYW1lLnRvTG93ZXJDYXNlKClcblx0XHQgICAgICAgIGlmKGVuZElnbm9yZUNhc2VNYWNoKXtcblx0XHQgICAgICAgIFx0ZG9tQnVpbGRlci5lbmRFbGVtZW50KGNvbmZpZy51cmksY29uZmlnLmxvY2FsTmFtZSx0YWdOYW1lKTtcblx0XHRcdFx0XHRpZihsb2NhbE5TTWFwKXtcblx0XHRcdFx0XHRcdGZvcih2YXIgcHJlZml4IGluIGxvY2FsTlNNYXApe1xuXHRcdFx0XHRcdFx0XHRkb21CdWlsZGVyLmVuZFByZWZpeE1hcHBpbmcocHJlZml4KSA7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmKCFlbmRNYXRjaCl7XG5cdFx0ICAgICAgICAgICAgXHRlcnJvckhhbmRsZXIuZmF0YWxFcnJvcihcImVuZCB0YWcgbmFtZTogXCIrdGFnTmFtZSsnIGlzIG5vdCBtYXRjaCB0aGUgY3VycmVudCBzdGFydCB0YWdOYW1lOicrY29uZmlnLnRhZ05hbWUgKTsgLy8gTm8ga25vd24gdGVzdCBjYXNlXG5cdFx0XHRcdFx0fVxuXHRcdCAgICAgICAgfWVsc2V7XG5cdFx0ICAgICAgICBcdHBhcnNlU3RhY2sucHVzaChjb25maWcpXG5cdFx0ICAgICAgICB9XG5cblx0XHRcdFx0ZW5kKys7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHQvLyBlbmQgZWxtZW50XG5cdFx0XHRjYXNlICc/JzovLyA8Py4uLj8+XG5cdFx0XHRcdGxvY2F0b3ImJnBvc2l0aW9uKHRhZ1N0YXJ0KTtcblx0XHRcdFx0ZW5kID0gcGFyc2VJbnN0cnVjdGlvbihzb3VyY2UsdGFnU3RhcnQsZG9tQnVpbGRlcik7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAnISc6Ly8gPCFkb2N0eXBlLDwhW0NEQVRBLDwhLS1cblx0XHRcdFx0bG9jYXRvciYmcG9zaXRpb24odGFnU3RhcnQpO1xuXHRcdFx0XHRlbmQgPSBwYXJzZURDQyhzb3VyY2UsdGFnU3RhcnQsZG9tQnVpbGRlcixlcnJvckhhbmRsZXIpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdGxvY2F0b3ImJnBvc2l0aW9uKHRhZ1N0YXJ0KTtcblx0XHRcdFx0dmFyIGVsID0gbmV3IEVsZW1lbnRBdHRyaWJ1dGVzKCk7XG5cdFx0XHRcdHZhciBjdXJyZW50TlNNYXAgPSBwYXJzZVN0YWNrW3BhcnNlU3RhY2subGVuZ3RoLTFdLmN1cnJlbnROU01hcDtcblx0XHRcdFx0Ly9lbFN0YXJ0RW5kXG5cdFx0XHRcdHZhciBlbmQgPSBwYXJzZUVsZW1lbnRTdGFydFBhcnQoc291cmNlLHRhZ1N0YXJ0LGVsLGN1cnJlbnROU01hcCxlbnRpdHlSZXBsYWNlcixlcnJvckhhbmRsZXIpO1xuXHRcdFx0XHR2YXIgbGVuID0gZWwubGVuZ3RoO1xuXG5cblx0XHRcdFx0aWYoIWVsLmNsb3NlZCAmJiBmaXhTZWxmQ2xvc2VkKHNvdXJjZSxlbmQsZWwudGFnTmFtZSxjbG9zZU1hcCkpe1xuXHRcdFx0XHRcdGVsLmNsb3NlZCA9IHRydWU7XG5cdFx0XHRcdFx0aWYoIWVudGl0eU1hcC5uYnNwKXtcblx0XHRcdFx0XHRcdGVycm9ySGFuZGxlci53YXJuaW5nKCd1bmNsb3NlZCB4bWwgYXR0cmlidXRlJyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdGlmKGxvY2F0b3IgJiYgbGVuKXtcblx0XHRcdFx0XHR2YXIgbG9jYXRvcjIgPSBjb3B5TG9jYXRvcihsb2NhdG9yLHt9KTtcblx0XHRcdFx0XHQvL3RyeXsvL2F0dHJpYnV0ZSBwb3NpdGlvbiBmaXhlZFxuXHRcdFx0XHRcdGZvcih2YXIgaSA9IDA7aTxsZW47aSsrKXtcblx0XHRcdFx0XHRcdHZhciBhID0gZWxbaV07XG5cdFx0XHRcdFx0XHRwb3NpdGlvbihhLm9mZnNldCk7XG5cdFx0XHRcdFx0XHRhLmxvY2F0b3IgPSBjb3B5TG9jYXRvcihsb2NhdG9yLHt9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0ZG9tQnVpbGRlci5sb2NhdG9yID0gbG9jYXRvcjJcblx0XHRcdFx0XHRpZihhcHBlbmRFbGVtZW50KGVsLGRvbUJ1aWxkZXIsY3VycmVudE5TTWFwKSl7XG5cdFx0XHRcdFx0XHRwYXJzZVN0YWNrLnB1c2goZWwpXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGRvbUJ1aWxkZXIubG9jYXRvciA9IGxvY2F0b3I7XG5cdFx0XHRcdH1lbHNle1xuXHRcdFx0XHRcdGlmKGFwcGVuZEVsZW1lbnQoZWwsZG9tQnVpbGRlcixjdXJyZW50TlNNYXApKXtcblx0XHRcdFx0XHRcdHBhcnNlU3RhY2sucHVzaChlbClcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoTkFNRVNQQUNFLmlzSFRNTChlbC51cmkpICYmICFlbC5jbG9zZWQpIHtcblx0XHRcdFx0XHRlbmQgPSBwYXJzZUh0bWxTcGVjaWFsQ29udGVudChzb3VyY2UsZW5kLGVsLnRhZ05hbWUsZW50aXR5UmVwbGFjZXIsZG9tQnVpbGRlcilcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRlbmQrKztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1jYXRjaChlKXtcblx0XHRcdGlmIChlIGluc3RhbmNlb2YgUGFyc2VFcnJvcikge1xuXHRcdFx0XHR0aHJvdyBlO1xuXHRcdFx0fVxuXHRcdFx0ZXJyb3JIYW5kbGVyLmVycm9yKCdlbGVtZW50IHBhcnNlIGVycm9yOiAnK2UpXG5cdFx0XHRlbmQgPSAtMTtcblx0XHR9XG5cdFx0aWYoZW5kPnN0YXJ0KXtcblx0XHRcdHN0YXJ0ID0gZW5kO1xuXHRcdH1lbHNle1xuXHRcdFx0Ly9UT0RPOiDov5nph4zmnInlj6/og71zYXjlm57pgIDvvIzmnInkvY3nva7plJnor6/po47pmalcblx0XHRcdGFwcGVuZFRleHQoTWF0aC5tYXgodGFnU3RhcnQsc3RhcnQpKzEpO1xuXHRcdH1cblx0fVxufVxuZnVuY3Rpb24gY29weUxvY2F0b3IoZix0KXtcblx0dC5saW5lTnVtYmVyID0gZi5saW5lTnVtYmVyO1xuXHR0LmNvbHVtbk51bWJlciA9IGYuY29sdW1uTnVtYmVyO1xuXHRyZXR1cm4gdDtcbn1cblxuLyoqXG4gKiBAc2VlICNhcHBlbmRFbGVtZW50KHNvdXJjZSxlbFN0YXJ0RW5kLGVsLHNlbGZDbG9zZWQsZW50aXR5UmVwbGFjZXIsZG9tQnVpbGRlcixwYXJzZVN0YWNrKTtcbiAqIEByZXR1cm4gZW5kIG9mIHRoZSBlbGVtZW50U3RhcnRQYXJ0KGVuZCBvZiBlbGVtZW50RW5kUGFydCBmb3Igc2VsZkNsb3NlZCBlbClcbiAqL1xuZnVuY3Rpb24gcGFyc2VFbGVtZW50U3RhcnRQYXJ0KHNvdXJjZSxzdGFydCxlbCxjdXJyZW50TlNNYXAsZW50aXR5UmVwbGFjZXIsZXJyb3JIYW5kbGVyKXtcblxuXHQvKipcblx0ICogQHBhcmFtIHtzdHJpbmd9IHFuYW1lXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZVxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhcnRJbmRleFxuXHQgKi9cblx0ZnVuY3Rpb24gYWRkQXR0cmlidXRlKHFuYW1lLCB2YWx1ZSwgc3RhcnRJbmRleCkge1xuXHRcdGlmIChlbC5hdHRyaWJ1dGVOYW1lcy5oYXNPd25Qcm9wZXJ0eShxbmFtZSkpIHtcblx0XHRcdGVycm9ySGFuZGxlci5mYXRhbEVycm9yKCdBdHRyaWJ1dGUgJyArIHFuYW1lICsgJyByZWRlZmluZWQnKVxuXHRcdH1cblx0XHRlbC5hZGRWYWx1ZShcblx0XHRcdHFuYW1lLFxuXHRcdFx0Ly8gQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIveG1sLyNBVk5vcm1hbGl6ZVxuXHRcdFx0Ly8gc2luY2UgdGhlIHhtbGRvbSBzYXggcGFyc2VyIGRvZXMgbm90IFwiaW50ZXJwcmV0XCIgRFREIHRoZSBmb2xsb3dpbmcgaXMgbm90IGltcGxlbWVudGVkOlxuXHRcdFx0Ly8gLSByZWN1cnNpdmUgcmVwbGFjZW1lbnQgb2YgKERURCkgZW50aXR5IHJlZmVyZW5jZXNcblx0XHRcdC8vIC0gdHJpbW1pbmcgYW5kIGNvbGxhcHNpbmcgbXVsdGlwbGUgc3BhY2VzIGludG8gYSBzaW5nbGUgb25lIGZvciBhdHRyaWJ1dGVzIHRoYXQgYXJlIG5vdCBvZiB0eXBlIENEQVRBXG5cdFx0XHR2YWx1ZS5yZXBsYWNlKC9bXFx0XFxuXFxyXS9nLCAnICcpLnJlcGxhY2UoLyYjP1xcdys7L2csIGVudGl0eVJlcGxhY2VyKSxcblx0XHRcdHN0YXJ0SW5kZXhcblx0XHQpXG5cdH1cblx0dmFyIGF0dHJOYW1lO1xuXHR2YXIgdmFsdWU7XG5cdHZhciBwID0gKytzdGFydDtcblx0dmFyIHMgPSBTX1RBRzsvL3N0YXR1c1xuXHR3aGlsZSh0cnVlKXtcblx0XHR2YXIgYyA9IHNvdXJjZS5jaGFyQXQocCk7XG5cdFx0c3dpdGNoKGMpe1xuXHRcdGNhc2UgJz0nOlxuXHRcdFx0aWYocyA9PT0gU19BVFRSKXsvL2F0dHJOYW1lXG5cdFx0XHRcdGF0dHJOYW1lID0gc291cmNlLnNsaWNlKHN0YXJ0LHApO1xuXHRcdFx0XHRzID0gU19FUTtcblx0XHRcdH1lbHNlIGlmKHMgPT09IFNfQVRUUl9TUEFDRSl7XG5cdFx0XHRcdHMgPSBTX0VRO1xuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdC8vZmF0YWxFcnJvcjogZXF1YWwgbXVzdCBhZnRlciBhdHRyTmFtZSBvciBzcGFjZSBhZnRlciBhdHRyTmFtZVxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ2F0dHJpYnV0ZSBlcXVhbCBtdXN0IGFmdGVyIGF0dHJOYW1lJyk7IC8vIE5vIGtub3duIHRlc3QgY2FzZVxuXHRcdFx0fVxuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSAnXFwnJzpcblx0XHRjYXNlICdcIic6XG5cdFx0XHRpZihzID09PSBTX0VRIHx8IHMgPT09IFNfQVRUUiAvL3x8IHMgPT0gU19BVFRSX1NQQUNFXG5cdFx0XHRcdCl7Ly9lcXVhbFxuXHRcdFx0XHRpZihzID09PSBTX0FUVFIpe1xuXHRcdFx0XHRcdGVycm9ySGFuZGxlci53YXJuaW5nKCdhdHRyaWJ1dGUgdmFsdWUgbXVzdCBhZnRlciBcIj1cIicpXG5cdFx0XHRcdFx0YXR0ck5hbWUgPSBzb3VyY2Uuc2xpY2Uoc3RhcnQscClcblx0XHRcdFx0fVxuXHRcdFx0XHRzdGFydCA9IHArMTtcblx0XHRcdFx0cCA9IHNvdXJjZS5pbmRleE9mKGMsc3RhcnQpXG5cdFx0XHRcdGlmKHA+MCl7XG5cdFx0XHRcdFx0dmFsdWUgPSBzb3VyY2Uuc2xpY2Uoc3RhcnQsIHApO1xuXHRcdFx0XHRcdGFkZEF0dHJpYnV0ZShhdHRyTmFtZSwgdmFsdWUsIHN0YXJ0LTEpO1xuXHRcdFx0XHRcdHMgPSBTX0FUVFJfRU5EO1xuXHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHQvL2ZhdGFsRXJyb3I6IG5vIGVuZCBxdW90IG1hdGNoXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCdhdHRyaWJ1dGUgdmFsdWUgbm8gZW5kIFxcJycrYysnXFwnIG1hdGNoJyk7XG5cdFx0XHRcdH1cblx0XHRcdH1lbHNlIGlmKHMgPT0gU19BVFRSX05PUVVPVF9WQUxVRSl7XG5cdFx0XHRcdHZhbHVlID0gc291cmNlLnNsaWNlKHN0YXJ0LCBwKTtcblx0XHRcdFx0YWRkQXR0cmlidXRlKGF0dHJOYW1lLCB2YWx1ZSwgc3RhcnQpO1xuXHRcdFx0XHRlcnJvckhhbmRsZXIud2FybmluZygnYXR0cmlidXRlIFwiJythdHRyTmFtZSsnXCIgbWlzc2VkIHN0YXJ0IHF1b3QoJytjKycpISEnKTtcblx0XHRcdFx0c3RhcnQgPSBwKzE7XG5cdFx0XHRcdHMgPSBTX0FUVFJfRU5EXG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0Ly9mYXRhbEVycm9yOiBubyBlcXVhbCBiZWZvcmVcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCdhdHRyaWJ1dGUgdmFsdWUgbXVzdCBhZnRlciBcIj1cIicpOyAvLyBObyBrbm93biB0ZXN0IGNhc2Vcblx0XHRcdH1cblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgJy8nOlxuXHRcdFx0c3dpdGNoKHMpe1xuXHRcdFx0Y2FzZSBTX1RBRzpcblx0XHRcdFx0ZWwuc2V0VGFnTmFtZShzb3VyY2Uuc2xpY2Uoc3RhcnQscCkpO1xuXHRcdFx0Y2FzZSBTX0FUVFJfRU5EOlxuXHRcdFx0Y2FzZSBTX1RBR19TUEFDRTpcblx0XHRcdGNhc2UgU19UQUdfQ0xPU0U6XG5cdFx0XHRcdHMgPVNfVEFHX0NMT1NFO1xuXHRcdFx0XHRlbC5jbG9zZWQgPSB0cnVlO1xuXHRcdFx0Y2FzZSBTX0FUVFJfTk9RVU9UX1ZBTFVFOlxuXHRcdFx0Y2FzZSBTX0FUVFI6XG5cdFx0XHRjYXNlIFNfQVRUUl9TUEFDRTpcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHQvL2Nhc2UgU19FUTpcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcImF0dHJpYnV0ZSBpbnZhbGlkIGNsb3NlIGNoYXIoJy8nKVwiKSAvLyBObyBrbm93biB0ZXN0IGNhc2Vcblx0XHRcdH1cblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgJyc6Ly9lbmQgZG9jdW1lbnRcblx0XHRcdGVycm9ySGFuZGxlci5lcnJvcigndW5leHBlY3RlZCBlbmQgb2YgaW5wdXQnKTtcblx0XHRcdGlmKHMgPT0gU19UQUcpe1xuXHRcdFx0XHRlbC5zZXRUYWdOYW1lKHNvdXJjZS5zbGljZShzdGFydCxwKSk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcDtcblx0XHRjYXNlICc+Jzpcblx0XHRcdHN3aXRjaChzKXtcblx0XHRcdGNhc2UgU19UQUc6XG5cdFx0XHRcdGVsLnNldFRhZ05hbWUoc291cmNlLnNsaWNlKHN0YXJ0LHApKTtcblx0XHRcdGNhc2UgU19BVFRSX0VORDpcblx0XHRcdGNhc2UgU19UQUdfU1BBQ0U6XG5cdFx0XHRjYXNlIFNfVEFHX0NMT1NFOlxuXHRcdFx0XHRicmVhazsvL25vcm1hbFxuXHRcdFx0Y2FzZSBTX0FUVFJfTk9RVU9UX1ZBTFVFOi8vQ29tcGF0aWJsZSBzdGF0ZVxuXHRcdFx0Y2FzZSBTX0FUVFI6XG5cdFx0XHRcdHZhbHVlID0gc291cmNlLnNsaWNlKHN0YXJ0LHApO1xuXHRcdFx0XHRpZih2YWx1ZS5zbGljZSgtMSkgPT09ICcvJyl7XG5cdFx0XHRcdFx0ZWwuY2xvc2VkICA9IHRydWU7XG5cdFx0XHRcdFx0dmFsdWUgPSB2YWx1ZS5zbGljZSgwLC0xKVxuXHRcdFx0XHR9XG5cdFx0XHRjYXNlIFNfQVRUUl9TUEFDRTpcblx0XHRcdFx0aWYocyA9PT0gU19BVFRSX1NQQUNFKXtcblx0XHRcdFx0XHR2YWx1ZSA9IGF0dHJOYW1lO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmKHMgPT0gU19BVFRSX05PUVVPVF9WQUxVRSl7XG5cdFx0XHRcdFx0ZXJyb3JIYW5kbGVyLndhcm5pbmcoJ2F0dHJpYnV0ZSBcIicrdmFsdWUrJ1wiIG1pc3NlZCBxdW90KFwiKSEnKTtcblx0XHRcdFx0XHRhZGRBdHRyaWJ1dGUoYXR0ck5hbWUsIHZhbHVlLCBzdGFydClcblx0XHRcdFx0fWVsc2V7XG5cdFx0XHRcdFx0aWYoIU5BTUVTUEFDRS5pc0hUTUwoY3VycmVudE5TTWFwWycnXSkgfHwgIXZhbHVlLm1hdGNoKC9eKD86ZGlzYWJsZWR8Y2hlY2tlZHxzZWxlY3RlZCkkL2kpKXtcblx0XHRcdFx0XHRcdGVycm9ySGFuZGxlci53YXJuaW5nKCdhdHRyaWJ1dGUgXCInK3ZhbHVlKydcIiBtaXNzZWQgdmFsdWUhISBcIicrdmFsdWUrJ1wiIGluc3RlYWQhIScpXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGFkZEF0dHJpYnV0ZSh2YWx1ZSwgdmFsdWUsIHN0YXJ0KVxuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSBTX0VROlxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ2F0dHJpYnV0ZSB2YWx1ZSBtaXNzZWQhIScpO1xuXHRcdFx0fVxuLy9cdFx0XHRjb25zb2xlLmxvZyh0YWdOYW1lLHRhZ05hbWVQYXR0ZXJuLHRhZ05hbWVQYXR0ZXJuLnRlc3QodGFnTmFtZSkpXG5cdFx0XHRyZXR1cm4gcDtcblx0XHQvKnhtbCBzcGFjZSAnXFx4MjAnIHwgI3g5IHwgI3hEIHwgI3hBOyAqL1xuXHRcdGNhc2UgJ1xcdTAwODAnOlxuXHRcdFx0YyA9ICcgJztcblx0XHRkZWZhdWx0OlxuXHRcdFx0aWYoYzw9ICcgJyl7Ly9zcGFjZVxuXHRcdFx0XHRzd2l0Y2gocyl7XG5cdFx0XHRcdGNhc2UgU19UQUc6XG5cdFx0XHRcdFx0ZWwuc2V0VGFnTmFtZShzb3VyY2Uuc2xpY2Uoc3RhcnQscCkpOy8vdGFnTmFtZVxuXHRcdFx0XHRcdHMgPSBTX1RBR19TUEFDRTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBTX0FUVFI6XG5cdFx0XHRcdFx0YXR0ck5hbWUgPSBzb3VyY2Uuc2xpY2Uoc3RhcnQscClcblx0XHRcdFx0XHRzID0gU19BVFRSX1NQQUNFO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFNfQVRUUl9OT1FVT1RfVkFMVUU6XG5cdFx0XHRcdFx0dmFyIHZhbHVlID0gc291cmNlLnNsaWNlKHN0YXJ0LCBwKTtcblx0XHRcdFx0XHRlcnJvckhhbmRsZXIud2FybmluZygnYXR0cmlidXRlIFwiJyt2YWx1ZSsnXCIgbWlzc2VkIHF1b3QoXCIpISEnKTtcblx0XHRcdFx0XHRhZGRBdHRyaWJ1dGUoYXR0ck5hbWUsIHZhbHVlLCBzdGFydClcblx0XHRcdFx0Y2FzZSBTX0FUVFJfRU5EOlxuXHRcdFx0XHRcdHMgPSBTX1RBR19TUEFDRTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Ly9jYXNlIFNfVEFHX1NQQUNFOlxuXHRcdFx0XHQvL2Nhc2UgU19FUTpcblx0XHRcdFx0Ly9jYXNlIFNfQVRUUl9TUEFDRTpcblx0XHRcdFx0Ly9cdHZvaWQoKTticmVhaztcblx0XHRcdFx0Ly9jYXNlIFNfVEFHX0NMT1NFOlxuXHRcdFx0XHRcdC8vaWdub3JlIHdhcm5pbmdcblx0XHRcdFx0fVxuXHRcdFx0fWVsc2V7Ly9ub3Qgc3BhY2Vcbi8vU19UQUcsXHRTX0FUVFIsXHRTX0VRLFx0U19BVFRSX05PUVVPVF9WQUxVRVxuLy9TX0FUVFJfU1BBQ0UsXHRTX0FUVFJfRU5ELFx0U19UQUdfU1BBQ0UsIFNfVEFHX0NMT1NFXG5cdFx0XHRcdHN3aXRjaChzKXtcblx0XHRcdFx0Ly9jYXNlIFNfVEFHOnZvaWQoKTticmVhaztcblx0XHRcdFx0Ly9jYXNlIFNfQVRUUjp2b2lkKCk7YnJlYWs7XG5cdFx0XHRcdC8vY2FzZSBTX0FUVFJfTk9RVU9UX1ZBTFVFOnZvaWQoKTticmVhaztcblx0XHRcdFx0Y2FzZSBTX0FUVFJfU1BBQ0U6XG5cdFx0XHRcdFx0dmFyIHRhZ05hbWUgPSAgZWwudGFnTmFtZTtcblx0XHRcdFx0XHRpZiAoIU5BTUVTUEFDRS5pc0hUTUwoY3VycmVudE5TTWFwWycnXSkgfHwgIWF0dHJOYW1lLm1hdGNoKC9eKD86ZGlzYWJsZWR8Y2hlY2tlZHxzZWxlY3RlZCkkL2kpKSB7XG5cdFx0XHRcdFx0XHRlcnJvckhhbmRsZXIud2FybmluZygnYXR0cmlidXRlIFwiJythdHRyTmFtZSsnXCIgbWlzc2VkIHZhbHVlISEgXCInK2F0dHJOYW1lKydcIiBpbnN0ZWFkMiEhJylcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0YWRkQXR0cmlidXRlKGF0dHJOYW1lLCBhdHRyTmFtZSwgc3RhcnQpO1xuXHRcdFx0XHRcdHN0YXJ0ID0gcDtcblx0XHRcdFx0XHRzID0gU19BVFRSO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFNfQVRUUl9FTkQ6XG5cdFx0XHRcdFx0ZXJyb3JIYW5kbGVyLndhcm5pbmcoJ2F0dHJpYnV0ZSBzcGFjZSBpcyByZXF1aXJlZFwiJythdHRyTmFtZSsnXCIhIScpXG5cdFx0XHRcdGNhc2UgU19UQUdfU1BBQ0U6XG5cdFx0XHRcdFx0cyA9IFNfQVRUUjtcblx0XHRcdFx0XHRzdGFydCA9IHA7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgU19FUTpcblx0XHRcdFx0XHRzID0gU19BVFRSX05PUVVPVF9WQUxVRTtcblx0XHRcdFx0XHRzdGFydCA9IHA7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgU19UQUdfQ0xPU0U6XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiZWxlbWVudHMgY2xvc2VkIGNoYXJhY3RlciAnLycgYW5kICc+JyBtdXN0IGJlIGNvbm5lY3RlZCB0b1wiKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0vL2VuZCBvdXRlciBzd2l0Y2hcblx0XHQvL2NvbnNvbGUubG9nKCdwKysnLHApXG5cdFx0cCsrO1xuXHR9XG59XG4vKipcbiAqIEByZXR1cm4gdHJ1ZSBpZiBoYXMgbmV3IG5hbWVzcGFjZSBkZWZpbmVcbiAqL1xuZnVuY3Rpb24gYXBwZW5kRWxlbWVudChlbCxkb21CdWlsZGVyLGN1cnJlbnROU01hcCl7XG5cdHZhciB0YWdOYW1lID0gZWwudGFnTmFtZTtcblx0dmFyIGxvY2FsTlNNYXAgPSBudWxsO1xuXHQvL3ZhciBjdXJyZW50TlNNYXAgPSBwYXJzZVN0YWNrW3BhcnNlU3RhY2subGVuZ3RoLTFdLmN1cnJlbnROU01hcDtcblx0dmFyIGkgPSBlbC5sZW5ndGg7XG5cdHdoaWxlKGktLSl7XG5cdFx0dmFyIGEgPSBlbFtpXTtcblx0XHR2YXIgcU5hbWUgPSBhLnFOYW1lO1xuXHRcdHZhciB2YWx1ZSA9IGEudmFsdWU7XG5cdFx0dmFyIG5zcCA9IHFOYW1lLmluZGV4T2YoJzonKTtcblx0XHRpZihuc3A+MCl7XG5cdFx0XHR2YXIgcHJlZml4ID0gYS5wcmVmaXggPSBxTmFtZS5zbGljZSgwLG5zcCk7XG5cdFx0XHR2YXIgbG9jYWxOYW1lID0gcU5hbWUuc2xpY2UobnNwKzEpO1xuXHRcdFx0dmFyIG5zUHJlZml4ID0gcHJlZml4ID09PSAneG1sbnMnICYmIGxvY2FsTmFtZVxuXHRcdH1lbHNle1xuXHRcdFx0bG9jYWxOYW1lID0gcU5hbWU7XG5cdFx0XHRwcmVmaXggPSBudWxsXG5cdFx0XHRuc1ByZWZpeCA9IHFOYW1lID09PSAneG1sbnMnICYmICcnXG5cdFx0fVxuXHRcdC8vY2FuIG5vdCBzZXQgcHJlZml4LGJlY2F1c2UgcHJlZml4ICE9PSAnJ1xuXHRcdGEubG9jYWxOYW1lID0gbG9jYWxOYW1lIDtcblx0XHQvL3ByZWZpeCA9PSBudWxsIGZvciBubyBucyBwcmVmaXggYXR0cmlidXRlXG5cdFx0aWYobnNQcmVmaXggIT09IGZhbHNlKXsvL2hhY2shIVxuXHRcdFx0aWYobG9jYWxOU01hcCA9PSBudWxsKXtcblx0XHRcdFx0bG9jYWxOU01hcCA9IHt9XG5cdFx0XHRcdC8vY29uc29sZS5sb2coY3VycmVudE5TTWFwLDApXG5cdFx0XHRcdF9jb3B5KGN1cnJlbnROU01hcCxjdXJyZW50TlNNYXA9e30pXG5cdFx0XHRcdC8vY29uc29sZS5sb2coY3VycmVudE5TTWFwLDEpXG5cdFx0XHR9XG5cdFx0XHRjdXJyZW50TlNNYXBbbnNQcmVmaXhdID0gbG9jYWxOU01hcFtuc1ByZWZpeF0gPSB2YWx1ZTtcblx0XHRcdGEudXJpID0gTkFNRVNQQUNFLlhNTE5TXG5cdFx0XHRkb21CdWlsZGVyLnN0YXJ0UHJlZml4TWFwcGluZyhuc1ByZWZpeCwgdmFsdWUpXG5cdFx0fVxuXHR9XG5cdHZhciBpID0gZWwubGVuZ3RoO1xuXHR3aGlsZShpLS0pe1xuXHRcdGEgPSBlbFtpXTtcblx0XHR2YXIgcHJlZml4ID0gYS5wcmVmaXg7XG5cdFx0aWYocHJlZml4KXsvL25vIHByZWZpeCBhdHRyaWJ1dGUgaGFzIG5vIG5hbWVzcGFjZVxuXHRcdFx0aWYocHJlZml4ID09PSAneG1sJyl7XG5cdFx0XHRcdGEudXJpID0gTkFNRVNQQUNFLlhNTDtcblx0XHRcdH1pZihwcmVmaXggIT09ICd4bWxucycpe1xuXHRcdFx0XHRhLnVyaSA9IGN1cnJlbnROU01hcFtwcmVmaXggfHwgJyddXG5cblx0XHRcdFx0Ly97Y29uc29sZS5sb2coJyMjIycrYS5xTmFtZSxkb21CdWlsZGVyLmxvY2F0b3Iuc3lzdGVtSWQrJycsY3VycmVudE5TTWFwLGEudXJpKX1cblx0XHRcdH1cblx0XHR9XG5cdH1cblx0dmFyIG5zcCA9IHRhZ05hbWUuaW5kZXhPZignOicpO1xuXHRpZihuc3A+MCl7XG5cdFx0cHJlZml4ID0gZWwucHJlZml4ID0gdGFnTmFtZS5zbGljZSgwLG5zcCk7XG5cdFx0bG9jYWxOYW1lID0gZWwubG9jYWxOYW1lID0gdGFnTmFtZS5zbGljZShuc3ArMSk7XG5cdH1lbHNle1xuXHRcdHByZWZpeCA9IG51bGw7Ly9pbXBvcnRhbnQhIVxuXHRcdGxvY2FsTmFtZSA9IGVsLmxvY2FsTmFtZSA9IHRhZ05hbWU7XG5cdH1cblx0Ly9ubyBwcmVmaXggZWxlbWVudCBoYXMgZGVmYXVsdCBuYW1lc3BhY2Vcblx0dmFyIG5zID0gZWwudXJpID0gY3VycmVudE5TTWFwW3ByZWZpeCB8fCAnJ107XG5cdGRvbUJ1aWxkZXIuc3RhcnRFbGVtZW50KG5zLGxvY2FsTmFtZSx0YWdOYW1lLGVsKTtcblx0Ly9lbmRQcmVmaXhNYXBwaW5nIGFuZCBzdGFydFByZWZpeE1hcHBpbmcgaGF2ZSBub3QgYW55IGhlbHAgZm9yIGRvbSBidWlsZGVyXG5cdC8vbG9jYWxOU01hcCA9IG51bGxcblx0aWYoZWwuY2xvc2VkKXtcblx0XHRkb21CdWlsZGVyLmVuZEVsZW1lbnQobnMsbG9jYWxOYW1lLHRhZ05hbWUpO1xuXHRcdGlmKGxvY2FsTlNNYXApe1xuXHRcdFx0Zm9yKHByZWZpeCBpbiBsb2NhbE5TTWFwKXtcblx0XHRcdFx0ZG9tQnVpbGRlci5lbmRQcmVmaXhNYXBwaW5nKHByZWZpeClcblx0XHRcdH1cblx0XHR9XG5cdH1lbHNle1xuXHRcdGVsLmN1cnJlbnROU01hcCA9IGN1cnJlbnROU01hcDtcblx0XHRlbC5sb2NhbE5TTWFwID0gbG9jYWxOU01hcDtcblx0XHQvL3BhcnNlU3RhY2sucHVzaChlbCk7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cbn1cbmZ1bmN0aW9uIHBhcnNlSHRtbFNwZWNpYWxDb250ZW50KHNvdXJjZSxlbFN0YXJ0RW5kLHRhZ05hbWUsZW50aXR5UmVwbGFjZXIsZG9tQnVpbGRlcil7XG5cdGlmKC9eKD86c2NyaXB0fHRleHRhcmVhKSQvaS50ZXN0KHRhZ05hbWUpKXtcblx0XHR2YXIgZWxFbmRTdGFydCA9ICBzb3VyY2UuaW5kZXhPZignPC8nK3RhZ05hbWUrJz4nLGVsU3RhcnRFbmQpO1xuXHRcdHZhciB0ZXh0ID0gc291cmNlLnN1YnN0cmluZyhlbFN0YXJ0RW5kKzEsZWxFbmRTdGFydCk7XG5cdFx0aWYoL1smPF0vLnRlc3QodGV4dCkpe1xuXHRcdFx0aWYoL15zY3JpcHQkL2kudGVzdCh0YWdOYW1lKSl7XG5cdFx0XHRcdC8vaWYoIS9cXF1cXF0+Ly50ZXN0KHRleHQpKXtcblx0XHRcdFx0XHQvL2xleEhhbmRsZXIuc3RhcnRDREFUQSgpO1xuXHRcdFx0XHRcdGRvbUJ1aWxkZXIuY2hhcmFjdGVycyh0ZXh0LDAsdGV4dC5sZW5ndGgpO1xuXHRcdFx0XHRcdC8vbGV4SGFuZGxlci5lbmRDREFUQSgpO1xuXHRcdFx0XHRcdHJldHVybiBlbEVuZFN0YXJ0O1xuXHRcdFx0XHQvL31cblx0XHRcdH0vL31lbHNley8vdGV4dCBhcmVhXG5cdFx0XHRcdHRleHQgPSB0ZXh0LnJlcGxhY2UoLyYjP1xcdys7L2csZW50aXR5UmVwbGFjZXIpO1xuXHRcdFx0XHRkb21CdWlsZGVyLmNoYXJhY3RlcnModGV4dCwwLHRleHQubGVuZ3RoKTtcblx0XHRcdFx0cmV0dXJuIGVsRW5kU3RhcnQ7XG5cdFx0XHQvL31cblxuXHRcdH1cblx0fVxuXHRyZXR1cm4gZWxTdGFydEVuZCsxO1xufVxuZnVuY3Rpb24gZml4U2VsZkNsb3NlZChzb3VyY2UsZWxTdGFydEVuZCx0YWdOYW1lLGNsb3NlTWFwKXtcblx0Ly9pZih0YWdOYW1lIGluIGNsb3NlTWFwKXtcblx0dmFyIHBvcyA9IGNsb3NlTWFwW3RhZ05hbWVdO1xuXHRpZihwb3MgPT0gbnVsbCl7XG5cdFx0Ly9jb25zb2xlLmxvZyh0YWdOYW1lKVxuXHRcdHBvcyA9ICBzb3VyY2UubGFzdEluZGV4T2YoJzwvJyt0YWdOYW1lKyc+Jylcblx0XHRpZihwb3M8ZWxTdGFydEVuZCl7Ly/lv5jorrDpl63lkIhcblx0XHRcdHBvcyA9IHNvdXJjZS5sYXN0SW5kZXhPZignPC8nK3RhZ05hbWUpXG5cdFx0fVxuXHRcdGNsb3NlTWFwW3RhZ05hbWVdID1wb3Ncblx0fVxuXHRyZXR1cm4gcG9zPGVsU3RhcnRFbmQ7XG5cdC8vfVxufVxuZnVuY3Rpb24gX2NvcHkoc291cmNlLHRhcmdldCl7XG5cdGZvcih2YXIgbiBpbiBzb3VyY2Upe3RhcmdldFtuXSA9IHNvdXJjZVtuXX1cbn1cbmZ1bmN0aW9uIHBhcnNlRENDKHNvdXJjZSxzdGFydCxkb21CdWlsZGVyLGVycm9ySGFuZGxlcil7Ly9zdXJlIHN0YXJ0IHdpdGggJzwhJ1xuXHR2YXIgbmV4dD0gc291cmNlLmNoYXJBdChzdGFydCsyKVxuXHRzd2l0Y2gobmV4dCl7XG5cdGNhc2UgJy0nOlxuXHRcdGlmKHNvdXJjZS5jaGFyQXQoc3RhcnQgKyAzKSA9PT0gJy0nKXtcblx0XHRcdHZhciBlbmQgPSBzb3VyY2UuaW5kZXhPZignLS0+JyxzdGFydCs0KTtcblx0XHRcdC8vYXBwZW5kIGNvbW1lbnQgc291cmNlLnN1YnN0cmluZyg0LGVuZCkvLzwhLS1cblx0XHRcdGlmKGVuZD5zdGFydCl7XG5cdFx0XHRcdGRvbUJ1aWxkZXIuY29tbWVudChzb3VyY2Usc3RhcnQrNCxlbmQtc3RhcnQtNCk7XG5cdFx0XHRcdHJldHVybiBlbmQrMztcblx0XHRcdH1lbHNle1xuXHRcdFx0XHRlcnJvckhhbmRsZXIuZXJyb3IoXCJVbmNsb3NlZCBjb21tZW50XCIpO1xuXHRcdFx0XHRyZXR1cm4gLTE7XG5cdFx0XHR9XG5cdFx0fWVsc2V7XG5cdFx0XHQvL2Vycm9yXG5cdFx0XHRyZXR1cm4gLTE7XG5cdFx0fVxuXHRkZWZhdWx0OlxuXHRcdGlmKHNvdXJjZS5zdWJzdHIoc3RhcnQrMyw2KSA9PSAnQ0RBVEFbJyl7XG5cdFx0XHR2YXIgZW5kID0gc291cmNlLmluZGV4T2YoJ11dPicsc3RhcnQrOSk7XG5cdFx0XHRkb21CdWlsZGVyLnN0YXJ0Q0RBVEEoKTtcblx0XHRcdGRvbUJ1aWxkZXIuY2hhcmFjdGVycyhzb3VyY2Usc3RhcnQrOSxlbmQtc3RhcnQtOSk7XG5cdFx0XHRkb21CdWlsZGVyLmVuZENEQVRBKClcblx0XHRcdHJldHVybiBlbmQrMztcblx0XHR9XG5cdFx0Ly88IURPQ1RZUEVcblx0XHQvL3N0YXJ0RFREKGphdmEubGFuZy5TdHJpbmcgbmFtZSwgamF2YS5sYW5nLlN0cmluZyBwdWJsaWNJZCwgamF2YS5sYW5nLlN0cmluZyBzeXN0ZW1JZClcblx0XHR2YXIgbWF0Y2hzID0gc3BsaXQoc291cmNlLHN0YXJ0KTtcblx0XHR2YXIgbGVuID0gbWF0Y2hzLmxlbmd0aDtcblx0XHRpZihsZW4+MSAmJiAvIWRvY3R5cGUvaS50ZXN0KG1hdGNoc1swXVswXSkpe1xuXHRcdFx0dmFyIG5hbWUgPSBtYXRjaHNbMV1bMF07XG5cdFx0XHR2YXIgcHViaWQgPSBmYWxzZTtcblx0XHRcdHZhciBzeXNpZCA9IGZhbHNlO1xuXHRcdFx0aWYobGVuPjMpe1xuXHRcdFx0XHRpZigvXnB1YmxpYyQvaS50ZXN0KG1hdGNoc1syXVswXSkpe1xuXHRcdFx0XHRcdHB1YmlkID0gbWF0Y2hzWzNdWzBdO1xuXHRcdFx0XHRcdHN5c2lkID0gbGVuPjQgJiYgbWF0Y2hzWzRdWzBdO1xuXHRcdFx0XHR9ZWxzZSBpZigvXnN5c3RlbSQvaS50ZXN0KG1hdGNoc1syXVswXSkpe1xuXHRcdFx0XHRcdHN5c2lkID0gbWF0Y2hzWzNdWzBdO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHR2YXIgbGFzdE1hdGNoID0gbWF0Y2hzW2xlbi0xXVxuXHRcdFx0ZG9tQnVpbGRlci5zdGFydERURChuYW1lLCBwdWJpZCwgc3lzaWQpO1xuXHRcdFx0ZG9tQnVpbGRlci5lbmREVEQoKTtcblxuXHRcdFx0cmV0dXJuIGxhc3RNYXRjaC5pbmRleCtsYXN0TWF0Y2hbMF0ubGVuZ3RoXG5cdFx0fVxuXHR9XG5cdHJldHVybiAtMTtcbn1cblxuXG5cbmZ1bmN0aW9uIHBhcnNlSW5zdHJ1Y3Rpb24oc291cmNlLHN0YXJ0LGRvbUJ1aWxkZXIpe1xuXHR2YXIgZW5kID0gc291cmNlLmluZGV4T2YoJz8+JyxzdGFydCk7XG5cdGlmKGVuZCl7XG5cdFx0dmFyIG1hdGNoID0gc291cmNlLnN1YnN0cmluZyhzdGFydCxlbmQpLm1hdGNoKC9ePFxcPyhcXFMqKVxccyooW1xcc1xcU10qPylcXHMqJC8pO1xuXHRcdGlmKG1hdGNoKXtcblx0XHRcdHZhciBsZW4gPSBtYXRjaFswXS5sZW5ndGg7XG5cdFx0XHRkb21CdWlsZGVyLnByb2Nlc3NpbmdJbnN0cnVjdGlvbihtYXRjaFsxXSwgbWF0Y2hbMl0pIDtcblx0XHRcdHJldHVybiBlbmQrMjtcblx0XHR9ZWxzZXsvL2Vycm9yXG5cdFx0XHRyZXR1cm4gLTE7XG5cdFx0fVxuXHR9XG5cdHJldHVybiAtMTtcbn1cblxuZnVuY3Rpb24gRWxlbWVudEF0dHJpYnV0ZXMoKXtcblx0dGhpcy5hdHRyaWJ1dGVOYW1lcyA9IHt9XG59XG5FbGVtZW50QXR0cmlidXRlcy5wcm90b3R5cGUgPSB7XG5cdHNldFRhZ05hbWU6ZnVuY3Rpb24odGFnTmFtZSl7XG5cdFx0aWYoIXRhZ05hbWVQYXR0ZXJuLnRlc3QodGFnTmFtZSkpe1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkIHRhZ05hbWU6Jyt0YWdOYW1lKVxuXHRcdH1cblx0XHR0aGlzLnRhZ05hbWUgPSB0YWdOYW1lXG5cdH0sXG5cdGFkZFZhbHVlOmZ1bmN0aW9uKHFOYW1lLCB2YWx1ZSwgb2Zmc2V0KSB7XG5cdFx0aWYoIXRhZ05hbWVQYXR0ZXJuLnRlc3QocU5hbWUpKXtcblx0XHRcdHRocm93IG5ldyBFcnJvcignaW52YWxpZCBhdHRyaWJ1dGU6JytxTmFtZSlcblx0XHR9XG5cdFx0dGhpcy5hdHRyaWJ1dGVOYW1lc1txTmFtZV0gPSB0aGlzLmxlbmd0aDtcblx0XHR0aGlzW3RoaXMubGVuZ3RoKytdID0ge3FOYW1lOnFOYW1lLHZhbHVlOnZhbHVlLG9mZnNldDpvZmZzZXR9XG5cdH0sXG5cdGxlbmd0aDowLFxuXHRnZXRMb2NhbE5hbWU6ZnVuY3Rpb24oaSl7cmV0dXJuIHRoaXNbaV0ubG9jYWxOYW1lfSxcblx0Z2V0TG9jYXRvcjpmdW5jdGlvbihpKXtyZXR1cm4gdGhpc1tpXS5sb2NhdG9yfSxcblx0Z2V0UU5hbWU6ZnVuY3Rpb24oaSl7cmV0dXJuIHRoaXNbaV0ucU5hbWV9LFxuXHRnZXRVUkk6ZnVuY3Rpb24oaSl7cmV0dXJuIHRoaXNbaV0udXJpfSxcblx0Z2V0VmFsdWU6ZnVuY3Rpb24oaSl7cmV0dXJuIHRoaXNbaV0udmFsdWV9XG4vL1x0LGdldEluZGV4OmZ1bmN0aW9uKHVyaSwgbG9jYWxOYW1lKSl7XG4vL1x0XHRpZihsb2NhbE5hbWUpe1xuLy9cbi8vXHRcdH1lbHNle1xuLy9cdFx0XHR2YXIgcU5hbWUgPSB1cmlcbi8vXHRcdH1cbi8vXHR9LFxuLy9cdGdldFZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0VmFsdWUodGhpcy5nZXRJbmRleC5hcHBseSh0aGlzLGFyZ3VtZW50cykpfSxcbi8vXHRnZXRUeXBlOmZ1bmN0aW9uKHVyaSxsb2NhbE5hbWUpe31cbi8vXHRnZXRUeXBlOmZ1bmN0aW9uKGkpe30sXG59XG5cblxuXG5mdW5jdGlvbiBzcGxpdChzb3VyY2Usc3RhcnQpe1xuXHR2YXIgbWF0Y2g7XG5cdHZhciBidWYgPSBbXTtcblx0dmFyIHJlZyA9IC8nW14nXSsnfFwiW15cIl0rXCJ8W15cXHM8PlxcLz1dKz0/fChcXC8/XFxzKj58PCkvZztcblx0cmVnLmxhc3RJbmRleCA9IHN0YXJ0O1xuXHRyZWcuZXhlYyhzb3VyY2UpOy8vc2tpcCA8XG5cdHdoaWxlKG1hdGNoID0gcmVnLmV4ZWMoc291cmNlKSl7XG5cdFx0YnVmLnB1c2gobWF0Y2gpO1xuXHRcdGlmKG1hdGNoWzFdKXJldHVybiBidWY7XG5cdH1cbn1cblxuZXhwb3J0cy5YTUxSZWFkZXIgPSBYTUxSZWFkZXI7XG5leHBvcnRzLlBhcnNlRXJyb3IgPSBQYXJzZUVycm9yO1xuIiwiLy8gc2hpbSBmb3IgdXNpbmcgcHJvY2VzcyBpbiBicm93c2VyXG52YXIgcHJvY2VzcyA9IG1vZHVsZS5leHBvcnRzID0ge307XG5cbi8vIGNhY2hlZCBmcm9tIHdoYXRldmVyIGdsb2JhbCBpcyBwcmVzZW50IHNvIHRoYXQgdGVzdCBydW5uZXJzIHRoYXQgc3R1YiBpdFxuLy8gZG9uJ3QgYnJlYWsgdGhpbmdzLiAgQnV0IHdlIG5lZWQgdG8gd3JhcCBpdCBpbiBhIHRyeSBjYXRjaCBpbiBjYXNlIGl0IGlzXG4vLyB3cmFwcGVkIGluIHN0cmljdCBtb2RlIGNvZGUgd2hpY2ggZG9lc24ndCBkZWZpbmUgYW55IGdsb2JhbHMuICBJdCdzIGluc2lkZSBhXG4vLyBmdW5jdGlvbiBiZWNhdXNlIHRyeS9jYXRjaGVzIGRlb3B0aW1pemUgaW4gY2VydGFpbiBlbmdpbmVzLlxuXG52YXIgY2FjaGVkU2V0VGltZW91dDtcbnZhciBjYWNoZWRDbGVhclRpbWVvdXQ7XG5cbmZ1bmN0aW9uIGRlZmF1bHRTZXRUaW1vdXQoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdzZXRUaW1lb3V0IGhhcyBub3QgYmVlbiBkZWZpbmVkJyk7XG59XG5mdW5jdGlvbiBkZWZhdWx0Q2xlYXJUaW1lb3V0ICgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2NsZWFyVGltZW91dCBoYXMgbm90IGJlZW4gZGVmaW5lZCcpO1xufVxuKGZ1bmN0aW9uICgpIHtcbiAgICB0cnkge1xuICAgICAgICBpZiAodHlwZW9mIHNldFRpbWVvdXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBzZXRUaW1lb3V0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IGRlZmF1bHRTZXRUaW1vdXQ7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBkZWZhdWx0U2V0VGltb3V0O1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBpZiAodHlwZW9mIGNsZWFyVGltZW91dCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gY2xlYXJUaW1lb3V0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gZGVmYXVsdENsZWFyVGltZW91dDtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gZGVmYXVsdENsZWFyVGltZW91dDtcbiAgICB9XG59ICgpKVxuZnVuY3Rpb24gcnVuVGltZW91dChmdW4pIHtcbiAgICBpZiAoY2FjaGVkU2V0VGltZW91dCA9PT0gc2V0VGltZW91dCkge1xuICAgICAgICAvL25vcm1hbCBlbnZpcm9tZW50cyBpbiBzYW5lIHNpdHVhdGlvbnNcbiAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuLCAwKTtcbiAgICB9XG4gICAgLy8gaWYgc2V0VGltZW91dCB3YXNuJ3QgYXZhaWxhYmxlIGJ1dCB3YXMgbGF0dGVyIGRlZmluZWRcbiAgICBpZiAoKGNhY2hlZFNldFRpbWVvdXQgPT09IGRlZmF1bHRTZXRUaW1vdXQgfHwgIWNhY2hlZFNldFRpbWVvdXQpICYmIHNldFRpbWVvdXQpIHtcbiAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IHNldFRpbWVvdXQ7XG4gICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1biwgMCk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIC8vIHdoZW4gd2hlbiBzb21lYm9keSBoYXMgc2NyZXdlZCB3aXRoIHNldFRpbWVvdXQgYnV0IG5vIEkuRS4gbWFkZG5lc3NcbiAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQoZnVuLCAwKTtcbiAgICB9IGNhdGNoKGUpe1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gV2hlbiB3ZSBhcmUgaW4gSS5FLiBidXQgdGhlIHNjcmlwdCBoYXMgYmVlbiBldmFsZWQgc28gSS5FLiBkb2Vzbid0IHRydXN0IHRoZSBnbG9iYWwgb2JqZWN0IHdoZW4gY2FsbGVkIG5vcm1hbGx5XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkU2V0VGltZW91dC5jYWxsKG51bGwsIGZ1biwgMCk7XG4gICAgICAgIH0gY2F0Y2goZSl7XG4gICAgICAgICAgICAvLyBzYW1lIGFzIGFib3ZlIGJ1dCB3aGVuIGl0J3MgYSB2ZXJzaW9uIG9mIEkuRS4gdGhhdCBtdXN0IGhhdmUgdGhlIGdsb2JhbCBvYmplY3QgZm9yICd0aGlzJywgaG9wZnVsbHkgb3VyIGNvbnRleHQgY29ycmVjdCBvdGhlcndpc2UgaXQgd2lsbCB0aHJvdyBhIGdsb2JhbCBlcnJvclxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQuY2FsbCh0aGlzLCBmdW4sIDApO1xuICAgICAgICB9XG4gICAgfVxuXG5cbn1cbmZ1bmN0aW9uIHJ1bkNsZWFyVGltZW91dChtYXJrZXIpIHtcbiAgICBpZiAoY2FjaGVkQ2xlYXJUaW1lb3V0ID09PSBjbGVhclRpbWVvdXQpIHtcbiAgICAgICAgLy9ub3JtYWwgZW52aXJvbWVudHMgaW4gc2FuZSBzaXR1YXRpb25zXG4gICAgICAgIHJldHVybiBjbGVhclRpbWVvdXQobWFya2VyKTtcbiAgICB9XG4gICAgLy8gaWYgY2xlYXJUaW1lb3V0IHdhc24ndCBhdmFpbGFibGUgYnV0IHdhcyBsYXR0ZXIgZGVmaW5lZFxuICAgIGlmICgoY2FjaGVkQ2xlYXJUaW1lb3V0ID09PSBkZWZhdWx0Q2xlYXJUaW1lb3V0IHx8ICFjYWNoZWRDbGVhclRpbWVvdXQpICYmIGNsZWFyVGltZW91dCkge1xuICAgICAgICBjYWNoZWRDbGVhclRpbWVvdXQgPSBjbGVhclRpbWVvdXQ7XG4gICAgICAgIHJldHVybiBjbGVhclRpbWVvdXQobWFya2VyKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgLy8gd2hlbiB3aGVuIHNvbWVib2R5IGhhcyBzY3Jld2VkIHdpdGggc2V0VGltZW91dCBidXQgbm8gSS5FLiBtYWRkbmVzc1xuICAgICAgICByZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0KG1hcmtlcik7XG4gICAgfSBjYXRjaCAoZSl7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBXaGVuIHdlIGFyZSBpbiBJLkUuIGJ1dCB0aGUgc2NyaXB0IGhhcyBiZWVuIGV2YWxlZCBzbyBJLkUuIGRvZXNuJ3QgIHRydXN0IHRoZSBnbG9iYWwgb2JqZWN0IHdoZW4gY2FsbGVkIG5vcm1hbGx5XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0LmNhbGwobnVsbCwgbWFya2VyKTtcbiAgICAgICAgfSBjYXRjaCAoZSl7XG4gICAgICAgICAgICAvLyBzYW1lIGFzIGFib3ZlIGJ1dCB3aGVuIGl0J3MgYSB2ZXJzaW9uIG9mIEkuRS4gdGhhdCBtdXN0IGhhdmUgdGhlIGdsb2JhbCBvYmplY3QgZm9yICd0aGlzJywgaG9wZnVsbHkgb3VyIGNvbnRleHQgY29ycmVjdCBvdGhlcndpc2UgaXQgd2lsbCB0aHJvdyBhIGdsb2JhbCBlcnJvci5cbiAgICAgICAgICAgIC8vIFNvbWUgdmVyc2lvbnMgb2YgSS5FLiBoYXZlIGRpZmZlcmVudCBydWxlcyBmb3IgY2xlYXJUaW1lb3V0IHZzIHNldFRpbWVvdXRcbiAgICAgICAgICAgIHJldHVybiBjYWNoZWRDbGVhclRpbWVvdXQuY2FsbCh0aGlzLCBtYXJrZXIpO1xuICAgICAgICB9XG4gICAgfVxuXG5cblxufVxudmFyIHF1ZXVlID0gW107XG52YXIgZHJhaW5pbmcgPSBmYWxzZTtcbnZhciBjdXJyZW50UXVldWU7XG52YXIgcXVldWVJbmRleCA9IC0xO1xuXG5mdW5jdGlvbiBjbGVhblVwTmV4dFRpY2soKSB7XG4gICAgaWYgKCFkcmFpbmluZyB8fCAhY3VycmVudFF1ZXVlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZHJhaW5pbmcgPSBmYWxzZTtcbiAgICBpZiAoY3VycmVudFF1ZXVlLmxlbmd0aCkge1xuICAgICAgICBxdWV1ZSA9IGN1cnJlbnRRdWV1ZS5jb25jYXQocXVldWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHF1ZXVlSW5kZXggPSAtMTtcbiAgICB9XG4gICAgaWYgKHF1ZXVlLmxlbmd0aCkge1xuICAgICAgICBkcmFpblF1ZXVlKCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBkcmFpblF1ZXVlKCkge1xuICAgIGlmIChkcmFpbmluZykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciB0aW1lb3V0ID0gcnVuVGltZW91dChjbGVhblVwTmV4dFRpY2spO1xuICAgIGRyYWluaW5nID0gdHJ1ZTtcblxuICAgIHZhciBsZW4gPSBxdWV1ZS5sZW5ndGg7XG4gICAgd2hpbGUobGVuKSB7XG4gICAgICAgIGN1cnJlbnRRdWV1ZSA9IHF1ZXVlO1xuICAgICAgICBxdWV1ZSA9IFtdO1xuICAgICAgICB3aGlsZSAoKytxdWV1ZUluZGV4IDwgbGVuKSB7XG4gICAgICAgICAgICBpZiAoY3VycmVudFF1ZXVlKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFF1ZXVlW3F1ZXVlSW5kZXhdLnJ1bigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHF1ZXVlSW5kZXggPSAtMTtcbiAgICAgICAgbGVuID0gcXVldWUubGVuZ3RoO1xuICAgIH1cbiAgICBjdXJyZW50UXVldWUgPSBudWxsO1xuICAgIGRyYWluaW5nID0gZmFsc2U7XG4gICAgcnVuQ2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xufVxuXG5wcm9jZXNzLm5leHRUaWNrID0gZnVuY3Rpb24gKGZ1bikge1xuICAgIHZhciBhcmdzID0gbmV3IEFycmF5KGFyZ3VtZW50cy5sZW5ndGggLSAxKTtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGFyZ3NbaSAtIDFdID0gYXJndW1lbnRzW2ldO1xuICAgICAgICB9XG4gICAgfVxuICAgIHF1ZXVlLnB1c2gobmV3IEl0ZW0oZnVuLCBhcmdzKSk7XG4gICAgaWYgKHF1ZXVlLmxlbmd0aCA9PT0gMSAmJiAhZHJhaW5pbmcpIHtcbiAgICAgICAgcnVuVGltZW91dChkcmFpblF1ZXVlKTtcbiAgICB9XG59O1xuXG4vLyB2OCBsaWtlcyBwcmVkaWN0aWJsZSBvYmplY3RzXG5mdW5jdGlvbiBJdGVtKGZ1biwgYXJyYXkpIHtcbiAgICB0aGlzLmZ1biA9IGZ1bjtcbiAgICB0aGlzLmFycmF5ID0gYXJyYXk7XG59XG5JdGVtLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5mdW4uYXBwbHkobnVsbCwgdGhpcy5hcnJheSk7XG59O1xucHJvY2Vzcy50aXRsZSA9ICdicm93c2VyJztcbnByb2Nlc3MuYnJvd3NlciA9IHRydWU7XG5wcm9jZXNzLmVudiA9IHt9O1xucHJvY2Vzcy5hcmd2ID0gW107XG5wcm9jZXNzLnZlcnNpb24gPSAnJzsgLy8gZW1wdHkgc3RyaW5nIHRvIGF2b2lkIHJlZ2V4cCBpc3N1ZXNcbnByb2Nlc3MudmVyc2lvbnMgPSB7fTtcblxuZnVuY3Rpb24gbm9vcCgpIHt9XG5cbnByb2Nlc3Mub24gPSBub29wO1xucHJvY2Vzcy5hZGRMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLm9uY2UgPSBub29wO1xucHJvY2Vzcy5vZmYgPSBub29wO1xucHJvY2Vzcy5yZW1vdmVMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLnJlbW92ZUFsbExpc3RlbmVycyA9IG5vb3A7XG5wcm9jZXNzLmVtaXQgPSBub29wO1xucHJvY2Vzcy5wcmVwZW5kTGlzdGVuZXIgPSBub29wO1xucHJvY2Vzcy5wcmVwZW5kT25jZUxpc3RlbmVyID0gbm9vcDtcblxucHJvY2Vzcy5saXN0ZW5lcnMgPSBmdW5jdGlvbiAobmFtZSkgeyByZXR1cm4gW10gfVxuXG5wcm9jZXNzLmJpbmRpbmcgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5iaW5kaW5nIGlzIG5vdCBzdXBwb3J0ZWQnKTtcbn07XG5cbnByb2Nlc3MuY3dkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gJy8nIH07XG5wcm9jZXNzLmNoZGlyID0gZnVuY3Rpb24gKGRpcikge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkJyk7XG59O1xucHJvY2Vzcy51bWFzayA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gMDsgfTtcbiIsIi8qIGdsb2JhbHMgX193ZWJwYWNrX2FtZF9vcHRpb25zX18gKi9cbm1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX2FtZF9vcHRpb25zX187XG4iLCJ2YXIgZztcblxuLy8gVGhpcyB3b3JrcyBpbiBub24tc3RyaWN0IG1vZGVcbmcgPSAoZnVuY3Rpb24oKSB7XG5cdHJldHVybiB0aGlzO1xufSkoKTtcblxudHJ5IHtcblx0Ly8gVGhpcyB3b3JrcyBpZiBldmFsIGlzIGFsbG93ZWQgKHNlZSBDU1ApXG5cdGcgPSBnIHx8IG5ldyBGdW5jdGlvbihcInJldHVybiB0aGlzXCIpKCk7XG59IGNhdGNoIChlKSB7XG5cdC8vIFRoaXMgd29ya3MgaWYgdGhlIHdpbmRvdyByZWZlcmVuY2UgaXMgYXZhaWxhYmxlXG5cdGlmICh0eXBlb2Ygd2luZG93ID09PSBcIm9iamVjdFwiKSBnID0gd2luZG93O1xufVxuXG4vLyBnIGNhbiBzdGlsbCBiZSB1bmRlZmluZWQsIGJ1dCBub3RoaW5nIHRvIGRvIGFib3V0IGl0Li4uXG4vLyBXZSByZXR1cm4gdW5kZWZpbmVkLCBpbnN0ZWFkIG9mIG5vdGhpbmcgaGVyZSwgc28gaXQnc1xuLy8gZWFzaWVyIHRvIGhhbmRsZSB0aGlzIGNhc2UuIGlmKCFnbG9iYWwpIHsgLi4ufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGc7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuXHRpZiAoIW1vZHVsZS53ZWJwYWNrUG9seWZpbGwpIHtcblx0XHRtb2R1bGUuZGVwcmVjYXRlID0gZnVuY3Rpb24oKSB7fTtcblx0XHRtb2R1bGUucGF0aHMgPSBbXTtcblx0XHQvLyBtb2R1bGUucGFyZW50ID0gdW5kZWZpbmVkIGJ5IGRlZmF1bHRcblx0XHRpZiAoIW1vZHVsZS5jaGlsZHJlbikgbW9kdWxlLmNoaWxkcmVuID0gW107XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZHVsZSwgXCJsb2FkZWRcIiwge1xuXHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcblx0XHRcdGdldDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJldHVybiBtb2R1bGUubDtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobW9kdWxlLCBcImlkXCIsIHtcblx0XHRcdGVudW1lcmFibGU6IHRydWUsXG5cdFx0XHRnZXQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRyZXR1cm4gbW9kdWxlLmk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0bW9kdWxlLndlYnBhY2tQb2x5ZmlsbCA9IDE7XG5cdH1cblx0cmV0dXJuIG1vZHVsZTtcbn07XG4iLCJ2YXIgX3R5cGVvZiA9IHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL3R5cGVvZlwiKTtcblxudmFyIHNlc3Npb24gPSByZXF1aXJlKCcuL3Nlc3Npb24nKTtcblxudmFyIEFzeW5jID0gcmVxdWlyZSgnLi9hc3luYycpO1xuXG52YXIgRXZlbnRQcm94eSA9IHJlcXVpcmUoJy4vZXZlbnQnKS5FdmVudFByb3h5O1xuXG52YXIgdXRpbCA9IHJlcXVpcmUoJy4vdXRpbCcpO1xuXG52YXIgVHJhY2tlciA9IHJlcXVpcmUoJy4vdHJhY2tlcicpOyAvLyDmlofku7bliIblnZfkuIrkvKDlhajov4fnqIvvvIzmmrTpnLLnmoTliIblnZfkuIrkvKDmjqXlj6NcblxuXG5mdW5jdGlvbiBzbGljZVVwbG9hZEZpbGUocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBlcCA9IG5ldyBFdmVudFByb3h5KCk7XG4gIHZhciBUYXNrSWQgPSBwYXJhbXMuVGFza0lkO1xuICB2YXIgQnVja2V0ID0gcGFyYW1zLkJ1Y2tldDtcbiAgdmFyIFJlZ2lvbiA9IHBhcmFtcy5SZWdpb247XG4gIHZhciBLZXkgPSBwYXJhbXMuS2V5O1xuICB2YXIgQm9keSA9IHBhcmFtcy5Cb2R5O1xuICB2YXIgQ2h1bmtTaXplID0gcGFyYW1zLkNodW5rU2l6ZSB8fCBwYXJhbXMuU2xpY2VTaXplIHx8IHNlbGYub3B0aW9ucy5DaHVua1NpemU7XG4gIHZhciBBc3luY0xpbWl0ID0gcGFyYW1zLkFzeW5jTGltaXQ7XG4gIHZhciBTdG9yYWdlQ2xhc3MgPSBwYXJhbXMuU3RvcmFnZUNsYXNzO1xuICB2YXIgU2VydmVyU2lkZUVuY3J5cHRpb24gPSBwYXJhbXMuU2VydmVyU2lkZUVuY3J5cHRpb247XG4gIHZhciBGaWxlU2l6ZTtcbiAgdmFyIG9uUHJvZ3Jlc3M7XG4gIHZhciBvbkhhc2hQcm9ncmVzcyA9IHBhcmFtcy5vbkhhc2hQcm9ncmVzcztcbiAgdmFyIHRyYWNrZXIgPSBwYXJhbXMudHJhY2tlcjtcbiAgdHJhY2tlciAmJiB0cmFja2VyLnNldFBhcmFtcyh7XG4gICAgY2h1bmtTaXplOiBDaHVua1NpemVcbiAgfSk7IC8vIOS4iuS8oOi/h+eoi+S4reWHuueOsOmUmeivr++8jOi/lOWbnumUmeivr1xuXG4gIGVwLm9uKCdlcnJvcicsIGZ1bmN0aW9uIChlcnIpIHtcbiAgICBpZiAoIXNlbGYuX2lzUnVubmluZ1Rhc2soVGFza0lkKSkgcmV0dXJuO1xuICAgIGVyci5VcGxvYWRJZCA9IHBhcmFtcy5VcGxvYWREYXRhLlVwbG9hZElkIHx8ICcnO1xuICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICB9KTsgLy8g5LiK5Lyg5YiG5Z2X5a6M5oiQ77yM5byA5aeLIHVwbG9hZFNsaWNlQ29tcGxldGUg5pON5L2cXG5cbiAgZXAub24oJ3VwbG9hZF9jb21wbGV0ZScsIGZ1bmN0aW9uIChVcGxvYWRDb21wbGV0ZURhdGEpIHtcbiAgICB2YXIgX1VwbG9hZENvbXBsZXRlRGF0YSA9IHV0aWwuZXh0ZW5kKHtcbiAgICAgIFVwbG9hZElkOiBwYXJhbXMuVXBsb2FkRGF0YS5VcGxvYWRJZCB8fCAnJ1xuICAgIH0sIFVwbG9hZENvbXBsZXRlRGF0YSk7XG5cbiAgICBjYWxsYmFjayhudWxsLCBfVXBsb2FkQ29tcGxldGVEYXRhKTtcbiAgfSk7IC8vIOS4iuS8oOWIhuWdl+WujOaIkO+8jOW8gOWniyB1cGxvYWRTbGljZUNvbXBsZXRlIOaTjeS9nFxuXG4gIGVwLm9uKCd1cGxvYWRfc2xpY2VfY29tcGxldGUnLCBmdW5jdGlvbiAoVXBsb2FkRGF0YSkge1xuICAgIHZhciBtZXRhSGVhZGVycyA9IHt9O1xuICAgIHV0aWwuZWFjaChwYXJhbXMuSGVhZGVycywgZnVuY3Rpb24gKHZhbCwgaykge1xuICAgICAgdmFyIHNob3J0S2V5ID0gay50b0xvd2VyQ2FzZSgpO1xuICAgICAgaWYgKHNob3J0S2V5LmluZGV4T2YoJ3gtY29zLW1ldGEtJykgPT09IDAgfHwgc2hvcnRLZXkgPT09ICdwaWMtb3BlcmF0aW9ucycpIG1ldGFIZWFkZXJzW2tdID0gdmFsO1xuICAgIH0pO1xuICAgIHVwbG9hZFNsaWNlQ29tcGxldGUuY2FsbChzZWxmLCB7XG4gICAgICBCdWNrZXQ6IEJ1Y2tldCxcbiAgICAgIFJlZ2lvbjogUmVnaW9uLFxuICAgICAgS2V5OiBLZXksXG4gICAgICBVcGxvYWRJZDogVXBsb2FkRGF0YS5VcGxvYWRJZCxcbiAgICAgIFNsaWNlTGlzdDogVXBsb2FkRGF0YS5TbGljZUxpc3QsXG4gICAgICBIZWFkZXJzOiBtZXRhSGVhZGVycyxcbiAgICAgIHRyYWNrZXI6IHRyYWNrZXJcbiAgICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgICBpZiAoIXNlbGYuX2lzUnVubmluZ1Rhc2soVGFza0lkKSkgcmV0dXJuO1xuICAgICAgc2Vzc2lvbi5yZW1vdmVVc2luZyhVcGxvYWREYXRhLlVwbG9hZElkKTtcblxuICAgICAgaWYgKGVycikge1xuICAgICAgICBvblByb2dyZXNzKG51bGwsIHRydWUpO1xuICAgICAgICByZXR1cm4gZXAuZW1pdCgnZXJyb3InLCBlcnIpO1xuICAgICAgfVxuXG4gICAgICBzZXNzaW9uLnJlbW92ZVVwbG9hZElkLmNhbGwoc2VsZiwgVXBsb2FkRGF0YS5VcGxvYWRJZCk7XG4gICAgICBvblByb2dyZXNzKHtcbiAgICAgICAgbG9hZGVkOiBGaWxlU2l6ZSxcbiAgICAgICAgdG90YWw6IEZpbGVTaXplXG4gICAgICB9LCB0cnVlKTtcbiAgICAgIGVwLmVtaXQoJ3VwbG9hZF9jb21wbGV0ZScsIGRhdGEpO1xuICAgIH0pO1xuICB9KTsgLy8g6I635Y+WIFVwbG9hZElkIOWujOaIkO+8jOW8gOWni+S4iuS8oOavj+S4quWIhueJh1xuXG4gIGVwLm9uKCdnZXRfdXBsb2FkX2RhdGFfZmluaXNoJywgZnVuY3Rpb24gKFVwbG9hZERhdGEpIHtcbiAgICAvLyDlpITnkIYgVXBsb2FkSWQg57yT5a2YXG4gICAgdmFyIHV1aWQgPSBzZXNzaW9uLmdldEZpbGVJZChCb2R5LCBwYXJhbXMuQ2h1bmtTaXplLCBCdWNrZXQsIEtleSk7XG4gICAgdXVpZCAmJiBzZXNzaW9uLnNhdmVVcGxvYWRJZC5jYWxsKHNlbGYsIHV1aWQsIFVwbG9hZERhdGEuVXBsb2FkSWQsIHNlbGYub3B0aW9ucy5VcGxvYWRJZENhY2hlTGltaXQpOyAvLyDnvJPlrZggVXBsb2FkSWRcblxuICAgIHNlc3Npb24uc2V0VXNpbmcoVXBsb2FkRGF0YS5VcGxvYWRJZCk7IC8vIOagh+iusCBVcGxvYWRJZCDkuLrmraPlnKjkvb/nlKhcbiAgICAvLyDojrflj5YgVXBsb2FkSWRcblxuICAgIG9uUHJvZ3Jlc3MobnVsbCwgdHJ1ZSk7IC8vIOS7u+WKoeeKtuaAgeW8gOWniyB1cGxvYWRpbmdcblxuICAgIHVwbG9hZFNsaWNlTGlzdC5jYWxsKHNlbGYsIHtcbiAgICAgIFRhc2tJZDogVGFza0lkLFxuICAgICAgQnVja2V0OiBCdWNrZXQsXG4gICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgIEtleTogS2V5LFxuICAgICAgQm9keTogQm9keSxcbiAgICAgIEZpbGVTaXplOiBGaWxlU2l6ZSxcbiAgICAgIFNsaWNlU2l6ZTogQ2h1bmtTaXplLFxuICAgICAgQXN5bmNMaW1pdDogQXN5bmNMaW1pdCxcbiAgICAgIFNlcnZlclNpZGVFbmNyeXB0aW9uOiBTZXJ2ZXJTaWRlRW5jcnlwdGlvbixcbiAgICAgIFVwbG9hZERhdGE6IFVwbG9hZERhdGEsXG4gICAgICBIZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICAgIG9uUHJvZ3Jlc3M6IG9uUHJvZ3Jlc3MsXG4gICAgICB0cmFja2VyOiB0cmFja2VyXG4gICAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcblxuICAgICAgaWYgKGVycikge1xuICAgICAgICBvblByb2dyZXNzKG51bGwsIHRydWUpO1xuICAgICAgICByZXR1cm4gZXAuZW1pdCgnZXJyb3InLCBlcnIpO1xuICAgICAgfVxuXG4gICAgICBlcC5lbWl0KCd1cGxvYWRfc2xpY2VfY29tcGxldGUnLCBkYXRhKTtcbiAgICB9KTtcbiAgfSk7IC8vIOW8gOWni+iOt+WPluaWh+S7tiBVcGxvYWRJZO+8jOmHjOmdouS8muinhuaDheWGteiuoeeulyBFVGFn77yM5bm25q+U5a+577yM5L+d6K+B5paH5Lu25LiA6Ie05oCn77yM5Lmf5LyY5YyW5LiK5LygXG5cbiAgZXAub24oJ2dldF9maWxlX3NpemVfZmluaXNoJywgZnVuY3Rpb24gKCkge1xuICAgIG9uUHJvZ3Jlc3MgPSB1dGlsLnRocm90dGxlT25Qcm9ncmVzcy5jYWxsKHNlbGYsIEZpbGVTaXplLCBwYXJhbXMub25Qcm9ncmVzcyk7XG5cbiAgICBpZiAocGFyYW1zLlVwbG9hZERhdGEuVXBsb2FkSWQpIHtcbiAgICAgIGVwLmVtaXQoJ2dldF91cGxvYWRfZGF0YV9maW5pc2gnLCBwYXJhbXMuVXBsb2FkRGF0YSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBfcGFyYW1zID0gdXRpbC5leHRlbmQoe1xuICAgICAgICBUYXNrSWQ6IFRhc2tJZCxcbiAgICAgICAgQnVja2V0OiBCdWNrZXQsXG4gICAgICAgIFJlZ2lvbjogUmVnaW9uLFxuICAgICAgICBLZXk6IEtleSxcbiAgICAgICAgSGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgICAgIFN0b3JhZ2VDbGFzczogU3RvcmFnZUNsYXNzLFxuICAgICAgICBCb2R5OiBCb2R5LFxuICAgICAgICBGaWxlU2l6ZTogRmlsZVNpemUsXG4gICAgICAgIFNsaWNlU2l6ZTogQ2h1bmtTaXplLFxuICAgICAgICBvbkhhc2hQcm9ncmVzczogb25IYXNoUHJvZ3Jlc3MsXG4gICAgICAgIHRyYWNrZXI6IHRyYWNrZXJcbiAgICAgIH0sIHBhcmFtcyk7XG5cbiAgICAgIGdldFVwbG9hZElkQW5kUGFydExpc3QuY2FsbChzZWxmLCBfcGFyYW1zLCBmdW5jdGlvbiAoZXJyLCBVcGxvYWREYXRhKSB7XG4gICAgICAgIGlmICghc2VsZi5faXNSdW5uaW5nVGFzayhUYXNrSWQpKSByZXR1cm47XG4gICAgICAgIGlmIChlcnIpIHJldHVybiBlcC5lbWl0KCdlcnJvcicsIGVycik7XG4gICAgICAgIHBhcmFtcy5VcGxvYWREYXRhLlVwbG9hZElkID0gVXBsb2FkRGF0YS5VcGxvYWRJZDtcbiAgICAgICAgcGFyYW1zLlVwbG9hZERhdGEuUGFydExpc3QgPSBVcGxvYWREYXRhLlBhcnRMaXN0O1xuICAgICAgICBlcC5lbWl0KCdnZXRfdXBsb2FkX2RhdGFfZmluaXNoJywgcGFyYW1zLlVwbG9hZERhdGEpO1xuICAgICAgfSk7XG4gICAgfVxuICB9KTsgLy8g6I635Y+W5LiK5Lyg5paH5Lu25aSn5bCPXG5cbiAgRmlsZVNpemUgPSBwYXJhbXMuQ29udGVudExlbmd0aDtcbiAgZGVsZXRlIHBhcmFtcy5Db250ZW50TGVuZ3RoO1xuICAhcGFyYW1zLkhlYWRlcnMgJiYgKHBhcmFtcy5IZWFkZXJzID0ge30pO1xuICB1dGlsLmVhY2gocGFyYW1zLkhlYWRlcnMsIGZ1bmN0aW9uIChpdGVtLCBrZXkpIHtcbiAgICBpZiAoa2V5LnRvTG93ZXJDYXNlKCkgPT09ICdjb250ZW50LWxlbmd0aCcpIHtcbiAgICAgIGRlbGV0ZSBwYXJhbXMuSGVhZGVyc1trZXldO1xuICAgIH1cbiAgfSk7IC8vIOaOp+WItuWIhueJh+Wkp+Wwj1xuXG4gIChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIFNJWkUgPSBbMSwgMiwgNCwgOCwgMTYsIDMyLCA2NCwgMTI4LCAyNTYsIDUxMiwgMTAyNCwgMTAyNCAqIDIsIDEwMjQgKiA0LCAxMDI0ICogNV07XG4gICAgdmFyIEF1dG9DaHVua1NpemUgPSAxMDI0ICogMTAyNDtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgU0laRS5sZW5ndGg7IGkrKykge1xuICAgICAgQXV0b0NodW5rU2l6ZSA9IFNJWkVbaV0gKiAxMDI0ICogMTAyNDtcbiAgICAgIGlmIChGaWxlU2l6ZSAvIEF1dG9DaHVua1NpemUgPD0gc2VsZi5vcHRpb25zLk1heFBhcnROdW1iZXIpIGJyZWFrO1xuICAgIH1cblxuICAgIHBhcmFtcy5DaHVua1NpemUgPSBwYXJhbXMuU2xpY2VTaXplID0gQ2h1bmtTaXplID0gTWF0aC5tYXgoQ2h1bmtTaXplLCBBdXRvQ2h1bmtTaXplKTtcbiAgfSkoKTsgLy8g5byA5aeL5LiK5LygXG5cblxuICBpZiAoRmlsZVNpemUgPT09IDApIHtcbiAgICBwYXJhbXMuQm9keSA9ICcnO1xuICAgIHBhcmFtcy5Db250ZW50TGVuZ3RoID0gMDtcbiAgICBwYXJhbXMuU2tpcFRhc2sgPSB0cnVlO1xuICAgIHNlbGYucHV0T2JqZWN0KHBhcmFtcywgY2FsbGJhY2spO1xuICB9IGVsc2Uge1xuICAgIGVwLmVtaXQoJ2dldF9maWxlX3NpemVfZmluaXNoJyk7XG4gIH1cbn0gLy8g6I635Y+W5LiK5Lyg5Lu75Yqh55qEIFVwbG9hZElkXG5cblxuZnVuY3Rpb24gZ2V0VXBsb2FkSWRBbmRQYXJ0TGlzdChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBUYXNrSWQgPSBwYXJhbXMuVGFza0lkO1xuICB2YXIgQnVja2V0ID0gcGFyYW1zLkJ1Y2tldDtcbiAgdmFyIFJlZ2lvbiA9IHBhcmFtcy5SZWdpb247XG4gIHZhciBLZXkgPSBwYXJhbXMuS2V5O1xuICB2YXIgU3RvcmFnZUNsYXNzID0gcGFyYW1zLlN0b3JhZ2VDbGFzcztcbiAgdmFyIHNlbGYgPSB0aGlzOyAvLyDorqHnrpcgRVRhZ1xuXG4gIHZhciBFVGFnTWFwID0ge307XG4gIHZhciBGaWxlU2l6ZSA9IHBhcmFtcy5GaWxlU2l6ZTtcbiAgdmFyIFNsaWNlU2l6ZSA9IHBhcmFtcy5TbGljZVNpemU7XG4gIHZhciBTbGljZUNvdW50ID0gTWF0aC5jZWlsKEZpbGVTaXplIC8gU2xpY2VTaXplKTtcbiAgdmFyIEZpbmlzaFNsaWNlQ291bnQgPSAwO1xuICB2YXIgRmluaXNoU2l6ZSA9IDA7XG4gIHZhciBvbkhhc2hQcm9ncmVzcyA9IHV0aWwudGhyb3R0bGVPblByb2dyZXNzLmNhbGwoc2VsZiwgRmlsZVNpemUsIHBhcmFtcy5vbkhhc2hQcm9ncmVzcyk7XG5cbiAgdmFyIGdldENodW5rRVRhZyA9IGZ1bmN0aW9uIGdldENodW5rRVRhZyhQYXJ0TnVtYmVyLCBjYWxsYmFjaykge1xuICAgIHZhciBzdGFydCA9IFNsaWNlU2l6ZSAqIChQYXJ0TnVtYmVyIC0gMSk7XG4gICAgdmFyIGVuZCA9IE1hdGgubWluKHN0YXJ0ICsgU2xpY2VTaXplLCBGaWxlU2l6ZSk7XG4gICAgdmFyIENodW5rU2l6ZSA9IGVuZCAtIHN0YXJ0O1xuXG4gICAgaWYgKEVUYWdNYXBbUGFydE51bWJlcl0pIHtcbiAgICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgUGFydE51bWJlcjogUGFydE51bWJlcixcbiAgICAgICAgRVRhZzogRVRhZ01hcFtQYXJ0TnVtYmVyXSxcbiAgICAgICAgU2l6ZTogQ2h1bmtTaXplXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdXRpbC5maWxlU2xpY2UocGFyYW1zLkJvZHksIHN0YXJ0LCBlbmQsIGZhbHNlLCBmdW5jdGlvbiAoY2h1bmtJdGVtKSB7XG4gICAgICAgIHV0aWwuZ2V0RmlsZU1kNShjaHVua0l0ZW0sIGZ1bmN0aW9uIChlcnIsIG1kNSkge1xuICAgICAgICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayh1dGlsLmVycm9yKGVycikpO1xuICAgICAgICAgIHZhciBFVGFnID0gJ1wiJyArIG1kNSArICdcIic7XG4gICAgICAgICAgRVRhZ01hcFtQYXJ0TnVtYmVyXSA9IEVUYWc7XG4gICAgICAgICAgRmluaXNoU2xpY2VDb3VudCArPSAxO1xuICAgICAgICAgIEZpbmlzaFNpemUgKz0gQ2h1bmtTaXplO1xuICAgICAgICAgIG9uSGFzaFByb2dyZXNzKHtcbiAgICAgICAgICAgIGxvYWRlZDogRmluaXNoU2l6ZSxcbiAgICAgICAgICAgIHRvdGFsOiBGaWxlU2l6ZVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgICAgIFBhcnROdW1iZXI6IFBhcnROdW1iZXIsXG4gICAgICAgICAgICBFVGFnOiBFVGFnLFxuICAgICAgICAgICAgU2l6ZTogQ2h1bmtTaXplXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9OyAvLyDpgJrov4flkozmlofku7bnmoQgbWQ1IOWvueavlO+8jOWIpOaWrSBVcGxvYWRJZCDmmK/lkKblj6/nlKhcblxuXG4gIHZhciBpc0F2YWlsYWJsZVVwbG9hZExpc3QgPSBmdW5jdGlvbiBpc0F2YWlsYWJsZVVwbG9hZExpc3QoUGFydExpc3QsIGNhbGxiYWNrKSB7XG4gICAgdmFyIFBhcnRDb3VudCA9IFBhcnRMaXN0Lmxlbmd0aDsgLy8g5aaC5p6c5rKh5pyJ5YiG54mH77yM6YCa6L+HXG5cbiAgICBpZiAoUGFydENvdW50ID09PSAwKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwgdHJ1ZSk7XG4gICAgfSAvLyDmo4Dmn6XliIbniYfmlbDph49cblxuXG4gICAgaWYgKFBhcnRDb3VudCA+IFNsaWNlQ291bnQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCBmYWxzZSk7XG4gICAgfSAvLyDmo4Dmn6XliIbniYflpKflsI9cblxuXG4gICAgaWYgKFBhcnRDb3VudCA+IDEpIHtcbiAgICAgIHZhciBQYXJ0U2xpY2VTaXplID0gTWF0aC5tYXgoUGFydExpc3RbMF0uU2l6ZSwgUGFydExpc3RbMV0uU2l6ZSk7XG5cbiAgICAgIGlmIChQYXJ0U2xpY2VTaXplICE9PSBTbGljZVNpemUpIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9IC8vIOmAkOS4quWIhueJh+iuoeeul+W5tuajgOafpSBFVGFnIOaYr+WQpuS4gOiHtFxuXG5cbiAgICB2YXIgbmV4dCA9IGZ1bmN0aW9uIG5leHQoaW5kZXgpIHtcbiAgICAgIGlmIChpbmRleCA8IFBhcnRDb3VudCkge1xuICAgICAgICB2YXIgUGFydCA9IFBhcnRMaXN0W2luZGV4XTtcbiAgICAgICAgZ2V0Q2h1bmtFVGFnKFBhcnQuUGFydE51bWJlciwgZnVuY3Rpb24gKGVyciwgY2h1bmspIHtcbiAgICAgICAgICBpZiAoY2h1bmsgJiYgY2h1bmsuRVRhZyA9PT0gUGFydC5FVGFnICYmIGNodW5rLlNpemUgPT09IFBhcnQuU2l6ZSkge1xuICAgICAgICAgICAgbmV4dChpbmRleCArIDEpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBmYWxzZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHRydWUpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBuZXh0KDApO1xuICB9O1xuXG4gIHZhciBlcCA9IG5ldyBFdmVudFByb3h5KCk7XG4gIGVwLm9uKCdlcnJvcicsIGZ1bmN0aW9uIChlcnJEYXRhKSB7XG4gICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcbiAgICByZXR1cm4gY2FsbGJhY2soZXJyRGF0YSk7XG4gIH0pOyAvLyDlrZjlnKggVXBsb2FkSWRcblxuICBlcC5vbigndXBsb2FkX2lkX2F2YWlsYWJsZScsIGZ1bmN0aW9uIChVcGxvYWREYXRhKSB7XG4gICAgLy8g6L2s5o2i5oiQIG1hcFxuICAgIHZhciBtYXAgPSB7fTtcbiAgICB2YXIgbGlzdCA9IFtdO1xuICAgIHV0aWwuZWFjaChVcGxvYWREYXRhLlBhcnRMaXN0LCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgbWFwW2l0ZW0uUGFydE51bWJlcl0gPSBpdGVtO1xuICAgIH0pO1xuXG4gICAgZm9yICh2YXIgUGFydE51bWJlciA9IDE7IFBhcnROdW1iZXIgPD0gU2xpY2VDb3VudDsgUGFydE51bWJlcisrKSB7XG4gICAgICB2YXIgaXRlbSA9IG1hcFtQYXJ0TnVtYmVyXTtcblxuICAgICAgaWYgKGl0ZW0pIHtcbiAgICAgICAgaXRlbS5QYXJ0TnVtYmVyID0gUGFydE51bWJlcjtcbiAgICAgICAgaXRlbS5VcGxvYWRlZCA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpdGVtID0ge1xuICAgICAgICAgIFBhcnROdW1iZXI6IFBhcnROdW1iZXIsXG4gICAgICAgICAgRVRhZzogbnVsbCxcbiAgICAgICAgICBVcGxvYWRlZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgbGlzdC5wdXNoKGl0ZW0pO1xuICAgIH1cblxuICAgIFVwbG9hZERhdGEuUGFydExpc3QgPSBsaXN0O1xuICAgIGNhbGxiYWNrKG51bGwsIFVwbG9hZERhdGEpO1xuICB9KTsgLy8g5LiN5a2Y5ZyoIFVwbG9hZElkLCDliJ3lp4vljJbnlJ/miJAgVXBsb2FkSWRcblxuICBlcC5vbignbm9fYXZhaWxhYmxlX3VwbG9hZF9pZCcsIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoIXNlbGYuX2lzUnVubmluZ1Rhc2soVGFza0lkKSkgcmV0dXJuO1xuXG4gICAgdmFyIF9wYXJhbXMgPSB1dGlsLmV4dGVuZCh7XG4gICAgICBCdWNrZXQ6IEJ1Y2tldCxcbiAgICAgIFJlZ2lvbjogUmVnaW9uLFxuICAgICAgS2V5OiBLZXksXG4gICAgICBRdWVyeTogdXRpbC5jbG9uZShwYXJhbXMuUXVlcnkpLFxuICAgICAgU3RvcmFnZUNsYXNzOiBTdG9yYWdlQ2xhc3MsXG4gICAgICBCb2R5OiBwYXJhbXMuQm9keSxcbiAgICAgIGNhbGxlZEJ5U2RrOiAnc2xpY2VVcGxvYWRGaWxlJyxcbiAgICAgIHRyYWNrZXI6IHBhcmFtcy50cmFja2VyXG4gICAgfSwgcGFyYW1zKTtcblxuICAgIHZhciBoZWFkZXJzID0gdXRpbC5jbG9uZShwYXJhbXMuSGVhZGVycyk7XG4gICAgZGVsZXRlIGhlYWRlcnNbJ3gtY29zLW1pbWUtbGltaXQnXTtcbiAgICBfcGFyYW1zLkhlYWRlcnMgPSBoZWFkZXJzO1xuICAgIHNlbGYubXVsdGlwYXJ0SW5pdChfcGFyYW1zLCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgICBpZiAoIXNlbGYuX2lzUnVubmluZ1Rhc2soVGFza0lkKSkgcmV0dXJuO1xuICAgICAgaWYgKGVycikgcmV0dXJuIGVwLmVtaXQoJ2Vycm9yJywgZXJyKTtcbiAgICAgIHZhciBVcGxvYWRJZCA9IGRhdGEuVXBsb2FkSWQ7XG5cbiAgICAgIGlmICghVXBsb2FkSWQpIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKCdubyBzdWNoIHVwbG9hZCBpZCcpKSk7XG4gICAgICB9XG5cbiAgICAgIGVwLmVtaXQoJ3VwbG9hZF9pZF9hdmFpbGFibGUnLCB7XG4gICAgICAgIFVwbG9hZElkOiBVcGxvYWRJZCxcbiAgICAgICAgUGFydExpc3Q6IFtdXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7IC8vIOWmguaenOW3suWtmOWcqCBVcGxvYWRJZO+8jOaJvuS4gOS4quWPr+S7peeUqOeahCBVcGxvYWRJZFxuXG4gIGVwLm9uKCdoYXNfYW5kX2NoZWNrX3VwbG9hZF9pZCcsIGZ1bmN0aW9uIChVcGxvYWRJZExpc3QpIHtcbiAgICAvLyDkuLLooYzlnLDvvIzmib7kuIDkuKrlhoXlrrnkuIDoh7TnmoQgVXBsb2FkSWRcbiAgICBVcGxvYWRJZExpc3QgPSBVcGxvYWRJZExpc3QucmV2ZXJzZSgpO1xuICAgIEFzeW5jLmVhY2hMaW1pdChVcGxvYWRJZExpc3QsIDEsIGZ1bmN0aW9uIChVcGxvYWRJZCwgYXN5bmNDYWxsYmFjaykge1xuICAgICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjsgLy8g5aaC5p6c5q2j5Zyo5LiK5Lyg77yM6Lez6L+HXG5cbiAgICAgIGlmIChzZXNzaW9uLnVzaW5nW1VwbG9hZElkXSkge1xuICAgICAgICBhc3luY0NhbGxiYWNrKCk7IC8vIOajgOafpeS4i+S4gOS4qiBVcGxvYWRJZFxuXG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gLy8g5Yik5patIFVwbG9hZElkIOaYr+WQpuWPr+eUqFxuXG5cbiAgICAgIHdob2xlTXVsdGlwYXJ0TGlzdFBhcnQuY2FsbChzZWxmLCB7XG4gICAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgICAgS2V5OiBLZXksXG4gICAgICAgIFVwbG9hZElkOiBVcGxvYWRJZCxcbiAgICAgICAgdHJhY2tlcjogcGFyYW1zLnRyYWNrZXJcbiAgICAgIH0sIGZ1bmN0aW9uIChlcnIsIFBhcnRMaXN0RGF0YSkge1xuICAgICAgICBpZiAoIXNlbGYuX2lzUnVubmluZ1Rhc2soVGFza0lkKSkgcmV0dXJuO1xuXG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICBzZXNzaW9uLnJlbW92ZVVzaW5nKFVwbG9hZElkKTtcbiAgICAgICAgICByZXR1cm4gZXAuZW1pdCgnZXJyb3InLCBlcnIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIFBhcnRMaXN0ID0gUGFydExpc3REYXRhLlBhcnRMaXN0O1xuICAgICAgICBQYXJ0TGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgaXRlbS5QYXJ0TnVtYmVyICo9IDE7XG4gICAgICAgICAgaXRlbS5TaXplICo9IDE7XG4gICAgICAgICAgaXRlbS5FVGFnID0gaXRlbS5FVGFnIHx8ICcnO1xuICAgICAgICB9KTtcbiAgICAgICAgaXNBdmFpbGFibGVVcGxvYWRMaXN0KFBhcnRMaXN0LCBmdW5jdGlvbiAoZXJyLCBpc0F2YWlsYWJsZSkge1xuICAgICAgICAgIGlmICghc2VsZi5faXNSdW5uaW5nVGFzayhUYXNrSWQpKSByZXR1cm47XG4gICAgICAgICAgaWYgKGVycikgcmV0dXJuIGVwLmVtaXQoJ2Vycm9yJywgZXJyKTtcblxuICAgICAgICAgIGlmIChpc0F2YWlsYWJsZSkge1xuICAgICAgICAgICAgYXN5bmNDYWxsYmFjayh7XG4gICAgICAgICAgICAgIFVwbG9hZElkOiBVcGxvYWRJZCxcbiAgICAgICAgICAgICAgUGFydExpc3Q6IFBhcnRMaXN0XG4gICAgICAgICAgICB9KTsgLy8g6ams5LiK57uT5p2fXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFzeW5jQ2FsbGJhY2soKTsgLy8g5qOA5p+l5LiL5LiA5LiqIFVwbG9hZElkXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0sIGZ1bmN0aW9uIChBdmFpbGFibGVVcGxvYWREYXRhKSB7XG4gICAgICBpZiAoIXNlbGYuX2lzUnVubmluZ1Rhc2soVGFza0lkKSkgcmV0dXJuO1xuICAgICAgb25IYXNoUHJvZ3Jlc3MobnVsbCwgdHJ1ZSk7XG5cbiAgICAgIGlmIChBdmFpbGFibGVVcGxvYWREYXRhICYmIEF2YWlsYWJsZVVwbG9hZERhdGEuVXBsb2FkSWQpIHtcbiAgICAgICAgZXAuZW1pdCgndXBsb2FkX2lkX2F2YWlsYWJsZScsIEF2YWlsYWJsZVVwbG9hZERhdGEpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZXAuZW1pdCgnbm9fYXZhaWxhYmxlX3VwbG9hZF9pZCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTsgLy8g5Zyo5pys5Zyw57yT5a2Y5om+5Y+v55So55qEIFVwbG9hZElkXG5cbiAgZXAub24oJ3NlZWtfbG9jYWxfYXZhaWxfdXBsb2FkX2lkJywgZnVuY3Rpb24gKFJlbW90ZVVwbG9hZElkTGlzdCkge1xuICAgIC8vIOWcqOacrOWcsOaJvuWPr+eUqOeahCBVcGxvYWRJZFxuICAgIHZhciB1dWlkID0gc2Vzc2lvbi5nZXRGaWxlSWQocGFyYW1zLkJvZHksIHBhcmFtcy5DaHVua1NpemUsIEJ1Y2tldCwgS2V5KTtcbiAgICB2YXIgTG9jYWxVcGxvYWRJZExpc3QgPSBzZXNzaW9uLmdldFVwbG9hZElkTGlzdC5jYWxsKHNlbGYsIHV1aWQpO1xuXG4gICAgaWYgKCF1dWlkIHx8ICFMb2NhbFVwbG9hZElkTGlzdCkge1xuICAgICAgZXAuZW1pdCgnaGFzX2FuZF9jaGVja191cGxvYWRfaWQnLCBSZW1vdGVVcGxvYWRJZExpc3QpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBuZXh0ID0gZnVuY3Rpb24gbmV4dChpbmRleCkge1xuICAgICAgLy8g5aaC5p6c5pys5Zyw5om+5LiN5Yiw5Y+v55SoIFVwbG9hZElk77yM5YaN5LiA5Liq5Liq6YGN5Y6G5qCh6aqM6L+c56uvXG4gICAgICBpZiAoaW5kZXggPj0gTG9jYWxVcGxvYWRJZExpc3QubGVuZ3RoKSB7XG4gICAgICAgIGVwLmVtaXQoJ2hhc19hbmRfY2hlY2tfdXBsb2FkX2lkJywgUmVtb3RlVXBsb2FkSWRMaXN0KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB2YXIgVXBsb2FkSWQgPSBMb2NhbFVwbG9hZElkTGlzdFtpbmRleF07IC8vIOWmguaenOS4jeWcqOi/nOerryBVcGxvYWRJZCDliJfooajph4zvvIzot7Pov4flubbliKDpmaRcblxuICAgICAgaWYgKCF1dGlsLmlzSW5BcnJheShSZW1vdGVVcGxvYWRJZExpc3QsIFVwbG9hZElkKSkge1xuICAgICAgICBzZXNzaW9uLnJlbW92ZVVwbG9hZElkLmNhbGwoc2VsZiwgVXBsb2FkSWQpO1xuICAgICAgICBuZXh0KGluZGV4ICsgMSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gLy8g5aaC5p6c5q2j5Zyo5LiK5Lyg77yM6Lez6L+HXG5cblxuICAgICAgaWYgKHNlc3Npb24udXNpbmdbVXBsb2FkSWRdKSB7XG4gICAgICAgIG5leHQoaW5kZXggKyAxKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSAvLyDliKTmlq0gVXBsb2FkSWQg5piv5ZCm5a2Y5Zyo57q/5LiKXG5cblxuICAgICAgd2hvbGVNdWx0aXBhcnRMaXN0UGFydC5jYWxsKHNlbGYsIHtcbiAgICAgICAgQnVja2V0OiBCdWNrZXQsXG4gICAgICAgIFJlZ2lvbjogUmVnaW9uLFxuICAgICAgICBLZXk6IEtleSxcbiAgICAgICAgVXBsb2FkSWQ6IFVwbG9hZElkLFxuICAgICAgICB0cmFja2VyOiBwYXJhbXMudHJhY2tlclxuICAgICAgfSwgZnVuY3Rpb24gKGVyciwgUGFydExpc3REYXRhKSB7XG4gICAgICAgIGlmICghc2VsZi5faXNSdW5uaW5nVGFzayhUYXNrSWQpKSByZXR1cm47XG5cbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIC8vIOWmguaenCBVcGxvYWRJZCDojrflj5bkvJrlh7rplJnvvIzot7Pov4flubbliKDpmaRcbiAgICAgICAgICBzZXNzaW9uLnJlbW92ZVVwbG9hZElkLmNhbGwoc2VsZiwgVXBsb2FkSWQpO1xuICAgICAgICAgIG5leHQoaW5kZXggKyAxKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyDmib7liLDlj6/nlKggVXBsb2FkSWRcbiAgICAgICAgICBlcC5lbWl0KCd1cGxvYWRfaWRfYXZhaWxhYmxlJywge1xuICAgICAgICAgICAgVXBsb2FkSWQ6IFVwbG9hZElkLFxuICAgICAgICAgICAgUGFydExpc3Q6IFBhcnRMaXN0RGF0YS5QYXJ0TGlzdFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgbmV4dCgwKTtcbiAgfSk7IC8vIOiOt+WPlue6v+S4iiBVcGxvYWRJZCDliJfooahcblxuICBlcC5vbignZ2V0X3JlbW90ZV91cGxvYWRfaWRfbGlzdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAvLyDojrflj5bnrKblkIjmnaHku7bnmoQgVXBsb2FkSWQg5YiX6KGo77yM5Zug5Li65ZCM5LiA5Liq5paH5Lu25Y+v5Lul5pyJ5aSa5Liq5LiK5Lyg5Lu75Yqh44CCXG4gICAgd2hvbGVNdWx0aXBhcnRMaXN0LmNhbGwoc2VsZiwge1xuICAgICAgQnVja2V0OiBCdWNrZXQsXG4gICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgIEtleTogS2V5LFxuICAgICAgdHJhY2tlcjogcGFyYW1zLnRyYWNrZXJcbiAgICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgICBpZiAoIXNlbGYuX2lzUnVubmluZ1Rhc2soVGFza0lkKSkgcmV0dXJuO1xuICAgICAgaWYgKGVycikgcmV0dXJuIGVwLmVtaXQoJ2Vycm9yJywgZXJyKTsgLy8g5pW055CG6L+c56uvIFVwbG9hZElkIOWIl+ihqFxuXG4gICAgICB2YXIgUmVtb3RlVXBsb2FkSWRMaXN0ID0gdXRpbC5maWx0ZXIoZGF0YS5VcGxvYWRMaXN0LCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICByZXR1cm4gaXRlbS5LZXkgPT09IEtleSAmJiAoIVN0b3JhZ2VDbGFzcyB8fCBpdGVtLlN0b3JhZ2VDbGFzcy50b1VwcGVyQ2FzZSgpID09PSBTdG9yYWdlQ2xhc3MudG9VcHBlckNhc2UoKSk7XG4gICAgICB9KS5yZXZlcnNlKCkubWFwKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHJldHVybiBpdGVtLlVwbG9hZElkIHx8IGl0ZW0uVXBsb2FkSUQ7XG4gICAgICB9KTtcblxuICAgICAgaWYgKFJlbW90ZVVwbG9hZElkTGlzdC5sZW5ndGgpIHtcbiAgICAgICAgZXAuZW1pdCgnc2Vla19sb2NhbF9hdmFpbF91cGxvYWRfaWQnLCBSZW1vdGVVcGxvYWRJZExpc3QpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8g6L+c56uv5rKh5pyJIFVwbG9hZElk77yM5riF55CG57yT5a2Y55qEIFVwbG9hZElkXG4gICAgICAgIHZhciB1dWlkID0gc2Vzc2lvbi5nZXRGaWxlSWQocGFyYW1zLkJvZHksIHBhcmFtcy5DaHVua1NpemUsIEJ1Y2tldCwgS2V5KSxcbiAgICAgICAgICAgIExvY2FsVXBsb2FkSWRMaXN0O1xuXG4gICAgICAgIGlmICh1dWlkICYmIChMb2NhbFVwbG9hZElkTGlzdCA9IHNlc3Npb24uZ2V0VXBsb2FkSWRMaXN0LmNhbGwoc2VsZiwgdXVpZCkpKSB7XG4gICAgICAgICAgdXRpbC5lYWNoKExvY2FsVXBsb2FkSWRMaXN0LCBmdW5jdGlvbiAoVXBsb2FkSWQpIHtcbiAgICAgICAgICAgIHNlc3Npb24ucmVtb3ZlVXBsb2FkSWQuY2FsbChzZWxmLCBVcGxvYWRJZCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBlcC5lbWl0KCdub19hdmFpbGFibGVfdXBsb2FkX2lkJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pOyAvLyDlvIDlp4vmib7lj6/nlKggVXBsb2FkSWRcblxuICBlcC5lbWl0KCdnZXRfcmVtb3RlX3VwbG9hZF9pZF9saXN0Jyk7XG59IC8vIOiOt+WPluespuWQiOadoeS7tueahOWFqOmDqOS4iuS8oOS7u+WKoSAo5p2h5Lu25YyF5ousIEJ1Y2tldCwgUmVnaW9uLCBQcmVmaXgpXG5cblxuZnVuY3Rpb24gd2hvbGVNdWx0aXBhcnRMaXN0KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgVXBsb2FkTGlzdCA9IFtdO1xuICB2YXIgc2VuZFBhcmFtcyA9IHtcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIFByZWZpeDogcGFyYW1zLktleSxcbiAgICBjYWxsZWRCeVNkazogcGFyYW1zLmNhbGxlZEJ5U2RrIHx8ICdzbGljZVVwbG9hZEZpbGUnLFxuICAgIHRyYWNrZXI6IHBhcmFtcy50cmFja2VyXG4gIH07XG5cbiAgdmFyIG5leHQgPSBmdW5jdGlvbiBuZXh0KCkge1xuICAgIHNlbGYubXVsdGlwYXJ0TGlzdChzZW5kUGFyYW1zLCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgIFVwbG9hZExpc3QucHVzaC5hcHBseShVcGxvYWRMaXN0LCBkYXRhLlVwbG9hZCB8fCBbXSk7XG5cbiAgICAgIGlmIChkYXRhLklzVHJ1bmNhdGVkID09PSAndHJ1ZScpIHtcbiAgICAgICAgLy8g5YiX6KGo5LiN5a6M5pW0XG4gICAgICAgIHNlbmRQYXJhbXMuS2V5TWFya2VyID0gZGF0YS5OZXh0S2V5TWFya2VyO1xuICAgICAgICBzZW5kUGFyYW1zLlVwbG9hZElkTWFya2VyID0gZGF0YS5OZXh0VXBsb2FkSWRNYXJrZXI7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgICBVcGxvYWRMaXN0OiBVcGxvYWRMaXN0XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIG5leHQoKTtcbn0gLy8g6I635Y+W5oyH5a6a5LiK5Lyg5Lu75Yqh55qE5YiG5Z2X5YiX6KGoXG5cblxuZnVuY3Rpb24gd2hvbGVNdWx0aXBhcnRMaXN0UGFydChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIFBhcnRMaXN0ID0gW107XG4gIHZhciBzZW5kUGFyYW1zID0ge1xuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgS2V5OiBwYXJhbXMuS2V5LFxuICAgIFVwbG9hZElkOiBwYXJhbXMuVXBsb2FkSWQsXG4gICAgY2FsbGVkQnlTZGs6ICdzbGljZVVwbG9hZEZpbGUnLFxuICAgIHRyYWNrZXI6IHBhcmFtcy50cmFja2VyXG4gIH07XG5cbiAgdmFyIG5leHQgPSBmdW5jdGlvbiBuZXh0KCkge1xuICAgIHNlbGYubXVsdGlwYXJ0TGlzdFBhcnQoc2VuZFBhcmFtcywgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgaWYgKGVycikgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICBQYXJ0TGlzdC5wdXNoLmFwcGx5KFBhcnRMaXN0LCBkYXRhLlBhcnQgfHwgW10pO1xuXG4gICAgICBpZiAoZGF0YS5Jc1RydW5jYXRlZCA9PT0gJ3RydWUnKSB7XG4gICAgICAgIC8vIOWIl+ihqOS4jeWujOaVtFxuICAgICAgICBzZW5kUGFyYW1zLlBhcnROdW1iZXJNYXJrZXIgPSBkYXRhLk5leHRQYXJ0TnVtYmVyTWFya2VyO1xuICAgICAgICBuZXh0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgICAgUGFydExpc3Q6IFBhcnRMaXN0XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIG5leHQoKTtcbn0gLy8g5LiK5Lyg5paH5Lu25YiG5Z2X77yM5YyF5ousXG5cbi8qXHJcbiBVcGxvYWRJZCAo5LiK5Lyg5Lu75Yqh57yW5Y+3KVxyXG4gQXN5bmNMaW1pdCAo5bm25Y+R6YePKe+8jFxyXG4gU2xpY2VMaXN0ICjkuIrkvKDnmoTliIblnZfmlbDnu4Qp77yMXHJcbiBGaWxlUGF0aCAo5pys5Zyw5paH5Lu255qE5L2N572uKe+8jFxyXG4gU2xpY2VTaXplICjmlofku7bliIblnZflpKflsI8pXHJcbiBGaWxlU2l6ZSAo5paH5Lu25aSn5bCPKVxyXG4gb25Qcm9ncmVzcyAo5LiK5Lyg5oiQ5Yqf5LmL5ZCO55qE5Zue6LCD5Ye95pWwKVxyXG4gKi9cblxuXG5mdW5jdGlvbiB1cGxvYWRTbGljZUxpc3QocGFyYW1zLCBjYikge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBUYXNrSWQgPSBwYXJhbXMuVGFza0lkO1xuICB2YXIgQnVja2V0ID0gcGFyYW1zLkJ1Y2tldDtcbiAgdmFyIFJlZ2lvbiA9IHBhcmFtcy5SZWdpb247XG4gIHZhciBLZXkgPSBwYXJhbXMuS2V5O1xuICB2YXIgVXBsb2FkRGF0YSA9IHBhcmFtcy5VcGxvYWREYXRhO1xuICB2YXIgRmlsZVNpemUgPSBwYXJhbXMuRmlsZVNpemU7XG4gIHZhciBTbGljZVNpemUgPSBwYXJhbXMuU2xpY2VTaXplO1xuICB2YXIgQ2h1bmtQYXJhbGxlbCA9IE1hdGgubWluKHBhcmFtcy5Bc3luY0xpbWl0IHx8IHNlbGYub3B0aW9ucy5DaHVua1BhcmFsbGVsTGltaXQgfHwgMSwgMjU2KTtcbiAgdmFyIEJvZHkgPSBwYXJhbXMuQm9keTtcbiAgdmFyIFNsaWNlQ291bnQgPSBNYXRoLmNlaWwoRmlsZVNpemUgLyBTbGljZVNpemUpO1xuICB2YXIgRmluaXNoU2l6ZSA9IDA7XG4gIHZhciBTZXJ2ZXJTaWRlRW5jcnlwdGlvbiA9IHBhcmFtcy5TZXJ2ZXJTaWRlRW5jcnlwdGlvbjtcbiAgdmFyIEhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgdmFyIG5lZWRVcGxvYWRTbGljZXMgPSB1dGlsLmZpbHRlcihVcGxvYWREYXRhLlBhcnRMaXN0LCBmdW5jdGlvbiAoU2xpY2VJdGVtKSB7XG4gICAgaWYgKFNsaWNlSXRlbVsnVXBsb2FkZWQnXSkge1xuICAgICAgRmluaXNoU2l6ZSArPSBTbGljZUl0ZW1bJ1BhcnROdW1iZXInXSA+PSBTbGljZUNvdW50ID8gRmlsZVNpemUgJSBTbGljZVNpemUgfHwgU2xpY2VTaXplIDogU2xpY2VTaXplO1xuICAgIH1cblxuICAgIHJldHVybiAhU2xpY2VJdGVtWydVcGxvYWRlZCddO1xuICB9KTtcbiAgdmFyIF9vblByb2dyZXNzMiA9IHBhcmFtcy5vblByb2dyZXNzO1xuICBBc3luYy5lYWNoTGltaXQobmVlZFVwbG9hZFNsaWNlcywgQ2h1bmtQYXJhbGxlbCwgZnVuY3Rpb24gKFNsaWNlSXRlbSwgYXN5bmNDYWxsYmFjaykge1xuICAgIGlmICghc2VsZi5faXNSdW5uaW5nVGFzayhUYXNrSWQpKSByZXR1cm47XG4gICAgdmFyIFBhcnROdW1iZXIgPSBTbGljZUl0ZW1bJ1BhcnROdW1iZXInXTtcbiAgICB2YXIgY3VycmVudFNpemUgPSBNYXRoLm1pbihGaWxlU2l6ZSwgU2xpY2VJdGVtWydQYXJ0TnVtYmVyJ10gKiBTbGljZVNpemUpIC0gKFNsaWNlSXRlbVsnUGFydE51bWJlciddIC0gMSkgKiBTbGljZVNpemU7XG4gICAgdmFyIHByZUFkZFNpemUgPSAwO1xuICAgIHVwbG9hZFNsaWNlSXRlbS5jYWxsKHNlbGYsIHtcbiAgICAgIFRhc2tJZDogVGFza0lkLFxuICAgICAgQnVja2V0OiBCdWNrZXQsXG4gICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgIEtleTogS2V5LFxuICAgICAgU2xpY2VTaXplOiBTbGljZVNpemUsXG4gICAgICBGaWxlU2l6ZTogRmlsZVNpemUsXG4gICAgICBQYXJ0TnVtYmVyOiBQYXJ0TnVtYmVyLFxuICAgICAgU2VydmVyU2lkZUVuY3J5cHRpb246IFNlcnZlclNpZGVFbmNyeXB0aW9uLFxuICAgICAgQm9keTogQm9keSxcbiAgICAgIFVwbG9hZERhdGE6IFVwbG9hZERhdGEsXG4gICAgICBIZWFkZXJzOiBIZWFkZXJzLFxuICAgICAgb25Qcm9ncmVzczogZnVuY3Rpb24gb25Qcm9ncmVzcyhkYXRhKSB7XG4gICAgICAgIEZpbmlzaFNpemUgKz0gZGF0YS5sb2FkZWQgLSBwcmVBZGRTaXplO1xuICAgICAgICBwcmVBZGRTaXplID0gZGF0YS5sb2FkZWQ7XG5cbiAgICAgICAgX29uUHJvZ3Jlc3MyKHtcbiAgICAgICAgICBsb2FkZWQ6IEZpbmlzaFNpemUsXG4gICAgICAgICAgdG90YWw6IEZpbGVTaXplXG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIHRyYWNrZXI6IHBhcmFtcy50cmFja2VyXG4gICAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcbiAgICAgIGlmICghZXJyICYmICFkYXRhLkVUYWcpIGVyciA9ICdnZXQgRVRhZyBlcnJvciwgcGxlYXNlIGFkZCBcIkVUYWdcIiB0byBDT1JTIEV4cG9zZUhlYWRlciBzZXR0aW5nLigg6I635Y+WRVRhZ+Wksei0pe+8jOivt+WcqENPUlMgRXhwb3NlSGVhZGVy6K6+572u5Lit5re75YqgRVRhZ++8jOivt+WPguiAg+aWh+aho++8mmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvMTMzMTggKSc7XG5cbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgRmluaXNoU2l6ZSAtPSBwcmVBZGRTaXplO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgRmluaXNoU2l6ZSArPSBjdXJyZW50U2l6ZSAtIHByZUFkZFNpemU7XG4gICAgICAgIFNsaWNlSXRlbS5FVGFnID0gZGF0YS5FVGFnO1xuICAgICAgfVxuXG4gICAgICBfb25Qcm9ncmVzczIoe1xuICAgICAgICBsb2FkZWQ6IEZpbmlzaFNpemUsXG4gICAgICAgIHRvdGFsOiBGaWxlU2l6ZVxuICAgICAgfSk7XG5cbiAgICAgIGFzeW5jQ2FsbGJhY2soZXJyIHx8IG51bGwsIGRhdGEpO1xuICAgIH0pO1xuICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcbiAgICBpZiAoZXJyKSByZXR1cm4gY2IoZXJyKTtcbiAgICBjYihudWxsLCB7XG4gICAgICBVcGxvYWRJZDogVXBsb2FkRGF0YS5VcGxvYWRJZCxcbiAgICAgIFNsaWNlTGlzdDogVXBsb2FkRGF0YS5QYXJ0TGlzdFxuICAgIH0pO1xuICB9KTtcbn0gLy8g5LiK5Lyg5oyH5a6a5YiG54mHXG5cblxuZnVuY3Rpb24gdXBsb2FkU2xpY2VJdGVtKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgVGFza0lkID0gcGFyYW1zLlRhc2tJZDtcbiAgdmFyIEJ1Y2tldCA9IHBhcmFtcy5CdWNrZXQ7XG4gIHZhciBSZWdpb24gPSBwYXJhbXMuUmVnaW9uO1xuICB2YXIgS2V5ID0gcGFyYW1zLktleTtcbiAgdmFyIEZpbGVTaXplID0gcGFyYW1zLkZpbGVTaXplO1xuICB2YXIgRmlsZUJvZHkgPSBwYXJhbXMuQm9keTtcbiAgdmFyIFBhcnROdW1iZXIgPSBwYXJhbXMuUGFydE51bWJlciAqIDE7XG4gIHZhciBTbGljZVNpemUgPSBwYXJhbXMuU2xpY2VTaXplO1xuICB2YXIgU2VydmVyU2lkZUVuY3J5cHRpb24gPSBwYXJhbXMuU2VydmVyU2lkZUVuY3J5cHRpb247XG4gIHZhciBVcGxvYWREYXRhID0gcGFyYW1zLlVwbG9hZERhdGE7XG4gIHZhciBIZWFkZXJzID0gcGFyYW1zLkhlYWRlcnMgfHwge307XG4gIHZhciBDaHVua1JldHJ5VGltZXMgPSBzZWxmLm9wdGlvbnMuQ2h1bmtSZXRyeVRpbWVzICsgMTtcbiAgdmFyIHN0YXJ0ID0gU2xpY2VTaXplICogKFBhcnROdW1iZXIgLSAxKTtcbiAgdmFyIENvbnRlbnRMZW5ndGggPSBTbGljZVNpemU7XG4gIHZhciBlbmQgPSBzdGFydCArIFNsaWNlU2l6ZTtcblxuICBpZiAoZW5kID4gRmlsZVNpemUpIHtcbiAgICBlbmQgPSBGaWxlU2l6ZTtcbiAgICBDb250ZW50TGVuZ3RoID0gZW5kIC0gc3RhcnQ7XG4gIH1cblxuICB2YXIgaGVhZGVyc1doaXRlTGlzdCA9IFsneC1jb3MtdHJhZmZpYy1saW1pdCcsICd4LWNvcy1taW1lLWxpbWl0J107XG4gIHZhciBoZWFkZXJzID0ge307XG4gIHV0aWwuZWFjaChIZWFkZXJzLCBmdW5jdGlvbiAodiwgaykge1xuICAgIGlmIChoZWFkZXJzV2hpdGVMaXN0LmluZGV4T2YoaykgPiAtMSkge1xuICAgICAgaGVhZGVyc1trXSA9IHY7XG4gICAgfVxuICB9KTtcbiAgdmFyIFBhcnRJdGVtID0gVXBsb2FkRGF0YS5QYXJ0TGlzdFtQYXJ0TnVtYmVyIC0gMV07XG4gIEFzeW5jLnJldHJ5KENodW5rUmV0cnlUaW1lcywgZnVuY3Rpb24gKHRyeUNhbGxiYWNrKSB7XG4gICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcbiAgICB1dGlsLmZpbGVTbGljZShGaWxlQm9keSwgc3RhcnQsIGVuZCwgdHJ1ZSwgZnVuY3Rpb24gKEJvZHkpIHtcbiAgICAgIHNlbGYubXVsdGlwYXJ0VXBsb2FkKHtcbiAgICAgICAgVGFza0lkOiBUYXNrSWQsXG4gICAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgICAgS2V5OiBLZXksXG4gICAgICAgIENvbnRlbnRMZW5ndGg6IENvbnRlbnRMZW5ndGgsXG4gICAgICAgIFBhcnROdW1iZXI6IFBhcnROdW1iZXIsXG4gICAgICAgIFVwbG9hZElkOiBVcGxvYWREYXRhLlVwbG9hZElkLFxuICAgICAgICBTZXJ2ZXJTaWRlRW5jcnlwdGlvbjogU2VydmVyU2lkZUVuY3J5cHRpb24sXG4gICAgICAgIEJvZHk6IEJvZHksXG4gICAgICAgIEhlYWRlcnM6IGhlYWRlcnMsXG4gICAgICAgIG9uUHJvZ3Jlc3M6IHBhcmFtcy5vblByb2dyZXNzLFxuICAgICAgICBjYWxsZWRCeVNkazogJ3NsaWNlVXBsb2FkRmlsZScsXG4gICAgICAgIHRyYWNrZXI6IHBhcmFtcy50cmFja2VyXG4gICAgICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgICAgIGlmICghc2VsZi5faXNSdW5uaW5nVGFzayhUYXNrSWQpKSByZXR1cm47XG4gICAgICAgIGlmIChlcnIpIHJldHVybiB0cnlDYWxsYmFjayhlcnIpO1xuICAgICAgICBQYXJ0SXRlbS5VcGxvYWRlZCA9IHRydWU7XG4gICAgICAgIHJldHVybiB0cnlDYWxsYmFjayhudWxsLCBkYXRhKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcbiAgICByZXR1cm4gY2FsbGJhY2soZXJyLCBkYXRhKTtcbiAgfSk7XG59IC8vIOWujOaIkOWIhuWdl+S4iuS8oFxuXG5cbmZ1bmN0aW9uIHVwbG9hZFNsaWNlQ29tcGxldGUocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgQnVja2V0ID0gcGFyYW1zLkJ1Y2tldDtcbiAgdmFyIFJlZ2lvbiA9IHBhcmFtcy5SZWdpb247XG4gIHZhciBLZXkgPSBwYXJhbXMuS2V5O1xuICB2YXIgVXBsb2FkSWQgPSBwYXJhbXMuVXBsb2FkSWQ7XG4gIHZhciBTbGljZUxpc3QgPSBwYXJhbXMuU2xpY2VMaXN0O1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBDaHVua1JldHJ5VGltZXMgPSB0aGlzLm9wdGlvbnMuQ2h1bmtSZXRyeVRpbWVzICsgMTtcbiAgdmFyIEhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgdmFyIFBhcnRzID0gU2xpY2VMaXN0Lm1hcChmdW5jdGlvbiAoaXRlbSkge1xuICAgIHJldHVybiB7XG4gICAgICBQYXJ0TnVtYmVyOiBpdGVtLlBhcnROdW1iZXIsXG4gICAgICBFVGFnOiBpdGVtLkVUYWdcbiAgICB9O1xuICB9KTsgLy8g5a6M5oiQ5LiK5Lyg55qE6K+35rGC5Lmf5YGa6YeN6K+VXG5cbiAgQXN5bmMucmV0cnkoQ2h1bmtSZXRyeVRpbWVzLCBmdW5jdGlvbiAodHJ5Q2FsbGJhY2spIHtcbiAgICBzZWxmLm11bHRpcGFydENvbXBsZXRlKHtcbiAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgUmVnaW9uOiBSZWdpb24sXG4gICAgICBLZXk6IEtleSxcbiAgICAgIFVwbG9hZElkOiBVcGxvYWRJZCxcbiAgICAgIFBhcnRzOiBQYXJ0cyxcbiAgICAgIEhlYWRlcnM6IEhlYWRlcnMsXG4gICAgICBjYWxsZWRCeVNkazogJ3NsaWNlVXBsb2FkRmlsZScsXG4gICAgICB0cmFja2VyOiBwYXJhbXMudHJhY2tlclxuICAgIH0sIHRyeUNhbGxiYWNrKTtcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGNhbGxiYWNrKGVyciwgZGF0YSk7XG4gIH0pO1xufSAvLyDmipvlvIPliIblnZfkuIrkvKDku7vliqFcblxuLypcclxuIEFzeW5jTGltaXQgKOaKm+W8g+S4iuS8oOS7u+WKoeeahOW5tuWPkemHjynvvIxcclxuIFVwbG9hZElkICjkuIrkvKDku7vliqHnmoTnvJblj7fvvIzlvZMgTGV2ZWwg5Li6IHRhc2sg5pe25YCZ6ZyA6KaBKVxyXG4gTGV2ZWwgKOaKm+W8g+WIhuWdl+S4iuS8oOS7u+WKoeeahOe6p+WIq++8jHRhc2sgOiDmipvlvIPmjIflrprnmoTkuIrkvKDku7vliqHvvIxmaWxlIO+8miDmipvlvIPmjIflrprnmoTmlofku7blr7nlupTnmoTkuIrkvKDku7vliqHvvIzlhbbku5blgLwg77ya5oqb5byD5oyH5a6aQnVja2V0IOeahOWFqOmDqOS4iuS8oOS7u+WKoSlcclxuICovXG5cblxuZnVuY3Rpb24gYWJvcnRVcGxvYWRUYXNrKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIEJ1Y2tldCA9IHBhcmFtcy5CdWNrZXQ7XG4gIHZhciBSZWdpb24gPSBwYXJhbXMuUmVnaW9uO1xuICB2YXIgS2V5ID0gcGFyYW1zLktleTtcbiAgdmFyIFVwbG9hZElkID0gcGFyYW1zLlVwbG9hZElkO1xuICB2YXIgTGV2ZWwgPSBwYXJhbXMuTGV2ZWwgfHwgJ3Rhc2snO1xuICB2YXIgQXN5bmNMaW1pdCA9IHBhcmFtcy5Bc3luY0xpbWl0O1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBlcCA9IG5ldyBFdmVudFByb3h5KCk7XG4gIGVwLm9uKCdlcnJvcicsIGZ1bmN0aW9uIChlcnJEYXRhKSB7XG4gICAgcmV0dXJuIGNhbGxiYWNrKGVyckRhdGEpO1xuICB9KTsgLy8g5bey57uP6I635Y+W5Yiw6ZyA6KaB5oqb5byD55qE5Lu75Yqh5YiX6KGoXG5cbiAgZXAub24oJ2dldF9hYm9ydF9hcnJheScsIGZ1bmN0aW9uIChBYm9ydEFycmF5KSB7XG4gICAgYWJvcnRVcGxvYWRUYXNrQXJyYXkuY2FsbChzZWxmLCB7XG4gICAgICBCdWNrZXQ6IEJ1Y2tldCxcbiAgICAgIFJlZ2lvbjogUmVnaW9uLFxuICAgICAgS2V5OiBLZXksXG4gICAgICBIZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICAgIEFzeW5jTGltaXQ6IEFzeW5jTGltaXQsXG4gICAgICBBYm9ydEFycmF5OiBBYm9ydEFycmF5XG4gICAgfSwgY2FsbGJhY2spO1xuICB9KTtcblxuICBpZiAoTGV2ZWwgPT09ICdidWNrZXQnKSB7XG4gICAgLy8gQnVja2V0IOe6p+WIq+eahOS7u+WKoeaKm+W8g++8jOaKm+W8g+ivpSBCdWNrZXQg5LiL55qE5YWo6YOo5LiK5Lyg5Lu75YqhXG4gICAgd2hvbGVNdWx0aXBhcnRMaXN0LmNhbGwoc2VsZiwge1xuICAgICAgQnVja2V0OiBCdWNrZXQsXG4gICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgIGNhbGxlZEJ5U2RrOiAnYWJvcnRVcGxvYWRUYXNrJ1xuICAgIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgZXAuZW1pdCgnZ2V0X2Fib3J0X2FycmF5JywgZGF0YS5VcGxvYWRMaXN0IHx8IFtdKTtcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChMZXZlbCA9PT0gJ2ZpbGUnKSB7XG4gICAgLy8g5paH5Lu257qn5Yir55qE5Lu75Yqh5oqb5byD77yM5oqb5byD6K+l5paH5Lu255qE5YWo6YOo5LiK5Lyg5Lu75YqhXG4gICAgaWYgKCFLZXkpIHJldHVybiBjYWxsYmFjayh1dGlsLmVycm9yKG5ldyBFcnJvcignYWJvcnRfdXBsb2FkX3Rhc2tfbm9fa2V5JykpKTtcbiAgICB3aG9sZU11bHRpcGFydExpc3QuY2FsbChzZWxmLCB7XG4gICAgICBCdWNrZXQ6IEJ1Y2tldCxcbiAgICAgIFJlZ2lvbjogUmVnaW9uLFxuICAgICAgS2V5OiBLZXksXG4gICAgICBjYWxsZWRCeVNkazogJ2Fib3J0VXBsb2FkVGFzaydcbiAgICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgIGVwLmVtaXQoJ2dldF9hYm9ydF9hcnJheScsIGRhdGEuVXBsb2FkTGlzdCB8fCBbXSk7XG4gICAgfSk7XG4gIH0gZWxzZSBpZiAoTGV2ZWwgPT09ICd0YXNrJykge1xuICAgIC8vIOWNleS4quS7u+WKoee6p+WIq+eahOS7u+WKoeaKm+W8g++8jOaKm+W8g+aMh+WumiBVcGxvYWRJZCDnmoTkuIrkvKDku7vliqFcbiAgICBpZiAoIVVwbG9hZElkKSByZXR1cm4gY2FsbGJhY2sodXRpbC5lcnJvcihuZXcgRXJyb3IoJ2Fib3J0X3VwbG9hZF90YXNrX25vX2lkJykpKTtcbiAgICBpZiAoIUtleSkgcmV0dXJuIGNhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKCdhYm9ydF91cGxvYWRfdGFza19ub19rZXknKSkpO1xuICAgIGVwLmVtaXQoJ2dldF9hYm9ydF9hcnJheScsIFt7XG4gICAgICBLZXk6IEtleSxcbiAgICAgIFVwbG9hZElkOiBVcGxvYWRJZFxuICAgIH1dKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gY2FsbGJhY2sodXRpbC5lcnJvcihuZXcgRXJyb3IoJ2Fib3J0X3Vua25vd25fbGV2ZWwnKSkpO1xuICB9XG59IC8vIOaJuemHj+aKm+W8g+WIhuWdl+S4iuS8oOS7u+WKoVxuXG5cbmZ1bmN0aW9uIGFib3J0VXBsb2FkVGFza0FycmF5KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIEJ1Y2tldCA9IHBhcmFtcy5CdWNrZXQ7XG4gIHZhciBSZWdpb24gPSBwYXJhbXMuUmVnaW9uO1xuICB2YXIgS2V5ID0gcGFyYW1zLktleTtcbiAgdmFyIEFib3J0QXJyYXkgPSBwYXJhbXMuQWJvcnRBcnJheTtcbiAgdmFyIEFzeW5jTGltaXQgPSBwYXJhbXMuQXN5bmNMaW1pdCB8fCAxO1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBpbmRleCA9IDA7XG4gIHZhciByZXN1bHRMaXN0ID0gbmV3IEFycmF5KEFib3J0QXJyYXkubGVuZ3RoKTtcbiAgQXN5bmMuZWFjaExpbWl0KEFib3J0QXJyYXksIEFzeW5jTGltaXQsIGZ1bmN0aW9uIChBYm9ydEl0ZW0sIG5leHRJdGVtKSB7XG4gICAgdmFyIGVhY2hJbmRleCA9IGluZGV4O1xuXG4gICAgaWYgKEtleSAmJiBLZXkgIT09IEFib3J0SXRlbS5LZXkpIHtcbiAgICAgIHJlc3VsdExpc3RbZWFjaEluZGV4XSA9IHtcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBLZXlOb3RNYXRjaDogdHJ1ZVxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgbmV4dEl0ZW0obnVsbCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIFVwbG9hZElkID0gQWJvcnRJdGVtLlVwbG9hZElkIHx8IEFib3J0SXRlbS5VcGxvYWRJRDtcbiAgICBzZWxmLm11bHRpcGFydEFib3J0KHtcbiAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgUmVnaW9uOiBSZWdpb24sXG4gICAgICBLZXk6IEFib3J0SXRlbS5LZXksXG4gICAgICBIZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICAgIFVwbG9hZElkOiBVcGxvYWRJZFxuICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgIHZhciB0YXNrID0ge1xuICAgICAgICBCdWNrZXQ6IEJ1Y2tldCxcbiAgICAgICAgUmVnaW9uOiBSZWdpb24sXG4gICAgICAgIEtleTogQWJvcnRJdGVtLktleSxcbiAgICAgICAgVXBsb2FkSWQ6IFVwbG9hZElkXG4gICAgICB9O1xuICAgICAgcmVzdWx0TGlzdFtlYWNoSW5kZXhdID0ge1xuICAgICAgICBlcnJvcjogZXJyLFxuICAgICAgICB0YXNrOiB0YXNrXG4gICAgICB9O1xuICAgICAgbmV4dEl0ZW0obnVsbCk7XG4gICAgfSk7XG4gICAgaW5kZXgrKztcbiAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIHZhciBzdWNjZXNzTGlzdCA9IFtdO1xuICAgIHZhciBlcnJvckxpc3QgPSBbXTtcblxuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSByZXN1bHRMaXN0Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICB2YXIgaXRlbSA9IHJlc3VsdExpc3RbaV07XG5cbiAgICAgIGlmIChpdGVtWyd0YXNrJ10pIHtcbiAgICAgICAgaWYgKGl0ZW1bJ2Vycm9yJ10pIHtcbiAgICAgICAgICBlcnJvckxpc3QucHVzaChpdGVtWyd0YXNrJ10pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN1Y2Nlc3NMaXN0LnB1c2goaXRlbVsndGFzayddKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdWNjZXNzTGlzdDogc3VjY2Vzc0xpc3QsXG4gICAgICBlcnJvckxpc3Q6IGVycm9yTGlzdFxuICAgIH0pO1xuICB9KTtcbn0gLy8g6auY57qn5LiK5LygXG5cblxuZnVuY3Rpb24gdXBsb2FkRmlsZShwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBzZWxmID0gdGhpczsgLy8g5Yik5pat5aSa5aSn55qE5paH5Lu25L2/55So5YiG54mH5LiK5LygXG5cbiAgdmFyIFNsaWNlU2l6ZSA9IHBhcmFtcy5TbGljZVNpemUgPT09IHVuZGVmaW5lZCA/IHNlbGYub3B0aW9ucy5TbGljZVNpemUgOiBwYXJhbXMuU2xpY2VTaXplO1xuICB2YXIgdGFza0xpc3QgPSBbXTtcbiAgdmFyIEJvZHkgPSBwYXJhbXMuQm9keTtcbiAgdmFyIEZpbGVTaXplID0gQm9keS5zaXplIHx8IEJvZHkubGVuZ3RoIHx8IDA7XG4gIHZhciBmaWxlSW5mbyA9IHtcbiAgICBUYXNrSWQ6ICcnXG4gIH07IC8vIOS4iuS8oOmTvui3r1xuXG4gIGlmIChzZWxmLm9wdGlvbnMuRW5hYmxlVHJhY2tlcikge1xuICAgIHZhciBhY2NlbGVyYXRlID0gc2VsZi5vcHRpb25zLlVzZUFjY2VsZXJhdGUgfHwgc2VsZi5vcHRpb25zLkRvbWFpbi5pbmNsdWRlcygnYWNjZWxlcmF0ZS4nKTtcbiAgICBwYXJhbXMudHJhY2tlciA9IG5ldyBUcmFja2VyKHtcbiAgICAgIGJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICAgIHJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICAgIGFwaU5hbWU6ICd1cGxvYWRGaWxlJyxcbiAgICAgIGZpbGVLZXk6IHBhcmFtcy5LZXksXG4gICAgICBmaWxlU2l6ZTogRmlsZVNpemUsXG4gICAgICBhY2NlbGVyYXRlOiBhY2NlbGVyYXRlLFxuICAgICAgZGVlcFRyYWNrZXI6IHNlbGYub3B0aW9ucy5EZWVwVHJhY2tlcixcbiAgICAgIGN1c3RvbUlkOiBzZWxmLm9wdGlvbnMuQ3VzdG9tSWQsXG4gICAgICBkZWxheTogc2VsZi5vcHRpb25zLlRyYWNrZXJEZWxheVxuICAgIH0pO1xuICB9IC8vIOaVtOeQhiBvcHRpb27vvIznlKjkuo7ov5Tlm57nu5nlm57osINcblxuXG4gIHV0aWwuZWFjaChwYXJhbXMsIGZ1bmN0aW9uICh2LCBrKSB7XG4gICAgaWYgKF90eXBlb2YodikgIT09ICdvYmplY3QnICYmIHR5cGVvZiB2ICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICBmaWxlSW5mb1trXSA9IHY7XG4gICAgfVxuICB9KTsgLy8g5aSE55CG5paH5Lu2IFRhc2tSZWFkeVxuXG4gIHZhciBfb25UYXNrUmVhZHkgPSBwYXJhbXMub25UYXNrUmVhZHk7XG5cbiAgdmFyIG9uVGFza1JlYWR5ID0gZnVuY3Rpb24gb25UYXNrUmVhZHkodGlkKSB7XG4gICAgZmlsZUluZm8uVGFza0lkID0gdGlkO1xuICAgIF9vblRhc2tSZWFkeSAmJiBfb25UYXNrUmVhZHkodGlkKTtcbiAgfTtcblxuICBwYXJhbXMub25UYXNrUmVhZHkgPSBvblRhc2tSZWFkeTsgLy8g5re75Yqg5LiK5Lyg5Lu75YqhLOi2hei/h+mYiOWAvOS9v+eUqOWIhuWdl+S4iuS8oO+8jOWwj+S6juetieS6juWImeeugOWNleS4iuS8oFxuXG4gIHZhciBhcGkgPSBGaWxlU2l6ZSA+IFNsaWNlU2l6ZSA/ICdzbGljZVVwbG9hZEZpbGUnIDogJ3B1dE9iamVjdCc7IC8vIOWkhOeQhuaWh+S7tuWujOaIkFxuXG4gIHZhciBfb25GaWxlRmluaXNoID0gcGFyYW1zLm9uRmlsZUZpbmlzaDtcblxuICB2YXIgb25GaWxlRmluaXNoID0gZnVuY3Rpb24gb25GaWxlRmluaXNoKGVyciwgZGF0YSkge1xuICAgIC8vIOagvOW8j+WMluS4iuaKpeWPguaVsOW5tuS4iuaKpVxuICAgIHBhcmFtcy50cmFja2VyICYmIHBhcmFtcy50cmFja2VyLmZvcm1hdFJlc3VsdChlcnIsIGRhdGEpO1xuICAgIF9vbkZpbGVGaW5pc2ggJiYgX29uRmlsZUZpbmlzaChlcnIsIGRhdGEsIGZpbGVJbmZvKTtcbiAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhlcnIsIGRhdGEpO1xuICB9O1xuXG4gIHRhc2tMaXN0LnB1c2goe1xuICAgIGFwaTogYXBpLFxuICAgIHBhcmFtczogcGFyYW1zLFxuICAgIGNhbGxiYWNrOiBvbkZpbGVGaW5pc2hcbiAgfSk7XG5cbiAgc2VsZi5fYWRkVGFza3ModGFza0xpc3QpO1xufSAvLyDmibnph4/kuIrkvKDmlofku7ZcblxuXG5mdW5jdGlvbiB1cGxvYWRGaWxlcyhwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBzZWxmID0gdGhpczsgLy8g5Yik5pat5aSa5aSn55qE5paH5Lu25L2/55So5YiG54mH5LiK5LygXG5cbiAgdmFyIFNsaWNlU2l6ZSA9IHBhcmFtcy5TbGljZVNpemUgPT09IHVuZGVmaW5lZCA/IHNlbGYub3B0aW9ucy5TbGljZVNpemUgOiBwYXJhbXMuU2xpY2VTaXplOyAvLyDmsYfmgLvov5Tlm57ov5vluqZcblxuICB2YXIgVG90YWxTaXplID0gMDtcbiAgdmFyIFRvdGFsRmluaXNoID0gMDtcbiAgdmFyIG9uVG90YWxQcm9ncmVzcyA9IHV0aWwudGhyb3R0bGVPblByb2dyZXNzLmNhbGwoc2VsZiwgVG90YWxGaW5pc2gsIHBhcmFtcy5vblByb2dyZXNzKTsgLy8g5rGH5oC76L+U5Zue5Zue6LCDXG5cbiAgdmFyIHVuRmluaXNoQ291bnQgPSBwYXJhbXMuZmlsZXMubGVuZ3RoO1xuICB2YXIgX29uVG90YWxGaWxlRmluaXNoID0gcGFyYW1zLm9uRmlsZUZpbmlzaDtcbiAgdmFyIHJlc3VsdExpc3QgPSBBcnJheSh1bkZpbmlzaENvdW50KTtcblxuICB2YXIgb25Ub3RhbEZpbGVGaW5pc2ggPSBmdW5jdGlvbiBvblRvdGFsRmlsZUZpbmlzaChlcnIsIGRhdGEsIG9wdGlvbnMpIHtcbiAgICBvblRvdGFsUHJvZ3Jlc3MobnVsbCwgdHJ1ZSk7XG4gICAgX29uVG90YWxGaWxlRmluaXNoICYmIF9vblRvdGFsRmlsZUZpbmlzaChlcnIsIGRhdGEsIG9wdGlvbnMpO1xuICAgIHJlc3VsdExpc3Rbb3B0aW9ucy5JbmRleF0gPSB7XG4gICAgICBvcHRpb25zOiBvcHRpb25zLFxuICAgICAgZXJyb3I6IGVycixcbiAgICAgIGRhdGE6IGRhdGFcbiAgICB9O1xuXG4gICAgaWYgKC0tdW5GaW5pc2hDb3VudCA8PSAwICYmIGNhbGxiYWNrKSB7XG4gICAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIGZpbGVzOiByZXN1bHRMaXN0XG4gICAgICB9KTtcbiAgICB9XG4gIH07IC8vIOW8gOWni+WkhOeQhuavj+S4quaWh+S7tlxuXG5cbiAgdmFyIHRhc2tMaXN0ID0gW107XG4gIHV0aWwuZWFjaChwYXJhbXMuZmlsZXMsIGZ1bmN0aW9uIChmaWxlUGFyYW1zLCBpbmRleCkge1xuICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICAvLyDlr7npvZAgbm9kZWpzIOe8qei/m1xuICAgICAgdmFyIEJvZHkgPSBmaWxlUGFyYW1zLkJvZHk7XG4gICAgICB2YXIgRmlsZVNpemUgPSBCb2R5LnNpemUgfHwgQm9keS5sZW5ndGggfHwgMDtcbiAgICAgIHZhciBmaWxlSW5mbyA9IHtcbiAgICAgICAgSW5kZXg6IGluZGV4LFxuICAgICAgICBUYXNrSWQ6ICcnXG4gICAgICB9OyAvLyDmm7TmlrDmlofku7bmgLvlpKflsI9cblxuICAgICAgVG90YWxTaXplICs9IEZpbGVTaXplOyAvLyDljZXkuKrmlofku7bkuIrkvKDpk77ot69cblxuICAgICAgaWYgKHNlbGYub3B0aW9ucy5FbmFibGVUcmFja2VyKSB7XG4gICAgICAgIHZhciBhY2NlbGVyYXRlID0gc2VsZi5vcHRpb25zLlVzZUFjY2VsZXJhdGUgfHwgc2VsZi5vcHRpb25zLkRvbWFpbi5pbmNsdWRlcygnYWNjZWxlcmF0ZS4nKTtcbiAgICAgICAgZmlsZVBhcmFtcy50cmFja2VyID0gbmV3IFRyYWNrZXIoe1xuICAgICAgICAgIGJ1Y2tldDogZmlsZVBhcmFtcy5CdWNrZXQsXG4gICAgICAgICAgcmVnaW9uOiBmaWxlUGFyYW1zLlJlZ2lvbixcbiAgICAgICAgICBhcGlOYW1lOiAndXBsb2FkRmlsZXMnLFxuICAgICAgICAgIGZpbGVLZXk6IGZpbGVQYXJhbXMuS2V5LFxuICAgICAgICAgIGZpbGVTaXplOiBGaWxlU2l6ZSxcbiAgICAgICAgICBhY2NlbGVyYXRlOiBhY2NlbGVyYXRlLFxuICAgICAgICAgIGRlZXBUcmFja2VyOiBzZWxmLm9wdGlvbnMuRGVlcFRyYWNrZXIsXG4gICAgICAgICAgY3VzdG9tSWQ6IHNlbGYub3B0aW9ucy5DdXN0b21JZCxcbiAgICAgICAgICBkZWxheTogc2VsZi5vcHRpb25zLlRyYWNrZXJEZWxheVxuICAgICAgICB9KTtcbiAgICAgIH0gLy8g5pW055CGIG9wdGlvbu+8jOeUqOS6jui/lOWbnue7meWbnuiwg1xuXG5cbiAgICAgIHV0aWwuZWFjaChmaWxlUGFyYW1zLCBmdW5jdGlvbiAodiwgaykge1xuICAgICAgICBpZiAoX3R5cGVvZih2KSAhPT0gJ29iamVjdCcgJiYgdHlwZW9mIHYgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBmaWxlSW5mb1trXSA9IHY7XG4gICAgICAgIH1cbiAgICAgIH0pOyAvLyDlpITnkIbljZXkuKrmlofku7YgVGFza1JlYWR5XG5cbiAgICAgIHZhciBfb25UYXNrUmVhZHkgPSBmaWxlUGFyYW1zLm9uVGFza1JlYWR5O1xuXG4gICAgICB2YXIgb25UYXNrUmVhZHkgPSBmdW5jdGlvbiBvblRhc2tSZWFkeSh0aWQpIHtcbiAgICAgICAgZmlsZUluZm8uVGFza0lkID0gdGlkO1xuICAgICAgICBfb25UYXNrUmVhZHkgJiYgX29uVGFza1JlYWR5KHRpZCk7XG4gICAgICB9O1xuXG4gICAgICBmaWxlUGFyYW1zLm9uVGFza1JlYWR5ID0gb25UYXNrUmVhZHk7IC8vIOWkhOeQhuWNleS4quaWh+S7tui/m+W6plxuXG4gICAgICB2YXIgUHJlQWRkU2l6ZSA9IDA7XG4gICAgICB2YXIgX29uUHJvZ3Jlc3MgPSBmaWxlUGFyYW1zLm9uUHJvZ3Jlc3M7XG5cbiAgICAgIHZhciBvblByb2dyZXNzID0gZnVuY3Rpb24gb25Qcm9ncmVzcyhpbmZvKSB7XG4gICAgICAgIFRvdGFsRmluaXNoID0gVG90YWxGaW5pc2ggLSBQcmVBZGRTaXplICsgaW5mby5sb2FkZWQ7XG4gICAgICAgIFByZUFkZFNpemUgPSBpbmZvLmxvYWRlZDtcbiAgICAgICAgX29uUHJvZ3Jlc3MgJiYgX29uUHJvZ3Jlc3MoaW5mbyk7XG4gICAgICAgIG9uVG90YWxQcm9ncmVzcyh7XG4gICAgICAgICAgbG9hZGVkOiBUb3RhbEZpbmlzaCxcbiAgICAgICAgICB0b3RhbDogVG90YWxTaXplXG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgZmlsZVBhcmFtcy5vblByb2dyZXNzID0gb25Qcm9ncmVzczsgLy8g5re75Yqg5LiK5Lyg5Lu75YqhXG5cbiAgICAgIHZhciBhcGkgPSBGaWxlU2l6ZSA+IFNsaWNlU2l6ZSA/ICdzbGljZVVwbG9hZEZpbGUnIDogJ3B1dE9iamVjdCc7IC8vIOWkhOeQhuWNleS4quaWh+S7tuWujOaIkFxuXG4gICAgICB2YXIgX29uRmlsZUZpbmlzaCA9IGZpbGVQYXJhbXMub25GaWxlRmluaXNoO1xuXG4gICAgICB2YXIgb25GaWxlRmluaXNoID0gZnVuY3Rpb24gb25GaWxlRmluaXNoKGVyciwgZGF0YSkge1xuICAgICAgICAvLyDmoLzlvI/ljJbkuIrmiqXlj4LmlbDlubbkuIrmiqVcbiAgICAgICAgZmlsZVBhcmFtcy50cmFja2VyICYmIGZpbGVQYXJhbXMudHJhY2tlci5mb3JtYXRSZXN1bHQoZXJyLCBkYXRhKTtcbiAgICAgICAgX29uRmlsZUZpbmlzaCAmJiBfb25GaWxlRmluaXNoKGVyciwgZGF0YSk7XG4gICAgICAgIG9uVG90YWxGaWxlRmluaXNoICYmIG9uVG90YWxGaWxlRmluaXNoKGVyciwgZGF0YSwgZmlsZUluZm8pO1xuICAgICAgfTtcblxuICAgICAgdGFza0xpc3QucHVzaCh7XG4gICAgICAgIGFwaTogYXBpLFxuICAgICAgICBwYXJhbXM6IGZpbGVQYXJhbXMsXG4gICAgICAgIGNhbGxiYWNrOiBvbkZpbGVGaW5pc2hcbiAgICAgIH0pO1xuICAgIH0pKCk7XG4gIH0pO1xuXG4gIHNlbGYuX2FkZFRhc2tzKHRhc2tMaXN0KTtcbn0gLy8g5YiG54mH5aSN5Yi25paH5Lu2XG5cblxuZnVuY3Rpb24gc2xpY2VDb3B5RmlsZShwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBlcCA9IG5ldyBFdmVudFByb3h5KCk7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIEJ1Y2tldCA9IHBhcmFtcy5CdWNrZXQ7XG4gIHZhciBSZWdpb24gPSBwYXJhbXMuUmVnaW9uO1xuICB2YXIgS2V5ID0gcGFyYW1zLktleTtcbiAgdmFyIENvcHlTb3VyY2UgPSBwYXJhbXMuQ29weVNvdXJjZTtcbiAgdmFyIG0gPSB1dGlsLmdldFNvdXJjZVBhcmFtcy5jYWxsKHRoaXMsIENvcHlTb3VyY2UpO1xuXG4gIGlmICghbSkge1xuICAgIGNhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKCdDb3B5U291cmNlIGZvcm1hdCBlcnJvcicpKSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIFNvdXJjZUJ1Y2tldCA9IG0uQnVja2V0O1xuICB2YXIgU291cmNlUmVnaW9uID0gbS5SZWdpb247XG4gIHZhciBTb3VyY2VLZXkgPSBkZWNvZGVVUklDb21wb25lbnQobS5LZXkpO1xuICB2YXIgQ29weVNsaWNlU2l6ZSA9IHBhcmFtcy5Db3B5U2xpY2VTaXplID09PSB1bmRlZmluZWQgPyBzZWxmLm9wdGlvbnMuQ29weVNsaWNlU2l6ZSA6IHBhcmFtcy5Db3B5U2xpY2VTaXplO1xuICBDb3B5U2xpY2VTaXplID0gTWF0aC5tYXgoMCwgQ29weVNsaWNlU2l6ZSk7XG4gIHZhciBDaHVua1NpemUgPSBwYXJhbXMuQ29weUNodW5rU2l6ZSB8fCB0aGlzLm9wdGlvbnMuQ29weUNodW5rU2l6ZTtcbiAgdmFyIENodW5rUGFyYWxsZWwgPSB0aGlzLm9wdGlvbnMuQ29weUNodW5rUGFyYWxsZWxMaW1pdDtcbiAgdmFyIENodW5rUmV0cnlUaW1lcyA9IHRoaXMub3B0aW9ucy5DaHVua1JldHJ5VGltZXMgKyAxO1xuICB2YXIgQ2h1bmtDb3VudCA9IDA7XG4gIHZhciBGaW5pc2hTaXplID0gMDtcbiAgdmFyIEZpbGVTaXplO1xuICB2YXIgb25Qcm9ncmVzcztcbiAgdmFyIFNvdXJjZVJlc0hlYWRlcnMgPSB7fTtcbiAgdmFyIFNvdXJjZUhlYWRlcnMgPSB7fTtcbiAgdmFyIFRhcmdldEhlYWRlciA9IHt9OyAvLyDliIbniYflpI3liLblrozmiJDvvIzlvIDlp4sgbXVsdGlwYXJ0Q29tcGxldGUg5pON5L2cXG5cbiAgZXAub24oJ2NvcHlfc2xpY2VfY29tcGxldGUnLCBmdW5jdGlvbiAoVXBsb2FkRGF0YSkge1xuICAgIHZhciBtZXRhSGVhZGVycyA9IHt9O1xuICAgIHV0aWwuZWFjaChwYXJhbXMuSGVhZGVycywgZnVuY3Rpb24gKHZhbCwgaykge1xuICAgICAgaWYgKGsudG9Mb3dlckNhc2UoKS5pbmRleE9mKCd4LWNvcy1tZXRhLScpID09PSAwKSBtZXRhSGVhZGVyc1trXSA9IHZhbDtcbiAgICB9KTtcbiAgICB2YXIgUGFydHMgPSB1dGlsLm1hcChVcGxvYWREYXRhLlBhcnRMaXN0LCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgUGFydE51bWJlcjogaXRlbS5QYXJ0TnVtYmVyLFxuICAgICAgICBFVGFnOiBpdGVtLkVUYWdcbiAgICAgIH07XG4gICAgfSk7IC8vIOWujOaIkOS4iuS8oOeahOivt+axguS5n+WBmumHjeivlVxuXG4gICAgQXN5bmMucmV0cnkoQ2h1bmtSZXRyeVRpbWVzLCBmdW5jdGlvbiAodHJ5Q2FsbGJhY2spIHtcbiAgICAgIHNlbGYubXVsdGlwYXJ0Q29tcGxldGUoe1xuICAgICAgICBCdWNrZXQ6IEJ1Y2tldCxcbiAgICAgICAgUmVnaW9uOiBSZWdpb24sXG4gICAgICAgIEtleTogS2V5LFxuICAgICAgICBVcGxvYWRJZDogVXBsb2FkRGF0YS5VcGxvYWRJZCxcbiAgICAgICAgUGFydHM6IFBhcnRzLFxuICAgICAgICBjYWxsZWRCeVNkazogJ3NsaWNlQ29weUZpbGUnXG4gICAgICB9LCB0cnlDYWxsYmFjayk7XG4gICAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgc2Vzc2lvbi5yZW1vdmVVc2luZyhVcGxvYWREYXRhLlVwbG9hZElkKTsgLy8g5qCH6K6wIFVwbG9hZElkIOayoeiiq+S9v+eUqOS6hu+8jOWboOS4uuWkjeWItuayoeaPkOS+m+mHjeivle+8jOaJgOS7peWPquimgeWHuumUme+8jOWwseaYryBVcGxvYWRJZCDlgZznlKjkuobjgIJcblxuICAgICAgaWYgKGVycikge1xuICAgICAgICBvblByb2dyZXNzKG51bGwsIHRydWUpO1xuICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgIH1cblxuICAgICAgc2Vzc2lvbi5yZW1vdmVVcGxvYWRJZChVcGxvYWREYXRhLlVwbG9hZElkKTtcbiAgICAgIG9uUHJvZ3Jlc3Moe1xuICAgICAgICBsb2FkZWQ6IEZpbGVTaXplLFxuICAgICAgICB0b3RhbDogRmlsZVNpemVcbiAgICAgIH0sIHRydWUpO1xuICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YSk7XG4gICAgfSk7XG4gIH0pO1xuICBlcC5vbignZ2V0X2NvcHlfZGF0YV9maW5pc2gnLCBmdW5jdGlvbiAoVXBsb2FkRGF0YSkge1xuICAgIC8vIOWkhOeQhiBVcGxvYWRJZCDnvJPlrZhcbiAgICB2YXIgdXVpZCA9IHNlc3Npb24uZ2V0Q29weUZpbGVJZChDb3B5U291cmNlLCBTb3VyY2VSZXNIZWFkZXJzLCBDaHVua1NpemUsIEJ1Y2tldCwgS2V5KTtcbiAgICB1dWlkICYmIHNlc3Npb24uc2F2ZVVwbG9hZElkKHV1aWQsIFVwbG9hZERhdGEuVXBsb2FkSWQsIHNlbGYub3B0aW9ucy5VcGxvYWRJZENhY2hlTGltaXQpOyAvLyDnvJPlrZggVXBsb2FkSWRcblxuICAgIHNlc3Npb24uc2V0VXNpbmcoVXBsb2FkRGF0YS5VcGxvYWRJZCk7IC8vIOagh+iusCBVcGxvYWRJZCDkuLrmraPlnKjkvb/nlKhcblxuICAgIHZhciBuZWVkQ29weVNsaWNlcyA9IHV0aWwuZmlsdGVyKFVwbG9hZERhdGEuUGFydExpc3QsIGZ1bmN0aW9uIChTbGljZUl0ZW0pIHtcbiAgICAgIGlmIChTbGljZUl0ZW1bJ1VwbG9hZGVkJ10pIHtcbiAgICAgICAgRmluaXNoU2l6ZSArPSBTbGljZUl0ZW1bJ1BhcnROdW1iZXInXSA+PSBDaHVua0NvdW50ID8gRmlsZVNpemUgJSBDaHVua1NpemUgfHwgQ2h1bmtTaXplIDogQ2h1bmtTaXplO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gIVNsaWNlSXRlbVsnVXBsb2FkZWQnXTtcbiAgICB9KTtcbiAgICBBc3luYy5lYWNoTGltaXQobmVlZENvcHlTbGljZXMsIENodW5rUGFyYWxsZWwsIGZ1bmN0aW9uIChTbGljZUl0ZW0sIGFzeW5jQ2FsbGJhY2spIHtcbiAgICAgIHZhciBQYXJ0TnVtYmVyID0gU2xpY2VJdGVtLlBhcnROdW1iZXI7XG4gICAgICB2YXIgQ29weVNvdXJjZVJhbmdlID0gU2xpY2VJdGVtLkNvcHlTb3VyY2VSYW5nZTtcbiAgICAgIHZhciBjdXJyZW50U2l6ZSA9IFNsaWNlSXRlbS5lbmQgLSBTbGljZUl0ZW0uc3RhcnQ7XG4gICAgICBBc3luYy5yZXRyeShDaHVua1JldHJ5VGltZXMsIGZ1bmN0aW9uICh0cnlDYWxsYmFjaykge1xuICAgICAgICBjb3B5U2xpY2VJdGVtLmNhbGwoc2VsZiwge1xuICAgICAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgICAgIFJlZ2lvbjogUmVnaW9uLFxuICAgICAgICAgIEtleTogS2V5LFxuICAgICAgICAgIENvcHlTb3VyY2U6IENvcHlTb3VyY2UsXG4gICAgICAgICAgVXBsb2FkSWQ6IFVwbG9hZERhdGEuVXBsb2FkSWQsXG4gICAgICAgICAgUGFydE51bWJlcjogUGFydE51bWJlcixcbiAgICAgICAgICBDb3B5U291cmNlUmFuZ2U6IENvcHlTb3VyY2VSYW5nZVxuICAgICAgICB9LCB0cnlDYWxsYmFjayk7XG4gICAgICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgICAgIGlmIChlcnIpIHJldHVybiBhc3luY0NhbGxiYWNrKGVycik7XG4gICAgICAgIEZpbmlzaFNpemUgKz0gY3VycmVudFNpemU7XG4gICAgICAgIG9uUHJvZ3Jlc3Moe1xuICAgICAgICAgIGxvYWRlZDogRmluaXNoU2l6ZSxcbiAgICAgICAgICB0b3RhbDogRmlsZVNpemVcbiAgICAgICAgfSk7XG4gICAgICAgIFNsaWNlSXRlbS5FVGFnID0gZGF0YS5FVGFnO1xuICAgICAgICBhc3luY0NhbGxiYWNrKGVyciB8fCBudWxsLCBkYXRhKTtcbiAgICAgIH0pO1xuICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgc2Vzc2lvbi5yZW1vdmVVc2luZyhVcGxvYWREYXRhLlVwbG9hZElkKTsgLy8g5qCH6K6wIFVwbG9hZElkIOayoeiiq+S9v+eUqOS6hu+8jOWboOS4uuWkjeWItuayoeaPkOS+m+mHjeivle+8jOaJgOS7peWPquimgeWHuumUme+8jOWwseaYryBVcGxvYWRJZCDlgZznlKjkuobjgIJcblxuICAgICAgICBvblByb2dyZXNzKG51bGwsIHRydWUpO1xuICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgIH1cblxuICAgICAgZXAuZW1pdCgnY29weV9zbGljZV9jb21wbGV0ZScsIFVwbG9hZERhdGEpO1xuICAgIH0pO1xuICB9KTtcbiAgZXAub24oJ2dldF9jaHVua19zaXplX2ZpbmlzaCcsIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY3JlYXRlTmV3VXBsb2FkSWQgPSBmdW5jdGlvbiBjcmVhdGVOZXdVcGxvYWRJZCgpIHtcbiAgICAgIHNlbGYubXVsdGlwYXJ0SW5pdCh7XG4gICAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgICAgS2V5OiBLZXksXG4gICAgICAgIEhlYWRlcnM6IFRhcmdldEhlYWRlclxuICAgICAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgcGFyYW1zLlVwbG9hZElkID0gZGF0YS5VcGxvYWRJZDtcbiAgICAgICAgZXAuZW1pdCgnZ2V0X2NvcHlfZGF0YV9maW5pc2gnLCB7XG4gICAgICAgICAgVXBsb2FkSWQ6IHBhcmFtcy5VcGxvYWRJZCxcbiAgICAgICAgICBQYXJ0TGlzdDogcGFyYW1zLlBhcnRMaXN0XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTsgLy8g5Zyo5pys5Zyw5om+5Y+v55So55qEIFVwbG9hZElkXG5cblxuICAgIHZhciB1dWlkID0gc2Vzc2lvbi5nZXRDb3B5RmlsZUlkKENvcHlTb3VyY2UsIFNvdXJjZVJlc0hlYWRlcnMsIENodW5rU2l6ZSwgQnVja2V0LCBLZXkpO1xuICAgIHZhciBMb2NhbFVwbG9hZElkTGlzdCA9IHNlc3Npb24uZ2V0VXBsb2FkSWRMaXN0KHV1aWQpO1xuICAgIGlmICghdXVpZCB8fCAhTG9jYWxVcGxvYWRJZExpc3QpIHJldHVybiBjcmVhdGVOZXdVcGxvYWRJZCgpO1xuXG4gICAgdmFyIG5leHQgPSBmdW5jdGlvbiBuZXh0KGluZGV4KSB7XG4gICAgICAvLyDlpoLmnpzmnKzlnLDmib7kuI3liLDlj6/nlKggVXBsb2FkSWTvvIzlho3kuIDkuKrkuKrpgY3ljobmoKHpqozov5znq69cbiAgICAgIGlmIChpbmRleCA+PSBMb2NhbFVwbG9hZElkTGlzdC5sZW5ndGgpIHJldHVybiBjcmVhdGVOZXdVcGxvYWRJZCgpO1xuICAgICAgdmFyIFVwbG9hZElkID0gTG9jYWxVcGxvYWRJZExpc3RbaW5kZXhdOyAvLyDlpoLmnpzmraPlnKjooqvkvb/nlKjvvIzot7Pov4dcblxuICAgICAgaWYgKHNlc3Npb24udXNpbmdbVXBsb2FkSWRdKSByZXR1cm4gbmV4dChpbmRleCArIDEpOyAvLyDliKTmlq0gVXBsb2FkSWQg5piv5ZCm5a2Y5Zyo57q/5LiKXG5cbiAgICAgIHdob2xlTXVsdGlwYXJ0TGlzdFBhcnQuY2FsbChzZWxmLCB7XG4gICAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgICAgS2V5OiBLZXksXG4gICAgICAgIFVwbG9hZElkOiBVcGxvYWRJZFxuICAgICAgfSwgZnVuY3Rpb24gKGVyciwgUGFydExpc3REYXRhKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAvLyDlpoLmnpwgVXBsb2FkSWQg6I635Y+W5Lya5Ye66ZSZ77yM6Lez6L+H5bm25Yig6ZmkXG4gICAgICAgICAgc2Vzc2lvbi5yZW1vdmVVcGxvYWRJZChVcGxvYWRJZCk7XG4gICAgICAgICAgbmV4dChpbmRleCArIDEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIOWmguaenOW8guatpeWbnuadpSBVcGxvYWRJZCDlt7Lnu4/ooqvnlKjkuobvvIzkuZ/ot7Pov4dcbiAgICAgICAgICBpZiAoc2Vzc2lvbi51c2luZ1tVcGxvYWRJZF0pIHJldHVybiBuZXh0KGluZGV4ICsgMSk7IC8vIOaJvuWIsOWPr+eUqCBVcGxvYWRJZFxuXG4gICAgICAgICAgdmFyIGZpbmlzaEVUYWdNYXAgPSB7fTtcbiAgICAgICAgICB2YXIgb2Zmc2V0ID0gMDtcbiAgICAgICAgICB1dGlsLmVhY2goUGFydExpc3REYXRhLlBhcnRMaXN0LCBmdW5jdGlvbiAoUGFydEl0ZW0pIHtcbiAgICAgICAgICAgIHZhciBzaXplID0gcGFyc2VJbnQoUGFydEl0ZW0uU2l6ZSk7XG4gICAgICAgICAgICB2YXIgZW5kID0gb2Zmc2V0ICsgc2l6ZSAtIDE7XG4gICAgICAgICAgICBmaW5pc2hFVGFnTWFwW1BhcnRJdGVtLlBhcnROdW1iZXIgKyAnfCcgKyBvZmZzZXQgKyAnfCcgKyBlbmRdID0gUGFydEl0ZW0uRVRhZztcbiAgICAgICAgICAgIG9mZnNldCArPSBzaXplO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHV0aWwuZWFjaChwYXJhbXMuUGFydExpc3QsIGZ1bmN0aW9uIChQYXJ0SXRlbSkge1xuICAgICAgICAgICAgdmFyIEVUYWcgPSBmaW5pc2hFVGFnTWFwW1BhcnRJdGVtLlBhcnROdW1iZXIgKyAnfCcgKyBQYXJ0SXRlbS5zdGFydCArICd8JyArIFBhcnRJdGVtLmVuZF07XG5cbiAgICAgICAgICAgIGlmIChFVGFnKSB7XG4gICAgICAgICAgICAgIFBhcnRJdGVtLkVUYWcgPSBFVGFnO1xuICAgICAgICAgICAgICBQYXJ0SXRlbS5VcGxvYWRlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZXAuZW1pdCgnZ2V0X2NvcHlfZGF0YV9maW5pc2gnLCB7XG4gICAgICAgICAgICBVcGxvYWRJZDogVXBsb2FkSWQsXG4gICAgICAgICAgICBQYXJ0TGlzdDogcGFyYW1zLlBhcnRMaXN0XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICBuZXh0KDApO1xuICB9KTtcbiAgZXAub24oJ2dldF9maWxlX3NpemVfZmluaXNoJywgZnVuY3Rpb24gKCkge1xuICAgIC8vIOaOp+WItuWIhueJh+Wkp+Wwj1xuICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgU0laRSA9IFsxLCAyLCA0LCA4LCAxNiwgMzIsIDY0LCAxMjgsIDI1NiwgNTEyLCAxMDI0LCAxMDI0ICogMiwgMTAyNCAqIDQsIDEwMjQgKiA1XTtcbiAgICAgIHZhciBBdXRvQ2h1bmtTaXplID0gMTAyNCAqIDEwMjQ7XG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgU0laRS5sZW5ndGg7IGkrKykge1xuICAgICAgICBBdXRvQ2h1bmtTaXplID0gU0laRVtpXSAqIDEwMjQgKiAxMDI0O1xuICAgICAgICBpZiAoRmlsZVNpemUgLyBBdXRvQ2h1bmtTaXplIDw9IHNlbGYub3B0aW9ucy5NYXhQYXJ0TnVtYmVyKSBicmVhaztcbiAgICAgIH1cblxuICAgICAgcGFyYW1zLkNodW5rU2l6ZSA9IENodW5rU2l6ZSA9IE1hdGgubWF4KENodW5rU2l6ZSwgQXV0b0NodW5rU2l6ZSk7XG4gICAgICBDaHVua0NvdW50ID0gTWF0aC5jZWlsKEZpbGVTaXplIC8gQ2h1bmtTaXplKTtcbiAgICAgIHZhciBsaXN0ID0gW107XG5cbiAgICAgIGZvciAodmFyIHBhcnROdW1iZXIgPSAxOyBwYXJ0TnVtYmVyIDw9IENodW5rQ291bnQ7IHBhcnROdW1iZXIrKykge1xuICAgICAgICB2YXIgc3RhcnQgPSAocGFydE51bWJlciAtIDEpICogQ2h1bmtTaXplO1xuICAgICAgICB2YXIgZW5kID0gcGFydE51bWJlciAqIENodW5rU2l6ZSA8IEZpbGVTaXplID8gcGFydE51bWJlciAqIENodW5rU2l6ZSAtIDEgOiBGaWxlU2l6ZSAtIDE7XG4gICAgICAgIHZhciBpdGVtID0ge1xuICAgICAgICAgIFBhcnROdW1iZXI6IHBhcnROdW1iZXIsXG4gICAgICAgICAgc3RhcnQ6IHN0YXJ0LFxuICAgICAgICAgIGVuZDogZW5kLFxuICAgICAgICAgIENvcHlTb3VyY2VSYW5nZTogXCJieXRlcz1cIiArIHN0YXJ0ICsgXCItXCIgKyBlbmRcbiAgICAgICAgfTtcbiAgICAgICAgbGlzdC5wdXNoKGl0ZW0pO1xuICAgICAgfVxuXG4gICAgICBwYXJhbXMuUGFydExpc3QgPSBsaXN0O1xuICAgIH0pKCk7XG5cbiAgICBpZiAocGFyYW1zLkhlYWRlcnNbJ3gtY29zLW1ldGFkYXRhLWRpcmVjdGl2ZSddID09PSAnUmVwbGFjZWQnKSB7XG4gICAgICBUYXJnZXRIZWFkZXIgPSBwYXJhbXMuSGVhZGVycztcbiAgICB9IGVsc2Uge1xuICAgICAgVGFyZ2V0SGVhZGVyID0gU291cmNlSGVhZGVycztcbiAgICB9XG5cbiAgICBUYXJnZXRIZWFkZXJbJ3gtY29zLXN0b3JhZ2UtY2xhc3MnXSA9IHBhcmFtcy5IZWFkZXJzWyd4LWNvcy1zdG9yYWdlLWNsYXNzJ10gfHwgU291cmNlSGVhZGVyc1sneC1jb3Mtc3RvcmFnZS1jbGFzcyddO1xuICAgIFRhcmdldEhlYWRlciA9IHV0aWwuY2xlYXJLZXkoVGFyZ2V0SGVhZGVyKTtcbiAgICAvKipcclxuICAgICAqIOWvueS6juW9kuaho+WtmOWCqOeahOWvueixoe+8jOWmguaenOacquaBouWkjeWJr+acrO+8jOWImeS4jeWFgeiuuCBDb3B5XHJcbiAgICAgKi9cblxuICAgIGlmIChTb3VyY2VIZWFkZXJzWyd4LWNvcy1zdG9yYWdlLWNsYXNzJ10gPT09ICdBUkNISVZFJyB8fCBTb3VyY2VIZWFkZXJzWyd4LWNvcy1zdG9yYWdlLWNsYXNzJ10gPT09ICdERUVQX0FSQ0hJVkUnKSB7XG4gICAgICB2YXIgcmVzdG9yZUhlYWRlciA9IFNvdXJjZUhlYWRlcnNbJ3gtY29zLXJlc3RvcmUnXTtcblxuICAgICAgaWYgKCFyZXN0b3JlSGVhZGVyIHx8IHJlc3RvcmVIZWFkZXIgPT09ICdvbmdvaW5nLXJlcXVlc3Q9XCJ0cnVlXCInKSB7XG4gICAgICAgIGNhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKCdVbnJlc3RvcmVkIGFyY2hpdmUgb2JqZWN0IGlzIG5vdCBhbGxvd2VkIHRvIGJlIGNvcGllZCcpKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gICAgLyoqXHJcbiAgICAgKiDljrvpmaTkuIDkupvml6DnlKjnmoTlpLTpg6jvvIzop4Tpgb8gbXVsdGlwYXJ0SW5pdCDlh7rplJlcclxuICAgICAqIOi/meS6m+WktOmDqOmAmuW4uOaYr+WcqCBwdXRPYmplY3RDb3B5IOaXtuaJjeS9v+eUqFxyXG4gICAgICovXG5cblxuICAgIGRlbGV0ZSBUYXJnZXRIZWFkZXJbJ3gtY29zLWNvcHktc291cmNlJ107XG4gICAgZGVsZXRlIFRhcmdldEhlYWRlclsneC1jb3MtbWV0YWRhdGEtZGlyZWN0aXZlJ107XG4gICAgZGVsZXRlIFRhcmdldEhlYWRlclsneC1jb3MtY29weS1zb3VyY2UtSWYtTW9kaWZpZWQtU2luY2UnXTtcbiAgICBkZWxldGUgVGFyZ2V0SGVhZGVyWyd4LWNvcy1jb3B5LXNvdXJjZS1JZi1Vbm1vZGlmaWVkLVNpbmNlJ107XG4gICAgZGVsZXRlIFRhcmdldEhlYWRlclsneC1jb3MtY29weS1zb3VyY2UtSWYtTWF0Y2gnXTtcbiAgICBkZWxldGUgVGFyZ2V0SGVhZGVyWyd4LWNvcy1jb3B5LXNvdXJjZS1JZi1Ob25lLU1hdGNoJ107XG4gICAgZXAuZW1pdCgnZ2V0X2NodW5rX3NpemVfZmluaXNoJyk7XG4gIH0pOyAvLyDojrflj5bov5znq6/lpI3liLbmupDmlofku7bnmoTlpKflsI9cblxuICBzZWxmLmhlYWRPYmplY3Qoe1xuICAgIEJ1Y2tldDogU291cmNlQnVja2V0LFxuICAgIFJlZ2lvbjogU291cmNlUmVnaW9uLFxuICAgIEtleTogU291cmNlS2V5XG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBpZiAoZXJyLnN0YXR1c0NvZGUgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDQwNCkge1xuICAgICAgICBjYWxsYmFjayh1dGlsLmVycm9yKGVyciwge1xuICAgICAgICAgIEVycm9yU3RhdHVzOiBTb3VyY2VLZXkgKyAnIE5vdCBFeGlzdCdcbiAgICAgICAgfSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIEZpbGVTaXplID0gcGFyYW1zLkZpbGVTaXplID0gZGF0YS5oZWFkZXJzWydjb250ZW50LWxlbmd0aCddO1xuXG4gICAgaWYgKEZpbGVTaXplID09PSB1bmRlZmluZWQgfHwgIUZpbGVTaXplKSB7XG4gICAgICBjYWxsYmFjayh1dGlsLmVycm9yKG5ldyBFcnJvcignZ2V0IENvbnRlbnQtTGVuZ3RoIGVycm9yLCBwbGVhc2UgYWRkIFwiQ29udGVudC1MZW5ndGhcIiB0byBDT1JTIEV4cG9zZUhlYWRlciBzZXR0aW5nLu+8iCDojrflj5ZDb250ZW50LUxlbmd0aOWksei0pe+8jOivt+WcqENPUlMgRXhwb3NlSGVhZGVy6K6+572u5Lit5re75YqgQ29udGVudC1MZW5ndGjvvIzor7flj4LogIPmlofmoaPvvJpodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2LzEzMzE4IO+8iScpKSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgb25Qcm9ncmVzcyA9IHV0aWwudGhyb3R0bGVPblByb2dyZXNzLmNhbGwoc2VsZiwgRmlsZVNpemUsIHBhcmFtcy5vblByb2dyZXNzKTsgLy8g5byA5aeL5LiK5LygXG5cbiAgICBpZiAoRmlsZVNpemUgPD0gQ29weVNsaWNlU2l6ZSkge1xuICAgICAgaWYgKCFwYXJhbXMuSGVhZGVyc1sneC1jb3MtbWV0YWRhdGEtZGlyZWN0aXZlJ10pIHtcbiAgICAgICAgcGFyYW1zLkhlYWRlcnNbJ3gtY29zLW1ldGFkYXRhLWRpcmVjdGl2ZSddID0gJ0NvcHknO1xuICAgICAgfVxuXG4gICAgICBzZWxmLnB1dE9iamVjdENvcHkocGFyYW1zLCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICBvblByb2dyZXNzKG51bGwsIHRydWUpO1xuICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICB9XG5cbiAgICAgICAgb25Qcm9ncmVzcyh7XG4gICAgICAgICAgbG9hZGVkOiBGaWxlU2l6ZSxcbiAgICAgICAgICB0b3RhbDogRmlsZVNpemVcbiAgICAgICAgfSwgdHJ1ZSk7XG4gICAgICAgIGNhbGxiYWNrKGVyciwgZGF0YSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIHJlc0hlYWRlcnMgPSBkYXRhLmhlYWRlcnM7XG4gICAgICBTb3VyY2VSZXNIZWFkZXJzID0gcmVzSGVhZGVycztcbiAgICAgIFNvdXJjZUhlYWRlcnMgPSB7XG4gICAgICAgICdDYWNoZS1Db250cm9sJzogcmVzSGVhZGVyc1snY2FjaGUtY29udHJvbCddLFxuICAgICAgICAnQ29udGVudC1EaXNwb3NpdGlvbic6IHJlc0hlYWRlcnNbJ2NvbnRlbnQtZGlzcG9zaXRpb24nXSxcbiAgICAgICAgJ0NvbnRlbnQtRW5jb2RpbmcnOiByZXNIZWFkZXJzWydjb250ZW50LWVuY29kaW5nJ10sXG4gICAgICAgICdDb250ZW50LVR5cGUnOiByZXNIZWFkZXJzWydjb250ZW50LXR5cGUnXSxcbiAgICAgICAgJ0V4cGlyZXMnOiByZXNIZWFkZXJzWydleHBpcmVzJ10sXG4gICAgICAgICd4LWNvcy1zdG9yYWdlLWNsYXNzJzogcmVzSGVhZGVyc1sneC1jb3Mtc3RvcmFnZS1jbGFzcyddXG4gICAgICB9O1xuICAgICAgdXRpbC5lYWNoKHJlc0hlYWRlcnMsIGZ1bmN0aW9uICh2LCBrKSB7XG4gICAgICAgIHZhciBtZXRhUHJlZml4ID0gJ3gtY29zLW1ldGEtJztcblxuICAgICAgICBpZiAoay5pbmRleE9mKG1ldGFQcmVmaXgpID09PSAwICYmIGsubGVuZ3RoID4gbWV0YVByZWZpeC5sZW5ndGgpIHtcbiAgICAgICAgICBTb3VyY2VIZWFkZXJzW2tdID0gdjtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBlcC5lbWl0KCdnZXRfZmlsZV9zaXplX2ZpbmlzaCcpO1xuICAgIH1cbiAgfSk7XG59IC8vIOWkjeWItuaMh+WumuWIhueJh1xuXG5cbmZ1bmN0aW9uIGNvcHlTbGljZUl0ZW0ocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgVGFza0lkID0gcGFyYW1zLlRhc2tJZDtcbiAgdmFyIEJ1Y2tldCA9IHBhcmFtcy5CdWNrZXQ7XG4gIHZhciBSZWdpb24gPSBwYXJhbXMuUmVnaW9uO1xuICB2YXIgS2V5ID0gcGFyYW1zLktleTtcbiAgdmFyIENvcHlTb3VyY2UgPSBwYXJhbXMuQ29weVNvdXJjZTtcbiAgdmFyIFVwbG9hZElkID0gcGFyYW1zLlVwbG9hZElkO1xuICB2YXIgUGFydE51bWJlciA9IHBhcmFtcy5QYXJ0TnVtYmVyICogMTtcbiAgdmFyIENvcHlTb3VyY2VSYW5nZSA9IHBhcmFtcy5Db3B5U291cmNlUmFuZ2U7XG4gIHZhciBDaHVua1JldHJ5VGltZXMgPSB0aGlzLm9wdGlvbnMuQ2h1bmtSZXRyeVRpbWVzICsgMTtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBBc3luYy5yZXRyeShDaHVua1JldHJ5VGltZXMsIGZ1bmN0aW9uICh0cnlDYWxsYmFjaykge1xuICAgIHNlbGYudXBsb2FkUGFydENvcHkoe1xuICAgICAgVGFza0lkOiBUYXNrSWQsXG4gICAgICBCdWNrZXQ6IEJ1Y2tldCxcbiAgICAgIFJlZ2lvbjogUmVnaW9uLFxuICAgICAgS2V5OiBLZXksXG4gICAgICBDb3B5U291cmNlOiBDb3B5U291cmNlLFxuICAgICAgVXBsb2FkSWQ6IFVwbG9hZElkLFxuICAgICAgUGFydE51bWJlcjogUGFydE51bWJlcixcbiAgICAgIENvcHlTb3VyY2VSYW5nZTogQ29weVNvdXJjZVJhbmdlXG4gICAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgdHJ5Q2FsbGJhY2soZXJyIHx8IG51bGwsIGRhdGEpO1xuICAgIH0pO1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgcmV0dXJuIGNhbGxiYWNrKGVyciwgZGF0YSk7XG4gIH0pO1xufVxuXG52YXIgQVBJX01BUCA9IHtcbiAgc2xpY2VVcGxvYWRGaWxlOiBzbGljZVVwbG9hZEZpbGUsXG4gIGFib3J0VXBsb2FkVGFzazogYWJvcnRVcGxvYWRUYXNrLFxuICB1cGxvYWRGaWxlOiB1cGxvYWRGaWxlLFxuICB1cGxvYWRGaWxlczogdXBsb2FkRmlsZXMsXG4gIHNsaWNlQ29weUZpbGU6IHNsaWNlQ29weUZpbGVcbn07XG5cbm1vZHVsZS5leHBvcnRzLmluaXQgPSBmdW5jdGlvbiAoQ09TLCB0YXNrKSB7XG4gIHRhc2sudHJhbnNmZXJUb1Rhc2tNZXRob2QoQVBJX01BUCwgJ3NsaWNlVXBsb2FkRmlsZScpO1xuICB1dGlsLmVhY2goQVBJX01BUCwgZnVuY3Rpb24gKGZuLCBhcGlOYW1lKSB7XG4gICAgQ09TLnByb3RvdHlwZVthcGlOYW1lXSA9IHV0aWwuYXBpV3JhcHBlcihhcGlOYW1lLCBmbik7XG4gIH0pO1xufTsiLCJ2YXIgZWFjaExpbWl0ID0gZnVuY3Rpb24gZWFjaExpbWl0KGFyciwgbGltaXQsIGl0ZXJhdG9yLCBjYWxsYmFjaykge1xuICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IGZ1bmN0aW9uICgpIHt9O1xuXG4gIGlmICghYXJyLmxlbmd0aCB8fCBsaW1pdCA8PSAwKSB7XG4gICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gIH1cblxuICB2YXIgY29tcGxldGVkID0gMDtcbiAgdmFyIHN0YXJ0ZWQgPSAwO1xuICB2YXIgcnVubmluZyA9IDA7XG5cbiAgKGZ1bmN0aW9uIHJlcGxlbmlzaCgpIHtcbiAgICBpZiAoY29tcGxldGVkID49IGFyci5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgIH1cblxuICAgIHdoaWxlIChydW5uaW5nIDwgbGltaXQgJiYgc3RhcnRlZCA8IGFyci5sZW5ndGgpIHtcbiAgICAgIHN0YXJ0ZWQgKz0gMTtcbiAgICAgIHJ1bm5pbmcgKz0gMTtcbiAgICAgIGl0ZXJhdG9yKGFycltzdGFydGVkIC0gMV0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIGNhbGxiYWNrKGVycik7XG5cbiAgICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uIGNhbGxiYWNrKCkge307XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29tcGxldGVkICs9IDE7XG4gICAgICAgICAgcnVubmluZyAtPSAxO1xuXG4gICAgICAgICAgaWYgKGNvbXBsZXRlZCA+PSBhcnIubGVuZ3RoKSB7XG4gICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXBsZW5pc2goKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSkoKTtcbn07XG5cbnZhciByZXRyeSA9IGZ1bmN0aW9uIHJldHJ5KHRpbWVzLCBpdGVyYXRvciwgY2FsbGJhY2spIHtcbiAgdmFyIG5leHQgPSBmdW5jdGlvbiBuZXh0KGluZGV4KSB7XG4gICAgaXRlcmF0b3IoZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgaWYgKGVyciAmJiBpbmRleCA8IHRpbWVzKSB7XG4gICAgICAgIG5leHQoaW5kZXggKyAxKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrKGVyciwgZGF0YSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgaWYgKHRpbWVzIDwgMSkge1xuICAgIGNhbGxiYWNrKCk7XG4gIH0gZWxzZSB7XG4gICAgbmV4dCgxKTtcbiAgfVxufTtcblxudmFyIGFzeW5jID0ge1xuICBlYWNoTGltaXQ6IGVhY2hMaW1pdCxcbiAgcmV0cnk6IHJldHJ5XG59O1xubW9kdWxlLmV4cG9ydHMgPSBhc3luYzsiLCJ2YXIgUkVRVUVTVCA9IHJlcXVpcmUoJy4uL2xpYi9yZXF1ZXN0Jyk7XG5cbnZhciB1dGlsID0gcmVxdWlyZSgnLi91dGlsJyk7IC8vIEJ1Y2tldCDnm7jlhbNcblxuLyoqXHJcbiAqIOiOt+WPlueUqOaIt+eahCBidWNrZXQg5YiX6KGoXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu++8jOS4i+mdouS4uuWPguaVsOWIl+ihqFxyXG4gKiDml6Dnibnmrorlj4LmlbBcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XHJcbiAqL1xuXG5cbmZ1bmN0aW9uIGdldFNlcnZpY2UocGFyYW1zLCBjYWxsYmFjaykge1xuICBpZiAodHlwZW9mIHBhcmFtcyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIGNhbGxiYWNrID0gcGFyYW1zO1xuICAgIHBhcmFtcyA9IHt9O1xuICB9XG5cbiAgdmFyIHByb3RvY29sID0gdGhpcy5vcHRpb25zLlByb3RvY29sIHx8ICh1dGlsLmlzQnJvd3NlciAmJiBsb2NhdGlvbi5wcm90b2NvbCA9PT0gJ2h0dHA6JyA/ICdodHRwOicgOiAnaHR0cHM6Jyk7XG4gIHZhciBkb21haW4gPSB0aGlzLm9wdGlvbnMuU2VydmljZURvbWFpbjtcbiAgdmFyIGFwcElkID0gcGFyYW1zLkFwcElkIHx8IHRoaXMub3B0aW9ucy5hcHBJZDtcbiAgdmFyIHJlZ2lvbiA9IHBhcmFtcy5SZWdpb247XG5cbiAgaWYgKGRvbWFpbikge1xuICAgIGRvbWFpbiA9IGRvbWFpbi5yZXBsYWNlKC9cXHtcXHtBcHBJZFxcfVxcfS9pZywgYXBwSWQgfHwgJycpLnJlcGxhY2UoL1xce1xce1JlZ2lvblxcfVxcfS9pZywgcmVnaW9uIHx8ICcnKS5yZXBsYWNlKC9cXHtcXHsuKj9cXH1cXH0vaWcsICcnKTtcblxuICAgIGlmICghL15bYS16QS1aXSs6XFwvXFwvLy50ZXN0KGRvbWFpbikpIHtcbiAgICAgIGRvbWFpbiA9IHByb3RvY29sICsgJy8vJyArIGRvbWFpbjtcbiAgICB9XG5cbiAgICBpZiAoZG9tYWluLnNsaWNlKC0xKSA9PT0gJy8nKSB7XG4gICAgICBkb21haW4gPSBkb21haW4uc2xpY2UoMCwgLTEpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChyZWdpb24pIHtcbiAgICBkb21haW4gPSBwcm90b2NvbCArICcvL2Nvcy4nICsgcmVnaW9uICsgJy5teXFjbG91ZC5jb20nO1xuICB9IGVsc2Uge1xuICAgIGRvbWFpbiA9IHByb3RvY29sICsgJy8vc2VydmljZS5jb3MubXlxY2xvdWQuY29tJztcbiAgfVxuXG4gIHZhciBTaWduSG9zdCA9ICcnO1xuICB2YXIgc3RhbmRhcmRIb3N0ID0gcmVnaW9uID8gJ2Nvcy4nICsgcmVnaW9uICsgJy5teXFjbG91ZC5jb20nIDogJ3NlcnZpY2UuY29zLm15cWNsb3VkLmNvbSc7XG4gIHZhciB1cmxIb3N0ID0gZG9tYWluLnJlcGxhY2UoL15odHRwcz86XFwvXFwvKFteL10rKShcXC8uKik/JC8sICckMScpO1xuICBpZiAoc3RhbmRhcmRIb3N0ID09PSB1cmxIb3N0KSBTaWduSG9zdCA9IHN0YW5kYXJkSG9zdDtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRTZXJ2aWNlJyxcbiAgICB1cmw6IGRvbWFpbixcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIFNpZ25Ib3N0OiBTaWduSG9zdFxuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgdmFyIGJ1Y2tldHMgPSBkYXRhICYmIGRhdGEuTGlzdEFsbE15QnVja2V0c1Jlc3VsdCAmJiBkYXRhLkxpc3RBbGxNeUJ1Y2tldHNSZXN1bHQuQnVja2V0cyAmJiBkYXRhLkxpc3RBbGxNeUJ1Y2tldHNSZXN1bHQuQnVja2V0cy5CdWNrZXQgfHwgW107XG4gICAgYnVja2V0cyA9IHV0aWwuaXNBcnJheShidWNrZXRzKSA/IGJ1Y2tldHMgOiBbYnVja2V0c107XG4gICAgdmFyIG93bmVyID0gZGF0YSAmJiBkYXRhLkxpc3RBbGxNeUJ1Y2tldHNSZXN1bHQgJiYgZGF0YS5MaXN0QWxsTXlCdWNrZXRzUmVzdWx0Lk93bmVyIHx8IHt9O1xuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIEJ1Y2tldHM6IGJ1Y2tldHMsXG4gICAgICBPd25lcjogb3duZXIsXG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcclxuICog5Yib5bu6IEJ1Y2tldO+8jOW5tuWIneWni+WMluiuv+mXruadg+mZkFxyXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkFDTCAgICAgICAgICAgICAgICAg55So5oi36Ieq5a6a5LmJ5paH5Lu25p2D6ZmQ77yM5Y+v5Lul6K6+572u77yacHJpdmF0Ze+8jHB1YmxpYy1yZWFk77yb6buY6K6k5YC877yacHJpdmF0Ze+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkdyYW50UmVhZCAgICAgICAgICAg6LWL5LqI6KKr5o6I5p2D6ICF6K+755qE5p2D6ZmQ77yM5qC85byPeC1jb3MtZ3JhbnQtcmVhZDogdWluPVwiIFwiLHVpbj1cIiBcIu+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkdyYW50V3JpdGUgICAgICAgICAg6LWL5LqI6KKr5o6I5p2D6ICF5YaZ55qE5p2D6ZmQ77yM5qC85byPeC1jb3MtZ3JhbnQtd3JpdGU6IHVpbj1cIiBcIix1aW49XCIgXCLvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5HcmFudEZ1bGxDb250cm9sICAgIOi1i+S6iOiiq+aOiOadg+iAheivu+WGmeadg+mZkO+8jOagvOW8j3gtY29zLWdyYW50LWZ1bGwtY29udHJvbDogdWluPVwiIFwiLHVpbj1cIiBcIu+8jOmdnuW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcclxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxyXG4gKiAgICAgQHJldHVybiAge1N0cmluZ30gIGRhdGEuTG9jYXRpb24gICAgICAgICAgICAg5pON5L2c5Zyw5Z2AXHJcbiAqL1xuXG5cbmZ1bmN0aW9uIHB1dEJ1Y2tldChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIHhtbCA9ICcnO1xuXG4gIGlmIChwYXJhbXNbJ0J1Y2tldEFaQ29uZmlnJ10pIHtcbiAgICB2YXIgQ3JlYXRlQnVja2V0Q29uZmlndXJhdGlvbiA9IHtcbiAgICAgIEJ1Y2tldEFaQ29uZmlnOiBwYXJhbXMuQnVja2V0QVpDb25maWdcbiAgICB9O1xuICAgIHhtbCA9IHV0aWwuanNvbjJ4bWwoe1xuICAgICAgQ3JlYXRlQnVja2V0Q29uZmlndXJhdGlvbjogQ3JlYXRlQnVja2V0Q29uZmlndXJhdGlvblxuICAgIH0pO1xuICB9XG5cbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRCdWNrZXQnLFxuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBib2R5OiB4bWxcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIHZhciB1cmwgPSBnZXRVcmwoe1xuICAgICAgcHJvdG9jb2w6IHNlbGYub3B0aW9ucy5Qcm90b2NvbCxcbiAgICAgIGRvbWFpbjogc2VsZi5vcHRpb25zLkRvbWFpbixcbiAgICAgIGJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICAgIHJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICAgIGlzTG9jYXRpb246IHRydWVcbiAgICB9KTtcbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBMb2NhdGlvbjogdXJsLFxuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXHJcbiAqIOafpeeci+aYr+WQpuWtmOWcqOivpUJ1Y2tldO+8jOaYr+WQpuacieadg+mZkOiuv+mXrlxyXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICAgICAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcclxuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxyXG4gKiAgICAgQHJldHVybiAge0Jvb2xlYW59ICBkYXRhLkJ1Y2tldEV4aXN0ICAgICBCdWNrZXTmmK/lkKblrZjlnKhcclxuICogICAgIEByZXR1cm4gIHtCb29sZWFufSAgZGF0YS5CdWNrZXRBdXRoICAgICAg5piv5ZCm5pyJIEJ1Y2tldCDnmoTorr/pl67mnYPpmZBcclxuICovXG5cblxuZnVuY3Rpb24gaGVhZEJ1Y2tldChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6SGVhZEJ1Y2tldCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBtZXRob2Q6ICdIRUFEJ1xuICB9LCBjYWxsYmFjayk7XG59XG4vKipcclxuICog6I635Y+WIEJ1Y2tldCDkuIvnmoQgb2JqZWN0IOWIl+ihqFxyXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlByZWZpeCAgICAgICAgICAgICAg5YmN57yA5Yy56YWN77yM55So5p2l6KeE5a6a6L+U5Zue55qE5paH5Lu25YmN57yA5Zyw5Z2A77yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuRGVsaW1pdGVyICAgICAgICAgICDlrprnlYznrKbkuLrkuIDkuKrnrKblj7fvvIzlpoLmnpzmnIlQcmVmaXjvvIzliJnlsIZQcmVmaXjliLBkZWxpbWl0ZXLkuYvpl7TnmoTnm7jlkIzot6/lvoTlvZLkuLrkuIDnsbvvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5NYXJrZXIgICAgICAgICAgICAgIOm7mOiupOS7pVVURi045LqM6L+b5Yi26aG65bqP5YiX5Ye65p2h55uu77yM5omA5pyJ5YiX5Ye65p2h55uu5LuObWFya2Vy5byA5aeL77yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuTWF4S2V5cyAgICAgICAgICAgICDljZXmrKHov5Tlm57mnIDlpKfnmoTmnaHnm67mlbDph4/vvIzpu5jorqQxMDAw77yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuRW5jb2RpbmdUeXBlICAgICAgICDop4Tlrprov5Tlm57lgLznmoTnvJbnoIHmlrnlvI/vvIzpnZ7lv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cclxuICogICAgIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhLkxpc3RCdWNrZXRSZXN1bHQgICAgIOi/lOWbnueahCBvYmplY3Qg5YiX6KGo5L+h5oGvXHJcbiAqL1xuXG5cbmZ1bmN0aW9uIGdldEJ1Y2tldChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciByZXFQYXJhbXMgPSB7fTtcbiAgcmVxUGFyYW1zWydwcmVmaXgnXSA9IHBhcmFtc1snUHJlZml4J10gfHwgJyc7XG4gIHJlcVBhcmFtc1snZGVsaW1pdGVyJ10gPSBwYXJhbXNbJ0RlbGltaXRlciddO1xuICByZXFQYXJhbXNbJ21hcmtlciddID0gcGFyYW1zWydNYXJrZXInXTtcbiAgcmVxUGFyYW1zWydtYXgta2V5cyddID0gcGFyYW1zWydNYXhLZXlzJ107XG4gIHJlcVBhcmFtc1snZW5jb2RpbmctdHlwZSddID0gcGFyYW1zWydFbmNvZGluZ1R5cGUnXTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRCdWNrZXQnLFxuICAgIFJlc291cmNlS2V5OiByZXFQYXJhbXNbJ3ByZWZpeCddLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBxczogcmVxUGFyYW1zXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB2YXIgTGlzdEJ1Y2tldFJlc3VsdCA9IGRhdGEuTGlzdEJ1Y2tldFJlc3VsdCB8fCB7fTtcbiAgICB2YXIgQ29udGVudHMgPSBMaXN0QnVja2V0UmVzdWx0LkNvbnRlbnRzIHx8IFtdO1xuICAgIHZhciBDb21tb25QcmVmaXhlcyA9IExpc3RCdWNrZXRSZXN1bHQuQ29tbW9uUHJlZml4ZXMgfHwgW107XG4gICAgQ29udGVudHMgPSB1dGlsLmlzQXJyYXkoQ29udGVudHMpID8gQ29udGVudHMgOiBbQ29udGVudHNdO1xuICAgIENvbW1vblByZWZpeGVzID0gdXRpbC5pc0FycmF5KENvbW1vblByZWZpeGVzKSA/IENvbW1vblByZWZpeGVzIDogW0NvbW1vblByZWZpeGVzXTtcbiAgICB2YXIgcmVzdWx0ID0gdXRpbC5jbG9uZShMaXN0QnVja2V0UmVzdWx0KTtcbiAgICB1dGlsLmV4dGVuZChyZXN1bHQsIHtcbiAgICAgIENvbnRlbnRzOiBDb250ZW50cyxcbiAgICAgIENvbW1vblByZWZpeGVzOiBDb21tb25QcmVmaXhlcyxcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gIH0pO1xufVxuLyoqXHJcbiAqIOWIoOmZpCBCdWNrZXRcclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcclxuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcclxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cclxuICogICAgIEByZXR1cm4gIHtTdHJpbmd9ICBkYXRhLkxvY2F0aW9uICAgICDmk43kvZzlnLDlnYBcclxuICovXG5cblxuZnVuY3Rpb24gZGVsZXRlQnVja2V0KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpEZWxldGVCdWNrZXQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgbWV0aG9kOiAnREVMRVRFJ1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gMjA0KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxyXG4gKiDorr7nva4gQnVja2V0IOeahCDmnYPpmZDliJfooahcclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5BQ0wgICAgICAgICAgICAgICAgIOeUqOaIt+iHquWumuS5ieaWh+S7tuadg+mZkO+8jOWPr+S7peiuvue9ru+8mnByaXZhdGXvvIxwdWJsaWMtcmVhZO+8m+m7mOiupOWAvO+8mnByaXZhdGXvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5HcmFudFJlYWQgICAgICAgICAgIOi1i+S6iOiiq+aOiOadg+iAheivu+eahOadg+mZkO+8jOagvOW8j3gtY29zLWdyYW50LXJlYWQ6IHVpbj1cIiBcIix1aW49XCIgXCLvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5HcmFudFdyaXRlICAgICAgICAgIOi1i+S6iOiiq+aOiOadg+iAheWGmeeahOadg+mZkO+8jOagvOW8j3gtY29zLWdyYW50LXdyaXRlOiB1aW49XCIgXCIsdWluPVwiIFwi77yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuR3JhbnRGdWxsQ29udHJvbCAgICDotYvkuojooqvmjojmnYPogIXor7vlhpnmnYPpmZDvvIzmoLzlvI94LWNvcy1ncmFudC1mdWxsLWNvbnRyb2w6IHVpbj1cIiBcIix1aW49XCIgXCLvvIzpnZ7lv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cclxuICovXG5cblxuZnVuY3Rpb24gcHV0QnVja2V0QWNsKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgdmFyIHhtbCA9ICcnO1xuXG4gIGlmIChwYXJhbXNbJ0FjY2Vzc0NvbnRyb2xQb2xpY3knXSkge1xuICAgIHZhciBBY2Nlc3NDb250cm9sUG9saWN5ID0gdXRpbC5jbG9uZShwYXJhbXNbJ0FjY2Vzc0NvbnRyb2xQb2xpY3knXSB8fCB7fSk7XG4gICAgdmFyIEdyYW50cyA9IEFjY2Vzc0NvbnRyb2xQb2xpY3kuR3JhbnRzIHx8IEFjY2Vzc0NvbnRyb2xQb2xpY3kuR3JhbnQ7XG4gICAgR3JhbnRzID0gdXRpbC5pc0FycmF5KEdyYW50cykgPyBHcmFudHMgOiBbR3JhbnRzXTtcbiAgICBkZWxldGUgQWNjZXNzQ29udHJvbFBvbGljeS5HcmFudDtcbiAgICBkZWxldGUgQWNjZXNzQ29udHJvbFBvbGljeS5HcmFudHM7XG4gICAgQWNjZXNzQ29udHJvbFBvbGljeS5BY2Nlc3NDb250cm9sTGlzdCA9IHtcbiAgICAgIEdyYW50OiBHcmFudHNcbiAgICB9O1xuICAgIHhtbCA9IHV0aWwuanNvbjJ4bWwoe1xuICAgICAgQWNjZXNzQ29udHJvbFBvbGljeTogQWNjZXNzQ29udHJvbFBvbGljeVxuICAgIH0pO1xuICAgIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3htbCc7XG4gICAgaGVhZGVyc1snQ29udGVudC1NRDUnXSA9IHV0aWwuYmluYXJ5QmFzZTY0KHV0aWwubWQ1KHhtbCkpO1xuICB9IC8vIEdyYW50IEhlYWRlciDljrvph41cblxuXG4gIHV0aWwuZWFjaChoZWFkZXJzLCBmdW5jdGlvbiAodmFsLCBrZXkpIHtcbiAgICBpZiAoa2V5LmluZGV4T2YoJ3gtY29zLWdyYW50LScpID09PSAwKSB7XG4gICAgICBoZWFkZXJzW2tleV0gPSB1bmlxR3JhbnQoaGVhZGVyc1trZXldKTtcbiAgICB9XG4gIH0pO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOlB1dEJ1Y2tldEFDTCcsXG4gICAgbWV0aG9kOiAnUFVUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IGhlYWRlcnMsXG4gICAgYWN0aW9uOiAnYWNsJyxcbiAgICBib2R5OiB4bWxcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxyXG4gKiDojrflj5YgQnVja2V0IOeahCDmnYPpmZDliJfooahcclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cclxuICogICAgIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhLkFjY2Vzc0NvbnRyb2xQb2xpY3kgIOiuv+mXruadg+mZkOS/oeaBr1xyXG4gKi9cblxuXG5mdW5jdGlvbiBnZXRCdWNrZXRBY2wocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkdldEJ1Y2tldEFDTCcsXG4gICAgbWV0aG9kOiAnR0VUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ2FjbCdcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIHZhciBBY2Nlc3NDb250cm9sUG9saWN5ID0gZGF0YS5BY2Nlc3NDb250cm9sUG9saWN5IHx8IHt9O1xuICAgIHZhciBPd25lciA9IEFjY2Vzc0NvbnRyb2xQb2xpY3kuT3duZXIgfHwge307XG4gICAgdmFyIEdyYW50ID0gQWNjZXNzQ29udHJvbFBvbGljeS5BY2Nlc3NDb250cm9sTGlzdC5HcmFudCB8fCBbXTtcbiAgICBHcmFudCA9IHV0aWwuaXNBcnJheShHcmFudCkgPyBHcmFudCA6IFtHcmFudF07XG4gICAgdmFyIHJlc3VsdCA9IGRlY29kZUFjbChBY2Nlc3NDb250cm9sUG9saWN5KTtcblxuICAgIGlmIChkYXRhLmhlYWRlcnMgJiYgZGF0YS5oZWFkZXJzWyd4LWNvcy1hY2wnXSkge1xuICAgICAgcmVzdWx0LkFDTCA9IGRhdGEuaGVhZGVyc1sneC1jb3MtYWNsJ107XG4gICAgfVxuXG4gICAgcmVzdWx0ID0gdXRpbC5leHRlbmQocmVzdWx0LCB7XG4gICAgICBPd25lcjogT3duZXIsXG4gICAgICBHcmFudHM6IEdyYW50LFxuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcbiAgfSk7XG59XG4vKipcclxuICog6K6+572uIEJ1Y2tldCDnmoQg6Leo5Z+f6K6+572uXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgICAgICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICAgICAgICAgICAgICAgICAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMuQ09SU0NvbmZpZ3VyYXRpb24gICAgICAg55u45YWz55qE6Leo5Z+f6K6+572u77yM5b+F6aG7XHJcbiAqIEBwYXJhbSAge0FycmF5fSAgcGFyYW1zLkNPUlNDb25maWd1cmF0aW9uLkNPUlNSdWxlcyAg5a+55bqU55qE6Leo5Z+f6KeE5YiZXHJcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICAgICAgICAgICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6L+U5Zue55qE5pWw5o2uXHJcbiAqL1xuXG5cbmZ1bmN0aW9uIHB1dEJ1Y2tldENvcnMocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgQ09SU0NvbmZpZ3VyYXRpb24gPSBwYXJhbXNbJ0NPUlNDb25maWd1cmF0aW9uJ10gfHwge307XG4gIHZhciBDT1JTUnVsZXMgPSBDT1JTQ29uZmlndXJhdGlvblsnQ09SU1J1bGVzJ10gfHwgcGFyYW1zWydDT1JTUnVsZXMnXSB8fCBbXTtcbiAgQ09SU1J1bGVzID0gdXRpbC5jbG9uZSh1dGlsLmlzQXJyYXkoQ09SU1J1bGVzKSA/IENPUlNSdWxlcyA6IFtDT1JTUnVsZXNdKTtcbiAgdXRpbC5lYWNoKENPUlNSdWxlcywgZnVuY3Rpb24gKHJ1bGUpIHtcbiAgICB1dGlsLmVhY2goWydBbGxvd2VkT3JpZ2luJywgJ0FsbG93ZWRIZWFkZXInLCAnQWxsb3dlZE1ldGhvZCcsICdFeHBvc2VIZWFkZXInXSwgZnVuY3Rpb24gKGtleSkge1xuICAgICAgdmFyIHNLZXkgPSBrZXkgKyAncyc7XG4gICAgICB2YXIgdmFsID0gcnVsZVtzS2V5XSB8fCBydWxlW2tleV0gfHwgW107XG4gICAgICBkZWxldGUgcnVsZVtzS2V5XTtcbiAgICAgIHJ1bGVba2V5XSA9IHV0aWwuaXNBcnJheSh2YWwpID8gdmFsIDogW3ZhbF07XG4gICAgfSk7XG4gIH0pO1xuICB2YXIgQ29uZiA9IHtcbiAgICBDT1JTUnVsZTogQ09SU1J1bGVzXG4gIH07XG4gIGlmIChwYXJhbXMuUmVzcG9uc2VWYXJ5KSBDb25mLlJlc3BvbnNlVmFyeSA9IHBhcmFtcy5SZXNwb25zZVZhcnk7XG4gIHZhciB4bWwgPSB1dGlsLmpzb24yeG1sKHtcbiAgICBDT1JTQ29uZmlndXJhdGlvbjogQ29uZlxuICB9KTtcbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veG1sJztcbiAgaGVhZGVyc1snQ29udGVudC1NRDUnXSA9IHV0aWwuYmluYXJ5QmFzZTY0KHV0aWwubWQ1KHhtbCkpO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOlB1dEJ1Y2tldENPUlMnLFxuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBib2R5OiB4bWwsXG4gICAgYWN0aW9uOiAnY29ycycsXG4gICAgaGVhZGVyczogaGVhZGVyc1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXHJcbiAqIOiOt+WPliBCdWNrZXQg55qEIOi3qOWfn+iuvue9rlxyXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcclxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxyXG4gKiAgICAgQHJldHVybiAge09iamVjdH0gIGRhdGEuQ09SU1J1bGVzICAgICAgICAgICAgQnVja2V055qE6Leo5Z+f6K6+572uXHJcbiAqL1xuXG5cbmZ1bmN0aW9uIGdldEJ1Y2tldENvcnMocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkdldEJ1Y2tldENPUlMnLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdjb3JzJ1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgaWYgKGVyci5zdGF0dXNDb2RlID09PSA0MDQgJiYgZXJyLmVycm9yICYmIGVyci5lcnJvci5Db2RlID09PSAnTm9TdWNoQ09SU0NvbmZpZ3VyYXRpb24nKSB7XG4gICAgICAgIHZhciByZXN1bHQgPSB7XG4gICAgICAgICAgQ09SU1J1bGVzOiBbXSxcbiAgICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgICB9O1xuICAgICAgICBlcnIuaGVhZGVycyAmJiAocmVzdWx0LmhlYWRlcnMgPSBlcnIuaGVhZGVycyk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIENPUlNDb25maWd1cmF0aW9uID0gZGF0YS5DT1JTQ29uZmlndXJhdGlvbiB8fCB7fTtcbiAgICB2YXIgQ09SU1J1bGVzID0gQ09SU0NvbmZpZ3VyYXRpb24uQ09SU1J1bGVzIHx8IENPUlNDb25maWd1cmF0aW9uLkNPUlNSdWxlIHx8IFtdO1xuICAgIENPUlNSdWxlcyA9IHV0aWwuY2xvbmUodXRpbC5pc0FycmF5KENPUlNSdWxlcykgPyBDT1JTUnVsZXMgOiBbQ09SU1J1bGVzXSk7XG4gICAgdmFyIFJlc3BvbnNlVmFyeSA9IENPUlNDb25maWd1cmF0aW9uLlJlc3BvbnNlVmFyeTtcbiAgICB1dGlsLmVhY2goQ09SU1J1bGVzLCBmdW5jdGlvbiAocnVsZSkge1xuICAgICAgdXRpbC5lYWNoKFsnQWxsb3dlZE9yaWdpbicsICdBbGxvd2VkSGVhZGVyJywgJ0FsbG93ZWRNZXRob2QnLCAnRXhwb3NlSGVhZGVyJ10sIGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgdmFyIHNLZXkgPSBrZXkgKyAncyc7XG4gICAgICAgIHZhciB2YWwgPSBydWxlW3NLZXldIHx8IHJ1bGVba2V5XSB8fCBbXTtcbiAgICAgICAgZGVsZXRlIHJ1bGVba2V5XTtcbiAgICAgICAgcnVsZVtzS2V5XSA9IHV0aWwuaXNBcnJheSh2YWwpID8gdmFsIDogW3ZhbF07XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBDT1JTUnVsZXM6IENPUlNSdWxlcyxcbiAgICAgIFJlc3BvbnNlVmFyeTogUmVzcG9uc2VWYXJ5LFxuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXHJcbiAqIOWIoOmZpCBCdWNrZXQg55qEIOi3qOWfn+iuvue9rlxyXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxyXG4gKi9cblxuXG5mdW5jdGlvbiBkZWxldGVCdWNrZXRDb3JzKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpEZWxldGVCdWNrZXRDT1JTJyxcbiAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgYWN0aW9uOiAnY29ycydcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUgfHwgZXJyLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcclxuICog6I635Y+WIEJ1Y2tldCDnmoQg5Zyw5Z+f5L+h5oGvXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XHJcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcclxuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAg6L+U5Zue5pWw5o2u77yM5YyF5ZCr5Zyw5Z+f5L+h5oGvIExvY2F0aW9uQ29uc3RyYWludFxyXG4gKi9cblxuXG5mdW5jdGlvbiBnZXRCdWNrZXRMb2NhdGlvbihwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6R2V0QnVja2V0TG9jYXRpb24nLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdsb2NhdGlvbidcbiAgfSwgY2FsbGJhY2spO1xufVxuXG5mdW5jdGlvbiBwdXRCdWNrZXRQb2xpY3kocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgUG9saWN5ID0gcGFyYW1zWydQb2xpY3knXTtcblxuICB0cnkge1xuICAgIGlmICh0eXBlb2YgUG9saWN5ID09PSAnc3RyaW5nJykgUG9saWN5ID0gSlNPTi5wYXJzZShQb2xpY3kpO1xuICB9IGNhdGNoIChlKSB7fVxuXG4gIGlmICghUG9saWN5IHx8IHR5cGVvZiBQb2xpY3kgPT09ICdzdHJpbmcnKSByZXR1cm4gY2FsbGJhY2sodXRpbC5lcnJvcihuZXcgRXJyb3IoJ1BvbGljeSBmb3JtYXQgZXJyb3InKSkpO1xuICB2YXIgUG9saWN5U3RyID0gSlNPTi5zdHJpbmdpZnkoUG9saWN5KTtcbiAgaWYgKCFQb2xpY3kudmVyc2lvbikgUG9saWN5LnZlcnNpb24gPSAnMi4wJztcbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24vanNvbic7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNShQb2xpY3lTdHIpKTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRCdWNrZXRQb2xpY3knLFxuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBhY3Rpb246ICdwb2xpY3knLFxuICAgIGJvZHk6IFBvbGljeVN0cixcbiAgICBoZWFkZXJzOiBoZWFkZXJzXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyICYmIGVyci5zdGF0dXNDb2RlID09PSAyMDQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXHJcbiAqIOiOt+WPliBCdWNrZXQg55qE6K+75Y+W5p2D6ZmQ562W55WlXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XHJcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcclxuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAg6L+U5Zue5pWw5o2uXHJcbiAqL1xuXG5cbmZ1bmN0aW9uIGdldEJ1Y2tldFBvbGljeShwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6R2V0QnVja2V0UG9saWN5JyxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgYWN0aW9uOiAncG9saWN5JyxcbiAgICByYXdCb2R5OiB0cnVlXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBpZiAoZXJyLnN0YXR1c0NvZGUgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDQwMykge1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sodXRpbC5lcnJvcihlcnIsIHtcbiAgICAgICAgICBFcnJvclN0YXR1czogJ0FjY2VzcyBEZW5pZWQnXG4gICAgICAgIH0pKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGVyci5zdGF0dXNDb2RlICYmIGVyci5zdGF0dXNDb2RlID09PSA0MDUpIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKHV0aWwuZXJyb3IoZXJyLCB7XG4gICAgICAgICAgRXJyb3JTdGF0dXM6ICdNZXRob2QgTm90IEFsbG93ZWQnXG4gICAgICAgIH0pKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGVyci5zdGF0dXNDb2RlICYmIGVyci5zdGF0dXNDb2RlID09PSA0MDQpIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKHV0aWwuZXJyb3IoZXJyLCB7XG4gICAgICAgICAgRXJyb3JTdGF0dXM6ICdQb2xpY3kgTm90IEZvdW5kJ1xuICAgICAgICB9KSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIHZhciBQb2xpY3kgPSB7fTtcblxuICAgIHRyeSB7XG4gICAgICBQb2xpY3kgPSBKU09OLnBhcnNlKGRhdGEuYm9keSk7XG4gICAgfSBjYXRjaCAoZSkge31cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIFBvbGljeTogUG9saWN5LFxuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXHJcbiAqIOWIoOmZpCBCdWNrZXQg55qEIOi3qOWfn+iuvue9rlxyXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxyXG4gKi9cblxuXG5mdW5jdGlvbiBkZWxldGVCdWNrZXRQb2xpY3kocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkRlbGV0ZUJ1Y2tldFBvbGljeScsXG4gICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ3BvbGljeSdcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUgfHwgZXJyLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcclxuICog6K6+572uIEJ1Y2tldCDnmoTmoIfnrb5cclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgQnVja2V05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge0FycmF5fSAgIHBhcmFtcy5UYWdTZXQgIOagh+etvuiuvue9ru+8jOW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcclxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgIOi/lOWbnuaVsOaNrlxyXG4gKi9cblxuXG5mdW5jdGlvbiBwdXRCdWNrZXRUYWdnaW5nKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIFRhZ2dpbmcgPSBwYXJhbXNbJ1RhZ2dpbmcnXSB8fCB7fTtcbiAgdmFyIFRhZ3MgPSBUYWdnaW5nLlRhZ1NldCB8fCBUYWdnaW5nLlRhZ3MgfHwgcGFyYW1zWydUYWdzJ10gfHwgW107XG4gIFRhZ3MgPSB1dGlsLmNsb25lKHV0aWwuaXNBcnJheShUYWdzKSA/IFRhZ3MgOiBbVGFnc10pO1xuICB2YXIgeG1sID0gdXRpbC5qc29uMnhtbCh7XG4gICAgVGFnZ2luZzoge1xuICAgICAgVGFnU2V0OiB7XG4gICAgICAgIFRhZzogVGFnc1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3htbCc7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNSh4bWwpKTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRCdWNrZXRUYWdnaW5nJyxcbiAgICBtZXRob2Q6ICdQVVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgYm9keTogeG1sLFxuICAgIGFjdGlvbjogJ3RhZ2dpbmcnLFxuICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcclxuICog6I635Y+WIEJ1Y2tldCDnmoTmoIfnrb7orr7nva5cclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgQnVja2V05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57mlbDmja5cclxuICovXG5cblxuZnVuY3Rpb24gZ2V0QnVja2V0VGFnZ2luZyhwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6R2V0QnVja2V0VGFnZ2luZycsXG4gICAgbWV0aG9kOiAnR0VUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ3RhZ2dpbmcnXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBpZiAoZXJyLnN0YXR1c0NvZGUgPT09IDQwNCAmJiBlcnIuZXJyb3IgJiYgKGVyci5lcnJvciA9PT0gXCJOb3QgRm91bmRcIiB8fCBlcnIuZXJyb3IuQ29kZSA9PT0gJ05vU3VjaFRhZ1NldCcpKSB7XG4gICAgICAgIHZhciByZXN1bHQgPSB7XG4gICAgICAgICAgVGFnczogW10sXG4gICAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgICAgfTtcbiAgICAgICAgZXJyLmhlYWRlcnMgJiYgKHJlc3VsdC5oZWFkZXJzID0gZXJyLmhlYWRlcnMpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBUYWdzID0gW107XG5cbiAgICB0cnkge1xuICAgICAgVGFncyA9IGRhdGEuVGFnZ2luZy5UYWdTZXQuVGFnIHx8IFtdO1xuICAgIH0gY2F0Y2ggKGUpIHt9XG5cbiAgICBUYWdzID0gdXRpbC5jbG9uZSh1dGlsLmlzQXJyYXkoVGFncykgPyBUYWdzIDogW1RhZ3NdKTtcbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBUYWdzOiBUYWdzLFxuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXHJcbiAqIOWIoOmZpCBCdWNrZXQg55qEIOagh+etvuiuvue9rlxyXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICBCdWNrZXTlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gIOWcsOWfn+WQjeensO+8jOW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcclxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxyXG4gKi9cblxuXG5mdW5jdGlvbiBkZWxldGVCdWNrZXRUYWdnaW5nKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpEZWxldGVCdWNrZXRUYWdnaW5nJyxcbiAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgYWN0aW9uOiAndGFnZ2luZydcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHB1dEJ1Y2tldExpZmVjeWNsZShwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBMaWZlY3ljbGVDb25maWd1cmF0aW9uID0gcGFyYW1zWydMaWZlY3ljbGVDb25maWd1cmF0aW9uJ10gfHwge307XG4gIHZhciBSdWxlcyA9IExpZmVjeWNsZUNvbmZpZ3VyYXRpb24uUnVsZXMgfHwgcGFyYW1zLlJ1bGVzIHx8IFtdO1xuICBSdWxlcyA9IHV0aWwuY2xvbmUoUnVsZXMpO1xuICB2YXIgeG1sID0gdXRpbC5qc29uMnhtbCh7XG4gICAgTGlmZWN5Y2xlQ29uZmlndXJhdGlvbjoge1xuICAgICAgUnVsZTogUnVsZXNcbiAgICB9XG4gIH0pO1xuICB2YXIgaGVhZGVycyA9IHBhcmFtcy5IZWFkZXJzO1xuICBoZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi94bWwnO1xuICBoZWFkZXJzWydDb250ZW50LU1ENSddID0gdXRpbC5iaW5hcnlCYXNlNjQodXRpbC5tZDUoeG1sKSk7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6UHV0QnVja2V0TGlmZWN5Y2xlJyxcbiAgICBtZXRob2Q6ICdQVVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgYm9keTogeG1sLFxuICAgIGFjdGlvbjogJ2xpZmVjeWNsZScsXG4gICAgaGVhZGVyczogaGVhZGVyc1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gMjA0KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0QnVja2V0TGlmZWN5Y2xlKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRCdWNrZXRMaWZlY3ljbGUnLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdsaWZlY3ljbGUnXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBpZiAoZXJyLnN0YXR1c0NvZGUgPT09IDQwNCAmJiBlcnIuZXJyb3IgJiYgZXJyLmVycm9yLkNvZGUgPT09ICdOb1N1Y2hMaWZlY3ljbGVDb25maWd1cmF0aW9uJykge1xuICAgICAgICB2YXIgcmVzdWx0ID0ge1xuICAgICAgICAgIFJ1bGVzOiBbXSxcbiAgICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgICB9O1xuICAgICAgICBlcnIuaGVhZGVycyAmJiAocmVzdWx0LmhlYWRlcnMgPSBlcnIuaGVhZGVycyk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIFJ1bGVzID0gW107XG5cbiAgICB0cnkge1xuICAgICAgUnVsZXMgPSBkYXRhLkxpZmVjeWNsZUNvbmZpZ3VyYXRpb24uUnVsZSB8fCBbXTtcbiAgICB9IGNhdGNoIChlKSB7fVxuXG4gICAgUnVsZXMgPSB1dGlsLmNsb25lKHV0aWwuaXNBcnJheShSdWxlcykgPyBSdWxlcyA6IFtSdWxlc10pO1xuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIFJ1bGVzOiBSdWxlcyxcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gZGVsZXRlQnVja2V0TGlmZWN5Y2xlKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpEZWxldGVCdWNrZXRMaWZlY3ljbGUnLFxuICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdsaWZlY3ljbGUnXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyICYmIGVyci5zdGF0dXNDb2RlID09PSAyMDQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBwdXRCdWNrZXRWZXJzaW9uaW5nKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgaWYgKCFwYXJhbXNbJ1ZlcnNpb25pbmdDb25maWd1cmF0aW9uJ10pIHtcbiAgICBjYWxsYmFjayh1dGlsLmVycm9yKG5ldyBFcnJvcignbWlzc2luZyBwYXJhbSBWZXJzaW9uaW5nQ29uZmlndXJhdGlvbicpKSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIFZlcnNpb25pbmdDb25maWd1cmF0aW9uID0gcGFyYW1zWydWZXJzaW9uaW5nQ29uZmlndXJhdGlvbiddIHx8IHt9O1xuICB2YXIgeG1sID0gdXRpbC5qc29uMnhtbCh7XG4gICAgVmVyc2lvbmluZ0NvbmZpZ3VyYXRpb246IFZlcnNpb25pbmdDb25maWd1cmF0aW9uXG4gIH0pO1xuICB2YXIgaGVhZGVycyA9IHBhcmFtcy5IZWFkZXJzO1xuICBoZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi94bWwnO1xuICBoZWFkZXJzWydDb250ZW50LU1ENSddID0gdXRpbC5iaW5hcnlCYXNlNjQodXRpbC5tZDUoeG1sKSk7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6UHV0QnVja2V0VmVyc2lvbmluZycsXG4gICAgbWV0aG9kOiAnUFVUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGJvZHk6IHhtbCxcbiAgICBhY3Rpb246ICd2ZXJzaW9uaW5nJyxcbiAgICBoZWFkZXJzOiBoZWFkZXJzXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyICYmIGVyci5zdGF0dXNDb2RlID09PSAyMDQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRCdWNrZXRWZXJzaW9uaW5nKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRCdWNrZXRWZXJzaW9uaW5nJyxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgYWN0aW9uOiAndmVyc2lvbmluZydcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmICghZXJyKSB7XG4gICAgICAhZGF0YS5WZXJzaW9uaW5nQ29uZmlndXJhdGlvbiAmJiAoZGF0YS5WZXJzaW9uaW5nQ29uZmlndXJhdGlvbiA9IHt9KTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhlcnIsIGRhdGEpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcHV0QnVja2V0UmVwbGljYXRpb24ocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgUmVwbGljYXRpb25Db25maWd1cmF0aW9uID0gdXRpbC5jbG9uZShwYXJhbXMuUmVwbGljYXRpb25Db25maWd1cmF0aW9uKTtcbiAgdmFyIHhtbCA9IHV0aWwuanNvbjJ4bWwoe1xuICAgIFJlcGxpY2F0aW9uQ29uZmlndXJhdGlvbjogUmVwbGljYXRpb25Db25maWd1cmF0aW9uXG4gIH0pO1xuICB4bWwgPSB4bWwucmVwbGFjZSgvPChcXC8/KVJ1bGVzPi9pZywgJzwkMVJ1bGU+Jyk7XG4gIHhtbCA9IHhtbC5yZXBsYWNlKC88KFxcLz8pVGFncz4vaWcsICc8JDFUYWc+Jyk7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3htbCc7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNSh4bWwpKTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRCdWNrZXRSZXBsaWNhdGlvbicsXG4gICAgbWV0aG9kOiAnUFVUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGJvZHk6IHhtbCxcbiAgICBhY3Rpb246ICdyZXBsaWNhdGlvbicsXG4gICAgaGVhZGVyczogaGVhZGVyc1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gMjA0KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0QnVja2V0UmVwbGljYXRpb24ocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkdldEJ1Y2tldFJlcGxpY2F0aW9uJyxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgYWN0aW9uOiAncmVwbGljYXRpb24nXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBpZiAoZXJyLnN0YXR1c0NvZGUgPT09IDQwNCAmJiBlcnIuZXJyb3IgJiYgKGVyci5lcnJvciA9PT0gJ05vdCBGb3VuZCcgfHwgZXJyLmVycm9yLkNvZGUgPT09ICdSZXBsaWNhdGlvbkNvbmZpZ3VyYXRpb25ub3RGb3VuZEVycm9yJykpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHtcbiAgICAgICAgICBSZXBsaWNhdGlvbkNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICAgIFJ1bGVzOiBbXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgICAgfTtcbiAgICAgICAgZXJyLmhlYWRlcnMgJiYgKHJlc3VsdC5oZWFkZXJzID0gZXJyLmhlYWRlcnMpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgICFkYXRhLlJlcGxpY2F0aW9uQ29uZmlndXJhdGlvbiAmJiAoZGF0YS5SZXBsaWNhdGlvbkNvbmZpZ3VyYXRpb24gPSB7fSk7XG5cbiAgICBpZiAoZGF0YS5SZXBsaWNhdGlvbkNvbmZpZ3VyYXRpb24uUnVsZSkge1xuICAgICAgZGF0YS5SZXBsaWNhdGlvbkNvbmZpZ3VyYXRpb24uUnVsZXMgPSB1dGlsLm1ha2VBcnJheShkYXRhLlJlcGxpY2F0aW9uQ29uZmlndXJhdGlvbi5SdWxlKTtcbiAgICAgIGRlbGV0ZSBkYXRhLlJlcGxpY2F0aW9uQ29uZmlndXJhdGlvbi5SdWxlO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKGVyciwgZGF0YSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBkZWxldGVCdWNrZXRSZXBsaWNhdGlvbihwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6RGVsZXRlQnVja2V0UmVwbGljYXRpb24nLFxuICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdyZXBsaWNhdGlvbidcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcclxuICog6K6+572uIEJ1Y2tldCDpnZnmgIHnvZHnq5nphY3nva7kv6Hmga9cclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcy5XZWJzaXRlQ29uZmlndXJhdGlvbiAgICAgICAgICAgICAgICAgICAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xyXG4gKiAgICAgICAgIEBwYXJhbSAge09iamVjdH0gICBXZWJzaXRlQ29uZmlndXJhdGlvbi5JbmRleERvY3VtZW50ICAgICAgICAgICAg57Si5byV5paH5qGj77yM5b+F6aG7XHJcbiAqICAgICAgICAgQHBhcmFtICB7T2JqZWN0fSAgIFdlYnNpdGVDb25maWd1cmF0aW9uLkVycm9yRG9jdW1lbnQgICAgICAgICAgICDplJnor6/mlofmoaPvvIzpnZ7lv4XpobtcclxuICogICAgICAgICBAcGFyYW0gIHtPYmplY3R9ICAgV2Vic2l0ZUNvbmZpZ3VyYXRpb24uUmVkaXJlY3RBbGxSZXF1ZXN0c1RvICAgIOmHjeWumuWQkeaJgOacieivt+axgu+8jOmdnuW/hemhu1xyXG4gKiAgICAgICAgIEBwYXJhbSAge0FycmF5fSAgIHBhcmFtcy5Sb3V0aW5nUnVsZXMgICAgICAgICAgICAgICAgICAgICAgICAgICAg6YeN5a6a5ZCR6KeE5YiZ77yM6Z2e5b+F6aG7XHJcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcclxuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6L+U5Zue5pWw5o2uXHJcbiAqL1xuXG5cbmZ1bmN0aW9uIHB1dEJ1Y2tldFdlYnNpdGUocGFyYW1zLCBjYWxsYmFjaykge1xuICBpZiAoIXBhcmFtc1snV2Vic2l0ZUNvbmZpZ3VyYXRpb24nXSkge1xuICAgIGNhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKCdtaXNzaW5nIHBhcmFtIFdlYnNpdGVDb25maWd1cmF0aW9uJykpKTtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgV2Vic2l0ZUNvbmZpZ3VyYXRpb24gPSB1dGlsLmNsb25lKHBhcmFtc1snV2Vic2l0ZUNvbmZpZ3VyYXRpb24nXSB8fCB7fSk7XG4gIHZhciBSb3V0aW5nUnVsZXMgPSBXZWJzaXRlQ29uZmlndXJhdGlvblsnUm91dGluZ1J1bGVzJ10gfHwgV2Vic2l0ZUNvbmZpZ3VyYXRpb25bJ1JvdXRpbmdSdWxlJ10gfHwgW107XG4gIFJvdXRpbmdSdWxlcyA9IHV0aWwuaXNBcnJheShSb3V0aW5nUnVsZXMpID8gUm91dGluZ1J1bGVzIDogW1JvdXRpbmdSdWxlc107XG4gIGRlbGV0ZSBXZWJzaXRlQ29uZmlndXJhdGlvbi5Sb3V0aW5nUnVsZTtcbiAgZGVsZXRlIFdlYnNpdGVDb25maWd1cmF0aW9uLlJvdXRpbmdSdWxlcztcbiAgaWYgKFJvdXRpbmdSdWxlcy5sZW5ndGgpIFdlYnNpdGVDb25maWd1cmF0aW9uLlJvdXRpbmdSdWxlcyA9IHtcbiAgICBSb3V0aW5nUnVsZTogUm91dGluZ1J1bGVzXG4gIH07XG4gIHZhciB4bWwgPSB1dGlsLmpzb24yeG1sKHtcbiAgICBXZWJzaXRlQ29uZmlndXJhdGlvbjogV2Vic2l0ZUNvbmZpZ3VyYXRpb25cbiAgfSk7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3htbCc7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNSh4bWwpKTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRCdWNrZXRXZWJzaXRlJyxcbiAgICBtZXRob2Q6ICdQVVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgYm9keTogeG1sLFxuICAgIGFjdGlvbjogJ3dlYnNpdGUnLFxuICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcclxuICog6I635Y+WIEJ1Y2tldCDnmoTpnZnmgIHnvZHnq5nphY3nva7kv6Hmga9cclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgQnVja2V05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57mlbDmja5cclxuICovXG5cblxuZnVuY3Rpb24gZ2V0QnVja2V0V2Vic2l0ZShwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6R2V0QnVja2V0V2Vic2l0ZScsXG4gICAgbWV0aG9kOiAnR0VUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIEtleTogcGFyYW1zLktleSxcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICd3ZWJzaXRlJ1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgaWYgKGVyci5zdGF0dXNDb2RlID09PSA0MDQgJiYgZXJyLmVycm9yLkNvZGUgPT09ICdOb1N1Y2hXZWJzaXRlQ29uZmlndXJhdGlvbicpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHtcbiAgICAgICAgICBXZWJzaXRlQ29uZmlndXJhdGlvbjoge30sXG4gICAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgICAgfTtcbiAgICAgICAgZXJyLmhlYWRlcnMgJiYgKHJlc3VsdC5oZWFkZXJzID0gZXJyLmhlYWRlcnMpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBXZWJzaXRlQ29uZmlndXJhdGlvbiA9IGRhdGEuV2Vic2l0ZUNvbmZpZ3VyYXRpb24gfHwge307XG5cbiAgICBpZiAoV2Vic2l0ZUNvbmZpZ3VyYXRpb25bJ1JvdXRpbmdSdWxlcyddKSB7XG4gICAgICB2YXIgUm91dGluZ1J1bGVzID0gdXRpbC5jbG9uZShXZWJzaXRlQ29uZmlndXJhdGlvblsnUm91dGluZ1J1bGVzJ10uUm91dGluZ1J1bGUgfHwgW10pO1xuICAgICAgUm91dGluZ1J1bGVzID0gdXRpbC5tYWtlQXJyYXkoUm91dGluZ1J1bGVzKTtcbiAgICAgIFdlYnNpdGVDb25maWd1cmF0aW9uLlJvdXRpbmdSdWxlcyA9IFJvdXRpbmdSdWxlcztcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBXZWJzaXRlQ29uZmlndXJhdGlvbjogV2Vic2l0ZUNvbmZpZ3VyYXRpb24sXG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcclxuICog5Yig6ZmkIEJ1Y2tldCDnmoTpnZnmgIHnvZHnq5nphY3nva5cclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgQnVja2V05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57mlbDmja5cclxuICovXG5cblxuZnVuY3Rpb24gZGVsZXRlQnVja2V0V2Vic2l0ZShwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6RGVsZXRlQnVja2V0V2Vic2l0ZScsXG4gICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ3dlYnNpdGUnXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyICYmIGVyci5zdGF0dXNDb2RlID09PSAyMDQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXHJcbiAqIOiuvue9riBCdWNrZXQg55qE6Ziy55uX6ZO+55m95ZCN5Y2V5oiW6ICF6buR5ZCN5Y2VXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMuUmVmZXJlckNvbmZpZ3VyYXRpb24gICAgICAgICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogICAgICAgICBAcGFyYW0gIHtTdHJpbmd9ICAgUmVmZXJlckNvbmZpZ3VyYXRpb24uU3RhdHVzICAgICAgICAgICAgICAgICAgIOaYr+WQpuW8gOWQr+mYsuebl+mTvu+8jOaemuS4vuWAvO+8mkVuYWJsZWTjgIFEaXNhYmxlZFxyXG4gKiAgICAgICAgIEBwYXJhbSAge1N0cmluZ30gICBSZWZlcmVyQ29uZmlndXJhdGlvbi5SZWZlcmVyVHlwZSAgICAgICAgICAgICAg6Ziy55uX6ZO+57G75Z6L77yM5p6a5Li+5YC877yaQmxhY2stTGlzdOOAgVdoaXRlLUxpc3TvvIzlv4XpobtcclxuICogICAgICAgICBAcGFyYW0gIHtBcnJheX0gICBSZWZlcmVyQ29uZmlndXJhdGlvbi5Eb21pYW5MaXN0LkRvbWFpbiAgICAgICAgIOeUn+aViOWfn+WQje+8jOW/hemhu1xyXG4gKiAgICAgICAgIEBwYXJhbSAge1N0cmluZ30gICBSZWZlcmVyQ29uZmlndXJhdGlvbi5FbXB0eVJlZmVyQ29uZmlndXJhdGlvbiAg77yM6Z2e5b+F6aG7XHJcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcclxuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6L+U5Zue5pWw5o2uXHJcbiAqL1xuXG5cbmZ1bmN0aW9uIHB1dEJ1Y2tldFJlZmVyZXIocGFyYW1zLCBjYWxsYmFjaykge1xuICBpZiAoIXBhcmFtc1snUmVmZXJlckNvbmZpZ3VyYXRpb24nXSkge1xuICAgIGNhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKCdtaXNzaW5nIHBhcmFtIFJlZmVyZXJDb25maWd1cmF0aW9uJykpKTtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgUmVmZXJlckNvbmZpZ3VyYXRpb24gPSB1dGlsLmNsb25lKHBhcmFtc1snUmVmZXJlckNvbmZpZ3VyYXRpb24nXSB8fCB7fSk7XG4gIHZhciBEb21haW5MaXN0ID0gUmVmZXJlckNvbmZpZ3VyYXRpb25bJ0RvbWFpbkxpc3QnXSB8fCB7fTtcbiAgdmFyIERvbWFpbnMgPSBEb21haW5MaXN0WydEb21haW5zJ10gfHwgRG9tYWluTGlzdFsnRG9tYWluJ10gfHwgW107XG4gIERvbWFpbnMgPSB1dGlsLmlzQXJyYXkoRG9tYWlucykgPyBEb21haW5zIDogW0RvbWFpbnNdO1xuICBpZiAoRG9tYWlucy5sZW5ndGgpIFJlZmVyZXJDb25maWd1cmF0aW9uLkRvbWFpbkxpc3QgPSB7XG4gICAgRG9tYWluOiBEb21haW5zXG4gIH07XG4gIHZhciB4bWwgPSB1dGlsLmpzb24yeG1sKHtcbiAgICBSZWZlcmVyQ29uZmlndXJhdGlvbjogUmVmZXJlckNvbmZpZ3VyYXRpb25cbiAgfSk7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3htbCc7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNSh4bWwpKTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRCdWNrZXRSZWZlcmVyJyxcbiAgICBtZXRob2Q6ICdQVVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgYm9keTogeG1sLFxuICAgIGFjdGlvbjogJ3JlZmVyZXInLFxuICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcclxuICog6I635Y+WIEJ1Y2tldCDnmoTpmLLnm5fpk77nmb3lkI3ljZXmiJbogIXpu5HlkI3ljZVcclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgQnVja2V05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57mlbDmja5cclxuICovXG5cblxuZnVuY3Rpb24gZ2V0QnVja2V0UmVmZXJlcihwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6R2V0QnVja2V0UmVmZXJlcicsXG4gICAgbWV0aG9kOiAnR0VUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIEtleTogcGFyYW1zLktleSxcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdyZWZlcmVyJ1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgaWYgKGVyci5zdGF0dXNDb2RlID09PSA0MDQgJiYgZXJyLmVycm9yLkNvZGUgPT09ICdOb1N1Y2hSZWZlcmVyQ29uZmlndXJhdGlvbicpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHtcbiAgICAgICAgICBXZWJzaXRlQ29uZmlndXJhdGlvbjoge30sXG4gICAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgICAgfTtcbiAgICAgICAgZXJyLmhlYWRlcnMgJiYgKHJlc3VsdC5oZWFkZXJzID0gZXJyLmhlYWRlcnMpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBSZWZlcmVyQ29uZmlndXJhdGlvbiA9IGRhdGEuUmVmZXJlckNvbmZpZ3VyYXRpb24gfHwge307XG5cbiAgICBpZiAoUmVmZXJlckNvbmZpZ3VyYXRpb25bJ0RvbWFpbkxpc3QnXSkge1xuICAgICAgdmFyIERvbWFpbnMgPSB1dGlsLm1ha2VBcnJheShSZWZlcmVyQ29uZmlndXJhdGlvblsnRG9tYWluTGlzdCddLkRvbWFpbiB8fCBbXSk7XG4gICAgICBSZWZlcmVyQ29uZmlndXJhdGlvbi5Eb21haW5MaXN0ID0ge1xuICAgICAgICBEb21haW5zOiBEb21haW5zXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIFJlZmVyZXJDb25maWd1cmF0aW9uOiBSZWZlcmVyQ29uZmlndXJhdGlvbixcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxyXG4gKiDorr7nva4gQnVja2V0IOiHquWumuS5ieWfn+WQjVxyXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcclxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOi/lOWbnuaVsOaNrlxyXG4gKi9cblxuXG5mdW5jdGlvbiBwdXRCdWNrZXREb21haW4ocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgRG9tYWluQ29uZmlndXJhdGlvbiA9IHBhcmFtc1snRG9tYWluQ29uZmlndXJhdGlvbiddIHx8IHt9O1xuICB2YXIgRG9tYWluUnVsZSA9IERvbWFpbkNvbmZpZ3VyYXRpb24uRG9tYWluUnVsZSB8fCBwYXJhbXMuRG9tYWluUnVsZSB8fCBbXTtcbiAgRG9tYWluUnVsZSA9IHV0aWwuY2xvbmUoRG9tYWluUnVsZSk7XG4gIHZhciB4bWwgPSB1dGlsLmpzb24yeG1sKHtcbiAgICBEb21haW5Db25maWd1cmF0aW9uOiB7XG4gICAgICBEb21haW5SdWxlOiBEb21haW5SdWxlXG4gICAgfVxuICB9KTtcbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veG1sJztcbiAgaGVhZGVyc1snQ29udGVudC1NRDUnXSA9IHV0aWwuYmluYXJ5QmFzZTY0KHV0aWwubWQ1KHhtbCkpO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOlB1dEJ1Y2tldERvbWFpbicsXG4gICAgbWV0aG9kOiAnUFVUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGJvZHk6IHhtbCxcbiAgICBhY3Rpb246ICdkb21haW4nLFxuICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcclxuICog6I635Y+WIEJ1Y2tldCDnmoToh6rlrprkuYnln5/lkI1cclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgQnVja2V05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57mlbDmja5cclxuICovXG5cblxuZnVuY3Rpb24gZ2V0QnVja2V0RG9tYWluKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRCdWNrZXREb21haW4nLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdkb21haW4nXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB2YXIgRG9tYWluUnVsZSA9IFtdO1xuXG4gICAgdHJ5IHtcbiAgICAgIERvbWFpblJ1bGUgPSBkYXRhLkRvbWFpbkNvbmZpZ3VyYXRpb24uRG9tYWluUnVsZSB8fCBbXTtcbiAgICB9IGNhdGNoIChlKSB7fVxuXG4gICAgRG9tYWluUnVsZSA9IHV0aWwuY2xvbmUodXRpbC5pc0FycmF5KERvbWFpblJ1bGUpID8gRG9tYWluUnVsZSA6IFtEb21haW5SdWxlXSk7XG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgRG9tYWluUnVsZTogRG9tYWluUnVsZSxcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxyXG4gKiDliKDpmaQgQnVja2V0IOiHquWumuS5ieWfn+WQjVxyXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICBCdWNrZXTlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gIOWcsOWfn+WQjeensO+8jOW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcclxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgIOi/lOWbnuaVsOaNrlxyXG4gKi9cblxuXG5mdW5jdGlvbiBkZWxldGVCdWNrZXREb21haW4ocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkRlbGV0ZUJ1Y2tldERvbWFpbicsXG4gICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ2RvbWFpbidcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcclxuICog6K6+572uIEJ1Y2tldCDnmoTlm57mupBcclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57mlbDmja5cclxuICovXG5cblxuZnVuY3Rpb24gcHV0QnVja2V0T3JpZ2luKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIE9yaWdpbkNvbmZpZ3VyYXRpb24gPSBwYXJhbXNbJ09yaWdpbkNvbmZpZ3VyYXRpb24nXSB8fCB7fTtcbiAgdmFyIE9yaWdpblJ1bGUgPSBPcmlnaW5Db25maWd1cmF0aW9uLk9yaWdpblJ1bGUgfHwgcGFyYW1zLk9yaWdpblJ1bGUgfHwgW107XG4gIE9yaWdpblJ1bGUgPSB1dGlsLmNsb25lKE9yaWdpblJ1bGUpO1xuICB2YXIgeG1sID0gdXRpbC5qc29uMnhtbCh7XG4gICAgT3JpZ2luQ29uZmlndXJhdGlvbjoge1xuICAgICAgT3JpZ2luUnVsZTogT3JpZ2luUnVsZVxuICAgIH1cbiAgfSk7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3htbCc7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNSh4bWwpKTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRCdWNrZXRPcmlnaW4nLFxuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBib2R5OiB4bWwsXG4gICAgYWN0aW9uOiAnb3JpZ2luJyxcbiAgICBoZWFkZXJzOiBoZWFkZXJzXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyICYmIGVyci5zdGF0dXNDb2RlID09PSAyMDQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXHJcbiAqIOiOt+WPliBCdWNrZXQg55qE5Zue5rqQXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XHJcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcclxuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAg6L+U5Zue5pWw5o2uXHJcbiAqL1xuXG5cbmZ1bmN0aW9uIGdldEJ1Y2tldE9yaWdpbihwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6R2V0QnVja2V0T3JpZ2luJyxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgYWN0aW9uOiAnb3JpZ2luJ1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgdmFyIE9yaWdpblJ1bGUgPSBbXTtcblxuICAgIHRyeSB7XG4gICAgICBPcmlnaW5SdWxlID0gZGF0YS5PcmlnaW5Db25maWd1cmF0aW9uLk9yaWdpblJ1bGUgfHwgW107XG4gICAgfSBjYXRjaCAoZSkge31cblxuICAgIE9yaWdpblJ1bGUgPSB1dGlsLmNsb25lKHV0aWwuaXNBcnJheShPcmlnaW5SdWxlKSA/IE9yaWdpblJ1bGUgOiBbT3JpZ2luUnVsZV0pO1xuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIE9yaWdpblJ1bGU6IE9yaWdpblJ1bGUsXG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcclxuICog5Yig6ZmkIEJ1Y2tldCDnmoTlm57mupBcclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgQnVja2V05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57mlbDmja5cclxuICovXG5cblxuZnVuY3Rpb24gZGVsZXRlQnVja2V0T3JpZ2luKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpEZWxldGVCdWNrZXRPcmlnaW4nLFxuICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdvcmlnaW4nXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyICYmIGVyci5zdGF0dXNDb2RlID09PSAyMDQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXHJcbiAqIOiuvue9riBCdWNrZXQg55qE5pel5b+X6K6w5b2VXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHsoT2JqZWN0fFN0cmluZyl9ICBwYXJhbXMuQnVja2V0TG9nZ2luZ1N0YXR1cyAgICAgICAgICAgICAgICAgICAgICAgICDor7TmmI7ml6Xlv5forrDlvZXphY3nva7nmoTnirbmgIHvvIzlpoLmnpzml6DlrZDoioLngrnkv6Hmga/liJnmhI/kuLrlhbPpl63ml6Xlv5forrDlvZXvvIzlv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57mlbDmja5cclxuICovXG5cblxuZnVuY3Rpb24gcHV0QnVja2V0TG9nZ2luZyhwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciB4bWwgPSB1dGlsLmpzb24yeG1sKHtcbiAgICBCdWNrZXRMb2dnaW5nU3RhdHVzOiBwYXJhbXNbJ0J1Y2tldExvZ2dpbmdTdGF0dXMnXSB8fCAnJ1xuICB9KTtcbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veG1sJztcbiAgaGVhZGVyc1snQ29udGVudC1NRDUnXSA9IHV0aWwuYmluYXJ5QmFzZTY0KHV0aWwubWQ1KHhtbCkpO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOlB1dEJ1Y2tldExvZ2dpbmcnLFxuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBib2R5OiB4bWwsXG4gICAgYWN0aW9uOiAnbG9nZ2luZycsXG4gICAgaGVhZGVyczogaGVhZGVyc1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gMjA0KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxyXG4gKiDojrflj5YgQnVja2V0IOeahOaXpeW/l+iusOW9lVxyXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICBCdWNrZXTlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gIOWcsOWfn+WQjeensO+8jOW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcclxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgIOi/lOWbnuaVsOaNrlxyXG4gKi9cblxuXG5mdW5jdGlvbiBnZXRCdWNrZXRMb2dnaW5nKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRCdWNrZXRMb2dnaW5nJyxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgYWN0aW9uOiAnbG9nZ2luZydcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIEJ1Y2tldExvZ2dpbmdTdGF0dXM6IGRhdGEuQnVja2V0TG9nZ2luZ1N0YXR1cyxcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxyXG4gKiDliJvlu7ov57yW6L6RIEJ1Y2tldCDnmoTmuIXljZXku7vliqFcclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5JZCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOa4heWNleS7u+WKoeeahOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zLkludmVudG9yeUNvbmZpZ3VyYXRpb24gICAgICAgICAgICAgICAgICAgICAg5YyF5ZCr5riF5Y2V55qE6YWN572u5Y+C5pWw77yM5b+F6aG7XHJcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcclxuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6L+U5Zue5pWw5o2uXHJcbiAqL1xuXG5cbmZ1bmN0aW9uIHB1dEJ1Y2tldEludmVudG9yeShwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBJbnZlbnRvcnlDb25maWd1cmF0aW9uID0gdXRpbC5jbG9uZShwYXJhbXNbJ0ludmVudG9yeUNvbmZpZ3VyYXRpb24nXSk7XG5cbiAgaWYgKEludmVudG9yeUNvbmZpZ3VyYXRpb24uT3B0aW9uYWxGaWVsZHMpIHtcbiAgICB2YXIgRmllbGQgPSBJbnZlbnRvcnlDb25maWd1cmF0aW9uLk9wdGlvbmFsRmllbGRzIHx8IFtdO1xuICAgIEludmVudG9yeUNvbmZpZ3VyYXRpb24uT3B0aW9uYWxGaWVsZHMgPSB7XG4gICAgICBGaWVsZDogRmllbGRcbiAgICB9O1xuICB9XG5cbiAgaWYgKEludmVudG9yeUNvbmZpZ3VyYXRpb24uRGVzdGluYXRpb24gJiYgSW52ZW50b3J5Q29uZmlndXJhdGlvbi5EZXN0aW5hdGlvbi5DT1NCdWNrZXREZXN0aW5hdGlvbiAmJiBJbnZlbnRvcnlDb25maWd1cmF0aW9uLkRlc3RpbmF0aW9uLkNPU0J1Y2tldERlc3RpbmF0aW9uLkVuY3J5cHRpb24pIHtcbiAgICB2YXIgRW5jcnlwdGlvbiA9IEludmVudG9yeUNvbmZpZ3VyYXRpb24uRGVzdGluYXRpb24uQ09TQnVja2V0RGVzdGluYXRpb24uRW5jcnlwdGlvbjtcblxuICAgIGlmIChPYmplY3Qua2V5cyhFbmNyeXB0aW9uKS5pbmRleE9mKCdTU0VDT1MnKSA+IC0xKSB7XG4gICAgICBFbmNyeXB0aW9uWydTU0UtQ09TJ10gPSBFbmNyeXB0aW9uWydTU0VDT1MnXTtcbiAgICAgIGRlbGV0ZSBFbmNyeXB0aW9uWydTU0VDT1MnXTtcbiAgICB9XG4gIH1cblxuICB2YXIgeG1sID0gdXRpbC5qc29uMnhtbCh7XG4gICAgSW52ZW50b3J5Q29uZmlndXJhdGlvbjogSW52ZW50b3J5Q29uZmlndXJhdGlvblxuICB9KTtcbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veG1sJztcbiAgaGVhZGVyc1snQ29udGVudC1NRDUnXSA9IHV0aWwuYmluYXJ5QmFzZTY0KHV0aWwubWQ1KHhtbCkpO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOlB1dEJ1Y2tldEludmVudG9yeScsXG4gICAgbWV0aG9kOiAnUFVUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGJvZHk6IHhtbCxcbiAgICBhY3Rpb246ICdpbnZlbnRvcnknLFxuICAgIHFzOiB7XG4gICAgICBpZDogcGFyYW1zWydJZCddXG4gICAgfSxcbiAgICBoZWFkZXJzOiBoZWFkZXJzXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyICYmIGVyci5zdGF0dXNDb2RlID09PSAyMDQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXHJcbiAqIOiOt+WPliBCdWNrZXQg55qE5riF5Y2V5Lu75Yqh5L+h5oGvXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuSWQgICAgICDmuIXljZXku7vliqHnmoTlkI3np7DvvIzlv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57mlbDmja5cclxuICovXG5cblxuZnVuY3Rpb24gZ2V0QnVja2V0SW52ZW50b3J5KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRCdWNrZXRJbnZlbnRvcnknLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdpbnZlbnRvcnknLFxuICAgIHFzOiB7XG4gICAgICBpZDogcGFyYW1zWydJZCddXG4gICAgfVxuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgdmFyIEludmVudG9yeUNvbmZpZ3VyYXRpb24gPSBkYXRhWydJbnZlbnRvcnlDb25maWd1cmF0aW9uJ107XG5cbiAgICBpZiAoSW52ZW50b3J5Q29uZmlndXJhdGlvbiAmJiBJbnZlbnRvcnlDb25maWd1cmF0aW9uLk9wdGlvbmFsRmllbGRzICYmIEludmVudG9yeUNvbmZpZ3VyYXRpb24uT3B0aW9uYWxGaWVsZHMuRmllbGQpIHtcbiAgICAgIHZhciBGaWVsZCA9IEludmVudG9yeUNvbmZpZ3VyYXRpb24uT3B0aW9uYWxGaWVsZHMuRmllbGQ7XG5cbiAgICAgIGlmICghdXRpbC5pc0FycmF5KEZpZWxkKSkge1xuICAgICAgICBGaWVsZCA9IFtGaWVsZF07XG4gICAgICB9XG5cbiAgICAgIEludmVudG9yeUNvbmZpZ3VyYXRpb24uT3B0aW9uYWxGaWVsZHMgPSBGaWVsZDtcbiAgICB9XG5cbiAgICBpZiAoSW52ZW50b3J5Q29uZmlndXJhdGlvbi5EZXN0aW5hdGlvbiAmJiBJbnZlbnRvcnlDb25maWd1cmF0aW9uLkRlc3RpbmF0aW9uLkNPU0J1Y2tldERlc3RpbmF0aW9uICYmIEludmVudG9yeUNvbmZpZ3VyYXRpb24uRGVzdGluYXRpb24uQ09TQnVja2V0RGVzdGluYXRpb24uRW5jcnlwdGlvbikge1xuICAgICAgdmFyIEVuY3J5cHRpb24gPSBJbnZlbnRvcnlDb25maWd1cmF0aW9uLkRlc3RpbmF0aW9uLkNPU0J1Y2tldERlc3RpbmF0aW9uLkVuY3J5cHRpb247XG5cbiAgICAgIGlmIChPYmplY3Qua2V5cyhFbmNyeXB0aW9uKS5pbmRleE9mKCdTU0UtQ09TJykgPiAtMSkge1xuICAgICAgICBFbmNyeXB0aW9uWydTU0VDT1MnXSA9IEVuY3J5cHRpb25bJ1NTRS1DT1MnXTtcbiAgICAgICAgZGVsZXRlIEVuY3J5cHRpb25bJ1NTRS1DT1MnXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBJbnZlbnRvcnlDb25maWd1cmF0aW9uOiBJbnZlbnRvcnlDb25maWd1cmF0aW9uLFxuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXHJcbiAqIOiOt+WPliBCdWNrZXQg55qE5riF5Y2V5Lu75Yqh5L+h5oGvXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgICAgICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICAgICAgICAgICAgICAgICAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQ29udGludWF0aW9uVG9rZW4gICAgICAg5b2TIENPUyDlk43lupTkvZPkuK0gSXNUcnVuY2F0ZWQg5Li6IHRydWXvvIzkuJQgTmV4dENvbnRpbnVhdGlvblRva2VuIOiKgueCueS4reWtmOWcqOWPguaVsOWAvOaXtu+8jOaCqOWPr+S7peWwhui/meS4quWPguaVsOS9nOS4uiBjb250aW51YXRpb24tdG9rZW4g5Y+C5pWw5YC877yM5Lul6I635Y+W5LiL5LiA6aG155qE5riF5Y2V5Lu75Yqh5L+h5oGv77yM6Z2e5b+F6aG7XHJcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICAgICAgICAgICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6L+U5Zue5pWw5o2uXHJcbiAqL1xuXG5cbmZ1bmN0aW9uIGxpc3RCdWNrZXRJbnZlbnRvcnkocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkxpc3RCdWNrZXRJbnZlbnRvcnknLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdpbnZlbnRvcnknLFxuICAgIHFzOiB7XG4gICAgICAnY29udGludWF0aW9uLXRva2VuJzogcGFyYW1zWydDb250aW51YXRpb25Ub2tlbiddXG4gICAgfVxuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgdmFyIExpc3RJbnZlbnRvcnlDb25maWd1cmF0aW9uUmVzdWx0ID0gZGF0YVsnTGlzdEludmVudG9yeUNvbmZpZ3VyYXRpb25SZXN1bHQnXTtcbiAgICB2YXIgSW52ZW50b3J5Q29uZmlndXJhdGlvbnMgPSBMaXN0SW52ZW50b3J5Q29uZmlndXJhdGlvblJlc3VsdC5JbnZlbnRvcnlDb25maWd1cmF0aW9uIHx8IFtdO1xuICAgIEludmVudG9yeUNvbmZpZ3VyYXRpb25zID0gdXRpbC5pc0FycmF5KEludmVudG9yeUNvbmZpZ3VyYXRpb25zKSA/IEludmVudG9yeUNvbmZpZ3VyYXRpb25zIDogW0ludmVudG9yeUNvbmZpZ3VyYXRpb25zXTtcbiAgICBkZWxldGUgTGlzdEludmVudG9yeUNvbmZpZ3VyYXRpb25SZXN1bHRbJ0ludmVudG9yeUNvbmZpZ3VyYXRpb24nXTtcbiAgICB1dGlsLmVhY2goSW52ZW50b3J5Q29uZmlndXJhdGlvbnMsIGZ1bmN0aW9uIChJbnZlbnRvcnlDb25maWd1cmF0aW9uKSB7XG4gICAgICBpZiAoSW52ZW50b3J5Q29uZmlndXJhdGlvbiAmJiBJbnZlbnRvcnlDb25maWd1cmF0aW9uLk9wdGlvbmFsRmllbGRzICYmIEludmVudG9yeUNvbmZpZ3VyYXRpb24uT3B0aW9uYWxGaWVsZHMuRmllbGQpIHtcbiAgICAgICAgdmFyIEZpZWxkID0gSW52ZW50b3J5Q29uZmlndXJhdGlvbi5PcHRpb25hbEZpZWxkcy5GaWVsZDtcblxuICAgICAgICBpZiAoIXV0aWwuaXNBcnJheShGaWVsZCkpIHtcbiAgICAgICAgICBGaWVsZCA9IFtGaWVsZF07XG4gICAgICAgIH1cblxuICAgICAgICBJbnZlbnRvcnlDb25maWd1cmF0aW9uLk9wdGlvbmFsRmllbGRzID0gRmllbGQ7XG4gICAgICB9XG5cbiAgICAgIGlmIChJbnZlbnRvcnlDb25maWd1cmF0aW9uLkRlc3RpbmF0aW9uICYmIEludmVudG9yeUNvbmZpZ3VyYXRpb24uRGVzdGluYXRpb24uQ09TQnVja2V0RGVzdGluYXRpb24gJiYgSW52ZW50b3J5Q29uZmlndXJhdGlvbi5EZXN0aW5hdGlvbi5DT1NCdWNrZXREZXN0aW5hdGlvbi5FbmNyeXB0aW9uKSB7XG4gICAgICAgIHZhciBFbmNyeXB0aW9uID0gSW52ZW50b3J5Q29uZmlndXJhdGlvbi5EZXN0aW5hdGlvbi5DT1NCdWNrZXREZXN0aW5hdGlvbi5FbmNyeXB0aW9uO1xuXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhFbmNyeXB0aW9uKS5pbmRleE9mKCdTU0UtQ09TJykgPiAtMSkge1xuICAgICAgICAgIEVuY3J5cHRpb25bJ1NTRUNPUyddID0gRW5jcnlwdGlvblsnU1NFLUNPUyddO1xuICAgICAgICAgIGRlbGV0ZSBFbmNyeXB0aW9uWydTU0UtQ09TJ107XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICBMaXN0SW52ZW50b3J5Q29uZmlndXJhdGlvblJlc3VsdC5JbnZlbnRvcnlDb25maWd1cmF0aW9ucyA9IEludmVudG9yeUNvbmZpZ3VyYXRpb25zO1xuICAgIHV0aWwuZXh0ZW5kKExpc3RJbnZlbnRvcnlDb25maWd1cmF0aW9uUmVzdWx0LCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgICBjYWxsYmFjayhudWxsLCBMaXN0SW52ZW50b3J5Q29uZmlndXJhdGlvblJlc3VsdCk7XG4gIH0pO1xufVxuLyoqXHJcbiAqIOWIoOmZpCBCdWNrZXQg55qE5riF5Y2V5Lu75YqhXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuSWQgICAgICDmuIXljZXku7vliqHnmoTlkI3np7DvvIzlv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57mlbDmja5cclxuICovXG5cblxuZnVuY3Rpb24gZGVsZXRlQnVja2V0SW52ZW50b3J5KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpEZWxldGVCdWNrZXRJbnZlbnRvcnknLFxuICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdpbnZlbnRvcnknLFxuICAgIHFzOiB7XG4gICAgICBpZDogcGFyYW1zWydJZCddXG4gICAgfVxuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gMjA0KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qIOWFqOeQg+WKoOmAnyAqL1xuXG5cbmZ1bmN0aW9uIHB1dEJ1Y2tldEFjY2VsZXJhdGUocGFyYW1zLCBjYWxsYmFjaykge1xuICBpZiAoIXBhcmFtc1snQWNjZWxlcmF0ZUNvbmZpZ3VyYXRpb24nXSkge1xuICAgIGNhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKCdtaXNzaW5nIHBhcmFtIEFjY2VsZXJhdGVDb25maWd1cmF0aW9uJykpKTtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgY29uZmlndXJhdGlvbiA9IHtcbiAgICBBY2NlbGVyYXRlQ29uZmlndXJhdGlvbjogcGFyYW1zLkFjY2VsZXJhdGVDb25maWd1cmF0aW9uIHx8IHt9XG4gIH07XG4gIHZhciB4bWwgPSB1dGlsLmpzb24yeG1sKGNvbmZpZ3VyYXRpb24pO1xuICB2YXIgaGVhZGVycyA9IHt9O1xuICBoZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi94bWwnO1xuICBoZWFkZXJzWydDb250ZW50LU1ENSddID0gdXRpbC5iaW5hcnlCYXNlNjQodXRpbC5tZDUoeG1sKSk7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6UHV0QnVja2V0QWNjZWxlcmF0ZScsXG4gICAgbWV0aG9kOiAnUFVUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGJvZHk6IHhtbCxcbiAgICBhY3Rpb246ICdhY2NlbGVyYXRlJyxcbiAgICBoZWFkZXJzOiBoZWFkZXJzXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGdldEJ1Y2tldEFjY2VsZXJhdGUocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkdldEJ1Y2tldEFjY2VsZXJhdGUnLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBhY3Rpb246ICdhY2NlbGVyYXRlJ1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKCFlcnIpIHtcbiAgICAgICFkYXRhLkFjY2VsZXJhdGVDb25maWd1cmF0aW9uICYmIChkYXRhLkFjY2VsZXJhdGVDb25maWd1cmF0aW9uID0ge30pO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKGVyciwgZGF0YSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBwdXRCdWNrZXRFbmNyeXB0aW9uKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIGNvbmYgPSBwYXJhbXMuU2VydmVyU2lkZUVuY3J5cHRpb25Db25maWd1cmF0aW9uIHx8IHt9O1xuICB2YXIgUnVsZXMgPSBjb25mLlJ1bGUgfHwgY29uZi5SdWxlcyB8fCBbXTtcbiAgdmFyIHhtbCA9IHV0aWwuanNvbjJ4bWwoe1xuICAgIFNlcnZlclNpZGVFbmNyeXB0aW9uQ29uZmlndXJhdGlvbjoge1xuICAgICAgUnVsZTogUnVsZXNcbiAgICB9XG4gIH0pO1xuICB2YXIgaGVhZGVycyA9IHBhcmFtcy5IZWFkZXJzO1xuICBoZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi94bWwnO1xuICBoZWFkZXJzWydDb250ZW50LU1ENSddID0gdXRpbC5iaW5hcnlCYXNlNjQodXRpbC5tZDUoeG1sKSk7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6UHV0QnVja2V0RW5jcnlwdGlvbicsXG4gICAgbWV0aG9kOiAnUFVUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGJvZHk6IHhtbCxcbiAgICBhY3Rpb246ICdlbmNyeXB0aW9uJyxcbiAgICBoZWFkZXJzOiBoZWFkZXJzXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyICYmIGVyci5zdGF0dXNDb2RlID09PSAyMDQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRCdWNrZXRFbmNyeXB0aW9uKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRCdWNrZXRFbmNyeXB0aW9uJyxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgYWN0aW9uOiAnZW5jcnlwdGlvbidcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGlmIChlcnIuc3RhdHVzQ29kZSA9PT0gNDA0ICYmIGVyci5jb2RlID09PSAnTm9TdWNoRW5jcnlwdGlvbkNvbmZpZ3VyYXRpb24nKSB7XG4gICAgICAgIHZhciByZXN1bHQgPSB7XG4gICAgICAgICAgRW5jcnlwdGlvbkNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICAgIFJ1bGVzOiBbXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgICAgfTtcbiAgICAgICAgZXJyLmhlYWRlcnMgJiYgKHJlc3VsdC5oZWFkZXJzID0gZXJyLmhlYWRlcnMpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBSdWxlcyA9IHV0aWwubWFrZUFycmF5KGRhdGEuRW5jcnlwdGlvbkNvbmZpZ3VyYXRpb24gJiYgZGF0YS5FbmNyeXB0aW9uQ29uZmlndXJhdGlvbi5SdWxlIHx8IFtdKTtcbiAgICBkYXRhLkVuY3J5cHRpb25Db25maWd1cmF0aW9uID0ge1xuICAgICAgUnVsZXM6IFJ1bGVzXG4gICAgfTtcbiAgICBjYWxsYmFjayhlcnIsIGRhdGEpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gZGVsZXRlQnVja2V0RW5jcnlwdGlvbihwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6RGVsZXRlQnVja2V0UmVwbGljYXRpb24nLFxuICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdlbmNyeXB0aW9uJ1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gMjA0KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn0gLy8gT2JqZWN0IOebuOWFs1xuXG4vKipcclxuICog5Y+W5Zue5a+55bqUT2JqZWN055qE5YWD5pWw5o2u77yMSGVhZOeahOadg+mZkOS4jkdldOeahOadg+mZkOS4gOiHtFxyXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLktleSAgICAgICAgICAgICAgICAg5paH5Lu25ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuSWZNb2RpZmllZFNpbmNlICAgICDlvZNPYmplY3TlnKjmjIflrprml7bpl7TlkI7ooqvkv67mlLnvvIzliJnov5Tlm57lr7nlupRPYmplY3TlhYPkv6Hmga/vvIzlkKbliJnov5Tlm54zMDTvvIzpnZ7lv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgICAgICDkuLrmjIflrpogb2JqZWN0IOeahOWFg+aVsOaNru+8jOWmguaenOiuvue9ruS6hiBJZk1vZGlmaWVkU2luY2Ug77yM5LiU5paH5Lu25pyq5L+u5pS577yM5YiZ6L+U5Zue5LiA5Liq5a+56LGh77yMTm90TW9kaWZpZWQg5bGe5oCn5Li6IHRydWVcclxuICogICAgIEByZXR1cm4gIHtCb29sZWFufSAgZGF0YS5Ob3RNb2RpZmllZCAgICAgICAgIOaYr+WQpuWcqCBJZk1vZGlmaWVkU2luY2Ug5pe26Ze054K55LmL5ZCO5pyq5L+u5pS56K+lIG9iamVjdO+8jOWImeS4uiB0cnVlXHJcbiAqL1xuXG5cbmZ1bmN0aW9uIGhlYWRPYmplY3QocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkhlYWRPYmplY3QnLFxuICAgIG1ldGhvZDogJ0hFQUQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgS2V5OiBwYXJhbXMuS2V5LFxuICAgIFZlcnNpb25JZDogcGFyYW1zLlZlcnNpb25JZCxcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVyc1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgdmFyIHN0YXR1c0NvZGUgPSBlcnIuc3RhdHVzQ29kZTtcblxuICAgICAgaWYgKHBhcmFtcy5IZWFkZXJzWydJZi1Nb2RpZmllZC1TaW5jZSddICYmIHN0YXR1c0NvZGUgJiYgc3RhdHVzQ29kZSA9PT0gMzA0KSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgICAgTm90TW9kaWZpZWQ6IHRydWUsXG4gICAgICAgICAgc3RhdHVzQ29kZTogc3RhdHVzQ29kZVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgZGF0YS5FVGFnID0gdXRpbC5hdHRyKGRhdGEuaGVhZGVycywgJ2V0YWcnLCAnJyk7XG4gICAgY2FsbGJhY2sobnVsbCwgZGF0YSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBsaXN0T2JqZWN0VmVyc2lvbnMocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgcmVxUGFyYW1zID0ge307XG4gIHJlcVBhcmFtc1sncHJlZml4J10gPSBwYXJhbXNbJ1ByZWZpeCddIHx8ICcnO1xuICByZXFQYXJhbXNbJ2RlbGltaXRlciddID0gcGFyYW1zWydEZWxpbWl0ZXInXTtcbiAgcmVxUGFyYW1zWydrZXktbWFya2VyJ10gPSBwYXJhbXNbJ0tleU1hcmtlciddO1xuICByZXFQYXJhbXNbJ3ZlcnNpb24taWQtbWFya2VyJ10gPSBwYXJhbXNbJ1ZlcnNpb25JZE1hcmtlciddO1xuICByZXFQYXJhbXNbJ21heC1rZXlzJ10gPSBwYXJhbXNbJ01heEtleXMnXTtcbiAgcmVxUGFyYW1zWydlbmNvZGluZy10eXBlJ10gPSBwYXJhbXNbJ0VuY29kaW5nVHlwZSddO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkdldEJ1Y2tldE9iamVjdFZlcnNpb25zJyxcbiAgICBSZXNvdXJjZUtleTogcmVxUGFyYW1zWydwcmVmaXgnXSxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgcXM6IHJlcVBhcmFtcyxcbiAgICBhY3Rpb246ICd2ZXJzaW9ucydcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIHZhciBMaXN0VmVyc2lvbnNSZXN1bHQgPSBkYXRhLkxpc3RWZXJzaW9uc1Jlc3VsdCB8fCB7fTtcbiAgICB2YXIgRGVsZXRlTWFya2VycyA9IExpc3RWZXJzaW9uc1Jlc3VsdC5EZWxldGVNYXJrZXIgfHwgW107XG4gICAgRGVsZXRlTWFya2VycyA9IHV0aWwuaXNBcnJheShEZWxldGVNYXJrZXJzKSA/IERlbGV0ZU1hcmtlcnMgOiBbRGVsZXRlTWFya2Vyc107XG4gICAgdmFyIFZlcnNpb25zID0gTGlzdFZlcnNpb25zUmVzdWx0LlZlcnNpb24gfHwgW107XG4gICAgVmVyc2lvbnMgPSB1dGlsLmlzQXJyYXkoVmVyc2lvbnMpID8gVmVyc2lvbnMgOiBbVmVyc2lvbnNdO1xuICAgIHZhciByZXN1bHQgPSB1dGlsLmNsb25lKExpc3RWZXJzaW9uc1Jlc3VsdCk7XG4gICAgZGVsZXRlIHJlc3VsdC5EZWxldGVNYXJrZXI7XG4gICAgZGVsZXRlIHJlc3VsdC5WZXJzaW9uO1xuICAgIHV0aWwuZXh0ZW5kKHJlc3VsdCwge1xuICAgICAgRGVsZXRlTWFya2VyczogRGVsZXRlTWFya2VycyxcbiAgICAgIFZlcnNpb25zOiBWZXJzaW9ucyxcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gIH0pO1xufVxuLyoqXHJcbiAqIOS4i+i9vSBvYmplY3RcclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgICAgICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5LZXkgICAgICAgICAgICAgICAgICAgICAgICAg5paH5Lu25ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtXcml0ZVN0cmVhbX0gIHBhcmFtcy5PdXRwdXQgICAgICAgICAgICAgICAgIOaWh+S7tuWGmeWFpea1ge+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLklmTW9kaWZpZWRTaW5jZSAgICAgICAgICAgICDlvZNPYmplY3TlnKjmjIflrprml7bpl7TlkI7ooqvkv67mlLnvvIzliJnov5Tlm57lr7nlupRPYmplY3TlhYPkv6Hmga/vvIzlkKbliJnov5Tlm54zMDTvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5JZlVubW9kaWZpZWRTaW5jZSAgICAgICAgICAg5aaC5p6c5paH5Lu25L+u5pS55pe26Ze05pep5LqO5oiW562J5LqO5oyH5a6a5pe26Ze077yM5omN6L+U5Zue5paH5Lu25YaF5a6544CC5ZCm5YiZ6L+U5ZueIDQxMiAocHJlY29uZGl0aW9uIGZhaWxlZCnvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5JZk1hdGNoICAgICAgICAgICAgICAgICAgICAg5b2TIEVUYWcg5LiO5oyH5a6a55qE5YaF5a655LiA6Ie077yM5omN6L+U5Zue5paH5Lu244CC5ZCm5YiZ6L+U5ZueIDQxMiAocHJlY29uZGl0aW9uIGZhaWxlZCnvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5JZk5vbmVNYXRjaCAgICAgICAgICAgICAgICAg5b2TIEVUYWcg5LiO5oyH5a6a55qE5YaF5a655LiN5LiA6Ie077yM5omN6L+U5Zue5paH5Lu244CC5ZCm5YiZ6L+U5ZueMzA0IChub3QgbW9kaWZpZWQp77yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVzcG9uc2VDb250ZW50VHlwZSAgICAgICAgIOiuvue9rui/lOWbnuWktOmDqOS4reeahCBDb250ZW50LVR5cGUg5Y+C5pWw77yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVzcG9uc2VDb250ZW50TGFuZ3VhZ2UgICAgIOiuvue9rui/lOWbnuWktOmDqOS4reeahCBDb250ZW50LUxhbmd1YWdlIOWPguaVsO+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlc3BvbnNlRXhwaXJlcyAgICAgICAgICAgICDorr7nva7ov5Tlm57lpLTpg6jkuK3nmoQgQ29udGVudC1FeHBpcmVzIOWPguaVsO+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlc3BvbnNlQ2FjaGVDb250cm9sICAgICAgICDorr7nva7ov5Tlm57lpLTpg6jkuK3nmoQgQ2FjaGUtQ29udHJvbCDlj4LmlbDvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZXNwb25zZUNvbnRlbnREaXNwb3NpdGlvbiAg6K6+572u6L+U5Zue5aS06YOo5Lit55qEIENvbnRlbnQtRGlzcG9zaXRpb24g5Y+C5pWw77yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVzcG9uc2VDb250ZW50RW5jb2RpbmcgICAgIOiuvue9rui/lOWbnuWktOmDqOS4reeahCBDb250ZW50LUVuY29kaW5nIOWPguaVsO+8jOmdnuW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcclxuICogQHBhcmFtICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOS4uuWvueW6lOeahCBvYmplY3Qg5pWw5o2u77yM5YyF5ousIGJvZHkg5ZKMIGhlYWRlcnNcclxuICovXG5cblxuZnVuY3Rpb24gZ2V0T2JqZWN0KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIHJlcVBhcmFtcyA9IHBhcmFtcy5RdWVyeSB8fCB7fTtcbiAgdmFyIHJlcVBhcmFtc1N0ciA9IHBhcmFtcy5RdWVyeVN0cmluZyB8fCAnJztcbiAgdmFyIG9uUHJvZ3Jlc3MgPSB1dGlsLnRocm90dGxlT25Qcm9ncmVzcy5jYWxsKHRoaXMsIDAsIHBhcmFtcy5vblByb2dyZXNzKTtcbiAgdmFyIHRyYWNrZXIgPSBwYXJhbXMudHJhY2tlcjtcbiAgdHJhY2tlciAmJiB0cmFja2VyLnNldFBhcmFtcyh7XG4gICAgc2lnblN0YXJ0VGltZTogbmV3IERhdGUoKS5nZXRUaW1lKClcbiAgfSk7XG4gIHJlcVBhcmFtc1sncmVzcG9uc2UtY29udGVudC10eXBlJ10gPSBwYXJhbXNbJ1Jlc3BvbnNlQ29udGVudFR5cGUnXTtcbiAgcmVxUGFyYW1zWydyZXNwb25zZS1jb250ZW50LWxhbmd1YWdlJ10gPSBwYXJhbXNbJ1Jlc3BvbnNlQ29udGVudExhbmd1YWdlJ107XG4gIHJlcVBhcmFtc1sncmVzcG9uc2UtZXhwaXJlcyddID0gcGFyYW1zWydSZXNwb25zZUV4cGlyZXMnXTtcbiAgcmVxUGFyYW1zWydyZXNwb25zZS1jYWNoZS1jb250cm9sJ10gPSBwYXJhbXNbJ1Jlc3BvbnNlQ2FjaGVDb250cm9sJ107XG4gIHJlcVBhcmFtc1sncmVzcG9uc2UtY29udGVudC1kaXNwb3NpdGlvbiddID0gcGFyYW1zWydSZXNwb25zZUNvbnRlbnREaXNwb3NpdGlvbiddO1xuICByZXFQYXJhbXNbJ3Jlc3BvbnNlLWNvbnRlbnQtZW5jb2RpbmcnXSA9IHBhcmFtc1snUmVzcG9uc2VDb250ZW50RW5jb2RpbmcnXTsgLy8g5aaC5p6c55So5oi36Ieq5bex5Lyg5YWl5LqGIG91dHB1dFxuXG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6R2V0T2JqZWN0JyxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgS2V5OiBwYXJhbXMuS2V5LFxuICAgIFZlcnNpb25JZDogcGFyYW1zLlZlcnNpb25JZCxcbiAgICBEYXRhVHlwZTogcGFyYW1zLkRhdGFUeXBlLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIHFzOiByZXFQYXJhbXMsXG4gICAgcXNTdHI6IHJlcVBhcmFtc1N0cixcbiAgICByYXdCb2R5OiB0cnVlLFxuICAgIG9uRG93bmxvYWRQcm9ncmVzczogb25Qcm9ncmVzcyxcbiAgICB0cmFja2VyOiB0cmFja2VyXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBvblByb2dyZXNzKG51bGwsIHRydWUpO1xuXG4gICAgaWYgKGVycikge1xuICAgICAgdmFyIHN0YXR1c0NvZGUgPSBlcnIuc3RhdHVzQ29kZTtcblxuICAgICAgaWYgKHBhcmFtcy5IZWFkZXJzWydJZi1Nb2RpZmllZC1TaW5jZSddICYmIHN0YXR1c0NvZGUgJiYgc3RhdHVzQ29kZSA9PT0gMzA0KSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgICAgTm90TW9kaWZpZWQ6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIEJvZHk6IGRhdGEuYm9keSxcbiAgICAgIEVUYWc6IHV0aWwuYXR0cihkYXRhLmhlYWRlcnMsICdldGFnJywgJycpLFxuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXHJcbiAqIOS4iuS8oCBvYmplY3RcclxuICogQHBhcmFtICB7T2JqZWN0fSBwYXJhbXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5LZXkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDmlofku7blkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge0ZpbGUgfHwgQmxvYiB8fCBTdHJpbmd9ICBwYXJhbXMuQm9keSAgICAgICAgICAgICAgICDkuIrkvKDmlofku7blr7nosaHmiJblrZfnrKbkuLLvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5DYWNoZUNvbnRyb2wgICAgICAgICAgICAgICAgICAgICAgICBSRkMgMjYxNiDkuK3lrprkuYnnmoTnvJPlrZjnrZbnlaXvvIzlsIbkvZzkuLogT2JqZWN0IOWFg+aVsOaNruS/neWtmO+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkNvbnRlbnREaXNwb3NpdGlvbiAgICAgICAgICAgICAgICAgIFJGQyAyNjE2IOS4reWumuS5ieeahOaWh+S7tuWQjeensO+8jOWwhuS9nOS4uiBPYmplY3Qg5YWD5pWw5o2u5L+d5a2Y77yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQ29udGVudEVuY29kaW5nICAgICAgICAgICAgICAgICAgICAgUkZDIDI2MTYg5Lit5a6a5LmJ55qE57yW56CB5qC85byP77yM5bCG5L2c5Li6IE9iamVjdCDlhYPmlbDmja7kv53lrZjvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5Db250ZW50TGVuZ3RoICAgICAgICAgICAgICAgICAgICAgICBSRkMgMjYxNiDkuK3lrprkuYnnmoQgSFRUUCDor7fmsYLlhoXlrrnplb/luqbvvIjlrZfoioLvvInvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5Db250ZW50VHlwZSAgICAgICAgICAgICAgICAgICAgICAgICBSRkMgMjYxNiDkuK3lrprkuYnnmoTlhoXlrrnnsbvlnovvvIhNSU1F77yJ77yM5bCG5L2c5Li6IE9iamVjdCDlhYPmlbDmja7kv53lrZjvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5FeHBlY3QgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlvZPkvb/nlKggRXhwZWN0OiAxMDAtY29udGludWUg5pe277yM5Zyo5pS25Yiw5pyN5Yqh56uv56Gu6K6k5ZCO77yM5omN5Lya5Y+R6YCB6K+35rGC5YaF5a6577yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuRXhwaXJlcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUkZDIDI2MTYg5Lit5a6a5LmJ55qE6L+H5pyf5pe26Ze077yM5bCG5L2c5Li6IE9iamVjdCDlhYPmlbDmja7kv53lrZjvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5BQ0wgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlhYHorrjnlKjmiLfoh6rlrprkuYnmlofku7bmnYPpmZDvvIzmnInmlYjlgLzvvJpwcml2YXRlIHwgcHVibGljLXJlYWTvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5HcmFudFJlYWQgICAgICAgICAgICAgICAgICAgICAgICAgICDotYvkuojooqvmjojmnYPogIXor7vlj5blr7nosaHnmoTmnYPpmZDvvIzmoLzlvI/vvJppZD1cIltPd25lclVpbl1cIu+8jOWPr+S9v+eUqOWNiuinkumAl+WPt++8iCzvvInliIbpmpTlpJrnu4TooqvmjojmnYPogIXvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5HcmFudFJlYWRBY3AgICAgICAgICAgICAgICAgICAgICAgICDotYvkuojooqvmjojmnYPogIXor7vlj5blr7nosaHnmoTorr/pl67mjqfliLbliJfooajvvIhBQ0zvvInnmoTmnYPpmZDvvIzmoLzlvI/vvJppZD1cIltPd25lclVpbl1cIu+8jOWPr+S9v+eUqOWNiuinkumAl+WPt++8iCzvvInliIbpmpTlpJrnu4TooqvmjojmnYPogIXvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5HcmFudFdyaXRlQWNwICAgICAgICAgICAgICAgICAgICAgICDotYvkuojooqvmjojmnYPogIXlhpnlhaXlr7nosaHnmoTorr/pl67mjqfliLbliJfooajvvIhBQ0zvvInnmoTmnYPpmZDvvIzmoLzlvI/vvJppZD1cIltPd25lclVpbl1cIu+8jOWPr+S9v+eUqOWNiuinkumAl+WPt++8iCzvvInliIbpmpTlpJrnu4TooqvmjojmnYPogIXvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5HcmFudEZ1bGxDb250cm9sICAgICAgICAgICAgICAgICAgICDotYvkuojooqvmjojmnYPogIXmk43kvZzlr7nosaHnmoTmiYDmnInmnYPpmZDvvIzmoLzlvI/vvJppZD1cIltPd25lclVpbl1cIu+8jOWPr+S9v+eUqOWNiuinkumAl+WPt++8iCzvvInliIbpmpTlpJrnu4TooqvmjojmnYPogIXvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5TdG9yYWdlQ2xhc3MgICAgICAgICAgICAgICAgICAgICAgICDorr7nva7lr7nosaHnmoTlrZjlgqjnuqfliKvvvIzmnprkuL7lgLzvvJpTVEFOREFSROOAgVNUQU5EQVJEX0lB44CBQVJDSElWRe+8jOm7mOiupOWAvO+8mlNUQU5EQVJE77yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMueC1jb3MtbWV0YS0qICAgICAgICAgICAgICAgICAgICAgICAg5YWB6K6455So5oi36Ieq5a6a5LmJ55qE5aS06YOo5L+h5oGv77yM5bCG5L2c5Li65a+56LGh55qE5YWD5pWw5o2u5L+d5a2Y44CC5aSn5bCP6ZmQ5Yi2MktC77yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQ29udGVudFNoYTEgICAgICAgICAgICAgICAgICAgICAgICAgUkZDIDMxNzQg5Lit5a6a5LmJ55qEIDE2MC1iaXQg5YaF5a65IFNIQS0xIOeul+azleagoemqjO+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlNlcnZlclNpZGVFbmNyeXB0aW9uICAgICAgICAgICAgICAgIOaUr+aMgeaMieeFp+aMh+WumueahOWKoOWvhueul+azlei/m+ihjOacjeWKoeerr+aVsOaNruWKoOWvhu+8jOagvOW8jyB4LWNvcy1zZXJ2ZXItc2lkZS1lbmNyeXB0aW9uOiBcIkFFUzI1Nlwi77yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtGdW5jdGlvbn0gIHBhcmFtcy5vblByb2dyZXNzICAgICAgICAgICAgICAgICAgICAgICAg5LiK5Lyg6L+b5bqm5Zue6LCD5Ye95pWwXHJcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Li65a+55bqU55qEIG9iamVjdCDmlbDmja5cclxuICogICAgIEByZXR1cm4gIHtTdHJpbmd9ICBkYXRhLkVUYWcgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDkuLrlr7nlupTkuIrkvKDmlofku7bnmoQgRVRhZyDlgLxcclxuICovXG5cblxuZnVuY3Rpb24gcHV0T2JqZWN0KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgRmlsZVNpemUgPSBwYXJhbXMuQ29udGVudExlbmd0aDtcbiAgdmFyIG9uUHJvZ3Jlc3MgPSB1dGlsLnRocm90dGxlT25Qcm9ncmVzcy5jYWxsKHNlbGYsIEZpbGVTaXplLCBwYXJhbXMub25Qcm9ncmVzcyk7IC8vIOeJueauiuWkhOeQhiBDYWNoZS1Db250cm9s44CBQ29udGVudC1UeXBl77yM6YG/5YWN5Luj55CG5pu05pS56L+Z5Lik5Liq5a2X5q615a+86Ie05YaZ5YWl5YiwIE9iamVjdCDlsZ7mgKfph4xcblxuICB2YXIgaGVhZGVycyA9IHBhcmFtcy5IZWFkZXJzO1xuICBpZiAoIWhlYWRlcnNbJ0NhY2hlLUNvbnRyb2wnXSAmJiAhaGVhZGVyc1snY2FjaGUtY29udHJvbCddKSBoZWFkZXJzWydDYWNoZS1Db250cm9sJ10gPSAnJztcbiAgaWYgKCFoZWFkZXJzWydDb250ZW50LVR5cGUnXSAmJiAhaGVhZGVyc1snY29udGVudC10eXBlJ10pIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gcGFyYW1zLkJvZHkgJiYgcGFyYW1zLkJvZHkudHlwZSB8fCAnJztcbiAgdmFyIG5lZWRDYWxjTWQ1ID0gcGFyYW1zLlVwbG9hZEFkZE1ldGFNZDUgfHwgc2VsZi5vcHRpb25zLlVwbG9hZEFkZE1ldGFNZDUgfHwgc2VsZi5vcHRpb25zLlVwbG9hZENoZWNrQ29udGVudE1kNTtcbiAgdmFyIHRyYWNrZXIgPSBwYXJhbXMudHJhY2tlcjtcbiAgbmVlZENhbGNNZDUgJiYgdHJhY2tlciAmJiB0cmFja2VyLnNldFBhcmFtcyh7XG4gICAgbWQ1U3RhcnRUaW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuICB9KTtcbiAgdXRpbC5nZXRCb2R5TWQ1KG5lZWRDYWxjTWQ1LCBwYXJhbXMuQm9keSwgZnVuY3Rpb24gKG1kNSkge1xuICAgIGlmIChtZDUpIHtcbiAgICAgIHRyYWNrZXIgJiYgdHJhY2tlci5zZXRQYXJhbXMoe1xuICAgICAgICBtZDVFbmRUaW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuICAgICAgfSk7XG4gICAgICBpZiAoc2VsZi5vcHRpb25zLlVwbG9hZENoZWNrQ29udGVudE1kNSkgaGVhZGVyc1snQ29udGVudC1NRDUnXSA9IHV0aWwuYmluYXJ5QmFzZTY0KG1kNSk7XG4gICAgICBpZiAocGFyYW1zLlVwbG9hZEFkZE1ldGFNZDUgfHwgc2VsZi5vcHRpb25zLlVwbG9hZEFkZE1ldGFNZDUpIGhlYWRlcnNbJ3gtY29zLW1ldGEtbWQ1J10gPSBtZDU7XG4gICAgfVxuXG4gICAgaWYgKHBhcmFtcy5Db250ZW50TGVuZ3RoICE9PSB1bmRlZmluZWQpIGhlYWRlcnNbJ0NvbnRlbnQtTGVuZ3RoJ10gPSBwYXJhbXMuQ29udGVudExlbmd0aDtcbiAgICBvblByb2dyZXNzKG51bGwsIHRydWUpOyAvLyDku7vliqHnirbmgIHlvIDlp4sgdXBsb2FkaW5nXG5cbiAgICBzdWJtaXRSZXF1ZXN0LmNhbGwoc2VsZiwge1xuICAgICAgQWN0aW9uOiAnbmFtZS9jb3M6UHV0T2JqZWN0JyxcbiAgICAgIFRhc2tJZDogcGFyYW1zLlRhc2tJZCxcbiAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICAgIHFzOiBwYXJhbXMuUXVlcnksXG4gICAgICBib2R5OiBwYXJhbXMuQm9keSxcbiAgICAgIG9uUHJvZ3Jlc3M6IG9uUHJvZ3Jlc3MsXG4gICAgICB0cmFja2VyOiB0cmFja2VyXG4gICAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBvblByb2dyZXNzKG51bGwsIHRydWUpO1xuICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgIH1cblxuICAgICAgb25Qcm9ncmVzcyh7XG4gICAgICAgIGxvYWRlZDogRmlsZVNpemUsXG4gICAgICAgIHRvdGFsOiBGaWxlU2l6ZVxuICAgICAgfSwgdHJ1ZSk7XG4gICAgICB2YXIgdXJsID0gZ2V0VXJsKHtcbiAgICAgICAgRm9yY2VQYXRoU3R5bGU6IHNlbGYub3B0aW9ucy5Gb3JjZVBhdGhTdHlsZSxcbiAgICAgICAgcHJvdG9jb2w6IHNlbGYub3B0aW9ucy5Qcm90b2NvbCxcbiAgICAgICAgZG9tYWluOiBzZWxmLm9wdGlvbnMuRG9tYWluLFxuICAgICAgICBidWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgICAgIHJlZ2lvbjogIXNlbGYub3B0aW9ucy5Vc2VBY2NlbGVyYXRlID8gcGFyYW1zLlJlZ2lvbiA6ICdhY2NlbGVyYXRlJyxcbiAgICAgICAgb2JqZWN0OiBwYXJhbXMuS2V5XG4gICAgICB9KTtcbiAgICAgIHVybCA9IHVybC5zdWJzdHIodXJsLmluZGV4T2YoJzovLycpICsgMyk7XG4gICAgICBkYXRhLkxvY2F0aW9uID0gdXJsO1xuICAgICAgZGF0YS5FVGFnID0gdXRpbC5hdHRyKGRhdGEuaGVhZGVycywgJ2V0YWcnLCAnJyk7XG4gICAgICBjYWxsYmFjayhudWxsLCBkYXRhKTtcbiAgICB9KTtcbiAgfSwgcGFyYW1zLm9uSGFzaFByb2dyZXNzKTtcbn1cbi8qKlxyXG4gKiDliKDpmaQgb2JqZWN0XHJcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuS2V5ICAgICAgICAgICAgIG9iamVjdOWQjeensO+8jOW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcclxuICogQHBhcmFtICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgICAgICAgICAgIOWIoOmZpOaTjeS9nOaIkOWKn+S5i+WQjui/lOWbnueahOaVsOaNrlxyXG4gKi9cblxuXG5mdW5jdGlvbiBkZWxldGVPYmplY3QocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkRlbGV0ZU9iamVjdCcsXG4gICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIEtleTogcGFyYW1zLktleSxcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBWZXJzaW9uSWQ6IHBhcmFtcy5WZXJzaW9uSWQsXG4gICAgYWN0aW9uOiBwYXJhbXMuUmVjdXJzaXZlID8gJ3JlY3Vyc2l2ZScgOiAnJ1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgdmFyIHN0YXR1c0NvZGUgPSBlcnIuc3RhdHVzQ29kZTtcblxuICAgICAgaWYgKHN0YXR1c0NvZGUgJiYgc3RhdHVzQ29kZSA9PT0gNDA0KSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgICAgQnVja2V0Tm90Rm91bmQ6IHRydWUsXG4gICAgICAgICAgc3RhdHVzQ29kZTogc3RhdHVzQ29kZVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxyXG4gKiDojrflj5Ygb2JqZWN0IOeahCDmnYPpmZDliJfooahcclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5LZXkgICAgICAgICAgICAgICAgIG9iamVjdOWQjeensO+8jOW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcclxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxyXG4gKiAgICAgQHJldHVybiAge09iamVjdH0gIGRhdGEuQWNjZXNzQ29udHJvbFBvbGljeSAg5p2D6ZmQ5YiX6KGoXHJcbiAqL1xuXG5cbmZ1bmN0aW9uIGdldE9iamVjdEFjbChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6R2V0T2JqZWN0QUNMJyxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgS2V5OiBwYXJhbXMuS2V5LFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ2FjbCdcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIHZhciBBY2Nlc3NDb250cm9sUG9saWN5ID0gZGF0YS5BY2Nlc3NDb250cm9sUG9saWN5IHx8IHt9O1xuICAgIHZhciBPd25lciA9IEFjY2Vzc0NvbnRyb2xQb2xpY3kuT3duZXIgfHwge307XG4gICAgdmFyIEdyYW50ID0gQWNjZXNzQ29udHJvbFBvbGljeS5BY2Nlc3NDb250cm9sTGlzdCAmJiBBY2Nlc3NDb250cm9sUG9saWN5LkFjY2Vzc0NvbnRyb2xMaXN0LkdyYW50IHx8IFtdO1xuICAgIEdyYW50ID0gdXRpbC5pc0FycmF5KEdyYW50KSA/IEdyYW50IDogW0dyYW50XTtcbiAgICB2YXIgcmVzdWx0ID0gZGVjb2RlQWNsKEFjY2Vzc0NvbnRyb2xQb2xpY3kpO1xuICAgIGRlbGV0ZSByZXN1bHQuR3JhbnRXcml0ZTtcblxuICAgIGlmIChkYXRhLmhlYWRlcnMgJiYgZGF0YS5oZWFkZXJzWyd4LWNvcy1hY2wnXSkge1xuICAgICAgcmVzdWx0LkFDTCA9IGRhdGEuaGVhZGVyc1sneC1jb3MtYWNsJ107XG4gICAgfVxuXG4gICAgcmVzdWx0ID0gdXRpbC5leHRlbmQocmVzdWx0LCB7XG4gICAgICBPd25lcjogT3duZXIsXG4gICAgICBHcmFudHM6IEdyYW50LFxuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcbiAgfSk7XG59XG4vKipcclxuICog6K6+572uIG9iamVjdCDnmoQg5p2D6ZmQ5YiX6KGoXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuS2V5ICAgICBvYmplY3TlkI3np7DvvIzlv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cclxuICovXG5cblxuZnVuY3Rpb24gcHV0T2JqZWN0QWNsKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgdmFyIHhtbCA9ICcnO1xuXG4gIGlmIChwYXJhbXNbJ0FjY2Vzc0NvbnRyb2xQb2xpY3knXSkge1xuICAgIHZhciBBY2Nlc3NDb250cm9sUG9saWN5ID0gdXRpbC5jbG9uZShwYXJhbXNbJ0FjY2Vzc0NvbnRyb2xQb2xpY3knXSB8fCB7fSk7XG4gICAgdmFyIEdyYW50cyA9IEFjY2Vzc0NvbnRyb2xQb2xpY3kuR3JhbnRzIHx8IEFjY2Vzc0NvbnRyb2xQb2xpY3kuR3JhbnQ7XG4gICAgR3JhbnRzID0gdXRpbC5pc0FycmF5KEdyYW50cykgPyBHcmFudHMgOiBbR3JhbnRzXTtcbiAgICBkZWxldGUgQWNjZXNzQ29udHJvbFBvbGljeS5HcmFudDtcbiAgICBkZWxldGUgQWNjZXNzQ29udHJvbFBvbGljeS5HcmFudHM7XG4gICAgQWNjZXNzQ29udHJvbFBvbGljeS5BY2Nlc3NDb250cm9sTGlzdCA9IHtcbiAgICAgIEdyYW50OiBHcmFudHNcbiAgICB9O1xuICAgIHhtbCA9IHV0aWwuanNvbjJ4bWwoe1xuICAgICAgQWNjZXNzQ29udHJvbFBvbGljeTogQWNjZXNzQ29udHJvbFBvbGljeVxuICAgIH0pO1xuICAgIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3htbCc7XG4gICAgaGVhZGVyc1snQ29udGVudC1NRDUnXSA9IHV0aWwuYmluYXJ5QmFzZTY0KHV0aWwubWQ1KHhtbCkpO1xuICB9IC8vIEdyYW50IEhlYWRlciDljrvph41cblxuXG4gIHV0aWwuZWFjaChoZWFkZXJzLCBmdW5jdGlvbiAodmFsLCBrZXkpIHtcbiAgICBpZiAoa2V5LmluZGV4T2YoJ3gtY29zLWdyYW50LScpID09PSAwKSB7XG4gICAgICBoZWFkZXJzW2tleV0gPSB1bmlxR3JhbnQoaGVhZGVyc1trZXldKTtcbiAgICB9XG4gIH0pO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOlB1dE9iamVjdEFDTCcsXG4gICAgbWV0aG9kOiAnUFVUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIEtleTogcGFyYW1zLktleSxcbiAgICBhY3Rpb246ICdhY2wnLFxuICAgIGhlYWRlcnM6IGhlYWRlcnMsXG4gICAgYm9keTogeG1sXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcclxuICogT3B0aW9ucyBPYmplY3Tor7fmsYLlrp7njrDot6jln5/orr/pl67nmoTpooTor7fmsYLjgILljbPlj5Hlh7rkuIDkuKogT1BUSU9OUyDor7fmsYLnu5nmnI3liqHlmajku6Xnoa7orqTmmK/lkKblj6/ku6Xov5vooYzot6jln5/mk43kvZzjgIJcclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgQnVja2V05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5LZXkgICAgIG9iamVjdOWQjeensO+8jOW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcclxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxyXG4gKi9cblxuXG5mdW5jdGlvbiBvcHRpb25zT2JqZWN0KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgaGVhZGVyc1snT3JpZ2luJ10gPSBwYXJhbXNbJ09yaWdpbiddO1xuICBoZWFkZXJzWydBY2Nlc3MtQ29udHJvbC1SZXF1ZXN0LU1ldGhvZCddID0gcGFyYW1zWydBY2Nlc3NDb250cm9sUmVxdWVzdE1ldGhvZCddO1xuICBoZWFkZXJzWydBY2Nlc3MtQ29udHJvbC1SZXF1ZXN0LUhlYWRlcnMnXSA9IHBhcmFtc1snQWNjZXNzQ29udHJvbFJlcXVlc3RIZWFkZXJzJ107XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6T3B0aW9uc09iamVjdCcsXG4gICAgbWV0aG9kOiAnT1BUSU9OUycsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgaGVhZGVyczogaGVhZGVyc1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgaWYgKGVyci5zdGF0dXNDb2RlICYmIGVyci5zdGF0dXNDb2RlID09PSA0MDMpIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgICBPcHRpb25zRm9yYmlkZGVuOiB0cnVlLFxuICAgICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICB2YXIgaGVhZGVycyA9IGRhdGEuaGVhZGVycyB8fCB7fTtcbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBBY2Nlc3NDb250cm9sQWxsb3dPcmlnaW46IGhlYWRlcnNbJ2FjY2Vzcy1jb250cm9sLWFsbG93LW9yaWdpbiddLFxuICAgICAgQWNjZXNzQ29udHJvbEFsbG93TWV0aG9kczogaGVhZGVyc1snYWNjZXNzLWNvbnRyb2wtYWxsb3ctbWV0aG9kcyddLFxuICAgICAgQWNjZXNzQ29udHJvbEFsbG93SGVhZGVyczogaGVhZGVyc1snYWNjZXNzLWNvbnRyb2wtYWxsb3ctaGVhZGVycyddLFxuICAgICAgQWNjZXNzQ29udHJvbEV4cG9zZUhlYWRlcnM6IGhlYWRlcnNbJ2FjY2Vzcy1jb250cm9sLWV4cG9zZS1oZWFkZXJzJ10sXG4gICAgICBBY2Nlc3NDb250cm9sTWF4QWdlOiBoZWFkZXJzWydhY2Nlc3MtY29udHJvbC1tYXgtYWdlJ10sXG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcclxuICogQHBhcmFtICB7T2JqZWN0fSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlj4LmlbDliJfooahcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIEJ1Y2tldCAgICAgICAgICAgICAgICAgICAgICAgICBCdWNrZXQg5ZCN56ewXHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBSZWdpb24gICAgICAgICAgICAgICAgICAgICAgICAg5Zyw5Z+f5ZCN56ewXHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBLZXkgICAgICAgICAgICAgICAgICAgICAgICAgICAg5paH5Lu25ZCN56ewXHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBDb3B5U291cmNlICAgICAgICAgICAgICAgICAgICAg5rqQ5paH5Lu2VVJM57ud5a+56Lev5b6E77yM5Y+v5Lul6YCa6L+HdmVyc2lvbmlk5a2Q6LWE5rqQ5oyH5a6a5Y6G5Y+y54mI5pysXHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBBQ0wgICAgICAgICAgICAgICAgICAgICAgICAgICAg5YWB6K6455So5oi36Ieq5a6a5LmJ5paH5Lu25p2D6ZmQ44CC5pyJ5pWI5YC877yacHJpdmF0Ze+8jHB1YmxpYy1yZWFk6buY6K6k5YC877yacHJpdmF0ZeOAglxyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgR3JhbnRSZWFkICAgICAgICAgICAgICAgICAgICAgIOi1i+S6iOiiq+aOiOadg+iAheivu+eahOadg+mZkO+8jOagvOW8jyB4LWNvcy1ncmFudC1yZWFkOiB1aW49XCIgXCIsdWluPVwiIFwi77yM5b2T6ZyA6KaB57uZ5a2Q6LSm5oi35o6I5p2D5pe277yMdWluPVwiUm9vdEFjb3VudElEL1N1YkFjY291bnRJRFwi77yM5b2T6ZyA6KaB57uZ5qC56LSm5oi35o6I5p2D5pe277yMdWluPVwiUm9vdEFjb3VudElEXCLjgIJcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIEdyYW50V3JpdGUgICAgICAgICAgICAgICAgICAgICDotYvkuojooqvmjojmnYPogIXlhpnnmoTmnYPpmZDvvIzmoLzlvI8geC1jb3MtZ3JhbnQtd3JpdGU6IHVpbj1cIiBcIix1aW49XCIgXCLvvIzlvZPpnIDopoHnu5nlrZDotKbmiLfmjojmnYPml7bvvIx1aW49XCJSb290QWNvdW50SUQvU3ViQWNjb3VudElEXCLvvIzlvZPpnIDopoHnu5nmoLnotKbmiLfmjojmnYPml7bvvIx1aW49XCJSb290QWNvdW50SURcIuOAglxyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgR3JhbnRGdWxsQ29udHJvbCAgICAgICAgICAgICAgIOi1i+S6iOiiq+aOiOadg+iAheivu+WGmeadg+mZkO+8jOagvOW8jyB4LWNvcy1ncmFudC1mdWxsLWNvbnRyb2w6IHVpbj1cIiBcIix1aW49XCIgXCLvvIzlvZPpnIDopoHnu5nlrZDotKbmiLfmjojmnYPml7bvvIx1aW49XCJSb290QWNvdW50SUQvU3ViQWNjb3VudElEXCLvvIzlvZPpnIDopoHnu5nmoLnotKbmiLfmjojmnYPml7bvvIx1aW49XCJSb290QWNvdW50SURcIuOAglxyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgTWV0YWRhdGFEaXJlY3RpdmUgICAgICAgICAgICAgIOaYr+WQpuaLt+i0neWFg+aVsOaNru+8jOaemuS4vuWAvO+8mkNvcHksIFJlcGxhY2Vk77yM6buY6K6k5YC8Q29weeOAguWBh+Wmguagh+iusOS4ukNvcHnvvIzlv73nlaVIZWFkZXLkuK3nmoTnlKjmiLflhYPmlbDmja7kv6Hmga/nm7TmjqXlpI3liLbvvJvlgYflpoLmoIforrDkuLpSZXBsYWNlZO+8jOaMiUhlYWRlcuS/oeaBr+S/ruaUueWFg+aVsOaNruOAguW9k+ebruagh+i3r+W+hOWSjOWOn+i3r+W+hOS4gOiHtO+8jOWNs+eUqOaIt+ivleWbvuS/ruaUueWFg+aVsOaNruaXtu+8jOW/hemhu+S4ulJlcGxhY2VkXHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBDb3B5U291cmNlSWZNb2RpZmllZFNpbmNlICAgICAg5b2TT2JqZWN05Zyo5oyH5a6a5pe26Ze05ZCO6KKr5L+u5pS577yM5YiZ5omn6KGM5pON5L2c77yM5ZCm5YiZ6L+U5ZueNDEy44CC5Y+v5LiOeC1jb3MtY29weS1zb3VyY2UtSWYtTm9uZS1NYXRjaOS4gOi1t+S9v+eUqO+8jOS4juWFtuS7luadoeS7tuiBlOWQiOS9v+eUqOi/lOWbnuWGsueqgeOAglxyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgQ29weVNvdXJjZUlmVW5tb2RpZmllZFNpbmNlICAgIOW9k09iamVjdOWcqOaMh+WumuaXtumXtOWQjuacquiiq+S/ruaUue+8jOWImeaJp+ihjOaTjeS9nO+8jOWQpuWImei/lOWbnjQxMuOAguWPr+S4jngtY29zLWNvcHktc291cmNlLUlmLU1hdGNo5LiA6LW35L2/55So77yM5LiO5YW25LuW5p2h5Lu26IGU5ZCI5L2/55So6L+U5Zue5Yay56qB44CCXHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBDb3B5U291cmNlSWZNYXRjaCAgICAgICAgICAgICAg5b2TT2JqZWN055qERVRhZ+WSjOe7meWumuS4gOiHtOaXtu+8jOWImeaJp+ihjOaTjeS9nO+8jOWQpuWImei/lOWbnjQxMuOAguWPr+S4jngtY29zLWNvcHktc291cmNlLUlmLVVubW9kaWZpZWQtU2luY2XkuIDotbfkvb/nlKjvvIzkuI7lhbbku5bmnaHku7bogZTlkIjkvb/nlKjov5Tlm57lhrLnqoHjgIJcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIENvcHlTb3VyY2VJZk5vbmVNYXRjaCAgICAgICAgICDlvZNPYmplY3TnmoRFVGFn5ZKM57uZ5a6a5LiN5LiA6Ie05pe277yM5YiZ5omn6KGM5pON5L2c77yM5ZCm5YiZ6L+U5ZueNDEy44CC5Y+v5LiOeC1jb3MtY29weS1zb3VyY2UtSWYtTW9kaWZpZWQtU2luY2XkuIDotbfkvb/nlKjvvIzkuI7lhbbku5bmnaHku7bogZTlkIjkvb/nlKjov5Tlm57lhrLnqoHjgIJcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIFN0b3JhZ2VDbGFzcyAgICAgICAgICAgICAgICAgICDlrZjlgqjnuqfliKvvvIzmnprkuL7lgLzvvJrlrZjlgqjnuqfliKvvvIzmnprkuL7lgLzvvJpTdGFuZGFyZCwgU3RhbmRhcmRfSUHvvIxBcmNoaXZl77yb6buY6K6k5YC877yaU3RhbmRhcmRcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIENhY2hlQ29udHJvbCAgICAgICAgICAgICAgICAgICDmjIflrprmiYDmnInnvJPlrZjmnLrliLblnKjmlbTkuKror7fmsYIv5ZON5bqU6ZO+5Lit5b+F6aG75pyN5LuO55qE5oyH5Luk44CCXHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBDb250ZW50RGlzcG9zaXRpb24gICAgICAgICAgICAgTUlNRSDljY/orq7nmoTmianlsZXvvIxNSU1FIOWNj+iuruaMh+ekuiBNSU1FIOeUqOaIt+S7o+eQhuWmguS9leaYvuekuumZhOWKoOeahOaWh+S7tlxyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgQ29udGVudEVuY29kaW5nICAgICAgICAgICAgICAgIEhUVFAg5Lit55So5p2l5a+544CM6YeH55So5L2V56eN57yW56CB5qC85byP5Lyg6L6T5q2j5paH44CN6L+b6KGM5Y2P5a6a55qE5LiA5a+55aS06YOo5a2X5q61XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBDb250ZW50TGVuZ3RoICAgICAgICAgICAgICAgICAg6K6+572u5ZON5bqU5raI5oGv55qE5a6e5L2T5YaF5a6555qE5aSn5bCP77yM5Y2V5L2N5Li65a2X6IqCXHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBDb250ZW50VHlwZSAgICAgICAgICAgICAgICAgICAgUkZDIDI2MTYg5Lit5a6a5LmJ55qEIEhUVFAg6K+35rGC5YaF5a6557G75Z6L77yITUlNRe+8ie+8jOS+i+WmgnRleHQvcGxhaW5cclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIEV4cGVjdCAgICAgICAgICAgICAgICAgICAgICAgICDor7fmsYLnmoTnibnlrprnmoTmnI3liqHlmajooYzkuLpcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIEV4cGlyZXMgICAgICAgICAgICAgICAgICAgICAgICDlk43lupTov4fmnJ/nmoTml6XmnJ/lkozml7bpl7RcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5TZXJ2ZXJTaWRlRW5jcnlwdGlvbiAgIOaUr+aMgeaMieeFp+aMh+WumueahOWKoOWvhueul+azlei/m+ihjOacjeWKoeerr+aVsOaNruWKoOWvhu+8jOagvOW8jyB4LWNvcy1zZXJ2ZXItc2lkZS1lbmNyeXB0aW9uOiBcIkFFUzI1Nlwi77yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBDb250ZW50TGFuZ3VhZ2UgICAgICAgICAgICAgICAg5oyH5a6a5YaF5a656K+t6KiAXHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICB4LWNvcy1tZXRhLSogICAgICAgICAgICAgICAgICAg5YWB6K6455So5oi36Ieq5a6a5LmJ55qE5aS06YOo5L+h5oGv77yM5bCG5L2c5Li6IE9iamVjdCDlhYPmlbDmja7ov5Tlm57jgILlpKflsI/pmZDliLYyS+OAglxyXG4gKi9cblxuXG5mdW5jdGlvbiBwdXRPYmplY3RDb3B5KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgLy8g54m55q6K5aSE55CGIENhY2hlLUNvbnRyb2xcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgaGVhZGVycyA9IHBhcmFtcy5IZWFkZXJzO1xuICBpZiAoIWhlYWRlcnNbJ0NhY2hlLUNvbnRyb2wnXSAmJiAhaGVhZGVyc1snY2FjaGUtY29udHJvbCddKSBoZWFkZXJzWydDYWNoZS1Db250cm9sJ10gPSAnJztcbiAgdmFyIENvcHlTb3VyY2UgPSBwYXJhbXMuQ29weVNvdXJjZSB8fCAnJztcbiAgdmFyIG0gPSB1dGlsLmdldFNvdXJjZVBhcmFtcy5jYWxsKHRoaXMsIENvcHlTb3VyY2UpO1xuXG4gIGlmICghbSkge1xuICAgIGNhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKCdDb3B5U291cmNlIGZvcm1hdCBlcnJvcicpKSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIFNvdXJjZUJ1Y2tldCA9IG1bMV07XG4gIHZhciBTb3VyY2VSZWdpb24gPSBtWzNdO1xuICB2YXIgU291cmNlS2V5ID0gZGVjb2RlVVJJQ29tcG9uZW50KG1bNF0pO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIFNjb3BlOiBbe1xuICAgICAgYWN0aW9uOiAnbmFtZS9jb3M6R2V0T2JqZWN0JyxcbiAgICAgIGJ1Y2tldDogU291cmNlQnVja2V0LFxuICAgICAgcmVnaW9uOiBTb3VyY2VSZWdpb24sXG4gICAgICBwcmVmaXg6IFNvdXJjZUtleVxuICAgIH0sIHtcbiAgICAgIGFjdGlvbjogJ25hbWUvY29zOlB1dE9iamVjdCcsXG4gICAgICBidWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgICByZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgICBwcmVmaXg6IHBhcmFtcy5LZXlcbiAgICB9XSxcbiAgICBtZXRob2Q6ICdQVVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgS2V5OiBwYXJhbXMuS2V5LFxuICAgIFZlcnNpb25JZDogcGFyYW1zLlZlcnNpb25JZCxcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVyc1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgdmFyIHJlc3VsdCA9IHV0aWwuY2xvbmUoZGF0YS5Db3B5T2JqZWN0UmVzdWx0IHx8IHt9KTtcbiAgICB2YXIgdXJsID0gZ2V0VXJsKHtcbiAgICAgIEZvcmNlUGF0aFN0eWxlOiBzZWxmLm9wdGlvbnMuRm9yY2VQYXRoU3R5bGUsXG4gICAgICBwcm90b2NvbDogc2VsZi5vcHRpb25zLlByb3RvY29sLFxuICAgICAgZG9tYWluOiBzZWxmLm9wdGlvbnMuRG9tYWluLFxuICAgICAgYnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgICAgcmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgICAgb2JqZWN0OiBwYXJhbXMuS2V5LFxuICAgICAgaXNMb2NhdGlvbjogdHJ1ZVxuICAgIH0pO1xuICAgIHV0aWwuZXh0ZW5kKHJlc3VsdCwge1xuICAgICAgTG9jYXRpb246IHVybCxcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiB1cGxvYWRQYXJ0Q29weShwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBDb3B5U291cmNlID0gcGFyYW1zLkNvcHlTb3VyY2UgfHwgJyc7XG4gIHZhciBtID0gdXRpbC5nZXRTb3VyY2VQYXJhbXMuY2FsbCh0aGlzLCBDb3B5U291cmNlKTtcblxuICBpZiAoIW0pIHtcbiAgICBjYWxsYmFjayh1dGlsLmVycm9yKG5ldyBFcnJvcignQ29weVNvdXJjZSBmb3JtYXQgZXJyb3InKSkpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBTb3VyY2VCdWNrZXQgPSBtWzFdO1xuICB2YXIgU291cmNlUmVnaW9uID0gbVszXTtcbiAgdmFyIFNvdXJjZUtleSA9IGRlY29kZVVSSUNvbXBvbmVudChtWzRdKTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBTY29wZTogW3tcbiAgICAgIGFjdGlvbjogJ25hbWUvY29zOkdldE9iamVjdCcsXG4gICAgICBidWNrZXQ6IFNvdXJjZUJ1Y2tldCxcbiAgICAgIHJlZ2lvbjogU291cmNlUmVnaW9uLFxuICAgICAgcHJlZml4OiBTb3VyY2VLZXlcbiAgICB9LCB7XG4gICAgICBhY3Rpb246ICduYW1lL2NvczpQdXRPYmplY3QnLFxuICAgICAgYnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgICAgcmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgICAgcHJlZml4OiBwYXJhbXMuS2V5XG4gICAgfV0sXG4gICAgbWV0aG9kOiAnUFVUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIEtleTogcGFyYW1zLktleSxcbiAgICBWZXJzaW9uSWQ6IHBhcmFtcy5WZXJzaW9uSWQsXG4gICAgcXM6IHtcbiAgICAgIHBhcnROdW1iZXI6IHBhcmFtc1snUGFydE51bWJlciddLFxuICAgICAgdXBsb2FkSWQ6IHBhcmFtc1snVXBsb2FkSWQnXVxuICAgIH0sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnNcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIHZhciByZXN1bHQgPSB1dGlsLmNsb25lKGRhdGEuQ29weVBhcnRSZXN1bHQgfHwge30pO1xuICAgIHV0aWwuZXh0ZW5kKHJlc3VsdCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGRlbGV0ZU11bHRpcGxlT2JqZWN0KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIE9iamVjdHMgPSBwYXJhbXMuT2JqZWN0cyB8fCBbXTtcbiAgdmFyIFF1aWV0ID0gcGFyYW1zLlF1aWV0O1xuICBPYmplY3RzID0gdXRpbC5pc0FycmF5KE9iamVjdHMpID8gT2JqZWN0cyA6IFtPYmplY3RzXTtcbiAgdmFyIHhtbCA9IHV0aWwuanNvbjJ4bWwoe1xuICAgIERlbGV0ZToge1xuICAgICAgT2JqZWN0OiBPYmplY3RzLFxuICAgICAgUXVpZXQ6IFF1aWV0IHx8IGZhbHNlXG4gICAgfVxuICB9KTtcbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veG1sJztcbiAgaGVhZGVyc1snQ29udGVudC1NRDUnXSA9IHV0aWwuYmluYXJ5QmFzZTY0KHV0aWwubWQ1KHhtbCkpO1xuICB2YXIgU2NvcGUgPSB1dGlsLm1hcChPYmplY3RzLCBmdW5jdGlvbiAodikge1xuICAgIHJldHVybiB7XG4gICAgICBhY3Rpb246ICduYW1lL2NvczpEZWxldGVPYmplY3QnLFxuICAgICAgYnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgICAgcmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgICAgcHJlZml4OiB2LktleVxuICAgIH07XG4gIH0pO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIFNjb3BlOiBTY29wZSxcbiAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGJvZHk6IHhtbCxcbiAgICBhY3Rpb246ICdkZWxldGUnLFxuICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIHZhciBEZWxldGVSZXN1bHQgPSBkYXRhLkRlbGV0ZVJlc3VsdCB8fCB7fTtcbiAgICB2YXIgRGVsZXRlZCA9IERlbGV0ZVJlc3VsdC5EZWxldGVkIHx8IFtdO1xuICAgIHZhciBFcnJvcnMgPSBEZWxldGVSZXN1bHQuRXJyb3IgfHwgW107XG4gICAgRGVsZXRlZCA9IHV0aWwuaXNBcnJheShEZWxldGVkKSA/IERlbGV0ZWQgOiBbRGVsZXRlZF07XG4gICAgRXJyb3JzID0gdXRpbC5pc0FycmF5KEVycm9ycykgPyBFcnJvcnMgOiBbRXJyb3JzXTtcbiAgICB2YXIgcmVzdWx0ID0gdXRpbC5jbG9uZShEZWxldGVSZXN1bHQpO1xuICAgIHV0aWwuZXh0ZW5kKHJlc3VsdCwge1xuICAgICAgRXJyb3I6IEVycm9ycyxcbiAgICAgIERlbGV0ZWQ6IERlbGV0ZWQsXG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcmVzdG9yZU9iamVjdChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG5cbiAgaWYgKCFwYXJhbXNbJ1Jlc3RvcmVSZXF1ZXN0J10pIHtcbiAgICBjYWxsYmFjayh1dGlsLmVycm9yKG5ldyBFcnJvcignbWlzc2luZyBwYXJhbSBSZXN0b3JlUmVxdWVzdCcpKSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIFJlc3RvcmVSZXF1ZXN0ID0gcGFyYW1zLlJlc3RvcmVSZXF1ZXN0IHx8IHt9O1xuICB2YXIgeG1sID0gdXRpbC5qc29uMnhtbCh7XG4gICAgUmVzdG9yZVJlcXVlc3Q6IFJlc3RvcmVSZXF1ZXN0XG4gIH0pO1xuICBoZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi94bWwnO1xuICBoZWFkZXJzWydDb250ZW50LU1ENSddID0gdXRpbC5iaW5hcnlCYXNlNjQodXRpbC5tZDUoeG1sKSk7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6UmVzdG9yZU9iamVjdCcsXG4gICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgVmVyc2lvbklkOiBwYXJhbXMuVmVyc2lvbklkLFxuICAgIGJvZHk6IHhtbCxcbiAgICBhY3Rpb246ICdyZXN0b3JlJyxcbiAgICBoZWFkZXJzOiBoZWFkZXJzXG4gIH0sIGNhbGxiYWNrKTtcbn1cbi8qKlxyXG4gKiDorr7nva4gT2JqZWN0IOeahOagh+etvlxyXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICBPYmplY3TlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gIOWcsOWfn+WQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7QXJyYXl9ICAgcGFyYW1zLlRhZ1NldCAg5qCH562+6K6+572u77yM5b+F6aG7XHJcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcclxuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNDI5OThcclxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgIOi/lOWbnuaVsOaNrlxyXG4gKi9cblxuXG5mdW5jdGlvbiBwdXRPYmplY3RUYWdnaW5nKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIFRhZ2dpbmcgPSBwYXJhbXNbJ1RhZ2dpbmcnXSB8fCB7fTtcbiAgdmFyIFRhZ3MgPSBUYWdnaW5nLlRhZ1NldCB8fCBUYWdnaW5nLlRhZ3MgfHwgcGFyYW1zWydUYWdzJ10gfHwgW107XG4gIFRhZ3MgPSB1dGlsLmNsb25lKHV0aWwuaXNBcnJheShUYWdzKSA/IFRhZ3MgOiBbVGFnc10pO1xuICB2YXIgeG1sID0gdXRpbC5qc29uMnhtbCh7XG4gICAgVGFnZ2luZzoge1xuICAgICAgVGFnU2V0OiB7XG4gICAgICAgIFRhZzogVGFnc1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3htbCc7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNSh4bWwpKTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRPYmplY3RUYWdnaW5nJyxcbiAgICBtZXRob2Q6ICdQVVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGJvZHk6IHhtbCxcbiAgICBhY3Rpb246ICd0YWdnaW5nJyxcbiAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgIFZlcnNpb25JZDogcGFyYW1zLlZlcnNpb25JZFxuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gMjA0KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxyXG4gKiDojrflj5YgT2JqZWN0IOeahOagh+etvuiuvue9rlxyXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICBCdWNrZXTlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gIOWcsOWfn+WQjeensO+8jOW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2LzQyOTk4XHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57mlbDmja5cclxuICovXG5cblxuZnVuY3Rpb24gZ2V0T2JqZWN0VGFnZ2luZyhwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6R2V0T2JqZWN0VGFnZ2luZycsXG4gICAgbWV0aG9kOiAnR0VUJyxcbiAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICd0YWdnaW5nJyxcbiAgICBWZXJzaW9uSWQ6IHBhcmFtcy5WZXJzaW9uSWRcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGlmIChlcnIuc3RhdHVzQ29kZSA9PT0gNDA0ICYmIGVyci5lcnJvciAmJiAoZXJyLmVycm9yID09PSBcIk5vdCBGb3VuZFwiIHx8IGVyci5lcnJvci5Db2RlID09PSAnTm9TdWNoVGFnU2V0JykpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHtcbiAgICAgICAgICBUYWdzOiBbXSxcbiAgICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgICB9O1xuICAgICAgICBlcnIuaGVhZGVycyAmJiAocmVzdWx0LmhlYWRlcnMgPSBlcnIuaGVhZGVycyk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIFRhZ3MgPSBbXTtcblxuICAgIHRyeSB7XG4gICAgICBUYWdzID0gZGF0YS5UYWdnaW5nLlRhZ1NldC5UYWcgfHwgW107XG4gICAgfSBjYXRjaCAoZSkge31cblxuICAgIFRhZ3MgPSB1dGlsLmNsb25lKHV0aWwuaXNBcnJheShUYWdzKSA/IFRhZ3MgOiBbVGFnc10pO1xuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIFRhZ3M6IFRhZ3MsXG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcclxuICog5Yig6ZmkIE9iamVjdCDnmoQg5qCH562+6K6+572uXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgIE9iamVjdOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XHJcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcclxuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNDI5OThcclxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxyXG4gKi9cblxuXG5mdW5jdGlvbiBkZWxldGVPYmplY3RUYWdnaW5nKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpEZWxldGVPYmplY3RUYWdnaW5nJyxcbiAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgS2V5OiBwYXJhbXMuS2V5LFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ3RhZ2dpbmcnLFxuICAgIFZlcnNpb25JZDogcGFyYW1zLlZlcnNpb25JZFxuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gMjA0KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxyXG4gKiDkvb/nlKggU1FMIOivreWPpeS7juaMh+WumuWvueixoe+8iENTViDmoLzlvI/miJbogIUgSlNPTiDmoLzlvI/vvInkuK3mo4DntKLlhoXlrrlcclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgT2JqZWN05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcy5TZWxlY3RSZXF1ZXN0IOWcsOWfn+WQjeensO+8jOW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2LzQyOTk4XHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cclxuICovXG5cblxuZnVuY3Rpb24gc2VsZWN0T2JqZWN0Q29udGVudChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBTZWxlY3RUeXBlID0gcGFyYW1zWydTZWxlY3RUeXBlJ107XG4gIGlmICghU2VsZWN0VHlwZSkgcmV0dXJuIGNhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKCdtaXNzaW5nIHBhcmFtIFNlbGVjdFR5cGUnKSkpO1xuICB2YXIgU2VsZWN0UmVxdWVzdCA9IHBhcmFtc1snU2VsZWN0UmVxdWVzdCddIHx8IHt9O1xuICB2YXIgeG1sID0gdXRpbC5qc29uMnhtbCh7XG4gICAgU2VsZWN0UmVxdWVzdDogU2VsZWN0UmVxdWVzdFxuICB9KTtcbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veG1sJztcbiAgaGVhZGVyc1snQ29udGVudC1NRDUnXSA9IHV0aWwuYmluYXJ5QmFzZTY0KHV0aWwubWQ1KHhtbCkpO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkdldE9iamVjdCcsXG4gICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgYWN0aW9uOiAnc2VsZWN0JyxcbiAgICBxczoge1xuICAgICAgJ3NlbGVjdC10eXBlJzogcGFyYW1zWydTZWxlY3RUeXBlJ11cbiAgICB9LFxuICAgIFZlcnNpb25JZDogcGFyYW1zLlZlcnNpb25JZCxcbiAgICBib2R5OiB4bWwsXG4gICAgRGF0YVR5cGU6ICdhcnJheWJ1ZmZlcicsXG4gICAgcmF3Qm9keTogdHJ1ZVxuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gMjA0KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIHZhciByZXN1bHQgPSB1dGlsLnBhcnNlU2VsZWN0UGF5bG9hZChkYXRhLmJvZHkpO1xuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVycyxcbiAgICAgIEJvZHk6IHJlc3VsdC5ib2R5LFxuICAgICAgUGF5bG9hZDogcmVzdWx0LnBheWxvYWRcbiAgICB9KTtcbiAgfSk7XG59IC8vIOWIhuWdl+S4iuS8oFxuXG4vKipcclxuICog5Yid5aeL5YyW5YiG5Z2X5LiK5LygXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICAgICAgICAgICAgICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgICAgICAgICAgICAgICAgICAgICAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuS2V5ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3TlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5VcGxvYWRJZCAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkNhY2hlQ29udHJvbCAgICAgICAgICAgICAgICAgICAgUkZDIDI2MTYg5Lit5a6a5LmJ55qE57yT5a2Y562W55Wl77yM5bCG5L2c5Li6IE9iamVjdCDlhYPmlbDmja7kv53lrZjvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5Db250ZW50RGlzcG9zaXRpb24gICAgICAgICAgICAgIFJGQyAyNjE2IOS4reWumuS5ieeahOaWh+S7tuWQjeensO+8jOWwhuS9nOS4uiBPYmplY3Qg5YWD5pWw5o2u5L+d5a2YICAgIO+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkNvbnRlbnRFbmNvZGluZyAgICAgICAgICAgICAgICAgUkZDIDI2MTYg5Lit5a6a5LmJ55qE57yW56CB5qC85byP77yM5bCG5L2c5Li6IE9iamVjdCDlhYPmlbDmja7kv53lrZjvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5Db250ZW50VHlwZSAgICAgICAgICAgICAgICAgICAgIFJGQyAyNjE2IOS4reWumuS5ieeahOWGheWuueexu+Wei++8iE1JTUXvvInvvIzlsIbkvZzkuLogT2JqZWN0IOWFg+aVsOaNruS/neWtmO+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkV4cGlyZXMgICAgICAgICAgICAgICAgICAgICAgICAgUkZDIDI2MTYg5Lit5a6a5LmJ55qE6L+H5pyf5pe26Ze077yM5bCG5L2c5Li6IE9iamVjdCDlhYPmlbDmja7kv53lrZjvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5BQ0wgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWFgeiuuOeUqOaIt+iHquWumuS5ieaWh+S7tuadg+mZkO+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkdyYW50UmVhZCAgICAgICAgICAgICAgICAgICAgICAg6LWL5LqI6KKr5o6I5p2D6ICF6K+755qE5p2D6ZmQIO+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkdyYW50V3JpdGUgICAgICAgICAgICAgICAgICAgICAg6LWL5LqI6KKr5o6I5p2D6ICF5YaZ55qE5p2D6ZmQIO+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkdyYW50RnVsbENvbnRyb2wgICAgICAgICAgICAgICAg6LWL5LqI6KKr5o6I5p2D6ICF6K+75YaZ5p2D6ZmQIO+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlN0b3JhZ2VDbGFzcyAgICAgICAgICAgICAgICAgICAg6K6+572uT2JqZWN055qE5a2Y5YKo57qn5Yir77yM5p6a5Li+5YC877yaU3RhbmRhcmTvvIxTdGFuZGFyZF9JQe+8jEFyY2hpdmXvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5TZXJ2ZXJTaWRlRW5jcnlwdGlvbiAgICAgICAgICAg5pSv5oyB5oyJ54Wn5oyH5a6a55qE5Yqg5a+G566X5rOV6L+b6KGM5pyN5Yqh56uv5pWw5o2u5Yqg5a+G77yM5qC85byPIHgtY29zLXNlcnZlci1zaWRlLWVuY3J5cHRpb246IFwiQUVTMjU2XCLvvIzpnZ7lv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cclxuICovXG5cblxuZnVuY3Rpb24gbXVsdGlwYXJ0SW5pdChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBzZWxmID0gdGhpczsgLy8g54m55q6K5aSE55CGIENhY2hlLUNvbnRyb2xcblxuICB2YXIgaGVhZGVycyA9IHBhcmFtcy5IZWFkZXJzO1xuICB2YXIgdHJhY2tlciA9IHBhcmFtcy50cmFja2VyOyAvLyDnibnmrorlpITnkIYgQ2FjaGUtQ29udHJvbOOAgUNvbnRlbnQtVHlwZVxuXG4gIGlmICghaGVhZGVyc1snQ2FjaGUtQ29udHJvbCddICYmICFoZWFkZXJzWydjYWNoZS1jb250cm9sJ10pIGhlYWRlcnNbJ0NhY2hlLUNvbnRyb2wnXSA9ICcnO1xuICBpZiAoIWhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddICYmICFoZWFkZXJzWydjb250ZW50LXR5cGUnXSkgaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSBwYXJhbXMuQm9keSAmJiBwYXJhbXMuQm9keS50eXBlIHx8ICcnO1xuICB2YXIgbmVlZENhbGNNZDUgPSBwYXJhbXMuQm9keSAmJiAocGFyYW1zLlVwbG9hZEFkZE1ldGFNZDUgfHwgc2VsZi5vcHRpb25zLlVwbG9hZEFkZE1ldGFNZDUpO1xuICBuZWVkQ2FsY01kNSAmJiB0cmFja2VyICYmIHRyYWNrZXIuc2V0UGFyYW1zKHtcbiAgICBtZDVTdGFydFRpbWU6IG5ldyBEYXRlKCkuZ2V0VGltZSgpXG4gIH0pO1xuICB1dGlsLmdldEJvZHlNZDUobmVlZENhbGNNZDUsIHBhcmFtcy5Cb2R5LCBmdW5jdGlvbiAobWQ1KSB7XG4gICAgaWYgKG1kNSkgcGFyYW1zLkhlYWRlcnNbJ3gtY29zLW1ldGEtbWQ1J10gPSBtZDU7XG4gICAgbmVlZENhbGNNZDUgJiYgdHJhY2tlciAmJiB0cmFja2VyLnNldFBhcmFtcyh7XG4gICAgICBtZDVFbmRUaW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuICAgIH0pO1xuICAgIHN1Ym1pdFJlcXVlc3QuY2FsbChzZWxmLCB7XG4gICAgICBBY3Rpb246ICduYW1lL2NvczpJbml0aWF0ZU11bHRpcGFydFVwbG9hZCcsXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICAgIEtleTogcGFyYW1zLktleSxcbiAgICAgIGFjdGlvbjogJ3VwbG9hZHMnLFxuICAgICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgICBxczogcGFyYW1zLlF1ZXJ5LFxuICAgICAgdHJhY2tlcjogdHJhY2tlclxuICAgIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgdHJhY2tlciAmJiB0cmFja2VyLnBhcmVudCAmJiB0cmFja2VyLnBhcmVudC5zZXRQYXJhbXMoe1xuICAgICAgICAgIGVycm9yTm9kZTogJ211bHRpcGFydEluaXQnXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgIH1cblxuICAgICAgZGF0YSA9IHV0aWwuY2xvbmUoZGF0YSB8fCB7fSk7XG5cbiAgICAgIGlmIChkYXRhICYmIGRhdGEuSW5pdGlhdGVNdWx0aXBhcnRVcGxvYWRSZXN1bHQpIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHV0aWwuZXh0ZW5kKGRhdGEuSW5pdGlhdGVNdWx0aXBhcnRVcGxvYWRSZXN1bHQsIHtcbiAgICAgICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgICAgIH0pKTtcbiAgICAgIH1cblxuICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YSk7XG4gICAgfSk7XG4gIH0sIHBhcmFtcy5vbkhhc2hQcm9ncmVzcyk7XG59XG4vKipcclxuICog5YiG5Z2X5LiK5LygXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICAgICAgICAgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgICAgICAgICAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuS2V5ICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7RmlsZSB8fCBCbG9iIHx8IFN0cmluZ30gIHBhcmFtcy5Cb2R5ICAgICAgICDkuIrkvKDmlofku7blr7nosaHmiJblrZfnrKbkuLJcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gcGFyYW1zLkNvbnRlbnRMZW5ndGggICAgICAgICAgICAgICAgUkZDIDI2MTYg5Lit5a6a5LmJ55qEIEhUVFAg6K+35rGC5YaF5a656ZW/5bqm77yI5a2X6IqC77yJ77yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9IHBhcmFtcy5FeHBlY3QgICAgICAgICAgICAgICAgICAgICAgIOW9k+S9v+eUqCBFeHBlY3Q6IDEwMC1jb250aW51ZSDml7bvvIzlnKjmlLbliLDmnI3liqHnq6/noa7orqTlkI7vvIzmiY3kvJrlj5HpgIHor7fmsYLlhoXlrrnvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gcGFyYW1zLlNlcnZlclNpZGVFbmNyeXB0aW9uICAgICAgICAg5pSv5oyB5oyJ54Wn5oyH5a6a55qE5Yqg5a+G566X5rOV6L+b6KGM5pyN5Yqh56uv5pWw5o2u5Yqg5a+G77yM5qC85byPIHgtY29zLXNlcnZlci1zaWRlLWVuY3J5cHRpb246IFwiQUVTMjU2XCLvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gcGFyYW1zLkNvbnRlbnRTaGExICAgICAgICAgICAgICAgICAgUkZDIDMxNzQg5Lit5a6a5LmJ55qEIDE2MC1iaXQg5YaF5a65IFNIQS0xIOeul+azleagoemqjOWAvO+8jOmdnuW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcclxuICogICAgIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXHJcbiAqICAgICBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxyXG4gKiAgICAgQHJldHVybiAge09iamVjdH0gIGRhdGEuRVRhZyAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57nmoTmlofku7bliIblnZcgc2hhMSDlgLxcclxuICovXG5cblxuZnVuY3Rpb24gbXVsdGlwYXJ0VXBsb2FkKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB1dGlsLmdldEZpbGVTaXplKCdtdWx0aXBhcnRVcGxvYWQnLCBwYXJhbXMsIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdHJhY2tlciA9IHBhcmFtcy50cmFja2VyO1xuICAgIHZhciBuZWVkQ2FsY01kNSA9IHNlbGYub3B0aW9ucy5VcGxvYWRDaGVja0NvbnRlbnRNZDU7XG4gICAgbmVlZENhbGNNZDUgJiYgdHJhY2tlciAmJiB0cmFja2VyLnNldFBhcmFtcyh7XG4gICAgICBtZDVTdGFydFRpbWU6IG5ldyBEYXRlKCkuZ2V0VGltZSgpXG4gICAgfSk7XG4gICAgdXRpbC5nZXRCb2R5TWQ1KG5lZWRDYWxjTWQ1LCBwYXJhbXMuQm9keSwgZnVuY3Rpb24gKG1kNSkge1xuICAgICAgaWYgKG1kNSkgcGFyYW1zLkhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NChtZDUpO1xuICAgICAgbmVlZENhbGNNZDUgJiYgdHJhY2tlciAmJiB0cmFja2VyLnNldFBhcmFtcyh7XG4gICAgICAgIG1kNUVuZFRpbWU6IG5ldyBEYXRlKCkuZ2V0VGltZSgpXG4gICAgICB9KTtcbiAgICAgIHRyYWNrZXIgJiYgdHJhY2tlci5zZXRQYXJhbXMoe1xuICAgICAgICBwYXJ0TnVtYmVyOiBwYXJhbXMuUGFydE51bWJlclxuICAgICAgfSk7XG4gICAgICBzdWJtaXRSZXF1ZXN0LmNhbGwoc2VsZiwge1xuICAgICAgICBBY3Rpb246ICduYW1lL2NvczpVcGxvYWRQYXJ0JyxcbiAgICAgICAgVGFza0lkOiBwYXJhbXMuVGFza0lkLFxuICAgICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICAgICAgS2V5OiBwYXJhbXMuS2V5LFxuICAgICAgICBxczoge1xuICAgICAgICAgIHBhcnROdW1iZXI6IHBhcmFtc1snUGFydE51bWJlciddLFxuICAgICAgICAgIHVwbG9hZElkOiBwYXJhbXNbJ1VwbG9hZElkJ11cbiAgICAgICAgfSxcbiAgICAgICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgICAgIG9uUHJvZ3Jlc3M6IHBhcmFtcy5vblByb2dyZXNzLFxuICAgICAgICBib2R5OiBwYXJhbXMuQm9keSB8fCBudWxsLFxuICAgICAgICB0cmFja2VyOiB0cmFja2VyXG4gICAgICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICB0cmFja2VyICYmIHRyYWNrZXIucGFyZW50ICYmIHRyYWNrZXIucGFyZW50LnNldFBhcmFtcyh7XG4gICAgICAgICAgICBlcnJvck5vZGU6ICdtdWx0aXBhcnRVcGxvYWQnXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICAgIH1cblxuICAgICAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgICAgRVRhZzogdXRpbC5hdHRyKGRhdGEuaGVhZGVycywgJ2V0YWcnLCAnJyksXG4gICAgICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxyXG4gKiDlrozmiJDliIblnZfkuIrkvKBcclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICAgICAgICAgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5LZXkgICAgICAgICAgICAgICAgICAgICBvYmplY3TlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge0FycmF5fSAgIHBhcmFtcy5QYXJ0cyAgICAgICAgICAgICAgICAgICDliIblnZfkv6Hmga/liJfooajvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5QYXJ0c1tpXS5QYXJ0TnVtYmVyICAgICDlnZfnvJblj7fvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5QYXJ0c1tpXS5FVGFnICAgICAgICAgICDliIblnZfnmoQgc2hhMSDmoKHpqozlgLxcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcclxuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcclxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cclxuICogICAgIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhLkNvbXBsZXRlTXVsdGlwYXJ0VXBsb2FkICDlrozmiJDliIblnZfkuIrkvKDlkI7nmoTmlofku7bkv6Hmga/vvIzljIXmi6xMb2NhdGlvbiwgQnVja2V0LCBLZXkg5ZKMIEVUYWdcclxuICovXG5cblxuZnVuY3Rpb24gbXVsdGlwYXJ0Q29tcGxldGUocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBVcGxvYWRJZCA9IHBhcmFtcy5VcGxvYWRJZDtcbiAgdmFyIFBhcnRzID0gcGFyYW1zWydQYXJ0cyddO1xuICB2YXIgdHJhY2tlciA9IHBhcmFtcy50cmFja2VyO1xuXG4gIGZvciAodmFyIGkgPSAwLCBsZW4gPSBQYXJ0cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgIGlmIChQYXJ0c1tpXVsnRVRhZyddICYmIFBhcnRzW2ldWydFVGFnJ10uaW5kZXhPZignXCInKSA9PT0gMCkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgUGFydHNbaV1bJ0VUYWcnXSA9ICdcIicgKyBQYXJ0c1tpXVsnRVRhZyddICsgJ1wiJztcbiAgfVxuXG4gIHZhciB4bWwgPSB1dGlsLmpzb24yeG1sKHtcbiAgICBDb21wbGV0ZU11bHRpcGFydFVwbG9hZDoge1xuICAgICAgUGFydDogUGFydHNcbiAgICB9XG4gIH0pOyAvLyBDU1AvY2VwaCBDb21wbGV0ZU11bHRpcGFydFVwbG9hZCDmjqXlj6MgYm9keSDlhpnmrbvkuobpmZDliLYgMU1C77yM6L+Z6YeM6YaJ5YCSIDEwMDAwIOeJh+aXtu+8jHhtbCDlrZfnrKbkuLLljrvmjonnqbrmoLw4NTNLQlxuXG4gIHhtbCA9IHhtbC5yZXBsYWNlKC9cXG5cXHMqL2csICcnKTtcbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veG1sJztcbiAgaGVhZGVyc1snQ29udGVudC1NRDUnXSA9IHV0aWwuYmluYXJ5QmFzZTY0KHV0aWwubWQ1KHhtbCkpO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkNvbXBsZXRlTXVsdGlwYXJ0VXBsb2FkJyxcbiAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIEtleTogcGFyYW1zLktleSxcbiAgICBxczoge1xuICAgICAgdXBsb2FkSWQ6IFVwbG9hZElkXG4gICAgfSxcbiAgICBib2R5OiB4bWwsXG4gICAgaGVhZGVyczogaGVhZGVycyxcbiAgICB0cmFja2VyOiB0cmFja2VyXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICB0cmFja2VyICYmIHRyYWNrZXIucGFyZW50ICYmIHRyYWNrZXIucGFyZW50LnNldFBhcmFtcyh7XG4gICAgICAgIGVycm9yTm9kZTogJ211bHRpcGFydENvbXBsZXRlJ1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICB2YXIgdXJsID0gZ2V0VXJsKHtcbiAgICAgIEZvcmNlUGF0aFN0eWxlOiBzZWxmLm9wdGlvbnMuRm9yY2VQYXRoU3R5bGUsXG4gICAgICBwcm90b2NvbDogc2VsZi5vcHRpb25zLlByb3RvY29sLFxuICAgICAgZG9tYWluOiBzZWxmLm9wdGlvbnMuRG9tYWluLFxuICAgICAgYnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgICAgcmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgICAgb2JqZWN0OiBwYXJhbXMuS2V5LFxuICAgICAgaXNMb2NhdGlvbjogdHJ1ZVxuICAgIH0pO1xuICAgIHZhciByZXMgPSBkYXRhLkNvbXBsZXRlTXVsdGlwYXJ0VXBsb2FkUmVzdWx0IHx8IHt9O1xuXG4gICAgaWYgKHJlcy5Qcm9jZXNzUmVzdWx0cykge1xuICAgICAgaWYgKHJlcyAmJiByZXMuUHJvY2Vzc1Jlc3VsdHMpIHtcbiAgICAgICAgcmVzLlVwbG9hZFJlc3VsdCA9IHtcbiAgICAgICAgICBPcmlnaW5hbEluZm86IHtcbiAgICAgICAgICAgIEtleTogcmVzLktleSxcbiAgICAgICAgICAgIExvY2F0aW9uOiB1cmwsXG4gICAgICAgICAgICBFVGFnOiByZXMuRVRhZyxcbiAgICAgICAgICAgIEltYWdlSW5mbzogcmVzLkltYWdlSW5mb1xuICAgICAgICAgIH0sXG4gICAgICAgICAgUHJvY2Vzc1Jlc3VsdHM6IHJlcy5Qcm9jZXNzUmVzdWx0c1xuICAgICAgICB9O1xuICAgICAgICBkZWxldGUgcmVzLkltYWdlSW5mbztcbiAgICAgICAgZGVsZXRlIHJlcy5Qcm9jZXNzUmVzdWx0cztcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgcmVzdWx0ID0gdXRpbC5leHRlbmQocmVzLCB7XG4gICAgICBMb2NhdGlvbjogdXJsLFxuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcbiAgfSk7XG59XG4vKipcclxuICog5YiG5Z2X5LiK5Lyg5Lu75Yqh5YiX6KGo5p+l6K+iXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICAgICAgICAgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgICAgICAgICAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuRGVsaW1pdGVyICAgICAgICAgICAgICAgICAgIOWumueVjOespuS4uuS4gOS4quespuWPt++8jOWmguaenOaciVByZWZpeO+8jOWImeWwhlByZWZpeOWIsGRlbGltaXRlcuS5i+mXtOeahOebuOWQjOi3r+W+hOW9kuS4uuS4gOexu++8jOWumuS5ieS4ukNvbW1vbiBQcmVmaXjvvIznhLblkI7liJflh7rmiYDmnIlDb21tb24gUHJlZml444CC5aaC5p6c5rKh5pyJUHJlZml477yM5YiZ5LuO6Lev5b6E6LW354K55byA5aeL77yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuRW5jb2RpbmdUeXBlICAgICAgICAgICAgICAgIOinhOWumui/lOWbnuWAvOeahOe8lueggeaWueW8j++8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlByZWZpeCAgICAgICAgICAgICAgICAgICAgICDliY3nvIDljLnphY3vvIznlKjmnaXop4Tlrprov5Tlm57nmoTmlofku7bliY3nvIDlnLDlnYDvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5NYXhVcGxvYWRzICAgICAgICAgICAgICAgICAg5Y2V5qyh6L+U5Zue5pyA5aSn55qE5p2h55uu5pWw6YeP77yM6buY6K6kMTAwMO+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLktleU1hcmtlciAgICAgICAgICAgICAgICAgICDkuI51cGxvYWQtaWQtbWFya2Vy5LiA6LW35L2/55SoIDwvQnI+5b2TdXBsb2FkLWlkLW1hcmtlcuacquiiq+aMh+WumuaXtu+8jE9iamVjdE5hbWXlrZfmr43pobrluo/lpKfkuo5rZXktbWFya2Vy55qE5p2h55uu5bCG6KKr5YiX5Ye6IDwvQnI+5b2TdXBsb2FkLWlkLW1hcmtlcuiiq+aMh+WumuaXtu+8jE9iamVjdE5hbWXlrZfmr43pobrluo/lpKfkuo5rZXktbWFya2Vy55qE5p2h55uu6KKr5YiX5Ye677yMT2JqZWN0TmFtZeWtl+avjemhuuW6j+etieS6jmtleS1tYXJrZXLlkIzml7ZVcGxvYWRJZOWkp+S6jnVwbG9hZC1pZC1tYXJrZXLnmoTmnaHnm67lsIbooqvliJflh7rvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5VcGxvYWRJZE1hcmtlciAgICAgICAgICAgICAg5LiOa2V5LW1hcmtlcuS4gOi1t+S9v+eUqCA8L0JyPuW9k2tleS1tYXJrZXLmnKrooqvmjIflrprml7bvvIx1cGxvYWQtaWQtbWFya2Vy5bCG6KKr5b+955WlIDwvQnI+5b2Ta2V5LW1hcmtlcuiiq+aMh+WumuaXtu+8jE9iamVjdE5hbWXlrZfmr43pobrluo/lpKfkuo5rZXktbWFya2Vy55qE5p2h55uu6KKr5YiX5Ye677yMT2JqZWN0TmFtZeWtl+avjemhuuW6j+etieS6jmtleS1tYXJrZXLlkIzml7ZVcGxvYWRJZOWkp+S6jnVwbG9hZC1pZC1tYXJrZXLnmoTmnaHnm67lsIbooqvliJflh7rvvIzpnZ7lv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XHJcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cclxuICogICAgIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhLkxpc3RNdWx0aXBhcnRVcGxvYWRzUmVzdWx0ICAg5YiG5Z2X5LiK5Lyg5Lu75Yqh5L+h5oGvXHJcbiAqL1xuXG5cbmZ1bmN0aW9uIG11bHRpcGFydExpc3QocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgcmVxUGFyYW1zID0ge307XG4gIHJlcVBhcmFtc1snZGVsaW1pdGVyJ10gPSBwYXJhbXNbJ0RlbGltaXRlciddO1xuICByZXFQYXJhbXNbJ2VuY29kaW5nLXR5cGUnXSA9IHBhcmFtc1snRW5jb2RpbmdUeXBlJ107XG4gIHJlcVBhcmFtc1sncHJlZml4J10gPSBwYXJhbXNbJ1ByZWZpeCddIHx8ICcnO1xuICByZXFQYXJhbXNbJ21heC11cGxvYWRzJ10gPSBwYXJhbXNbJ01heFVwbG9hZHMnXTtcbiAgcmVxUGFyYW1zWydrZXktbWFya2VyJ10gPSBwYXJhbXNbJ0tleU1hcmtlciddO1xuICByZXFQYXJhbXNbJ3VwbG9hZC1pZC1tYXJrZXInXSA9IHBhcmFtc1snVXBsb2FkSWRNYXJrZXInXTtcbiAgcmVxUGFyYW1zID0gdXRpbC5jbGVhcktleShyZXFQYXJhbXMpO1xuICB2YXIgdHJhY2tlciA9IHBhcmFtcy50cmFja2VyO1xuICB0cmFja2VyICYmIHRyYWNrZXIuc2V0UGFyYW1zKHtcbiAgICBzaWduU3RhcnRUaW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuICB9KTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpMaXN0TXVsdGlwYXJ0VXBsb2FkcycsXG4gICAgUmVzb3VyY2VLZXk6IHJlcVBhcmFtc1sncHJlZml4J10sXG4gICAgbWV0aG9kOiAnR0VUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIHFzOiByZXFQYXJhbXMsXG4gICAgYWN0aW9uOiAndXBsb2FkcycsXG4gICAgdHJhY2tlcjogdHJhY2tlclxuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgdHJhY2tlciAmJiB0cmFja2VyLnBhcmVudCAmJiB0cmFja2VyLnBhcmVudC5zZXRQYXJhbXMoe1xuICAgICAgICBlcnJvck5vZGU6ICdtdWx0aXBhcnRMaXN0J1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBpZiAoZGF0YSAmJiBkYXRhLkxpc3RNdWx0aXBhcnRVcGxvYWRzUmVzdWx0KSB7XG4gICAgICB2YXIgVXBsb2FkID0gZGF0YS5MaXN0TXVsdGlwYXJ0VXBsb2Fkc1Jlc3VsdC5VcGxvYWQgfHwgW107XG4gICAgICBVcGxvYWQgPSB1dGlsLmlzQXJyYXkoVXBsb2FkKSA/IFVwbG9hZCA6IFtVcGxvYWRdO1xuICAgICAgZGF0YS5MaXN0TXVsdGlwYXJ0VXBsb2Fkc1Jlc3VsdC5VcGxvYWQgPSBVcGxvYWQ7XG4gICAgfVxuXG4gICAgdmFyIHJlc3VsdCA9IHV0aWwuY2xvbmUoZGF0YS5MaXN0TXVsdGlwYXJ0VXBsb2Fkc1Jlc3VsdCB8fCB7fSk7XG4gICAgdXRpbC5leHRlbmQocmVzdWx0LCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xuICB9KTtcbn1cbi8qKlxyXG4gKiDkuIrkvKDnmoTliIblnZfliJfooajmn6Xor6JcclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgICAgICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5LZXkgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuVXBsb2FkSWQgICAgICAgICAgICAgICAgICAgIOagh+ekuuacrOasoeWIhuWdl+S4iuS8oOeahElE77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuRW5jb2RpbmdUeXBlICAgICAgICAgICAgICAgIOinhOWumui/lOWbnuWAvOeahOe8lueggeaWueW8j++8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLk1heFBhcnRzICAgICAgICAgICAgICAgICAgICDljZXmrKHov5Tlm57mnIDlpKfnmoTmnaHnm67mlbDph4/vvIzpu5jorqQxMDAw77yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUGFydE51bWJlck1hcmtlciAgICAgICAgICAgIOm7mOiupOS7pVVURi045LqM6L+b5Yi26aG65bqP5YiX5Ye65p2h55uu77yM5omA5pyJ5YiX5Ye65p2h55uu5LuObWFya2Vy5byA5aeL77yM6Z2e5b+F6aG7XHJcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcclxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6L+U5Zue55qE5pWw5o2uXHJcbiAqICAgICBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YS5MaXN0TXVsdGlwYXJ0VXBsb2Fkc1Jlc3VsdCAgIOWIhuWdl+S/oeaBr1xyXG4gKi9cblxuXG5mdW5jdGlvbiBtdWx0aXBhcnRMaXN0UGFydChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciByZXFQYXJhbXMgPSB7fTtcbiAgdmFyIHRyYWNrZXIgPSBwYXJhbXMudHJhY2tlcjtcbiAgcmVxUGFyYW1zWyd1cGxvYWRJZCddID0gcGFyYW1zWydVcGxvYWRJZCddO1xuICByZXFQYXJhbXNbJ2VuY29kaW5nLXR5cGUnXSA9IHBhcmFtc1snRW5jb2RpbmdUeXBlJ107XG4gIHJlcVBhcmFtc1snbWF4LXBhcnRzJ10gPSBwYXJhbXNbJ01heFBhcnRzJ107XG4gIHJlcVBhcmFtc1sncGFydC1udW1iZXItbWFya2VyJ10gPSBwYXJhbXNbJ1BhcnROdW1iZXJNYXJrZXInXTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpMaXN0UGFydHMnLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgcXM6IHJlcVBhcmFtc1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgdHJhY2tlciAmJiB0cmFja2VyLnBhcmVudCAmJiB0cmFja2VyLnBhcmVudC5zZXRQYXJhbXMoe1xuICAgICAgICBlcnJvck5vZGU6ICdtdWx0aXBhcnRMaXN0UGFydCdcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgdmFyIExpc3RQYXJ0c1Jlc3VsdCA9IGRhdGEuTGlzdFBhcnRzUmVzdWx0IHx8IHt9O1xuICAgIHZhciBQYXJ0ID0gTGlzdFBhcnRzUmVzdWx0LlBhcnQgfHwgW107XG4gICAgUGFydCA9IHV0aWwuaXNBcnJheShQYXJ0KSA/IFBhcnQgOiBbUGFydF07XG4gICAgTGlzdFBhcnRzUmVzdWx0LlBhcnQgPSBQYXJ0O1xuICAgIHZhciByZXN1bHQgPSB1dGlsLmNsb25lKExpc3RQYXJ0c1Jlc3VsdCk7XG4gICAgdXRpbC5leHRlbmQocmVzdWx0LCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xuICB9KTtcbn1cbi8qKlxyXG4gKiDmipvlvIPliIblnZfkuIrkvKBcclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5LZXkgICAgICAgICBvYmplY3TlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5VcGxvYWRJZCAgICDmoIfnpLrmnKzmrKHliIblnZfkuIrkvKDnmoRJRO+8jOW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiAgICAgQHJldHVybiAge09iamVjdH0gICAgZXJyICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxyXG4gKiAgICAgQHJldHVybiAge09iamVjdH0gICAgZGF0YSAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxyXG4gKi9cblxuXG5mdW5jdGlvbiBtdWx0aXBhcnRBYm9ydChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciByZXFQYXJhbXMgPSB7fTtcbiAgcmVxUGFyYW1zWyd1cGxvYWRJZCddID0gcGFyYW1zWydVcGxvYWRJZCddO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkFib3J0TXVsdGlwYXJ0VXBsb2FkJyxcbiAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgS2V5OiBwYXJhbXMuS2V5LFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIHFzOiByZXFQYXJhbXNcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxyXG4gKiDmipvlvIPliIblnZfkuIrkvKBcclxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5LZXkgICAgICAgICBvYmplY3TlkI3np7DvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5VcGxvYWRJZCAgICDmoIfnpLrmnKzmrKHliIblnZfkuIrkvKDnmoRJRO+8jOW/hemhu1xyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiAgICAgQHJldHVybiAge09iamVjdH0gICAgZXJyICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxyXG4gKiAgICAgQHJldHVybiAge09iamVjdH0gICAgZGF0YSAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxyXG4gKi9cblxuXG5mdW5jdGlvbiByZXF1ZXN0KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBtZXRob2Q6IHBhcmFtcy5NZXRob2QsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgYWN0aW9uOiBwYXJhbXMuQWN0aW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIHFzOiBwYXJhbXMuUXVlcnksXG4gICAgYm9keTogcGFyYW1zLkJvZHksXG4gICAgVXJsOiBwYXJhbXMuVXJsLFxuICAgIHJhd0JvZHk6IHBhcmFtcy5SYXdCb2R5LFxuICAgIERhdGFUeXBlOiBwYXJhbXMuRGF0YVR5cGVcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuXG4gICAgaWYgKGRhdGEgJiYgZGF0YS5ib2R5KSB7XG4gICAgICBkYXRhLkJvZHkgPSBkYXRhLmJvZHk7XG4gICAgICBkZWxldGUgZGF0YS5ib2R5O1xuICAgIH1cblxuICAgIGNhbGxiYWNrKGVyciwgZGF0YSk7XG4gIH0pO1xufVxuLyoqXHJcbiAqIOi/veWKoOS4iuS8oFxyXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLktleSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7RmlsZSB8fCBCbG9iIHx8IFN0cmluZ30gIHBhcmFtcy5Cb2R5ICAgICAgICAgICAgICAgIOS4iuS8oOaWh+S7tuWvueixoeaIluWtl+espuS4slxyXG4gKiAgICAgQHBhcmFtICB7TnVtYmVyfSAgcGFyYW1zLlBvc2l0aW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgIOi/veWKoOaTjeS9nOeahOi1t+Wni+eCue+8jOWNleS9jeS4uuWtl+iKgu+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkNhY2hlQ29udHJvbCAgICAgICAgICAgICAgICAgICAgICAgIFJGQyAyNjE2IOS4reWumuS5ieeahOe8k+WtmOetlueVpe+8jOWwhuS9nOS4uiBPYmplY3Qg5YWD5pWw5o2u5L+d5a2Y77yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQ29udGVudERpc3Bvc2l0aW9uICAgICAgICAgICAgICAgICAgUkZDIDI2MTYg5Lit5a6a5LmJ55qE5paH5Lu25ZCN56ew77yM5bCG5L2c5Li6IE9iamVjdCDlhYPmlbDmja7kv53lrZjvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5Db250ZW50RW5jb2RpbmcgICAgICAgICAgICAgICAgICAgICBSRkMgMjYxNiDkuK3lrprkuYnnmoTnvJbnoIHmoLzlvI/vvIzlsIbkvZzkuLogT2JqZWN0IOWFg+aVsOaNruS/neWtmO+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkNvbnRlbnRMZW5ndGggICAgICAgICAgICAgICAgICAgICAgIFJGQyAyNjE2IOS4reWumuS5ieeahCBIVFRQIOivt+axguWGheWuuemVv+W6pu+8iOWtl+iKgu+8ie+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkNvbnRlbnRUeXBlICAgICAgICAgICAgICAgICAgICAgICAgIFJGQyAyNjE2IOS4reWumuS5ieeahOWGheWuueexu+Wei++8iE1JTUXvvInvvIzlsIbkvZzkuLogT2JqZWN0IOWFg+aVsOaNruS/neWtmO+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkV4cGVjdCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOW9k+S9v+eUqCBFeHBlY3Q6IDEwMC1jb250aW51ZSDml7bvvIzlnKjmlLbliLDmnI3liqHnq6/noa7orqTlkI7vvIzmiY3kvJrlj5HpgIHor7fmsYLlhoXlrrnvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5FeHBpcmVzICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSRkMgMjYxNiDkuK3lrprkuYnnmoTov4fmnJ/ml7bpl7TvvIzlsIbkvZzkuLogT2JqZWN0IOWFg+aVsOaNruS/neWtmO+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkFDTCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWFgeiuuOeUqOaIt+iHquWumuS5ieaWh+S7tuadg+mZkO+8jOacieaViOWAvO+8mnByaXZhdGUgfCBwdWJsaWMtcmVhZO+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkdyYW50UmVhZCAgICAgICAgICAgICAgICAgICAgICAgICAgIOi1i+S6iOiiq+aOiOadg+iAheivu+WPluWvueixoeeahOadg+mZkO+8jOagvOW8j++8mmlkPVwiW093bmVyVWluXVwi77yM5Y+v5L2/55So5Y2K6KeS6YCX5Y+377yILO+8ieWIhumalOWkmue7hOiiq+aOiOadg+iAhe+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkdyYW50UmVhZEFjcCAgICAgICAgICAgICAgICAgICAgICAgIOi1i+S6iOiiq+aOiOadg+iAheivu+WPluWvueixoeeahOiuv+mXruaOp+WItuWIl+ihqO+8iEFDTO+8ieeahOadg+mZkO+8jOagvOW8j++8mmlkPVwiW093bmVyVWluXVwi77yM5Y+v5L2/55So5Y2K6KeS6YCX5Y+377yILO+8ieWIhumalOWkmue7hOiiq+aOiOadg+iAhe+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkdyYW50V3JpdGVBY3AgICAgICAgICAgICAgICAgICAgICAgIOi1i+S6iOiiq+aOiOadg+iAheWGmeWFpeWvueixoeeahOiuv+mXruaOp+WItuWIl+ihqO+8iEFDTO+8ieeahOadg+mZkO+8jOagvOW8j++8mmlkPVwiW093bmVyVWluXVwi77yM5Y+v5L2/55So5Y2K6KeS6YCX5Y+377yILO+8ieWIhumalOWkmue7hOiiq+aOiOadg+iAhe+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkdyYW50RnVsbENvbnRyb2wgICAgICAgICAgICAgICAgICAgIOi1i+S6iOiiq+aOiOadg+iAheaTjeS9nOWvueixoeeahOaJgOacieadg+mZkO+8jOagvOW8j++8mmlkPVwiW093bmVyVWluXVwi77yM5Y+v5L2/55So5Y2K6KeS6YCX5Y+377yILO+8ieWIhumalOWkmue7hOiiq+aOiOadg+iAhe+8jOmdnuW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlN0b3JhZ2VDbGFzcyAgICAgICAgICAgICAgICAgICAgICAgIOiuvue9ruWvueixoeeahOWtmOWCqOe6p+WIq++8jOaemuS4vuWAvO+8mlNUQU5EQVJE44CBU1RBTkRBUkRfSUHjgIFBUkNISVZF77yM6buY6K6k5YC877yaU1RBTkRBUkTvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy54LWNvcy1tZXRhLSogICAgICAgICAgICAgICAgICAgICAgICDlhYHorrjnlKjmiLfoh6rlrprkuYnnmoTlpLTpg6jkv6Hmga/vvIzlsIbkvZzkuLrlr7nosaHnmoTlhYPmlbDmja7kv53lrZjjgILlpKflsI/pmZDliLYyS0LvvIzpnZ7lv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5Db250ZW50U2hhMSAgICAgICAgICAgICAgICAgICAgICAgICBSRkMgMzE3NCDkuK3lrprkuYnnmoQgMTYwLWJpdCDlhoXlrrkgU0hBLTEg566X5rOV5qCh6aqM77yM6Z2e5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuU2VydmVyU2lkZUVuY3J5cHRpb24gICAgICAgICAgICAgICAg5pSv5oyB5oyJ54Wn5oyH5a6a55qE5Yqg5a+G566X5rOV6L+b6KGM5pyN5Yqh56uv5pWw5o2u5Yqg5a+G77yM5qC85byPIHgtY29zLXNlcnZlci1zaWRlLWVuY3J5cHRpb246IFwiQUVTMjU2XCLvvIzpnZ7lv4XpobtcclxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcclxuICogICAgIEByZXR1cm4gIHtPYmplY3R9ICAgIGVyciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcclxuICogICAgIEByZXR1cm4gIHtPYmplY3R9ICAgIGRhdGEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cclxuICovXG5cblxuZnVuY3Rpb24gYXBwZW5kT2JqZWN0KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgLy8g54m55q6K5aSE55CGIENhY2hlLUNvbnRyb2zjgIFDb250ZW50LVR5cGXvvIzpgb/lhY3ku6PnkIbmm7TmlLnov5nkuKTkuKrlrZfmrrXlr7zoh7TlhpnlhaXliLAgT2JqZWN0IOWxnuaAp+mHjFxuICB2YXIgaGVhZGVycyA9IHBhcmFtcy5IZWFkZXJzO1xuICBpZiAoIWhlYWRlcnNbJ0NhY2hlLUNvbnRyb2wnXSAmJiAhaGVhZGVyc1snY2FjaGUtY29udHJvbCddKSBoZWFkZXJzWydDYWNoZS1Db250cm9sJ10gPSAnJztcbiAgaWYgKCFoZWFkZXJzWydDb250ZW50LVR5cGUnXSAmJiAhaGVhZGVyc1snY29udGVudC10eXBlJ10pIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gcGFyYW1zLkJvZHkgJiYgcGFyYW1zLkJvZHkudHlwZSB8fCAnJztcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpBcHBlbmRPYmplY3QnLFxuICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgYWN0aW9uOiAnYXBwZW5kJyxcbiAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgYm9keTogcGFyYW1zLkJvZHksXG4gICAgcXM6IHtcbiAgICAgIHBvc2l0aW9uOiBwYXJhbXMuUG9zaXRpb25cbiAgICB9LFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICBjYWxsYmFjayhudWxsLCBkYXRhKTtcbiAgfSk7XG59XG4vKipcclxuICog6I635Y+W562+5ZCNXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcclxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5NZXRob2QgIOivt+axguaWueazle+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLktleSAgICAgb2JqZWN05ZCN56ew77yM5b+F6aG7XHJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuRXhwaXJlcyDlkI3otoXml7bml7bpl7TvvIzljZXkvY3np5LvvIzlj6/pgIlcclxuICogQHJldHVybiAge1N0cmluZ30gIGRhdGEgICAgICAgICAgICAgIOi/lOWbnuetvuWQjeWtl+espuS4slxyXG4gKi9cblxuXG5mdW5jdGlvbiBnZXRBdXRoKHBhcmFtcykge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHJldHVybiB1dGlsLmdldEF1dGgoe1xuICAgIFNlY3JldElkOiBwYXJhbXMuU2VjcmV0SWQgfHwgdGhpcy5vcHRpb25zLlNlY3JldElkIHx8ICcnLFxuICAgIFNlY3JldEtleTogcGFyYW1zLlNlY3JldEtleSB8fCB0aGlzLm9wdGlvbnMuU2VjcmV0S2V5IHx8ICcnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgTWV0aG9kOiBwYXJhbXMuTWV0aG9kLFxuICAgIEtleTogcGFyYW1zLktleSxcbiAgICBRdWVyeTogcGFyYW1zLlF1ZXJ5LFxuICAgIEhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIEV4cGlyZXM6IHBhcmFtcy5FeHBpcmVzLFxuICAgIFVzZVJhd0tleTogc2VsZi5vcHRpb25zLlVzZVJhd0tleSxcbiAgICBTeXN0ZW1DbG9ja09mZnNldDogc2VsZi5vcHRpb25zLlN5c3RlbUNsb2NrT2Zmc2V0XG4gIH0pO1xufVxuLyoqXHJcbiAqIOiOt+WPluaWh+S7tuS4i+i9vemTvuaOpVxyXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLktleSAgICAgICAgIG9iamVjdOWQjeensO+8jOW/hemhu1xyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLk1ldGhvZCAgICAgIOivt+axgueahOaWueazle+8jOWPr+mAiVxyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkV4cGlyZXMgICAgIOetvuWQjei2heaXtuaXtumXtO+8jOWNleS9jeenku+8jOWPr+mAiVxyXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xyXG4gKiAgICAgQHJldHVybiAge09iamVjdH0gICAgZXJyICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxyXG4gKiAgICAgQHJldHVybiAge09iamVjdH0gICAgZGF0YSAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxyXG4gKi9cblxuXG5mdW5jdGlvbiBnZXRPYmplY3RVcmwocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciB1c2VBY2NlbGVyYXRlID0gcGFyYW1zLlVzZUFjY2VsZXJhdGUgPT09IHVuZGVmaW5lZCA/IHNlbGYub3B0aW9ucy5Vc2VBY2NlbGVyYXRlIDogcGFyYW1zLlVzZUFjY2VsZXJhdGU7XG4gIHZhciB1cmwgPSBnZXRVcmwoe1xuICAgIEZvcmNlUGF0aFN0eWxlOiBzZWxmLm9wdGlvbnMuRm9yY2VQYXRoU3R5bGUsXG4gICAgcHJvdG9jb2w6IHBhcmFtcy5Qcm90b2NvbCB8fCBzZWxmLm9wdGlvbnMuUHJvdG9jb2wsXG4gICAgZG9tYWluOiBwYXJhbXMuRG9tYWluIHx8IHNlbGYub3B0aW9ucy5Eb21haW4sXG4gICAgYnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIHJlZ2lvbjogdXNlQWNjZWxlcmF0ZSA/ICdhY2NlbGVyYXRlJyA6IHBhcmFtcy5SZWdpb24sXG4gICAgb2JqZWN0OiBwYXJhbXMuS2V5XG4gIH0pO1xuICB2YXIgcXVlcnlQYXJhbXNTdHIgPSAnJztcblxuICBpZiAocGFyYW1zLlF1ZXJ5KSB7XG4gICAgcXVlcnlQYXJhbXNTdHIgKz0gdXRpbC5vYmoyc3RyKHBhcmFtcy5RdWVyeSk7XG4gIH1cblxuICBpZiAocGFyYW1zLlF1ZXJ5U3RyaW5nKSB7XG4gICAgcXVlcnlQYXJhbXNTdHIgKz0gKHF1ZXJ5UGFyYW1zU3RyID8gJyYnIDogJycpICsgcGFyYW1zLlF1ZXJ5U3RyaW5nO1xuICB9XG5cbiAgdmFyIHN5bmNVcmwgPSB1cmw7XG5cbiAgaWYgKHBhcmFtcy5TaWduICE9PSB1bmRlZmluZWQgJiYgIXBhcmFtcy5TaWduKSB7XG4gICAgcXVlcnlQYXJhbXNTdHIgJiYgKHN5bmNVcmwgKz0gJz8nICsgcXVlcnlQYXJhbXNTdHIpO1xuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIFVybDogc3luY1VybFxuICAgIH0pO1xuICAgIHJldHVybiBzeW5jVXJsO1xuICB9IC8vIOetvuWQjeWKoOS4iiBIb3N077yM6YG/5YWN6Leo5qG26K6/6ZeuXG5cblxuICB2YXIgU2lnbkhvc3QgPSBnZXRTaWduSG9zdC5jYWxsKHRoaXMsIHtcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIFVzZUFjY2VsZXJhdGU6IHBhcmFtcy5Vc2VBY2NlbGVyYXRlLFxuICAgIFVybDogdXJsXG4gIH0pO1xuICB2YXIgQXV0aERhdGEgPSBnZXRBdXRob3JpemF0aW9uQXN5bmMuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAocGFyYW1zLk1ldGhvZCB8fCAnJykudG9VcHBlckNhc2UoKSA9PT0gJ1BVVCcgPyAnbmFtZS9jb3M6UHV0T2JqZWN0JyA6ICduYW1lL2NvczpHZXRPYmplY3QnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCB8fCAnJyxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24gfHwgJycsXG4gICAgTWV0aG9kOiBwYXJhbXMuTWV0aG9kIHx8ICdnZXQnLFxuICAgIEtleTogcGFyYW1zLktleSxcbiAgICBFeHBpcmVzOiBwYXJhbXMuRXhwaXJlcyxcbiAgICBIZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBRdWVyeTogcGFyYW1zLlF1ZXJ5LFxuICAgIFNpZ25Ib3N0OiBTaWduSG9zdCxcbiAgICBGb3JjZVNpZ25Ib3N0OiBwYXJhbXMuRm9yY2VTaWduSG9zdCA9PT0gZmFsc2UgPyBmYWxzZSA6IHNlbGYub3B0aW9ucy5Gb3JjZVNpZ25Ib3N0IC8vIGdldE9iamVjdFVybOaUr+aMgeS8oOWPgkZvcmNlU2lnbkhvc3RcblxuICB9LCBmdW5jdGlvbiAoZXJyLCBBdXRoRGF0YSkge1xuICAgIGlmICghY2FsbGJhY2spIHJldHVybjtcblxuICAgIGlmIChlcnIpIHtcbiAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICByZXR1cm47XG4gICAgfSAvLyDlhbzlrrnkuIfosaF1cmwgcVVybFBhcmFtTGlzdOmcgOimgeWGjWVuY29kZeS4gOasoVxuXG5cbiAgICB2YXIgcmVwbGFjZVVybFBhcmFtTGlzdCA9IGZ1bmN0aW9uIHJlcGxhY2VVcmxQYXJhbUxpc3QodXJsKSB7XG4gICAgICB2YXIgdXJsUGFyYW1zID0gdXJsLm1hdGNoKC9xLXVybC1wYXJhbS1saXN0Lio/KD89JikvZylbMF07XG4gICAgICB2YXIgZW5jb2RlZFBhcmFtcyA9ICdxLXVybC1wYXJhbS1saXN0PScgKyBlbmNvZGVVUklDb21wb25lbnQodXJsUGFyYW1zLnJlcGxhY2UoL3EtdXJsLXBhcmFtLWxpc3Q9LywgJycpKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgdmFyIHJlZyA9IG5ldyBSZWdFeHAodXJsUGFyYW1zLCAnZycpO1xuICAgICAgdmFyIHJlcGxhY2VkVXJsID0gdXJsLnJlcGxhY2UocmVnLCBlbmNvZGVkUGFyYW1zKTtcbiAgICAgIHJldHVybiByZXBsYWNlZFVybDtcbiAgICB9O1xuXG4gICAgdmFyIHNpZ25VcmwgPSB1cmw7XG4gICAgc2lnblVybCArPSAnPycgKyAoQXV0aERhdGEuQXV0aG9yaXphdGlvbi5pbmRleE9mKCdxLXNpZ25hdHVyZScpID4gLTEgPyByZXBsYWNlVXJsUGFyYW1MaXN0KEF1dGhEYXRhLkF1dGhvcml6YXRpb24pIDogJ3NpZ249JyArIGVuY29kZVVSSUNvbXBvbmVudChBdXRoRGF0YS5BdXRob3JpemF0aW9uKSk7XG4gICAgQXV0aERhdGEuU2VjdXJpdHlUb2tlbiAmJiAoc2lnblVybCArPSAnJngtY29zLXNlY3VyaXR5LXRva2VuPScgKyBBdXRoRGF0YS5TZWN1cml0eVRva2VuKTtcbiAgICBBdXRoRGF0YS5DbGllbnRJUCAmJiAoc2lnblVybCArPSAnJmNsaWVudElQPScgKyBBdXRoRGF0YS5DbGllbnRJUCk7XG4gICAgQXV0aERhdGEuQ2xpZW50VUEgJiYgKHNpZ25VcmwgKz0gJyZjbGllbnRVQT0nICsgQXV0aERhdGEuQ2xpZW50VUEpO1xuICAgIEF1dGhEYXRhLlRva2VuICYmIChzaWduVXJsICs9ICcmdG9rZW49JyArIEF1dGhEYXRhLlRva2VuKTtcbiAgICBxdWVyeVBhcmFtc1N0ciAmJiAoc2lnblVybCArPSAnJicgKyBxdWVyeVBhcmFtc1N0cik7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIFVybDogc2lnblVybFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGlmIChBdXRoRGF0YSkge1xuICAgIHN5bmNVcmwgKz0gJz8nICsgQXV0aERhdGEuQXV0aG9yaXphdGlvbiArIChBdXRoRGF0YS5TZWN1cml0eVRva2VuID8gJyZ4LWNvcy1zZWN1cml0eS10b2tlbj0nICsgQXV0aERhdGEuU2VjdXJpdHlUb2tlbiA6ICcnKTtcbiAgICBxdWVyeVBhcmFtc1N0ciAmJiAoc3luY1VybCArPSAnJicgKyBxdWVyeVBhcmFtc1N0cik7XG4gIH0gZWxzZSB7XG4gICAgcXVlcnlQYXJhbXNTdHIgJiYgKHN5bmNVcmwgKz0gJz8nICsgcXVlcnlQYXJhbXNTdHIpO1xuICB9XG5cbiAgcmV0dXJuIHN5bmNVcmw7XG59XG4vKipcclxuICog56eB5pyJ5pa55rOVXHJcbiAqL1xuXG5cbmZ1bmN0aW9uIGRlY29kZUFjbChBY2Nlc3NDb250cm9sUG9saWN5KSB7XG4gIHZhciByZXN1bHQgPSB7XG4gICAgR3JhbnRGdWxsQ29udHJvbDogW10sXG4gICAgR3JhbnRXcml0ZTogW10sXG4gICAgR3JhbnRSZWFkOiBbXSxcbiAgICBHcmFudFJlYWRBY3A6IFtdLFxuICAgIEdyYW50V3JpdGVBY3A6IFtdLFxuICAgIEFDTDogJydcbiAgfTtcbiAgdmFyIEdyYW50TWFwID0ge1xuICAgICdGVUxMX0NPTlRST0wnOiAnR3JhbnRGdWxsQ29udHJvbCcsXG4gICAgJ1dSSVRFJzogJ0dyYW50V3JpdGUnLFxuICAgICdSRUFEJzogJ0dyYW50UmVhZCcsXG4gICAgJ1JFQURfQUNQJzogJ0dyYW50UmVhZEFjcCcsXG4gICAgJ1dSSVRFX0FDUCc6ICdHcmFudFdyaXRlQWNwJ1xuICB9O1xuICB2YXIgQWNjZXNzQ29udHJvbExpc3QgPSBBY2Nlc3NDb250cm9sUG9saWN5ICYmIEFjY2Vzc0NvbnRyb2xQb2xpY3kuQWNjZXNzQ29udHJvbExpc3QgfHwge307XG4gIHZhciBHcmFudCA9IEFjY2Vzc0NvbnRyb2xMaXN0LkdyYW50O1xuXG4gIGlmIChHcmFudCkge1xuICAgIEdyYW50ID0gdXRpbC5pc0FycmF5KEdyYW50KSA/IEdyYW50IDogW0dyYW50XTtcbiAgfVxuXG4gIHZhciBQdWJsaWNBY2wgPSB7XG4gICAgUkVBRDogMCxcbiAgICBXUklURTogMCxcbiAgICBGVUxMX0NPTlRST0w6IDBcbiAgfTtcbiAgR3JhbnQgJiYgR3JhbnQubGVuZ3RoICYmIHV0aWwuZWFjaChHcmFudCwgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpZiAoaXRlbS5HcmFudGVlLklEID09PSAncWNzOjpjYW06OmFueW9uZTphbnlvbmUnIHx8IGl0ZW0uR3JhbnRlZS5VUkkgPT09ICdodHRwOi8vY2FtLnFjbG91ZC5jb20vZ3JvdXBzL2dsb2JhbC9BbGxVc2VycycpIHtcbiAgICAgIFB1YmxpY0FjbFtpdGVtLlBlcm1pc3Npb25dID0gMTtcbiAgICB9IGVsc2UgaWYgKGl0ZW0uR3JhbnRlZS5JRCAhPT0gQWNjZXNzQ29udHJvbFBvbGljeS5Pd25lci5JRCkge1xuICAgICAgcmVzdWx0W0dyYW50TWFwW2l0ZW0uUGVybWlzc2lvbl1dLnB1c2goJ2lkPVwiJyArIGl0ZW0uR3JhbnRlZS5JRCArICdcIicpO1xuICAgIH1cbiAgfSk7XG5cbiAgaWYgKFB1YmxpY0FjbC5GVUxMX0NPTlRST0wgfHwgUHVibGljQWNsLldSSVRFICYmIFB1YmxpY0FjbC5SRUFEKSB7XG4gICAgcmVzdWx0LkFDTCA9ICdwdWJsaWMtcmVhZC13cml0ZSc7XG4gIH0gZWxzZSBpZiAoUHVibGljQWNsLlJFQUQpIHtcbiAgICByZXN1bHQuQUNMID0gJ3B1YmxpYy1yZWFkJztcbiAgfSBlbHNlIHtcbiAgICByZXN1bHQuQUNMID0gJ3ByaXZhdGUnO1xuICB9XG5cbiAgdXRpbC5lYWNoKEdyYW50TWFwLCBmdW5jdGlvbiAoaXRlbSkge1xuICAgIHJlc3VsdFtpdGVtXSA9IHVuaXFHcmFudChyZXN1bHRbaXRlbV0uam9pbignLCcpKTtcbiAgfSk7XG4gIHJldHVybiByZXN1bHQ7XG59IC8vIEdyYW50IOWOu+mHjVxuXG5cbmZ1bmN0aW9uIHVuaXFHcmFudChzdHIpIHtcbiAgdmFyIGFyciA9IHN0ci5zcGxpdCgnLCcpO1xuICB2YXIgZXhpc3QgPSB7fTtcbiAgdmFyIGksIGl0ZW07XG5cbiAgZm9yIChpID0gMDsgaSA8IGFyci5sZW5ndGg7KSB7XG4gICAgaXRlbSA9IGFycltpXS50cmltKCk7XG5cbiAgICBpZiAoZXhpc3RbaXRlbV0pIHtcbiAgICAgIGFyci5zcGxpY2UoaSwgMSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGV4aXN0W2l0ZW1dID0gdHJ1ZTtcbiAgICAgIGFycltpXSA9IGl0ZW07XG4gICAgICBpKys7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGFyci5qb2luKCcsJyk7XG59IC8vIOeUn+aIkOaTjeS9nCB1cmxcblxuXG5mdW5jdGlvbiBnZXRVcmwocGFyYW1zKSB7XG4gIHZhciByZWdpb24gPSBwYXJhbXMucmVnaW9uIHx8ICcnO1xuICB2YXIgbG9uZ0J1Y2tldCA9IHBhcmFtcy5idWNrZXQgfHwgJyc7XG4gIHZhciBzaG9ydEJ1Y2tldCA9IGxvbmdCdWNrZXQuc3Vic3RyKDAsIGxvbmdCdWNrZXQubGFzdEluZGV4T2YoJy0nKSk7XG4gIHZhciBhcHBJZCA9IGxvbmdCdWNrZXQuc3Vic3RyKGxvbmdCdWNrZXQubGFzdEluZGV4T2YoJy0nKSArIDEpO1xuICB2YXIgZG9tYWluID0gcGFyYW1zLmRvbWFpbjtcbiAgdmFyIG9iamVjdCA9IHBhcmFtcy5vYmplY3Q7XG5cbiAgaWYgKHR5cGVvZiBkb21haW4gPT09ICdmdW5jdGlvbicpIHtcbiAgICBkb21haW4gPSBkb21haW4oe1xuICAgICAgQnVja2V0OiBsb25nQnVja2V0LFxuICAgICAgUmVnaW9uOiByZWdpb25cbiAgICB9KTtcbiAgfVxuXG4gIHZhciBwcm90b2NvbCA9IHBhcmFtcy5wcm90b2NvbCB8fCAodXRpbC5pc0Jyb3dzZXIgJiYgbG9jYXRpb24ucHJvdG9jb2wgPT09ICdodHRwOicgPyAnaHR0cDonIDogJ2h0dHBzOicpO1xuXG4gIGlmICghZG9tYWluKSB7XG4gICAgaWYgKFsnY24tc291dGgnLCAnY24tc291dGgtMicsICdjbi1ub3J0aCcsICdjbi1lYXN0JywgJ2NuLXNvdXRod2VzdCcsICdzZyddLmluZGV4T2YocmVnaW9uKSA+IC0xKSB7XG4gICAgICBkb21haW4gPSAne1JlZ2lvbn0ubXlxY2xvdWQuY29tJztcbiAgICB9IGVsc2Uge1xuICAgICAgZG9tYWluID0gJ2Nvcy57UmVnaW9ufS5teXFjbG91ZC5jb20nO1xuICAgIH1cblxuICAgIGlmICghcGFyYW1zLkZvcmNlUGF0aFN0eWxlKSB7XG4gICAgICBkb21haW4gPSAne0J1Y2tldH0uJyArIGRvbWFpbjtcbiAgICB9XG4gIH1cblxuICBkb21haW4gPSBkb21haW4ucmVwbGFjZSgvXFx7XFx7QXBwSWRcXH1cXH0vaWcsIGFwcElkKS5yZXBsYWNlKC9cXHtcXHtCdWNrZXRcXH1cXH0vaWcsIHNob3J0QnVja2V0KS5yZXBsYWNlKC9cXHtcXHtSZWdpb25cXH1cXH0vaWcsIHJlZ2lvbikucmVwbGFjZSgvXFx7XFx7Lio/XFx9XFx9L2lnLCAnJyk7XG4gIGRvbWFpbiA9IGRvbWFpbi5yZXBsYWNlKC9cXHtBcHBJZFxcfS9pZywgYXBwSWQpLnJlcGxhY2UoL1xce0J1Y2tldE5hbWVcXH0vaWcsIHNob3J0QnVja2V0KS5yZXBsYWNlKC9cXHtCdWNrZXRcXH0vaWcsIGxvbmdCdWNrZXQpLnJlcGxhY2UoL1xce1JlZ2lvblxcfS9pZywgcmVnaW9uKS5yZXBsYWNlKC9cXHsuKj9cXH0vaWcsICcnKTtcblxuICBpZiAoIS9eW2EtekEtWl0rOlxcL1xcLy8udGVzdChkb21haW4pKSB7XG4gICAgZG9tYWluID0gcHJvdG9jb2wgKyAnLy8nICsgZG9tYWluO1xuICB9IC8vIOWOu+aOieWfn+WQjeacgOWQjueahOaWnOadhlxuXG5cbiAgaWYgKGRvbWFpbi5zbGljZSgtMSkgPT09ICcvJykge1xuICAgIGRvbWFpbiA9IGRvbWFpbi5zbGljZSgwLCAtMSk7XG4gIH1cblxuICB2YXIgdXJsID0gZG9tYWluO1xuXG4gIGlmIChwYXJhbXMuRm9yY2VQYXRoU3R5bGUpIHtcbiAgICB1cmwgKz0gJy8nICsgbG9uZ0J1Y2tldDtcbiAgfVxuXG4gIHVybCArPSAnLyc7XG5cbiAgaWYgKG9iamVjdCkge1xuICAgIHVybCArPSB1dGlsLmNhbVNhZmVVcmxFbmNvZGUob2JqZWN0KS5yZXBsYWNlKC8lMkYvZywgJy8nKTtcbiAgfVxuXG4gIGlmIChwYXJhbXMuaXNMb2NhdGlvbikge1xuICAgIHVybCA9IHVybC5yZXBsYWNlKC9eaHR0cHM/OlxcL1xcLy8sICcnKTtcbiAgfVxuXG4gIHJldHVybiB1cmw7XG59XG5cbnZhciBnZXRTaWduSG9zdCA9IGZ1bmN0aW9uIGdldFNpZ25Ib3N0KG9wdCkge1xuICBpZiAoIW9wdC5CdWNrZXQgfHwgIW9wdC5SZWdpb24pIHJldHVybiAnJztcbiAgdmFyIHVzZUFjY2VsZXJhdGUgPSBvcHQuVXNlQWNjZWxlcmF0ZSA9PT0gdW5kZWZpbmVkID8gdGhpcy5vcHRpb25zLlVzZUFjY2VsZXJhdGUgOiBvcHQuVXNlQWNjZWxlcmF0ZTtcbiAgdmFyIHVybCA9IG9wdC5VcmwgfHwgZ2V0VXJsKHtcbiAgICBGb3JjZVBhdGhTdHlsZTogdGhpcy5vcHRpb25zLkZvcmNlUGF0aFN0eWxlLFxuICAgIHByb3RvY29sOiB0aGlzLm9wdGlvbnMuUHJvdG9jb2wsXG4gICAgZG9tYWluOiB0aGlzLm9wdGlvbnMuRG9tYWluLFxuICAgIGJ1Y2tldDogb3B0LkJ1Y2tldCxcbiAgICByZWdpb246IHVzZUFjY2VsZXJhdGUgPyAnYWNjZWxlcmF0ZScgOiBvcHQuUmVnaW9uXG4gIH0pO1xuICB2YXIgdXJsSG9zdCA9IHVybC5yZXBsYWNlKC9eaHR0cHM/OlxcL1xcLyhbXi9dKykoXFwvLiopPyQvLCAnJDEnKTtcbiAgdmFyIHN0YW5kYXJkSG9zdFJlZyA9IG5ldyBSZWdFeHAoJ14oW2EtelxcXFxkLV0rLVxcXFxkK1xcXFwuKT8oY29zfGNvc3Y2fGNpfHBpYylcXFxcLihbYS16XFxcXGQtXSspXFxcXC5teXFjbG91ZFxcXFwuY29tJCcpO1xuICBpZiAoc3RhbmRhcmRIb3N0UmVnLnRlc3QodXJsSG9zdCkpIHJldHVybiB1cmxIb3N0O1xuICByZXR1cm4gJyc7XG59OyAvLyDlvILmraXojrflj5bnrb7lkI1cblxuXG5mdW5jdGlvbiBnZXRBdXRob3JpemF0aW9uQXN5bmMocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgaGVhZGVycyA9IHV0aWwuY2xvbmUocGFyYW1zLkhlYWRlcnMpO1xuICB2YXIgaGVhZGVySG9zdCA9ICcnO1xuICB1dGlsLmVhY2goaGVhZGVycywgZnVuY3Rpb24gKHYsIGspIHtcbiAgICAodiA9PT0gJycgfHwgWydjb250ZW50LXR5cGUnLCAnY2FjaGUtY29udHJvbCcsICdleHBpcmVzJ10uaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID4gLTEpICYmIGRlbGV0ZSBoZWFkZXJzW2tdO1xuICAgIGlmIChrLnRvTG93ZXJDYXNlKCkgPT09ICdob3N0JykgaGVhZGVySG9zdCA9IHY7XG4gIH0pOyAvLyBGb3JjZVNpZ25Ib3N05piO56Gu5Lyg5YWlZmFsc2XmiY3kuI3liqDlhaVob3N0562+5ZCNXG5cbiAgdmFyIGZvcmNlU2lnbkhvc3QgPSBwYXJhbXMuRm9yY2VTaWduSG9zdCA9PT0gZmFsc2UgPyBmYWxzZSA6IHRydWU7IC8vIEhvc3Qg5Yqg5YWl562+5ZCN6K6h566XXG5cbiAgaWYgKCFoZWFkZXJIb3N0ICYmIHBhcmFtcy5TaWduSG9zdCAmJiBmb3JjZVNpZ25Ib3N0KSBoZWFkZXJzLkhvc3QgPSBwYXJhbXMuU2lnbkhvc3Q7IC8vIOiOt+WPluWHreivgeeahOWbnuiwg++8jOmBv+WFjeeUqOaItyBjYWxsYmFjayDlpJrmrKFcblxuICB2YXIgY2JEb25lID0gZmFsc2U7XG5cbiAgdmFyIGNiID0gZnVuY3Rpb24gY2IoZXJyLCBBdXRoRGF0YSkge1xuICAgIGlmIChjYkRvbmUpIHJldHVybjtcbiAgICBjYkRvbmUgPSB0cnVlO1xuXG4gICAgaWYgKEF1dGhEYXRhICYmIEF1dGhEYXRhLlhDb3NTZWN1cml0eVRva2VuICYmICFBdXRoRGF0YS5TZWN1cml0eVRva2VuKSB7XG4gICAgICBBdXRoRGF0YSA9IHV0aWwuY2xvbmUoQXV0aERhdGEpO1xuICAgICAgQXV0aERhdGEuU2VjdXJpdHlUb2tlbiA9IEF1dGhEYXRhLlhDb3NTZWN1cml0eVRva2VuO1xuICAgICAgZGVsZXRlIEF1dGhEYXRhLlhDb3NTZWN1cml0eVRva2VuO1xuICAgIH1cblxuICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGVyciwgQXV0aERhdGEpO1xuICB9O1xuXG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIEJ1Y2tldCA9IHBhcmFtcy5CdWNrZXQgfHwgJyc7XG4gIHZhciBSZWdpb24gPSBwYXJhbXMuUmVnaW9uIHx8ICcnOyAvLyBQYXRoTmFtZVxuXG4gIHZhciBLZXlOYW1lID0gcGFyYW1zLktleSB8fCAnJztcblxuICBpZiAoc2VsZi5vcHRpb25zLkZvcmNlUGF0aFN0eWxlICYmIEJ1Y2tldCkge1xuICAgIEtleU5hbWUgPSBCdWNrZXQgKyAnLycgKyBLZXlOYW1lO1xuICB9XG5cbiAgdmFyIFBhdGhuYW1lID0gJy8nICsgS2V5TmFtZTsgLy8gQWN0aW9u44CBUmVzb3VyY2VLZXlcblxuICB2YXIgU3RzRGF0YSA9IHt9O1xuICB2YXIgU2NvcGUgPSBwYXJhbXMuU2NvcGU7XG5cbiAgaWYgKCFTY29wZSkge1xuICAgIHZhciBBY3Rpb24gPSBwYXJhbXMuQWN0aW9uIHx8ICcnO1xuICAgIHZhciBSZXNvdXJjZUtleSA9IHBhcmFtcy5SZXNvdXJjZUtleSB8fCBwYXJhbXMuS2V5IHx8ICcnO1xuICAgIFNjb3BlID0gcGFyYW1zLlNjb3BlIHx8IFt7XG4gICAgICBhY3Rpb246IEFjdGlvbixcbiAgICAgIGJ1Y2tldDogQnVja2V0LFxuICAgICAgcmVnaW9uOiBSZWdpb24sXG4gICAgICBwcmVmaXg6IFJlc291cmNlS2V5XG4gICAgfV07XG4gIH1cblxuICB2YXIgU2NvcGVLZXkgPSB1dGlsLm1kNShKU09OLnN0cmluZ2lmeShTY29wZSkpOyAvLyBTVFNcblxuICBzZWxmLl9TdHNDYWNoZSA9IHNlbGYuX1N0c0NhY2hlIHx8IFtdO1xuXG4gIChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGksIEF1dGhEYXRhO1xuXG4gICAgZm9yIChpID0gc2VsZi5fU3RzQ2FjaGUubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIEF1dGhEYXRhID0gc2VsZi5fU3RzQ2FjaGVbaV07XG4gICAgICB2YXIgY29tcGFyZVRpbWUgPSBNYXRoLnJvdW5kKHV0aWwuZ2V0U2tld1RpbWUoc2VsZi5vcHRpb25zLlN5c3RlbUNsb2NrT2Zmc2V0KSAvIDEwMDApICsgMzA7XG5cbiAgICAgIGlmIChBdXRoRGF0YS5TdGFydFRpbWUgJiYgY29tcGFyZVRpbWUgPCBBdXRoRGF0YS5TdGFydFRpbWUgfHwgY29tcGFyZVRpbWUgPj0gQXV0aERhdGEuRXhwaXJlZFRpbWUpIHtcbiAgICAgICAgc2VsZi5fU3RzQ2FjaGUuc3BsaWNlKGksIDEpO1xuXG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAoIUF1dGhEYXRhLlNjb3BlTGltaXQgfHwgQXV0aERhdGEuU2NvcGVMaW1pdCAmJiBBdXRoRGF0YS5TY29wZUtleSA9PT0gU2NvcGVLZXkpIHtcbiAgICAgICAgU3RzRGF0YSA9IEF1dGhEYXRhO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH0pKCk7XG5cbiAgdmFyIGNhbGNBdXRoQnlUbXBLZXkgPSBmdW5jdGlvbiBjYWxjQXV0aEJ5VG1wS2V5KCkge1xuICAgIHZhciBLZXlUaW1lID0gJyc7XG4gICAgaWYgKFN0c0RhdGEuU3RhcnRUaW1lICYmIHBhcmFtcy5FeHBpcmVzKSBLZXlUaW1lID0gU3RzRGF0YS5TdGFydFRpbWUgKyAnOycgKyAoU3RzRGF0YS5TdGFydFRpbWUgKyBwYXJhbXMuRXhwaXJlcyAqIDEpO2Vsc2UgaWYgKFN0c0RhdGEuU3RhcnRUaW1lICYmIFN0c0RhdGEuRXhwaXJlZFRpbWUpIEtleVRpbWUgPSBTdHNEYXRhLlN0YXJ0VGltZSArICc7JyArIFN0c0RhdGEuRXhwaXJlZFRpbWU7XG4gICAgdmFyIEF1dGhvcml6YXRpb24gPSB1dGlsLmdldEF1dGgoe1xuICAgICAgU2VjcmV0SWQ6IFN0c0RhdGEuVG1wU2VjcmV0SWQsXG4gICAgICBTZWNyZXRLZXk6IFN0c0RhdGEuVG1wU2VjcmV0S2V5LFxuICAgICAgTWV0aG9kOiBwYXJhbXMuTWV0aG9kLFxuICAgICAgUGF0aG5hbWU6IFBhdGhuYW1lLFxuICAgICAgUXVlcnk6IHBhcmFtcy5RdWVyeSxcbiAgICAgIEhlYWRlcnM6IGhlYWRlcnMsXG4gICAgICBFeHBpcmVzOiBwYXJhbXMuRXhwaXJlcyxcbiAgICAgIFVzZVJhd0tleTogc2VsZi5vcHRpb25zLlVzZVJhd0tleSxcbiAgICAgIFN5c3RlbUNsb2NrT2Zmc2V0OiBzZWxmLm9wdGlvbnMuU3lzdGVtQ2xvY2tPZmZzZXQsXG4gICAgICBLZXlUaW1lOiBLZXlUaW1lLFxuICAgICAgRm9yY2VTaWduSG9zdDogZm9yY2VTaWduSG9zdFxuICAgIH0pO1xuICAgIHZhciBBdXRoRGF0YSA9IHtcbiAgICAgIEF1dGhvcml6YXRpb246IEF1dGhvcml6YXRpb24sXG4gICAgICBTZWN1cml0eVRva2VuOiBTdHNEYXRhLlNlY3VyaXR5VG9rZW4gfHwgU3RzRGF0YS5YQ29zU2VjdXJpdHlUb2tlbiB8fCAnJyxcbiAgICAgIFRva2VuOiBTdHNEYXRhLlRva2VuIHx8ICcnLFxuICAgICAgQ2xpZW50SVA6IFN0c0RhdGEuQ2xpZW50SVAgfHwgJycsXG4gICAgICBDbGllbnRVQTogU3RzRGF0YS5DbGllbnRVQSB8fCAnJ1xuICAgIH07XG4gICAgY2IobnVsbCwgQXV0aERhdGEpO1xuICB9O1xuXG4gIHZhciBjaGVja0F1dGhFcnJvciA9IGZ1bmN0aW9uIGNoZWNrQXV0aEVycm9yKEF1dGhEYXRhKSB7XG4gICAgaWYgKEF1dGhEYXRhLkF1dGhvcml6YXRpb24pIHtcbiAgICAgIC8vIOajgOafpeetvuWQjeagvOW8j1xuICAgICAgdmFyIGZvcm1hdEFsbG93ID0gZmFsc2U7XG4gICAgICB2YXIgYXV0aCA9IEF1dGhEYXRhLkF1dGhvcml6YXRpb247XG5cbiAgICAgIGlmIChhdXRoKSB7XG4gICAgICAgIGlmIChhdXRoLmluZGV4T2YoJyAnKSA+IC0xKSB7XG4gICAgICAgICAgZm9ybWF0QWxsb3cgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIGlmIChhdXRoLmluZGV4T2YoJ3Etc2lnbi1hbGdvcml0aG09JykgPiAtMSAmJiBhdXRoLmluZGV4T2YoJ3EtYWs9JykgPiAtMSAmJiBhdXRoLmluZGV4T2YoJ3Etc2lnbi10aW1lPScpID4gLTEgJiYgYXV0aC5pbmRleE9mKCdxLWtleS10aW1lPScpID4gLTEgJiYgYXV0aC5pbmRleE9mKCdxLXVybC1wYXJhbS1saXN0PScpID4gLTEpIHtcbiAgICAgICAgICBmb3JtYXRBbGxvdyA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF1dGggPSBhdG9iKGF1dGgpO1xuXG4gICAgICAgICAgICBpZiAoYXV0aC5pbmRleE9mKCdhPScpID4gLTEgJiYgYXV0aC5pbmRleE9mKCdrPScpID4gLTEgJiYgYXV0aC5pbmRleE9mKCd0PScpID4gLTEgJiYgYXV0aC5pbmRleE9mKCdyPScpID4gLTEgJiYgYXV0aC5pbmRleE9mKCdiPScpID4gLTEpIHtcbiAgICAgICAgICAgICAgZm9ybWF0QWxsb3cgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKCFmb3JtYXRBbGxvdykgcmV0dXJuIHV0aWwuZXJyb3IobmV3IEVycm9yKCdnZXRBdXRob3JpemF0aW9uIGNhbGxiYWNrIHBhcmFtcyBmb3JtYXQgZXJyb3InKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghQXV0aERhdGEuVG1wU2VjcmV0SWQpIHJldHVybiB1dGlsLmVycm9yKG5ldyBFcnJvcignZ2V0QXV0aG9yaXphdGlvbiBjYWxsYmFjayBwYXJhbXMgbWlzc2luZyBcIlRtcFNlY3JldElkXCInKSk7XG4gICAgICBpZiAoIUF1dGhEYXRhLlRtcFNlY3JldEtleSkgcmV0dXJuIHV0aWwuZXJyb3IobmV3IEVycm9yKCdnZXRBdXRob3JpemF0aW9uIGNhbGxiYWNrIHBhcmFtcyBtaXNzaW5nIFwiVG1wU2VjcmV0S2V5XCInKSk7XG4gICAgICBpZiAoIUF1dGhEYXRhLlNlY3VyaXR5VG9rZW4gJiYgIUF1dGhEYXRhLlhDb3NTZWN1cml0eVRva2VuKSByZXR1cm4gdXRpbC5lcnJvcihuZXcgRXJyb3IoJ2dldEF1dGhvcml6YXRpb24gY2FsbGJhY2sgcGFyYW1zIG1pc3NpbmcgXCJTZWN1cml0eVRva2VuXCInKSk7XG4gICAgICBpZiAoIUF1dGhEYXRhLkV4cGlyZWRUaW1lKSByZXR1cm4gdXRpbC5lcnJvcihuZXcgRXJyb3IoJ2dldEF1dGhvcml6YXRpb24gY2FsbGJhY2sgcGFyYW1zIG1pc3NpbmcgXCJFeHBpcmVkVGltZVwiJykpO1xuICAgICAgaWYgKEF1dGhEYXRhLkV4cGlyZWRUaW1lICYmIEF1dGhEYXRhLkV4cGlyZWRUaW1lLnRvU3RyaW5nKCkubGVuZ3RoICE9PSAxMCkgcmV0dXJuIHV0aWwuZXJyb3IobmV3IEVycm9yKCdnZXRBdXRob3JpemF0aW9uIGNhbGxiYWNrIHBhcmFtcyBcIkV4cGlyZWRUaW1lXCIgc2hvdWxkIGJlIDEwIGRpZ2l0cycpKTtcbiAgICAgIGlmIChBdXRoRGF0YS5TdGFydFRpbWUgJiYgQXV0aERhdGEuU3RhcnRUaW1lLnRvU3RyaW5nKCkubGVuZ3RoICE9PSAxMCkgcmV0dXJuIHV0aWwuZXJyb3IobmV3IEVycm9yKCdnZXRBdXRob3JpemF0aW9uIGNhbGxiYWNrIHBhcmFtcyBcIlN0YXJ0VGltZVwiIHNob3VsZCBiZSAxMCBTdGFydFRpbWUnKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9OyAvLyDlhYjliKTmlq3mmK/lkKbmnInkuLTml7blr4bpkqVcblxuXG4gIGlmIChTdHNEYXRhLkV4cGlyZWRUaW1lICYmIFN0c0RhdGEuRXhwaXJlZFRpbWUgLSB1dGlsLmdldFNrZXdUaW1lKHNlbGYub3B0aW9ucy5TeXN0ZW1DbG9ja09mZnNldCkgLyAxMDAwID4gNjApIHtcbiAgICAvLyDlpoLmnpznvJPlrZjnmoTkuLTml7blr4bpkqXmnInmlYjvvIzlubbov5jmnInotoXov4c2MOenkuacieaViOacn+WwseebtOaOpeS9v+eUqFxuICAgIGNhbGNBdXRoQnlUbXBLZXkoKTtcbiAgfSBlbHNlIGlmIChzZWxmLm9wdGlvbnMuZ2V0QXV0aG9yaXphdGlvbikge1xuICAgIC8vIOWklumDqOiuoeeul+etvuWQjeaIluiOt+WPluS4tOaXtuWvhumSpVxuICAgIHNlbGYub3B0aW9ucy5nZXRBdXRob3JpemF0aW9uLmNhbGwoc2VsZiwge1xuICAgICAgQnVja2V0OiBCdWNrZXQsXG4gICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgIE1ldGhvZDogcGFyYW1zLk1ldGhvZCxcbiAgICAgIEtleTogS2V5TmFtZSxcbiAgICAgIFBhdGhuYW1lOiBQYXRobmFtZSxcbiAgICAgIFF1ZXJ5OiBwYXJhbXMuUXVlcnksXG4gICAgICBIZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgU2NvcGU6IFNjb3BlLFxuICAgICAgU3lzdGVtQ2xvY2tPZmZzZXQ6IHNlbGYub3B0aW9ucy5TeXN0ZW1DbG9ja09mZnNldCxcbiAgICAgIEZvcmNlU2lnbkhvc3Q6IGZvcmNlU2lnbkhvc3RcbiAgICB9LCBmdW5jdGlvbiAoQXV0aERhdGEpIHtcbiAgICAgIGlmICh0eXBlb2YgQXV0aERhdGEgPT09ICdzdHJpbmcnKSBBdXRoRGF0YSA9IHtcbiAgICAgICAgQXV0aG9yaXphdGlvbjogQXV0aERhdGFcbiAgICAgIH07XG4gICAgICB2YXIgQXV0aEVycm9yID0gY2hlY2tBdXRoRXJyb3IoQXV0aERhdGEpO1xuICAgICAgaWYgKEF1dGhFcnJvcikgcmV0dXJuIGNiKEF1dGhFcnJvcik7XG5cbiAgICAgIGlmIChBdXRoRGF0YS5BdXRob3JpemF0aW9uKSB7XG4gICAgICAgIGNiKG51bGwsIEF1dGhEYXRhKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIFN0c0RhdGEgPSBBdXRoRGF0YSB8fCB7fTtcbiAgICAgICAgU3RzRGF0YS5TY29wZSA9IFNjb3BlO1xuICAgICAgICBTdHNEYXRhLlNjb3BlS2V5ID0gU2NvcGVLZXk7XG5cbiAgICAgICAgc2VsZi5fU3RzQ2FjaGUucHVzaChTdHNEYXRhKTtcblxuICAgICAgICBjYWxjQXV0aEJ5VG1wS2V5KCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0gZWxzZSBpZiAoc2VsZi5vcHRpb25zLmdldFNUUykge1xuICAgIC8vIOWklumDqOiOt+WPluS4tOaXtuWvhumSpVxuICAgIHNlbGYub3B0aW9ucy5nZXRTVFMuY2FsbChzZWxmLCB7XG4gICAgICBCdWNrZXQ6IEJ1Y2tldCxcbiAgICAgIFJlZ2lvbjogUmVnaW9uXG4gICAgfSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgIFN0c0RhdGEgPSBkYXRhIHx8IHt9O1xuICAgICAgU3RzRGF0YS5TY29wZSA9IFNjb3BlO1xuICAgICAgU3RzRGF0YS5TY29wZUtleSA9IFNjb3BlS2V5O1xuICAgICAgaWYgKCFTdHNEYXRhLlRtcFNlY3JldElkKSBTdHNEYXRhLlRtcFNlY3JldElkID0gU3RzRGF0YS5TZWNyZXRJZDtcbiAgICAgIGlmICghU3RzRGF0YS5UbXBTZWNyZXRLZXkpIFN0c0RhdGEuVG1wU2VjcmV0S2V5ID0gU3RzRGF0YS5TZWNyZXRLZXk7XG4gICAgICB2YXIgQXV0aEVycm9yID0gY2hlY2tBdXRoRXJyb3IoU3RzRGF0YSk7XG4gICAgICBpZiAoQXV0aEVycm9yKSByZXR1cm4gY2IoQXV0aEVycm9yKTtcblxuICAgICAgc2VsZi5fU3RzQ2FjaGUucHVzaChTdHNEYXRhKTtcblxuICAgICAgY2FsY0F1dGhCeVRtcEtleSgpO1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIC8vIOWGhemDqOiuoeeul+iOt+WPluetvuWQjVxuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgQXV0aG9yaXphdGlvbiA9IHV0aWwuZ2V0QXV0aCh7XG4gICAgICAgIFNlY3JldElkOiBwYXJhbXMuU2VjcmV0SWQgfHwgc2VsZi5vcHRpb25zLlNlY3JldElkLFxuICAgICAgICBTZWNyZXRLZXk6IHBhcmFtcy5TZWNyZXRLZXkgfHwgc2VsZi5vcHRpb25zLlNlY3JldEtleSxcbiAgICAgICAgTWV0aG9kOiBwYXJhbXMuTWV0aG9kLFxuICAgICAgICBQYXRobmFtZTogUGF0aG5hbWUsXG4gICAgICAgIFF1ZXJ5OiBwYXJhbXMuUXVlcnksXG4gICAgICAgIEhlYWRlcnM6IGhlYWRlcnMsXG4gICAgICAgIEV4cGlyZXM6IHBhcmFtcy5FeHBpcmVzLFxuICAgICAgICBVc2VSYXdLZXk6IHNlbGYub3B0aW9ucy5Vc2VSYXdLZXksXG4gICAgICAgIFN5c3RlbUNsb2NrT2Zmc2V0OiBzZWxmLm9wdGlvbnMuU3lzdGVtQ2xvY2tPZmZzZXQsXG4gICAgICAgIEZvcmNlU2lnbkhvc3Q6IGZvcmNlU2lnbkhvc3RcbiAgICAgIH0pO1xuICAgICAgdmFyIEF1dGhEYXRhID0ge1xuICAgICAgICBBdXRob3JpemF0aW9uOiBBdXRob3JpemF0aW9uLFxuICAgICAgICBTZWN1cml0eVRva2VuOiBzZWxmLm9wdGlvbnMuU2VjdXJpdHlUb2tlbiB8fCBzZWxmLm9wdGlvbnMuWENvc1NlY3VyaXR5VG9rZW5cbiAgICAgIH07XG4gICAgICBjYihudWxsLCBBdXRoRGF0YSk7XG4gICAgICByZXR1cm4gQXV0aERhdGE7XG4gICAgfSgpO1xuICB9XG5cbiAgcmV0dXJuICcnO1xufSAvLyDosIPmlbTml7bpl7TlgY/lt65cblxuXG5mdW5jdGlvbiBhbGxvd1JldHJ5KGVycikge1xuICB2YXIgYWxsb3dSZXRyeSA9IGZhbHNlO1xuICB2YXIgaXNUaW1lRXJyb3IgPSBmYWxzZTtcbiAgdmFyIHNlcnZlckRhdGUgPSBlcnIuaGVhZGVycyAmJiAoZXJyLmhlYWRlcnMuZGF0ZSB8fCBlcnIuaGVhZGVycy5EYXRlKSB8fCBlcnIuZXJyb3IgJiYgZXJyLmVycm9yLlNlcnZlclRpbWU7XG5cbiAgdHJ5IHtcbiAgICB2YXIgZXJyb3JDb2RlID0gZXJyLmVycm9yLkNvZGU7XG4gICAgdmFyIGVycm9yTWVzc2FnZSA9IGVyci5lcnJvci5NZXNzYWdlO1xuXG4gICAgaWYgKGVycm9yQ29kZSA9PT0gJ1JlcXVlc3RUaW1lVG9vU2tld2VkJyB8fCBlcnJvckNvZGUgPT09ICdBY2Nlc3NEZW5pZWQnICYmIGVycm9yTWVzc2FnZSA9PT0gJ1JlcXVlc3QgaGFzIGV4cGlyZWQnKSB7XG4gICAgICBpc1RpbWVFcnJvciA9IHRydWU7XG4gICAgfVxuICB9IGNhdGNoIChlKSB7fVxuXG4gIGlmIChlcnIpIHtcbiAgICBpZiAoaXNUaW1lRXJyb3IgJiYgc2VydmVyRGF0ZSkge1xuICAgICAgdmFyIHNlcnZlclRpbWUgPSBEYXRlLnBhcnNlKHNlcnZlckRhdGUpO1xuXG4gICAgICBpZiAodGhpcy5vcHRpb25zLkNvcnJlY3RDbG9ja1NrZXcgJiYgTWF0aC5hYnModXRpbC5nZXRTa2V3VGltZSh0aGlzLm9wdGlvbnMuU3lzdGVtQ2xvY2tPZmZzZXQpIC0gc2VydmVyVGltZSkgPj0gMzAwMDApIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignZXJyb3I6IExvY2FsIHRpbWUgaXMgdG9vIHNrZXdlZC4nKTtcbiAgICAgICAgdGhpcy5vcHRpb25zLlN5c3RlbUNsb2NrT2Zmc2V0ID0gc2VydmVyVGltZSAtIERhdGUubm93KCk7XG4gICAgICAgIGFsbG93UmV0cnkgPSB0cnVlO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoTWF0aC5mbG9vcihlcnIuc3RhdHVzQ29kZSAvIDEwMCkgPT09IDUpIHtcbiAgICAgIGFsbG93UmV0cnkgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBhbGxvd1JldHJ5O1xufSAvLyDojrflj5bnrb7lkI3lubblj5Hotbfor7fmsYJcblxuXG5mdW5jdGlvbiBzdWJtaXRSZXF1ZXN0KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIHNlbGYgPSB0aGlzOyAvLyDlpITnkIYgaGVhZGVyc1xuXG4gICFwYXJhbXMuaGVhZGVycyAmJiAocGFyYW1zLmhlYWRlcnMgPSB7fSk7IC8vIOWkhOeQhiBxdWVyeVxuXG4gICFwYXJhbXMucXMgJiYgKHBhcmFtcy5xcyA9IHt9KTtcbiAgcGFyYW1zLlZlcnNpb25JZCAmJiAocGFyYW1zLnFzLnZlcnNpb25JZCA9IHBhcmFtcy5WZXJzaW9uSWQpO1xuICBwYXJhbXMucXMgPSB1dGlsLmNsZWFyS2V5KHBhcmFtcy5xcyk7IC8vIOa4heeQhiB1bmRlZmluZWQg5ZKMIG51bGwg5a2X5q61XG5cbiAgcGFyYW1zLmhlYWRlcnMgJiYgKHBhcmFtcy5oZWFkZXJzID0gdXRpbC5jbGVhcktleShwYXJhbXMuaGVhZGVycykpO1xuICBwYXJhbXMucXMgJiYgKHBhcmFtcy5xcyA9IHV0aWwuY2xlYXJLZXkocGFyYW1zLnFzKSk7XG4gIHZhciBRdWVyeSA9IHV0aWwuY2xvbmUocGFyYW1zLnFzKTtcbiAgcGFyYW1zLmFjdGlvbiAmJiAoUXVlcnlbcGFyYW1zLmFjdGlvbl0gPSAnJyk7XG4gIHZhciBwYXJhbXNVcmwgPSBwYXJhbXMudXJsIHx8IHBhcmFtcy5Vcmw7XG4gIHZhciBTaWduSG9zdCA9IHBhcmFtcy5TaWduSG9zdCB8fCBnZXRTaWduSG9zdC5jYWxsKHRoaXMsIHtcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIFVybDogcGFyYW1zVXJsXG4gIH0pO1xuICB2YXIgdHJhY2tlciA9IHBhcmFtcy50cmFja2VyO1xuXG4gIHZhciBuZXh0ID0gZnVuY3Rpb24gbmV4dCh0cnlUaW1lcykge1xuICAgIHZhciBvbGRDbG9ja09mZnNldCA9IHNlbGYub3B0aW9ucy5TeXN0ZW1DbG9ja09mZnNldDtcbiAgICB0cmFja2VyICYmIHRyYWNrZXIuc2V0UGFyYW1zKHtcbiAgICAgIHNpZ25TdGFydFRpbWU6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgICAgcmV0cnlUaW1lczogdHJ5VGltZXMgLSAxXG4gICAgfSk7XG4gICAgZ2V0QXV0aG9yaXphdGlvbkFzeW5jLmNhbGwoc2VsZiwge1xuICAgICAgQnVja2V0OiBwYXJhbXMuQnVja2V0IHx8ICcnLFxuICAgICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uIHx8ICcnLFxuICAgICAgTWV0aG9kOiBwYXJhbXMubWV0aG9kLFxuICAgICAgS2V5OiBwYXJhbXMuS2V5LFxuICAgICAgUXVlcnk6IFF1ZXJ5LFxuICAgICAgSGVhZGVyczogcGFyYW1zLmhlYWRlcnMsXG4gICAgICBTaWduSG9zdDogU2lnbkhvc3QsXG4gICAgICBBY3Rpb246IHBhcmFtcy5BY3Rpb24sXG4gICAgICBSZXNvdXJjZUtleTogcGFyYW1zLlJlc291cmNlS2V5LFxuICAgICAgU2NvcGU6IHBhcmFtcy5TY29wZSxcbiAgICAgIEZvcmNlU2lnbkhvc3Q6IHNlbGYub3B0aW9ucy5Gb3JjZVNpZ25Ib3N0XG4gICAgfSwgZnVuY3Rpb24gKGVyciwgQXV0aERhdGEpIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0cmFja2VyICYmIHRyYWNrZXIuc2V0UGFyYW1zKHtcbiAgICAgICAgc2lnbkVuZFRpbWU6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgICAgICBodHRwU3RhcnRUaW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuICAgICAgfSk7XG4gICAgICBwYXJhbXMuQXV0aERhdGEgPSBBdXRoRGF0YTtcblxuICAgICAgX3N1Ym1pdFJlcXVlc3QuY2FsbChzZWxmLCBwYXJhbXMsIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICAgICAgdHJhY2tlciAmJiB0cmFja2VyLnNldFBhcmFtcyh7XG4gICAgICAgICAgaHR0cEVuZFRpbWU6IG5ldyBEYXRlKCkuZ2V0VGltZSgpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChlcnIgJiYgdHJ5VGltZXMgPCAyICYmIChvbGRDbG9ja09mZnNldCAhPT0gc2VsZi5vcHRpb25zLlN5c3RlbUNsb2NrT2Zmc2V0IHx8IGFsbG93UmV0cnkuY2FsbChzZWxmLCBlcnIpKSkge1xuICAgICAgICAgIGlmIChwYXJhbXMuaGVhZGVycykge1xuICAgICAgICAgICAgZGVsZXRlIHBhcmFtcy5oZWFkZXJzLkF1dGhvcml6YXRpb247XG4gICAgICAgICAgICBkZWxldGUgcGFyYW1zLmhlYWRlcnNbJ3Rva2VuJ107XG4gICAgICAgICAgICBkZWxldGUgcGFyYW1zLmhlYWRlcnNbJ2NsaWVudElQJ107XG4gICAgICAgICAgICBkZWxldGUgcGFyYW1zLmhlYWRlcnNbJ2NsaWVudFVBJ107XG4gICAgICAgICAgICBwYXJhbXMuaGVhZGVyc1sneC1jb3Mtc2VjdXJpdHktdG9rZW4nXSAmJiBkZWxldGUgcGFyYW1zLmhlYWRlcnNbJ3gtY29zLXNlY3VyaXR5LXRva2VuJ107XG4gICAgICAgICAgICBwYXJhbXMuaGVhZGVyc1sneC1jaS1zZWN1cml0eS10b2tlbiddICYmIGRlbGV0ZSBwYXJhbXMuaGVhZGVyc1sneC1jaS1zZWN1cml0eS10b2tlbiddO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIG5leHQodHJ5VGltZXMgKyAxKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjYWxsYmFjayhlcnIsIGRhdGEpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICBuZXh0KDEpO1xufSAvLyDlj5Hotbfor7fmsYJcblxuXG5mdW5jdGlvbiBfc3VibWl0UmVxdWVzdChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIFRhc2tJZCA9IHBhcmFtcy5UYXNrSWQ7XG4gIGlmIChUYXNrSWQgJiYgIXNlbGYuX2lzUnVubmluZ1Rhc2soVGFza0lkKSkgcmV0dXJuO1xuICB2YXIgYnVja2V0ID0gcGFyYW1zLkJ1Y2tldDtcbiAgdmFyIHJlZ2lvbiA9IHBhcmFtcy5SZWdpb247XG4gIHZhciBvYmplY3QgPSBwYXJhbXMuS2V5O1xuICB2YXIgbWV0aG9kID0gcGFyYW1zLm1ldGhvZCB8fCAnR0VUJztcbiAgdmFyIHVybCA9IHBhcmFtcy5VcmwgfHwgcGFyYW1zLnVybDtcbiAgdmFyIGJvZHkgPSBwYXJhbXMuYm9keTtcbiAgdmFyIHJhd0JvZHkgPSBwYXJhbXMucmF3Qm9keTsgLy8gdXJsXG5cbiAgaWYgKHNlbGYub3B0aW9ucy5Vc2VBY2NlbGVyYXRlKSB7XG4gICAgcmVnaW9uID0gJ2FjY2VsZXJhdGUnO1xuICB9XG5cbiAgdXJsID0gdXJsIHx8IGdldFVybCh7XG4gICAgRm9yY2VQYXRoU3R5bGU6IHNlbGYub3B0aW9ucy5Gb3JjZVBhdGhTdHlsZSxcbiAgICBwcm90b2NvbDogc2VsZi5vcHRpb25zLlByb3RvY29sLFxuICAgIGRvbWFpbjogc2VsZi5vcHRpb25zLkRvbWFpbixcbiAgICBidWNrZXQ6IGJ1Y2tldCxcbiAgICByZWdpb246IHJlZ2lvbixcbiAgICBvYmplY3Q6IG9iamVjdFxuICB9KTtcblxuICBpZiAocGFyYW1zLmFjdGlvbikge1xuICAgIHVybCA9IHVybCArICc/JyArIHBhcmFtcy5hY3Rpb247XG4gIH1cblxuICBpZiAocGFyYW1zLnFzU3RyKSB7XG4gICAgaWYgKHVybC5pbmRleE9mKCc/JykgPiAtMSkge1xuICAgICAgdXJsID0gdXJsICsgJyYnICsgcGFyYW1zLnFzU3RyO1xuICAgIH0gZWxzZSB7XG4gICAgICB1cmwgPSB1cmwgKyAnPycgKyBwYXJhbXMucXNTdHI7XG4gICAgfVxuICB9XG5cbiAgdmFyIG9wdCA9IHtcbiAgICBtZXRob2Q6IG1ldGhvZCxcbiAgICB1cmw6IHVybCxcbiAgICBoZWFkZXJzOiBwYXJhbXMuaGVhZGVycyxcbiAgICBxczogcGFyYW1zLnFzLFxuICAgIGJvZHk6IGJvZHlcbiAgfTsgLy8g5YW85a65Y2nmjqXlj6NcblxuICB2YXIgdG9rZW4gPSAneC1jb3Mtc2VjdXJpdHktdG9rZW4nO1xuXG4gIGlmICh1dGlsLmlzQ0lIb3N0KHVybCkpIHtcbiAgICB0b2tlbiA9ICd4LWNpLXNlY3VyaXR5LXRva2VuJztcbiAgfSAvLyDojrflj5bnrb7lkI1cblxuXG4gIG9wdC5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSBwYXJhbXMuQXV0aERhdGEuQXV0aG9yaXphdGlvbjtcbiAgcGFyYW1zLkF1dGhEYXRhLlRva2VuICYmIChvcHQuaGVhZGVyc1sndG9rZW4nXSA9IHBhcmFtcy5BdXRoRGF0YS5Ub2tlbik7XG4gIHBhcmFtcy5BdXRoRGF0YS5DbGllbnRJUCAmJiAob3B0LmhlYWRlcnNbJ2NsaWVudElQJ10gPSBwYXJhbXMuQXV0aERhdGEuQ2xpZW50SVApO1xuICBwYXJhbXMuQXV0aERhdGEuQ2xpZW50VUEgJiYgKG9wdC5oZWFkZXJzWydjbGllbnRVQSddID0gcGFyYW1zLkF1dGhEYXRhLkNsaWVudFVBKTtcbiAgcGFyYW1zLkF1dGhEYXRhLlNlY3VyaXR5VG9rZW4gJiYgKG9wdC5oZWFkZXJzW3Rva2VuXSA9IHBhcmFtcy5BdXRoRGF0YS5TZWN1cml0eVRva2VuKTsgLy8g5riF55CGIHVuZGVmaW5lZCDlkowgbnVsbCDlrZfmrrVcblxuICBvcHQuaGVhZGVycyAmJiAob3B0LmhlYWRlcnMgPSB1dGlsLmNsZWFyS2V5KG9wdC5oZWFkZXJzKSk7XG4gIG9wdCA9IHV0aWwuY2xlYXJLZXkob3B0KTsgLy8gcHJvZ3Jlc3NcblxuICBpZiAocGFyYW1zLm9uUHJvZ3Jlc3MgJiYgdHlwZW9mIHBhcmFtcy5vblByb2dyZXNzID09PSAnZnVuY3Rpb24nKSB7XG4gICAgdmFyIGNvbnRlbnRMZW5ndGggPSBib2R5ICYmIChib2R5LnNpemUgfHwgYm9keS5sZW5ndGgpIHx8IDA7XG5cbiAgICBvcHQub25Qcm9ncmVzcyA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoVGFza0lkICYmICFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcbiAgICAgIHZhciBsb2FkZWQgPSBlID8gZS5sb2FkZWQgOiAwO1xuICAgICAgcGFyYW1zLm9uUHJvZ3Jlc3Moe1xuICAgICAgICBsb2FkZWQ6IGxvYWRlZCxcbiAgICAgICAgdG90YWw6IGNvbnRlbnRMZW5ndGhcbiAgICAgIH0pO1xuICAgIH07XG4gIH1cblxuICBpZiAocGFyYW1zLm9uRG93bmxvYWRQcm9ncmVzcykge1xuICAgIG9wdC5vbkRvd25sb2FkUHJvZ3Jlc3MgPSBwYXJhbXMub25Eb3dubG9hZFByb2dyZXNzO1xuICB9XG5cbiAgaWYgKHBhcmFtcy5EYXRhVHlwZSkge1xuICAgIG9wdC5kYXRhVHlwZSA9IHBhcmFtcy5EYXRhVHlwZTtcbiAgfVxuXG4gIGlmICh0aGlzLm9wdGlvbnMuVGltZW91dCkge1xuICAgIG9wdC50aW1lb3V0ID0gdGhpcy5vcHRpb25zLlRpbWVvdXQ7XG4gIH1cblxuICBzZWxmLm9wdGlvbnMuRm9yY2VQYXRoU3R5bGUgJiYgKG9wdC5wYXRoU3R5bGUgPSBzZWxmLm9wdGlvbnMuRm9yY2VQYXRoU3R5bGUpO1xuICBzZWxmLmVtaXQoJ2JlZm9yZS1zZW5kJywgb3B0KTtcbiAgdmFyIHVzZUFjY2VsZXJhdGUgPSBvcHQudXJsLmluY2x1ZGVzKCdhY2NlbGVyYXRlLicpO1xuICB2YXIgcXVlcnlTdHJpbmcgPSBPYmplY3Qua2V5cyhvcHQucXMpLm1hcChmdW5jdGlvbiAoa2V5KSB7XG4gICAgcmV0dXJuIFwiXCIuY29uY2F0KGtleSwgXCI9XCIpLmNvbmNhdChvcHQucXNba2V5XSk7XG4gIH0pLmpvaW4oJyYnKTtcbiAgdmFyIGZ1bGxVcmwgPSBxdWVyeVN0cmluZyA/IG9wdC51cmwgKyAnPycgKyBxdWVyeVN0cmluZyA6IG9wdC51cmw7XG4gIHBhcmFtcy50cmFja2VyICYmIHBhcmFtcy50cmFja2VyLnNldFBhcmFtcyh7XG4gICAgcmVxVXJsOiBmdWxsVXJsLFxuICAgIGFjY2VsZXJhdGU6IHVzZUFjY2VsZXJhdGUgPyAnWScgOiAnTidcbiAgfSk7IC8vIOWIhuWdl+S4iuS8oOaXtue7meeItue6p3RyYWNrZXLorr7nva51cmzkv6Hmga9cblxuICBwYXJhbXMudHJhY2tlciAmJiBwYXJhbXMudHJhY2tlci5wYXJlbnQgJiYgcGFyYW1zLnRyYWNrZXIucGFyZW50LnNldFBhcmFtcyh7XG4gICAgcmVxVXJsOiBmdWxsVXJsLFxuICAgIGFjY2VsZXJhdGU6IHVzZUFjY2VsZXJhdGUgPyAnWScgOiAnTidcbiAgfSk7XG4gIHZhciBzZW5kZXIgPSAoc2VsZi5vcHRpb25zLlJlcXVlc3QgfHwgUkVRVUVTVCkob3B0LCBmdW5jdGlvbiAocikge1xuICAgIGlmIChyLmVycm9yID09PSAnYWJvcnQnKSByZXR1cm47XG4gICAgdmFyIHJlY2VpdmUgPSB7XG4gICAgICBvcHRpb25zOiBvcHQsXG4gICAgICBlcnJvcjogZXJyLFxuICAgICAgc3RhdHVzQ29kZTogcmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzQ29kZSB8fCAwLFxuICAgICAgaGVhZGVyczogcmVzcG9uc2UgJiYgcmVzcG9uc2UuaGVhZGVycyB8fCB7fSxcbiAgICAgIGJvZHk6IGJvZHlcbiAgICB9O1xuICAgIHNlbGYuZW1pdCgnYWZ0ZXItcmVjZWl2ZScsIHJlY2VpdmUpO1xuICAgIGVyciA9IHJlY2VpdmUuZXJyb3I7XG4gICAgYm9keSA9IHJlY2VpdmUuYm9keTtcbiAgICByZXNwb25zZSA9IHtcbiAgICAgIHN0YXR1c0NvZGU6IHJlY2VpdmUuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IHJlY2VpdmUuaGVhZGVyc1xuICAgIH07IC8vIOaKm+WHuuS6i+S7tu+8jOWFgeiuuOS/ruaUuei/lOWbnuWAvOeahCBlcnJvcuOAgXN0YXR1c0NvZGXjgIFzdGF0dXNNZXNzYWdl44CBYm9keVxuXG4gICAgc2VsZi5lbWl0KCdhZnRlci1yZWNlaXZlJywgcik7XG4gICAgdmFyIHJlc3BvbnNlID0ge1xuICAgICAgc3RhdHVzQ29kZTogci5zdGF0dXNDb2RlLFxuICAgICAgc3RhdHVzTWVzc2FnZTogci5zdGF0dXNNZXNzYWdlLFxuICAgICAgaGVhZGVyczogci5oZWFkZXJzXG4gICAgfTtcbiAgICB2YXIgZXJyID0gci5lcnJvcjtcbiAgICB2YXIgYm9keSA9IHIuYm9keTsgLy8g6L+U5Zue5YaF5a655re75YqgIOeKtuaAgeeggSDlkowgaGVhZGVyc1xuXG4gICAgdmFyIGhhc1JldHVybmVkO1xuXG4gICAgdmFyIGNiID0gZnVuY3Rpb24gY2IoZXJyLCBkYXRhKSB7XG4gICAgICBUYXNrSWQgJiYgc2VsZi5vZmYoJ2lubmVyLWtpbGwtdGFzaycsIGtpbGxUYXNrKTtcbiAgICAgIGlmIChoYXNSZXR1cm5lZCkgcmV0dXJuO1xuICAgICAgaGFzUmV0dXJuZWQgPSB0cnVlO1xuICAgICAgdmFyIGF0dHJzID0ge307XG4gICAgICByZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXNDb2RlICYmIChhdHRycy5zdGF0dXNDb2RlID0gcmVzcG9uc2Uuc3RhdHVzQ29kZSk7XG4gICAgICByZXNwb25zZSAmJiByZXNwb25zZS5oZWFkZXJzICYmIChhdHRycy5oZWFkZXJzID0gcmVzcG9uc2UuaGVhZGVycyk7XG5cbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgZXJyID0gdXRpbC5leHRlbmQoZXJyIHx8IHt9LCBhdHRycyk7XG4gICAgICAgIGNhbGxiYWNrKGVyciwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkYXRhID0gdXRpbC5leHRlbmQoZGF0YSB8fCB7fSwgYXR0cnMpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCBkYXRhKTtcbiAgICAgIH1cblxuICAgICAgc2VuZGVyID0gbnVsbDtcbiAgICB9OyAvLyDor7fmsYLplJnor6/vvIzlj5HnlJ/nvZHnu5zplJnor69cblxuXG4gICAgaWYgKGVycikgcmV0dXJuIGNiKHV0aWwuZXJyb3IoZXJyKSk7IC8vIOivt+axgui/lOWbnueggeS4jeS4uiAyMDBcblxuICAgIHZhciBzdGF0dXNDb2RlID0gcmVzcG9uc2Uuc3RhdHVzQ29kZTtcbiAgICB2YXIgc3RhdHVzU3VjY2VzcyA9IE1hdGguZmxvb3Ioc3RhdHVzQ29kZSAvIDEwMCkgPT09IDI7IC8vIDIwMCAyMDIgMjA0IDIwNlxuICAgIC8vIOS4jeWvuSBib2R5IOi/m+ihjOi9rOaNou+8jGJvZHkg55u05o6l5oyC6L296L+U5ZueXG5cbiAgICBpZiAocmF3Qm9keSAmJiBzdGF0dXNTdWNjZXNzKSByZXR1cm4gY2IobnVsbCwge1xuICAgICAgYm9keTogYm9keVxuICAgIH0pOyAvLyDop6PmnpAgeG1sIGJvZHlcblxuICAgIHZhciBqc29uO1xuXG4gICAgdHJ5IHtcbiAgICAgIGpzb24gPSBib2R5ICYmIGJvZHkuaW5kZXhPZignPCcpID4gLTEgJiYgYm9keS5pbmRleE9mKCc+JykgPiAtMSAmJiB1dGlsLnhtbDJqc29uKGJvZHkpIHx8IHt9O1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGpzb24gPSB7fTtcbiAgICB9IC8vIOWkhOeQhui/lOWbnuWAvFxuXG5cbiAgICB2YXIgeG1sRXJyb3IgPSBqc29uICYmIGpzb24uRXJyb3I7XG5cbiAgICBpZiAoc3RhdHVzU3VjY2Vzcykge1xuICAgICAgLy8g5q2j56Gu6L+U5Zue77yM54q25oCB56CBIDJ4eCDml7bvvIxib2R5IOS4jeS8muaciSBFcnJvclxuICAgICAgY2IobnVsbCwganNvbik7XG4gICAgfSBlbHNlIGlmICh4bWxFcnJvcikge1xuICAgICAgLy8g5q2j5bi46L+U5Zue5LqGIHhtbCBib2R577yM5LiU5pyJIEVycm9yIOiKgueCuVxuICAgICAgY2IodXRpbC5lcnJvcihuZXcgRXJyb3IoeG1sRXJyb3IuTWVzc2FnZSksIHtcbiAgICAgICAgY29kZTogeG1sRXJyb3IuQ29kZSxcbiAgICAgICAgZXJyb3I6IHhtbEVycm9yXG4gICAgICB9KSk7XG4gICAgfSBlbHNlIGlmIChzdGF0dXNDb2RlKSB7XG4gICAgICAvLyDmnInplJnor6/nmoTnirbmgIHnoIFcbiAgICAgIGNiKHV0aWwuZXJyb3IobmV3IEVycm9yKHJlc3BvbnNlLnN0YXR1c01lc3NhZ2UpLCB7XG4gICAgICAgIGNvZGU6ICcnICsgc3RhdHVzQ29kZVxuICAgICAgfSkpO1xuICAgIH0gZWxzZSBpZiAoc3RhdHVzQ29kZSkge1xuICAgICAgLy8g5peg54q25oCB56CB77yM5oiW6ICF6I635Y+W5LiN5Yiw54q25oCB56CBXG4gICAgICBjYih1dGlsLmVycm9yKG5ldyBFcnJvcignc3RhdHVzQ29kZSBlcnJvcicpKSk7XG4gICAgfVxuICB9KTsgLy8ga2lsbCB0YXNrXG5cbiAgdmFyIGtpbGxUYXNrID0gZnVuY3Rpb24ga2lsbFRhc2soZGF0YSkge1xuICAgIGlmIChkYXRhLlRhc2tJZCA9PT0gVGFza0lkKSB7XG4gICAgICBzZW5kZXIgJiYgc2VuZGVyLmFib3J0ICYmIHNlbmRlci5hYm9ydCgpO1xuICAgICAgc2VsZi5vZmYoJ2lubmVyLWtpbGwtdGFzaycsIGtpbGxUYXNrKTtcbiAgICB9XG4gIH07XG5cbiAgVGFza0lkICYmIHNlbGYub24oJ2lubmVyLWtpbGwtdGFzaycsIGtpbGxUYXNrKTtcbn1cblxudmFyIEFQSV9NQVAgPSB7XG4gIC8vIEJ1Y2tldCDnm7jlhbPmlrnms5VcbiAgZ2V0U2VydmljZTogZ2V0U2VydmljZSxcbiAgLy8gQnVja2V0XG4gIHB1dEJ1Y2tldDogcHV0QnVja2V0LFxuICBoZWFkQnVja2V0OiBoZWFkQnVja2V0LFxuICAvLyBCdWNrZXRcbiAgZ2V0QnVja2V0OiBnZXRCdWNrZXQsXG4gIGRlbGV0ZUJ1Y2tldDogZGVsZXRlQnVja2V0LFxuICBwdXRCdWNrZXRBY2w6IHB1dEJ1Y2tldEFjbCxcbiAgLy8gQnVja2V0QUNMXG4gIGdldEJ1Y2tldEFjbDogZ2V0QnVja2V0QWNsLFxuICBwdXRCdWNrZXRDb3JzOiBwdXRCdWNrZXRDb3JzLFxuICAvLyBCdWNrZXRDb3JzXG4gIGdldEJ1Y2tldENvcnM6IGdldEJ1Y2tldENvcnMsXG4gIGRlbGV0ZUJ1Y2tldENvcnM6IGRlbGV0ZUJ1Y2tldENvcnMsXG4gIGdldEJ1Y2tldExvY2F0aW9uOiBnZXRCdWNrZXRMb2NhdGlvbixcbiAgLy8gQnVja2V0TG9jYXRpb25cbiAgZ2V0QnVja2V0UG9saWN5OiBnZXRCdWNrZXRQb2xpY3ksXG4gIC8vIEJ1Y2tldFBvbGljeVxuICBwdXRCdWNrZXRQb2xpY3k6IHB1dEJ1Y2tldFBvbGljeSxcbiAgZGVsZXRlQnVja2V0UG9saWN5OiBkZWxldGVCdWNrZXRQb2xpY3ksXG4gIHB1dEJ1Y2tldFRhZ2dpbmc6IHB1dEJ1Y2tldFRhZ2dpbmcsXG4gIC8vIEJ1Y2tldFRhZ2dpbmdcbiAgZ2V0QnVja2V0VGFnZ2luZzogZ2V0QnVja2V0VGFnZ2luZyxcbiAgZGVsZXRlQnVja2V0VGFnZ2luZzogZGVsZXRlQnVja2V0VGFnZ2luZyxcbiAgcHV0QnVja2V0TGlmZWN5Y2xlOiBwdXRCdWNrZXRMaWZlY3ljbGUsXG4gIC8vIEJ1Y2tldExpZmVjeWNsZVxuICBnZXRCdWNrZXRMaWZlY3ljbGU6IGdldEJ1Y2tldExpZmVjeWNsZSxcbiAgZGVsZXRlQnVja2V0TGlmZWN5Y2xlOiBkZWxldGVCdWNrZXRMaWZlY3ljbGUsXG4gIHB1dEJ1Y2tldFZlcnNpb25pbmc6IHB1dEJ1Y2tldFZlcnNpb25pbmcsXG4gIC8vIEJ1Y2tldFZlcnNpb25pbmdcbiAgZ2V0QnVja2V0VmVyc2lvbmluZzogZ2V0QnVja2V0VmVyc2lvbmluZyxcbiAgcHV0QnVja2V0UmVwbGljYXRpb246IHB1dEJ1Y2tldFJlcGxpY2F0aW9uLFxuICAvLyBCdWNrZXRSZXBsaWNhdGlvblxuICBnZXRCdWNrZXRSZXBsaWNhdGlvbjogZ2V0QnVja2V0UmVwbGljYXRpb24sXG4gIGRlbGV0ZUJ1Y2tldFJlcGxpY2F0aW9uOiBkZWxldGVCdWNrZXRSZXBsaWNhdGlvbixcbiAgcHV0QnVja2V0V2Vic2l0ZTogcHV0QnVja2V0V2Vic2l0ZSxcbiAgLy8gQnVja2V0V2Vic2l0ZVxuICBnZXRCdWNrZXRXZWJzaXRlOiBnZXRCdWNrZXRXZWJzaXRlLFxuICBkZWxldGVCdWNrZXRXZWJzaXRlOiBkZWxldGVCdWNrZXRXZWJzaXRlLFxuICBwdXRCdWNrZXRSZWZlcmVyOiBwdXRCdWNrZXRSZWZlcmVyLFxuICAvLyBCdWNrZXRSZWZlcmVyXG4gIGdldEJ1Y2tldFJlZmVyZXI6IGdldEJ1Y2tldFJlZmVyZXIsXG4gIHB1dEJ1Y2tldERvbWFpbjogcHV0QnVja2V0RG9tYWluLFxuICAvLyBCdWNrZXREb21haW5cbiAgZ2V0QnVja2V0RG9tYWluOiBnZXRCdWNrZXREb21haW4sXG4gIGRlbGV0ZUJ1Y2tldERvbWFpbjogZGVsZXRlQnVja2V0RG9tYWluLFxuICBwdXRCdWNrZXRPcmlnaW46IHB1dEJ1Y2tldE9yaWdpbixcbiAgLy8gQnVja2V0T3JpZ2luXG4gIGdldEJ1Y2tldE9yaWdpbjogZ2V0QnVja2V0T3JpZ2luLFxuICBkZWxldGVCdWNrZXRPcmlnaW46IGRlbGV0ZUJ1Y2tldE9yaWdpbixcbiAgcHV0QnVja2V0TG9nZ2luZzogcHV0QnVja2V0TG9nZ2luZyxcbiAgLy8gQnVja2V0TG9nZ2luZ1xuICBnZXRCdWNrZXRMb2dnaW5nOiBnZXRCdWNrZXRMb2dnaW5nLFxuICBwdXRCdWNrZXRJbnZlbnRvcnk6IHB1dEJ1Y2tldEludmVudG9yeSxcbiAgLy8gQnVja2V0SW52ZW50b3J5XG4gIGdldEJ1Y2tldEludmVudG9yeTogZ2V0QnVja2V0SW52ZW50b3J5LFxuICBsaXN0QnVja2V0SW52ZW50b3J5OiBsaXN0QnVja2V0SW52ZW50b3J5LFxuICBkZWxldGVCdWNrZXRJbnZlbnRvcnk6IGRlbGV0ZUJ1Y2tldEludmVudG9yeSxcbiAgcHV0QnVja2V0QWNjZWxlcmF0ZTogcHV0QnVja2V0QWNjZWxlcmF0ZSxcbiAgZ2V0QnVja2V0QWNjZWxlcmF0ZTogZ2V0QnVja2V0QWNjZWxlcmF0ZSxcbiAgcHV0QnVja2V0RW5jcnlwdGlvbjogcHV0QnVja2V0RW5jcnlwdGlvbixcbiAgZ2V0QnVja2V0RW5jcnlwdGlvbjogZ2V0QnVja2V0RW5jcnlwdGlvbixcbiAgZGVsZXRlQnVja2V0RW5jcnlwdGlvbjogZGVsZXRlQnVja2V0RW5jcnlwdGlvbixcbiAgLy8gT2JqZWN0IOebuOWFs+aWueazlVxuICBnZXRPYmplY3Q6IGdldE9iamVjdCxcbiAgaGVhZE9iamVjdDogaGVhZE9iamVjdCxcbiAgbGlzdE9iamVjdFZlcnNpb25zOiBsaXN0T2JqZWN0VmVyc2lvbnMsXG4gIHB1dE9iamVjdDogcHV0T2JqZWN0LFxuICBkZWxldGVPYmplY3Q6IGRlbGV0ZU9iamVjdCxcbiAgZ2V0T2JqZWN0QWNsOiBnZXRPYmplY3RBY2wsXG4gIHB1dE9iamVjdEFjbDogcHV0T2JqZWN0QWNsLFxuICBvcHRpb25zT2JqZWN0OiBvcHRpb25zT2JqZWN0LFxuICBwdXRPYmplY3RDb3B5OiBwdXRPYmplY3RDb3B5LFxuICBkZWxldGVNdWx0aXBsZU9iamVjdDogZGVsZXRlTXVsdGlwbGVPYmplY3QsXG4gIHJlc3RvcmVPYmplY3Q6IHJlc3RvcmVPYmplY3QsXG4gIHB1dE9iamVjdFRhZ2dpbmc6IHB1dE9iamVjdFRhZ2dpbmcsXG4gIGdldE9iamVjdFRhZ2dpbmc6IGdldE9iamVjdFRhZ2dpbmcsXG4gIGRlbGV0ZU9iamVjdFRhZ2dpbmc6IGRlbGV0ZU9iamVjdFRhZ2dpbmcsXG4gIHNlbGVjdE9iamVjdENvbnRlbnQ6IHNlbGVjdE9iamVjdENvbnRlbnQsXG4gIGFwcGVuZE9iamVjdDogYXBwZW5kT2JqZWN0LFxuICAvLyDliIblnZfkuIrkvKDnm7jlhbPmlrnms5VcbiAgdXBsb2FkUGFydENvcHk6IHVwbG9hZFBhcnRDb3B5LFxuICBtdWx0aXBhcnRJbml0OiBtdWx0aXBhcnRJbml0LFxuICBtdWx0aXBhcnRVcGxvYWQ6IG11bHRpcGFydFVwbG9hZCxcbiAgbXVsdGlwYXJ0Q29tcGxldGU6IG11bHRpcGFydENvbXBsZXRlLFxuICBtdWx0aXBhcnRMaXN0OiBtdWx0aXBhcnRMaXN0LFxuICBtdWx0aXBhcnRMaXN0UGFydDogbXVsdGlwYXJ0TGlzdFBhcnQsXG4gIG11bHRpcGFydEFib3J0OiBtdWx0aXBhcnRBYm9ydCxcbiAgLy8g5bel5YW35pa55rOVXG4gIHJlcXVlc3Q6IHJlcXVlc3QsXG4gIGdldE9iamVjdFVybDogZ2V0T2JqZWN0VXJsLFxuICBnZXRBdXRoOiBnZXRBdXRoXG59O1xuXG5mdW5jdGlvbiB3YXJuT2xkQXBpKGFwaU5hbWUsIGZuLCBwcm90bykge1xuICB1dGlsLmVhY2goWydDb3JzJywgJ0FjbCddLCBmdW5jdGlvbiAoc3VmZml4KSB7XG4gICAgaWYgKGFwaU5hbWUuc2xpY2UoLXN1ZmZpeC5sZW5ndGgpID09PSBzdWZmaXgpIHtcbiAgICAgIHZhciBvbGROYW1lID0gYXBpTmFtZS5zbGljZSgwLCAtc3VmZml4Lmxlbmd0aCkgKyBzdWZmaXgudG9VcHBlckNhc2UoKTtcbiAgICAgIHZhciBhcGlGbiA9IHV0aWwuYXBpV3JhcHBlcihhcGlOYW1lLCBmbik7XG4gICAgICB2YXIgd2FybmVkID0gZmFsc2U7XG5cbiAgICAgIHByb3RvW29sZE5hbWVdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAhd2FybmVkICYmIGNvbnNvbGUud2Fybignd2FybmluZzogY29zLicgKyBvbGROYW1lICsgJyBoYXMgYmVlbiBkZXByZWNhdGVkLiBQbGVhc2UgVXNlIGNvcy4nICsgYXBpTmFtZSArICcgaW5zdGVhZC4nKTtcbiAgICAgICAgd2FybmVkID0gdHJ1ZTtcbiAgICAgICAgYXBpRm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfVxuICB9KTtcbn1cblxubW9kdWxlLmV4cG9ydHMuaW5pdCA9IGZ1bmN0aW9uIChDT1MsIHRhc2spIHtcbiAgdGFzay50cmFuc2ZlclRvVGFza01ldGhvZChBUElfTUFQLCAncHV0T2JqZWN0Jyk7XG4gIHV0aWwuZWFjaChBUElfTUFQLCBmdW5jdGlvbiAoZm4sIGFwaU5hbWUpIHtcbiAgICBDT1MucHJvdG90eXBlW2FwaU5hbWVdID0gdXRpbC5hcGlXcmFwcGVyKGFwaU5hbWUsIGZuKTtcbiAgICB3YXJuT2xkQXBpKGFwaU5hbWUsIGZuLCBDT1MucHJvdG90eXBlKTtcbiAgfSk7XG59OyIsIid1c2Ugc3RyaWN0JztcblxudmFyIHV0aWwgPSByZXF1aXJlKCcuL3V0aWwnKTtcblxudmFyIGV2ZW50ID0gcmVxdWlyZSgnLi9ldmVudCcpO1xuXG52YXIgdGFzayA9IHJlcXVpcmUoJy4vdGFzaycpO1xuXG52YXIgYmFzZSA9IHJlcXVpcmUoJy4vYmFzZScpO1xuXG52YXIgYWR2YW5jZSA9IHJlcXVpcmUoJy4vYWR2YW5jZScpO1xuXG52YXIgcGtnID0gcmVxdWlyZSgnLi4vcGFja2FnZS5qc29uJyk7XG5cbnZhciBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgQXBwSWQ6ICcnLFxuICAvLyBBcHBJZCDlt7Llup/lvIPvvIzor7fmi7zmjqXliLAgQnVja2V0IOWQjuS8oOWFpe+8jOS+i+Wmgu+8mnRlc3QtMTI1MDAwMDAwMFxuICBTZWNyZXRJZDogJycsXG4gIFNlY3JldEtleTogJycsXG4gIFNlY3VyaXR5VG9rZW46ICcnLFxuICAvLyDkvb/nlKjkuLTml7blr4bpkqXpnIDopoHms6jmhI/oh6rooYzliLfmlrAgVG9rZW5cbiAgQ2h1bmtSZXRyeVRpbWVzOiAyLFxuICBGaWxlUGFyYWxsZWxMaW1pdDogMyxcbiAgQ2h1bmtQYXJhbGxlbExpbWl0OiAzLFxuICBDaHVua1NpemU6IDEwMjQgKiAxMDI0LFxuICBTbGljZVNpemU6IDEwMjQgKiAxMDI0LFxuICBDb3B5Q2h1bmtQYXJhbGxlbExpbWl0OiAyMCxcbiAgQ29weUNodW5rU2l6ZTogMTAyNCAqIDEwMjQgKiAxMCxcbiAgQ29weVNsaWNlU2l6ZTogMTAyNCAqIDEwMjQgKiAxMCxcbiAgTWF4UGFydE51bWJlcjogMTAwMDAsXG4gIFByb2dyZXNzSW50ZXJ2YWw6IDEwMDAsXG4gIERvbWFpbjogJycsXG4gIFNlcnZpY2VEb21haW46ICcnLFxuICBQcm90b2NvbDogJycsXG4gIENvbXBhdGliaWxpdHlNb2RlOiBmYWxzZSxcbiAgRm9yY2VQYXRoU3R5bGU6IGZhbHNlLFxuICBVc2VSYXdLZXk6IGZhbHNlLFxuICBUaW1lb3V0OiAwLFxuICAvLyDljZXkvY3mr6vnp5LvvIwwIOS7o+ihqOS4jeiuvue9rui2heaXtuaXtumXtFxuICBDb3JyZWN0Q2xvY2tTa2V3OiB0cnVlLFxuICBTeXN0ZW1DbG9ja09mZnNldDogMCxcbiAgLy8g5Y2V5L2N5q+r56eS77yMbXNcbiAgVXBsb2FkQ2hlY2tDb250ZW50TWQ1OiBmYWxzZSxcbiAgVXBsb2FkUXVldWVTaXplOiAxMDAwMCxcbiAgVXBsb2FkQWRkTWV0YU1kNTogZmFsc2UsXG4gIFVwbG9hZElkQ2FjaGVMaW1pdDogNTAsXG4gIFVzZUFjY2VsZXJhdGU6IGZhbHNlLFxuICBGb3JjZVNpZ25Ib3N0OiB0cnVlLFxuICAvLyDpu5jorqTlsIZob3N05Yqg5YWl562+5ZCN6K6h566X77yM5YWz6Zet5ZCO5Y+v6IO95a+86Ie06LaK5p2D6aOO6Zmp77yM5bu66K6u5L+d5oyB5Li6dHJ1ZVxuICBFbmFibGVUcmFja2VyOiBmYWxzZSxcbiAgLy8g6buY6K6k5YWz6Zet5LiK5oqlXG4gIERlZXBUcmFja2VyOiBmYWxzZSxcbiAgLy8g5LiK5oql5pe25piv5ZCm5a+55q+P5Liq5YiG5Z2X5LiK5Lyg5YGa5Y2V54us5LiK5oqlXG4gIFRyYWNrZXJEZWxheTogNTAwMCxcbiAgLy8g5ZGo5pyf5oCn5LiK5oql77yM5Y2V5L2N5q+r56eS44CCMOS7o+ihqOWunuaXtuS4iuaKpVxuICBDdXN0b21JZDogJycgLy8g6Ieq5a6a5LmJ5LiK5oqlaWRcblxufTsgLy8g5a+55aSW5pq06Zyy55qE57G7XG5cbnZhciBDT1MgPSBmdW5jdGlvbiBDT1Mob3B0aW9ucykge1xuICB0aGlzLm9wdGlvbnMgPSB1dGlsLmV4dGVuZCh1dGlsLmNsb25lKGRlZmF1bHRPcHRpb25zKSwgb3B0aW9ucyB8fCB7fSk7XG4gIHRoaXMub3B0aW9ucy5GaWxlUGFyYWxsZWxMaW1pdCA9IE1hdGgubWF4KDEsIHRoaXMub3B0aW9ucy5GaWxlUGFyYWxsZWxMaW1pdCk7XG4gIHRoaXMub3B0aW9ucy5DaHVua1BhcmFsbGVsTGltaXQgPSBNYXRoLm1heCgxLCB0aGlzLm9wdGlvbnMuQ2h1bmtQYXJhbGxlbExpbWl0KTtcbiAgdGhpcy5vcHRpb25zLkNodW5rUmV0cnlUaW1lcyA9IE1hdGgubWF4KDAsIHRoaXMub3B0aW9ucy5DaHVua1JldHJ5VGltZXMpO1xuICB0aGlzLm9wdGlvbnMuQ2h1bmtTaXplID0gTWF0aC5tYXgoMTAyNCAqIDEwMjQsIHRoaXMub3B0aW9ucy5DaHVua1NpemUpO1xuICB0aGlzLm9wdGlvbnMuQ29weUNodW5rUGFyYWxsZWxMaW1pdCA9IE1hdGgubWF4KDEsIHRoaXMub3B0aW9ucy5Db3B5Q2h1bmtQYXJhbGxlbExpbWl0KTtcbiAgdGhpcy5vcHRpb25zLkNvcHlDaHVua1NpemUgPSBNYXRoLm1heCgxMDI0ICogMTAyNCwgdGhpcy5vcHRpb25zLkNvcHlDaHVua1NpemUpO1xuICB0aGlzLm9wdGlvbnMuQ29weVNsaWNlU2l6ZSA9IE1hdGgubWF4KDAsIHRoaXMub3B0aW9ucy5Db3B5U2xpY2VTaXplKTtcbiAgdGhpcy5vcHRpb25zLk1heFBhcnROdW1iZXIgPSBNYXRoLm1heCgxMDI0LCBNYXRoLm1pbigxMDAwMCwgdGhpcy5vcHRpb25zLk1heFBhcnROdW1iZXIpKTtcbiAgdGhpcy5vcHRpb25zLlRpbWVvdXQgPSBNYXRoLm1heCgwLCB0aGlzLm9wdGlvbnMuVGltZW91dCk7XG5cbiAgaWYgKHRoaXMub3B0aW9ucy5BcHBJZCkge1xuICAgIGNvbnNvbGUud2Fybignd2FybmluZzogQXBwSWQgaGFzIGJlZW4gZGVwcmVjYXRlZCwgUGxlYXNlIHB1dCBpdCBhdCB0aGUgZW5kIG9mIHBhcmFtZXRlciBCdWNrZXQoRS5nOiBcInRlc3QtMTI1MDAwMDAwMFwiKS4nKTtcbiAgfVxuXG4gIGlmICh0aGlzLm9wdGlvbnMuU2VjcmV0SWQgJiYgdGhpcy5vcHRpb25zLlNlY3JldElkLmluZGV4T2YoJyAnKSA+IC0xKSB7XG4gICAgY29uc29sZS5lcnJvcignZXJyb3I6IFNlY3JldElk5qC85byP6ZSZ6K+v77yM6K+35qOA5p+lJyk7XG4gICAgY29uc29sZS5lcnJvcignZXJyb3I6IFNlY3JldElkIGZvcm1hdCBpcyBpbmNvcnJlY3QuIFBsZWFzZSBjaGVjaycpO1xuICB9XG5cbiAgaWYgKHRoaXMub3B0aW9ucy5TZWNyZXRLZXkgJiYgdGhpcy5vcHRpb25zLlNlY3JldEtleS5pbmRleE9mKCcgJykgPiAtMSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ2Vycm9yOiBTZWNyZXRLZXnmoLzlvI/plJnor6/vvIzor7fmo4Dmn6UnKTtcbiAgICBjb25zb2xlLmVycm9yKCdlcnJvcjogU2VjcmV0S2V5IGZvcm1hdCBpcyBpbmNvcnJlY3QuIFBsZWFzZSBjaGVjaycpO1xuICB9XG5cbiAgaWYgKHV0aWwuaXNOb2RlKCkpIHtcbiAgICBjb25zb2xlLndhcm4oJ3dhcm5pbmc6IGNvcy1qcy1zZGstdjUg5LiN5pSv5oyBIG5vZGVqcyDnjq/looPkvb/nlKjvvIzor7fmlLnnlKggY29zLW5vZGVqcy1zZGstdjXvvIzlj4LogIPmlofmoaPvvJogaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi84NjI5Jyk7XG4gICAgY29uc29sZS53YXJuKCd3YXJuaW5nOiBjb3MtanMtc2RrLXY1IGRvZXMgbm90IHN1cHBvcnQgbm9kZWpzIGVudmlyb25tZW50LiBQbGVhc2UgdXNlIGNvcy1ub2RlanMtc2RrLXY1IGluc3RlYWQuIFNlZTogaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi84NjI5Jyk7XG4gIH1cblxuICBldmVudC5pbml0KHRoaXMpO1xuICB0YXNrLmluaXQodGhpcyk7XG59O1xuXG5iYXNlLmluaXQoQ09TLCB0YXNrKTtcbmFkdmFuY2UuaW5pdChDT1MsIHRhc2spO1xuQ09TLnV0aWwgPSB7XG4gIG1kNTogdXRpbC5tZDUsXG4gIHhtbDJqc29uOiB1dGlsLnhtbDJqc29uLFxuICBqc29uMnhtbDogdXRpbC5qc29uMnhtbFxufTtcbkNPUy5nZXRBdXRob3JpemF0aW9uID0gdXRpbC5nZXRBdXRoO1xuQ09TLnZlcnNpb24gPSBwa2cudmVyc2lvbjtcbm1vZHVsZS5leHBvcnRzID0gQ09TOyIsInZhciBpbml0RXZlbnQgPSBmdW5jdGlvbiBpbml0RXZlbnQoY29zKSB7XG4gIHZhciBsaXN0ZW5lcnMgPSB7fTtcblxuICB2YXIgZ2V0TGlzdCA9IGZ1bmN0aW9uIGdldExpc3QoYWN0aW9uKSB7XG4gICAgIWxpc3RlbmVyc1thY3Rpb25dICYmIChsaXN0ZW5lcnNbYWN0aW9uXSA9IFtdKTtcbiAgICByZXR1cm4gbGlzdGVuZXJzW2FjdGlvbl07XG4gIH07XG5cbiAgY29zLm9uID0gZnVuY3Rpb24gKGFjdGlvbiwgY2FsbGJhY2spIHtcbiAgICBpZiAoYWN0aW9uID09PSAndGFzay1saXN0LXVwZGF0ZScpIHtcbiAgICAgIGNvbnNvbGUud2Fybignd2FybmluZzogRXZlbnQgXCInICsgYWN0aW9uICsgJ1wiIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgXCJsaXN0LXVwZGF0ZVwiIGluc3RlYWQuJyk7XG4gICAgfVxuXG4gICAgZ2V0TGlzdChhY3Rpb24pLnB1c2goY2FsbGJhY2spO1xuICB9O1xuXG4gIGNvcy5vZmYgPSBmdW5jdGlvbiAoYWN0aW9uLCBjYWxsYmFjaykge1xuICAgIHZhciBsaXN0ID0gZ2V0TGlzdChhY3Rpb24pO1xuXG4gICAgZm9yICh2YXIgaSA9IGxpc3QubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIGNhbGxiYWNrID09PSBsaXN0W2ldICYmIGxpc3Quc3BsaWNlKGksIDEpO1xuICAgIH1cbiAgfTtcblxuICBjb3MuZW1pdCA9IGZ1bmN0aW9uIChhY3Rpb24sIGRhdGEpIHtcbiAgICB2YXIgbGlzdCA9IGdldExpc3QoYWN0aW9uKS5tYXAoZnVuY3Rpb24gKGNiKSB7XG4gICAgICByZXR1cm4gY2I7XG4gICAgfSk7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxpc3RbaV0oZGF0YSk7XG4gICAgfVxuICB9O1xufTtcblxudmFyIEV2ZW50UHJveHkgPSBmdW5jdGlvbiBFdmVudFByb3h5KCkge1xuICBpbml0RXZlbnQodGhpcyk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cy5pbml0ID0gaW5pdEV2ZW50O1xubW9kdWxlLmV4cG9ydHMuRXZlbnRQcm94eSA9IEV2ZW50UHJveHk7IiwidmFyIHV0aWwgPSByZXF1aXJlKCcuL3V0aWwnKTsgLy8g5oyJ54Wn5paH5Lu254m55b6B5YC877yM57yT5a2YIFVwbG9hZElkXG5cblxudmFyIGNhY2hlS2V5ID0gJ2Nvc19zZGtfdXBsb2FkX2NhY2hlJztcbnZhciBleHBpcmVzID0gMzAgKiAyNCAqIDM2MDA7XG52YXIgY2FjaGU7XG52YXIgdGltZXI7XG5cbnZhciBnZXRDYWNoZSA9IGZ1bmN0aW9uIGdldENhY2hlKCkge1xuICB0cnkge1xuICAgIHZhciB2YWwgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKGNhY2hlS2V5KSk7XG4gIH0gY2F0Y2ggKGUpIHt9XG5cbiAgaWYgKCF2YWwpIHZhbCA9IFtdO1xuICBjYWNoZSA9IHZhbDtcbn07XG5cbnZhciBzZXRDYWNoZSA9IGZ1bmN0aW9uIHNldENhY2hlKCkge1xuICB0cnkge1xuICAgIGlmIChjYWNoZS5sZW5ndGgpIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGNhY2hlS2V5LCBKU09OLnN0cmluZ2lmeShjYWNoZSkpO2Vsc2UgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oY2FjaGVLZXkpO1xuICB9IGNhdGNoIChlKSB7fVxufTtcblxudmFyIGluaXQgPSBmdW5jdGlvbiBpbml0KCkge1xuICBpZiAoY2FjaGUpIHJldHVybjtcbiAgZ2V0Q2FjaGUuY2FsbCh0aGlzKTsgLy8g5riF55CG5aSq6ICB5pen55qE5pWw5o2uXG5cbiAgdmFyIGNoYW5nZWQgPSBmYWxzZTtcbiAgdmFyIG5vdyA9IE1hdGgucm91bmQoRGF0ZS5ub3coKSAvIDEwMDApO1xuXG4gIGZvciAodmFyIGkgPSBjYWNoZS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgIHZhciBtdGltZSA9IGNhY2hlW2ldWzJdO1xuXG4gICAgaWYgKCFtdGltZSB8fCBtdGltZSArIGV4cGlyZXMgPCBub3cpIHtcbiAgICAgIGNhY2hlLnNwbGljZShpLCAxKTtcbiAgICAgIGNoYW5nZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIGNoYW5nZWQgJiYgc2V0Q2FjaGUoKTtcbn07IC8vIOaKiue8k+WtmOWtmOWIsOacrOWcsFxuXG5cbnZhciBzYXZlID0gZnVuY3Rpb24gc2F2ZSgpIHtcbiAgaWYgKHRpbWVyKSByZXR1cm47XG4gIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgc2V0Q2FjaGUoKTtcbiAgICB0aW1lciA9IG51bGw7XG4gIH0sIDQwMCk7XG59O1xuXG52YXIgbW9kID0ge1xuICB1c2luZzoge30sXG4gIC8vIOagh+iusCBVcGxvYWRJZCDmraPlnKjkvb/nlKhcbiAgc2V0VXNpbmc6IGZ1bmN0aW9uIHNldFVzaW5nKHV1aWQpIHtcbiAgICBtb2QudXNpbmdbdXVpZF0gPSB0cnVlO1xuICB9LFxuICAvLyDmoIforrAgVXBsb2FkSWQg5bey57uP5rKh5Zyo5L2/55SoXG4gIHJlbW92ZVVzaW5nOiBmdW5jdGlvbiByZW1vdmVVc2luZyh1dWlkKSB7XG4gICAgZGVsZXRlIG1vZC51c2luZ1t1dWlkXTtcbiAgfSxcbiAgLy8g55So5LiK5Lyg5Y+C5pWw55Sf5oiQ5ZOI5biM5YC8XG4gIGdldEZpbGVJZDogZnVuY3Rpb24gZ2V0RmlsZUlkKGZpbGUsIENodW5rU2l6ZSwgQnVja2V0LCBLZXkpIHtcbiAgICBpZiAoZmlsZS5uYW1lICYmIGZpbGUuc2l6ZSAmJiBmaWxlLmxhc3RNb2RpZmllZERhdGUgJiYgQ2h1bmtTaXplKSB7XG4gICAgICByZXR1cm4gdXRpbC5tZDUoW2ZpbGUubmFtZSwgZmlsZS5zaXplLCBmaWxlLmxhc3RNb2RpZmllZERhdGUsIENodW5rU2l6ZSwgQnVja2V0LCBLZXldLmpvaW4oJzo6JykpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH0sXG4gIC8vIOeUqOS4iuS8oOWPguaVsOeUn+aIkOWTiOW4jOWAvFxuICBnZXRDb3B5RmlsZUlkOiBmdW5jdGlvbiBnZXRDb3B5RmlsZUlkKGNvcHlTb3VyY2UsIHNvdXJjZUhlYWRlcnMsIENodW5rU2l6ZSwgQnVja2V0LCBLZXkpIHtcbiAgICB2YXIgc2l6ZSA9IHNvdXJjZUhlYWRlcnNbJ2NvbnRlbnQtbGVuZ3RoJ107XG4gICAgdmFyIGV0YWcgPSBzb3VyY2VIZWFkZXJzLmV0YWcgfHwgJyc7XG4gICAgdmFyIGxhc3RNb2RpZmllZCA9IHNvdXJjZUhlYWRlcnNbJ2xhc3QtbW9kaWZpZWQnXTtcblxuICAgIGlmIChjb3B5U291cmNlICYmIENodW5rU2l6ZSkge1xuICAgICAgcmV0dXJuIHV0aWwubWQ1KFtjb3B5U291cmNlLCBzaXplLCBldGFnLCBsYXN0TW9kaWZpZWQsIENodW5rU2l6ZSwgQnVja2V0LCBLZXldLmpvaW4oJzo6JykpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH0sXG4gIC8vIOiOt+WPluaWh+S7tuWvueW6lOeahCBVcGxvYWRJZCDliJfooahcbiAgZ2V0VXBsb2FkSWRMaXN0OiBmdW5jdGlvbiBnZXRVcGxvYWRJZExpc3QodXVpZCkge1xuICAgIGlmICghdXVpZCkgcmV0dXJuIG51bGw7XG4gICAgaW5pdC5jYWxsKHRoaXMpO1xuICAgIHZhciBsaXN0ID0gW107XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNhY2hlLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoY2FjaGVbaV1bMF0gPT09IHV1aWQpIGxpc3QucHVzaChjYWNoZVtpXVsxXSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGxpc3QubGVuZ3RoID8gbGlzdCA6IG51bGw7XG4gIH0sXG4gIC8vIOe8k+WtmCBVcGxvYWRJZFxuICBzYXZlVXBsb2FkSWQ6IGZ1bmN0aW9uIHNhdmVVcGxvYWRJZCh1dWlkLCBVcGxvYWRJZCwgbGltaXQpIHtcbiAgICBpbml0LmNhbGwodGhpcyk7XG4gICAgaWYgKCF1dWlkKSByZXR1cm47IC8vIOa4heeQhuayoeeUqOeahCBVcGxvYWRJZO+8jGpzIOaWh+S7tuayoeaciSBGaWxlUGF0aCDvvIzlj6rmuIXnkIbnm7jlkIzorrDlvZVcblxuICAgIGZvciAodmFyIGkgPSBjYWNoZS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgdmFyIGl0ZW0gPSBjYWNoZVtpXTtcblxuICAgICAgaWYgKGl0ZW1bMF0gPT09IHV1aWQgJiYgaXRlbVsxXSA9PT0gVXBsb2FkSWQpIHtcbiAgICAgICAgY2FjaGUuc3BsaWNlKGksIDEpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNhY2hlLnVuc2hpZnQoW3V1aWQsIFVwbG9hZElkLCBNYXRoLnJvdW5kKERhdGUubm93KCkgLyAxMDAwKV0pO1xuICAgIGlmIChjYWNoZS5sZW5ndGggPiBsaW1pdCkgY2FjaGUuc3BsaWNlKGxpbWl0KTtcbiAgICBzYXZlKCk7XG4gIH0sXG4gIC8vIFVwbG9hZElkIOW3sueUqOWujO+8jOenu+mZpOaOiVxuICByZW1vdmVVcGxvYWRJZDogZnVuY3Rpb24gcmVtb3ZlVXBsb2FkSWQoVXBsb2FkSWQpIHtcbiAgICBpbml0LmNhbGwodGhpcyk7XG4gICAgZGVsZXRlIG1vZC51c2luZ1tVcGxvYWRJZF07XG5cbiAgICBmb3IgKHZhciBpID0gY2FjaGUubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIGlmIChjYWNoZVtpXVsxXSA9PT0gVXBsb2FkSWQpIGNhY2hlLnNwbGljZShpLCAxKTtcbiAgICB9XG5cbiAgICBzYXZlKCk7XG4gIH1cbn07XG5tb2R1bGUuZXhwb3J0cyA9IG1vZDsiLCJ2YXIgc2Vzc2lvbiA9IHJlcXVpcmUoJy4vc2Vzc2lvbicpO1xuXG52YXIgdXRpbCA9IHJlcXVpcmUoJy4vdXRpbCcpO1xuXG52YXIgb3JpZ2luQXBpTWFwID0ge307XG5cbnZhciB0cmFuc2ZlclRvVGFza01ldGhvZCA9IGZ1bmN0aW9uIHRyYW5zZmVyVG9UYXNrTWV0aG9kKGFwaU1hcCwgYXBpTmFtZSkge1xuICBvcmlnaW5BcGlNYXBbYXBpTmFtZV0gPSBhcGlNYXBbYXBpTmFtZV07XG5cbiAgYXBpTWFwW2FwaU5hbWVdID0gZnVuY3Rpb24gKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgICBpZiAocGFyYW1zLlNraXBUYXNrKSB7XG4gICAgICBvcmlnaW5BcGlNYXBbYXBpTmFtZV0uY2FsbCh0aGlzLCBwYXJhbXMsIGNhbGxiYWNrKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fYWRkVGFzayhhcGlOYW1lLCBwYXJhbXMsIGNhbGxiYWNrKTtcbiAgICB9XG4gIH07XG59O1xuXG52YXIgaW5pdFRhc2sgPSBmdW5jdGlvbiBpbml0VGFzayhjb3MpIHtcbiAgdmFyIHF1ZXVlID0gW107XG4gIHZhciB0YXNrcyA9IHt9O1xuICB2YXIgdXBsb2FkaW5nRmlsZUNvdW50ID0gMDtcbiAgdmFyIG5leHRVcGxvYWRJbmRleCA9IDA7IC8vIOaOpeWPo+i/lOWbnueugOeVpeeahOS7u+WKoeS/oeaBr1xuXG4gIHZhciBmb3JtYXRUYXNrID0gZnVuY3Rpb24gZm9ybWF0VGFzayh0YXNrKSB7XG4gICAgdmFyIHQgPSB7XG4gICAgICBpZDogdGFzay5pZCxcbiAgICAgIEJ1Y2tldDogdGFzay5CdWNrZXQsXG4gICAgICBSZWdpb246IHRhc2suUmVnaW9uLFxuICAgICAgS2V5OiB0YXNrLktleSxcbiAgICAgIEZpbGVQYXRoOiB0YXNrLkZpbGVQYXRoLFxuICAgICAgc3RhdGU6IHRhc2suc3RhdGUsXG4gICAgICBsb2FkZWQ6IHRhc2subG9hZGVkLFxuICAgICAgc2l6ZTogdGFzay5zaXplLFxuICAgICAgc3BlZWQ6IHRhc2suc3BlZWQsXG4gICAgICBwZXJjZW50OiB0YXNrLnBlcmNlbnQsXG4gICAgICBoYXNoUGVyY2VudDogdGFzay5oYXNoUGVyY2VudCxcbiAgICAgIGVycm9yOiB0YXNrLmVycm9yXG4gICAgfTtcbiAgICBpZiAodGFzay5GaWxlUGF0aCkgdC5GaWxlUGF0aCA9IHRhc2suRmlsZVBhdGg7XG4gICAgaWYgKHRhc2suX2N1c3RvbSkgdC5fY3VzdG9tID0gdGFzay5fY3VzdG9tOyAvLyDmjqfliLblj7Dkvb/nlKhcblxuICAgIHJldHVybiB0O1xuICB9O1xuXG4gIHZhciBlbWl0TGlzdFVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdGltZXI7XG5cbiAgICB2YXIgZW1pdCA9IGZ1bmN0aW9uIGVtaXQoKSB7XG4gICAgICB0aW1lciA9IDA7XG4gICAgICBjb3MuZW1pdCgndGFzay1saXN0LXVwZGF0ZScsIHtcbiAgICAgICAgbGlzdDogdXRpbC5tYXAocXVldWUsIGZvcm1hdFRhc2spXG4gICAgICB9KTtcbiAgICAgIGNvcy5lbWl0KCdsaXN0LXVwZGF0ZScsIHtcbiAgICAgICAgbGlzdDogdXRpbC5tYXAocXVldWUsIGZvcm1hdFRhc2spXG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICghdGltZXIpIHRpbWVyID0gc2V0VGltZW91dChlbWl0KTtcbiAgICB9O1xuICB9KCk7XG5cbiAgdmFyIGNsZWFyUXVldWUgPSBmdW5jdGlvbiBjbGVhclF1ZXVlKCkge1xuICAgIGlmIChxdWV1ZS5sZW5ndGggPD0gY29zLm9wdGlvbnMuVXBsb2FkUXVldWVTaXplKSByZXR1cm47XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5leHRVcGxvYWRJbmRleCAmJiAvLyDlsI/kuo7lvZPliY3mk43kvZznmoQgaW5kZXgg5omN5riF55CGXG4gICAgaSA8IHF1ZXVlLmxlbmd0aCAmJiAvLyDlpKfkuo7pmJ/liJfmiY3muIXnkIZcbiAgICBxdWV1ZS5sZW5ndGggPiBjb3Mub3B0aW9ucy5VcGxvYWRRdWV1ZVNpemUgLy8g5aaC5p6c6L+Y5aSq5aSa77yM5omN57un57ut5riF55CGXG4gICAgOykge1xuICAgICAgdmFyIGlzQWN0aXZlID0gcXVldWVbaV0uc3RhdGUgPT09ICd3YWl0aW5nJyB8fCBxdWV1ZVtpXS5zdGF0ZSA9PT0gJ2NoZWNraW5nJyB8fCBxdWV1ZVtpXS5zdGF0ZSA9PT0gJ3VwbG9hZGluZyc7XG5cbiAgICAgIGlmICghcXVldWVbaV0gfHwgIWlzQWN0aXZlKSB7XG4gICAgICAgIHRhc2tzW3F1ZXVlW2ldLmlkXSAmJiBkZWxldGUgdGFza3NbcXVldWVbaV0uaWRdO1xuICAgICAgICBxdWV1ZS5zcGxpY2UoaSwgMSk7XG4gICAgICAgIG5leHRVcGxvYWRJbmRleC0tO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaSsrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGVtaXRMaXN0VXBkYXRlKCk7XG4gIH07XG5cbiAgdmFyIHN0YXJ0TmV4dFRhc2sgPSBmdW5jdGlvbiBzdGFydE5leHRUYXNrKCkge1xuICAgIC8vIOajgOafpeaYr+WQpuWFgeiuuOWinuWKoOaJp+ihjOi/m+eoi1xuICAgIGlmICh1cGxvYWRpbmdGaWxlQ291bnQgPj0gY29zLm9wdGlvbnMuRmlsZVBhcmFsbGVsTGltaXQpIHJldHVybjsgLy8g6Lez6L+H5LiN5Y+v5omn6KGM55qE5Lu75YqhXG5cbiAgICB3aGlsZSAocXVldWVbbmV4dFVwbG9hZEluZGV4XSAmJiBxdWV1ZVtuZXh0VXBsb2FkSW5kZXhdLnN0YXRlICE9PSAnd2FpdGluZycpIHtcbiAgICAgIG5leHRVcGxvYWRJbmRleCsrO1xuICAgIH0gLy8g5qOA5p+l5piv5ZCm5bey6YGN5Y6G57uT5p2fXG5cblxuICAgIGlmIChuZXh0VXBsb2FkSW5kZXggPj0gcXVldWUubGVuZ3RoKSByZXR1cm47IC8vIOS4iuS8oOivpemBjeWOhuWIsOeahOS7u+WKoVxuXG4gICAgdmFyIHRhc2sgPSBxdWV1ZVtuZXh0VXBsb2FkSW5kZXhdO1xuICAgIG5leHRVcGxvYWRJbmRleCsrO1xuICAgIHVwbG9hZGluZ0ZpbGVDb3VudCsrO1xuICAgIHRhc2suc3RhdGUgPSAnY2hlY2tpbmcnO1xuICAgIHRhc2sucGFyYW1zLm9uVGFza1N0YXJ0ICYmIHRhc2sucGFyYW1zLm9uVGFza1N0YXJ0KGZvcm1hdFRhc2sodGFzaykpO1xuICAgICF0YXNrLnBhcmFtcy5VcGxvYWREYXRhICYmICh0YXNrLnBhcmFtcy5VcGxvYWREYXRhID0ge30pO1xuICAgIHZhciBhcGlQYXJhbXMgPSB1dGlsLmZvcm1hdFBhcmFtcyh0YXNrLmFwaSwgdGFzay5wYXJhbXMpO1xuICAgIG9yaWdpbkFwaU1hcFt0YXNrLmFwaV0uY2FsbChjb3MsIGFwaVBhcmFtcywgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgaWYgKCFjb3MuX2lzUnVubmluZ1Rhc2sodGFzay5pZCkpIHJldHVybjtcblxuICAgICAgaWYgKHRhc2suc3RhdGUgPT09ICdjaGVja2luZycgfHwgdGFzay5zdGF0ZSA9PT0gJ3VwbG9hZGluZycpIHtcbiAgICAgICAgdGFzay5zdGF0ZSA9IGVyciA/ICdlcnJvcicgOiAnc3VjY2Vzcyc7XG4gICAgICAgIGVyciAmJiAodGFzay5lcnJvciA9IGVycik7XG4gICAgICAgIHVwbG9hZGluZ0ZpbGVDb3VudC0tO1xuICAgICAgICBlbWl0TGlzdFVwZGF0ZSgpO1xuICAgICAgICBzdGFydE5leHRUYXNrKCk7XG4gICAgICAgIHRhc2suY2FsbGJhY2sgJiYgdGFzay5jYWxsYmFjayhlcnIsIGRhdGEpO1xuXG4gICAgICAgIGlmICh0YXNrLnN0YXRlID09PSAnc3VjY2VzcycpIHtcbiAgICAgICAgICBpZiAodGFzay5wYXJhbXMpIHtcbiAgICAgICAgICAgIGRlbGV0ZSB0YXNrLnBhcmFtcy5VcGxvYWREYXRhO1xuICAgICAgICAgICAgZGVsZXRlIHRhc2sucGFyYW1zLkJvZHk7XG4gICAgICAgICAgICBkZWxldGUgdGFzay5wYXJhbXM7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZGVsZXRlIHRhc2suY2FsbGJhY2s7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY2xlYXJRdWV1ZSgpO1xuICAgIH0pO1xuICAgIGVtaXRMaXN0VXBkYXRlKCk7IC8vIOW8guatpeaJp+ihjOS4i+S4gOS4quS7u+WKoVxuXG4gICAgc2V0VGltZW91dChzdGFydE5leHRUYXNrKTtcbiAgfTtcblxuICB2YXIga2lsbFRhc2sgPSBmdW5jdGlvbiBraWxsVGFzayhpZCwgc3dpdGNoVG9TdGF0ZSkge1xuICAgIHZhciB0YXNrID0gdGFza3NbaWRdO1xuICAgIGlmICghdGFzaykgcmV0dXJuO1xuICAgIHZhciB3YWl0aW5nID0gdGFzayAmJiB0YXNrLnN0YXRlID09PSAnd2FpdGluZyc7XG4gICAgdmFyIHJ1bm5pbmcgPSB0YXNrICYmICh0YXNrLnN0YXRlID09PSAnY2hlY2tpbmcnIHx8IHRhc2suc3RhdGUgPT09ICd1cGxvYWRpbmcnKTtcblxuICAgIGlmIChzd2l0Y2hUb1N0YXRlID09PSAnY2FuY2VsZWQnICYmIHRhc2suc3RhdGUgIT09ICdjYW5jZWxlZCcgfHwgc3dpdGNoVG9TdGF0ZSA9PT0gJ3BhdXNlZCcgJiYgd2FpdGluZyB8fCBzd2l0Y2hUb1N0YXRlID09PSAncGF1c2VkJyAmJiBydW5uaW5nKSB7XG4gICAgICBpZiAoc3dpdGNoVG9TdGF0ZSA9PT0gJ3BhdXNlZCcgJiYgdGFzay5wYXJhbXMuQm9keSAmJiB0eXBlb2YgdGFzay5wYXJhbXMuQm9keS5waXBlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ3N0cmVhbSBub3Qgc3VwcG9ydCBwYXVzZScpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRhc2suc3RhdGUgPSBzd2l0Y2hUb1N0YXRlO1xuICAgICAgY29zLmVtaXQoJ2lubmVyLWtpbGwtdGFzaycsIHtcbiAgICAgICAgVGFza0lkOiBpZCxcbiAgICAgICAgdG9TdGF0ZTogc3dpdGNoVG9TdGF0ZVxuICAgICAgfSk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciBVcGxvYWRJZCA9IHRhc2sgJiYgdGFzay5wYXJhbXMgJiYgdGFzay5wYXJhbXMuVXBsb2FkRGF0YS5VcGxvYWRJZDtcbiAgICAgIH0gY2F0Y2ggKGUpIHt9XG5cbiAgICAgIGlmIChzd2l0Y2hUb1N0YXRlID09PSAnY2FuY2VsZWQnICYmIFVwbG9hZElkKSBzZXNzaW9uLnJlbW92ZVVzaW5nKFVwbG9hZElkKTtcbiAgICAgIGVtaXRMaXN0VXBkYXRlKCk7XG5cbiAgICAgIGlmIChydW5uaW5nKSB7XG4gICAgICAgIHVwbG9hZGluZ0ZpbGVDb3VudC0tO1xuICAgICAgICBzdGFydE5leHRUYXNrKCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChzd2l0Y2hUb1N0YXRlID09PSAnY2FuY2VsZWQnKSB7XG4gICAgICAgIGlmICh0YXNrLnBhcmFtcykge1xuICAgICAgICAgIGRlbGV0ZSB0YXNrLnBhcmFtcy5VcGxvYWREYXRhO1xuICAgICAgICAgIGRlbGV0ZSB0YXNrLnBhcmFtcy5Cb2R5O1xuICAgICAgICAgIGRlbGV0ZSB0YXNrLnBhcmFtcztcbiAgICAgICAgfVxuXG4gICAgICAgIGRlbGV0ZSB0YXNrLmNhbGxiYWNrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNsZWFyUXVldWUoKTtcbiAgfTtcblxuICBjb3MuX2FkZFRhc2tzID0gZnVuY3Rpb24gKHRhc2tMaXN0KSB7XG4gICAgdXRpbC5lYWNoKHRhc2tMaXN0LCBmdW5jdGlvbiAodGFzaykge1xuICAgICAgY29zLl9hZGRUYXNrKHRhc2suYXBpLCB0YXNrLnBhcmFtcywgdGFzay5jYWxsYmFjaywgdHJ1ZSk7XG4gICAgfSk7XG4gICAgZW1pdExpc3RVcGRhdGUoKTtcbiAgfTtcblxuICB2YXIgaXNUYXNrUmVhZHlXYXJuaW5nID0gdHJ1ZTtcblxuICBjb3MuX2FkZFRhc2sgPSBmdW5jdGlvbiAoYXBpLCBwYXJhbXMsIGNhbGxiYWNrLCBpZ25vcmVBZGRFdmVudCkge1xuICAgIC8vIOWkjeWItuWPguaVsOWvueixoVxuICAgIHBhcmFtcyA9IHV0aWwuZm9ybWF0UGFyYW1zKGFwaSwgcGFyYW1zKTsgLy8g55Sf5oiQIGlkXG5cbiAgICB2YXIgaWQgPSB1dGlsLnV1aWQoKTtcbiAgICBwYXJhbXMuVGFza0lkID0gaWQ7XG4gICAgcGFyYW1zLm9uVGFza1JlYWR5ICYmIHBhcmFtcy5vblRhc2tSZWFkeShpZCk7XG5cbiAgICBpZiAocGFyYW1zLlRhc2tSZWFkeSkge1xuICAgICAgcGFyYW1zLlRhc2tSZWFkeShpZCk7XG4gICAgICBpc1Rhc2tSZWFkeVdhcm5pbmcgJiYgY29uc29sZS53YXJuKCd3YXJuaW5nOiBQYXJhbSBcIlRhc2tSZWFkeVwiIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgXCJvblRhc2tSZWFkeVwiIGluc3RlYWQuJyk7XG4gICAgICBpc1Rhc2tSZWFkeVdhcm5pbmcgPSBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgdGFzayA9IHtcbiAgICAgIC8vIGVudlxuICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgICBjYWxsYmFjazogY2FsbGJhY2ssXG4gICAgICBhcGk6IGFwaSxcbiAgICAgIGluZGV4OiBxdWV1ZS5sZW5ndGgsXG4gICAgICAvLyB0YXNrXG4gICAgICBpZDogaWQsXG4gICAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgICBGaWxlUGF0aDogcGFyYW1zLkZpbGVQYXRoIHx8ICcnLFxuICAgICAgc3RhdGU6ICd3YWl0aW5nJyxcbiAgICAgIGxvYWRlZDogMCxcbiAgICAgIHNpemU6IDAsXG4gICAgICBzcGVlZDogMCxcbiAgICAgIHBlcmNlbnQ6IDAsXG4gICAgICBoYXNoUGVyY2VudDogMCxcbiAgICAgIGVycm9yOiBudWxsLFxuICAgICAgX2N1c3RvbTogcGFyYW1zLl9jdXN0b21cbiAgICB9O1xuICAgIHZhciBvbkhhc2hQcm9ncmVzcyA9IHBhcmFtcy5vbkhhc2hQcm9ncmVzcztcblxuICAgIHBhcmFtcy5vbkhhc2hQcm9ncmVzcyA9IGZ1bmN0aW9uIChpbmZvKSB7XG4gICAgICBpZiAoIWNvcy5faXNSdW5uaW5nVGFzayh0YXNrLmlkKSkgcmV0dXJuO1xuICAgICAgdGFzay5oYXNoUGVyY2VudCA9IGluZm8ucGVyY2VudDtcbiAgICAgIG9uSGFzaFByb2dyZXNzICYmIG9uSGFzaFByb2dyZXNzKGluZm8pO1xuICAgICAgZW1pdExpc3RVcGRhdGUoKTtcbiAgICB9O1xuXG4gICAgdmFyIG9uUHJvZ3Jlc3MgPSBwYXJhbXMub25Qcm9ncmVzcztcblxuICAgIHBhcmFtcy5vblByb2dyZXNzID0gZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgIGlmICghY29zLl9pc1J1bm5pbmdUYXNrKHRhc2suaWQpKSByZXR1cm47XG4gICAgICB0YXNrLnN0YXRlID09PSAnY2hlY2tpbmcnICYmICh0YXNrLnN0YXRlID0gJ3VwbG9hZGluZycpO1xuICAgICAgdGFzay5sb2FkZWQgPSBpbmZvLmxvYWRlZDtcbiAgICAgIHRhc2suc3BlZWQgPSBpbmZvLnNwZWVkO1xuICAgICAgdGFzay5wZXJjZW50ID0gaW5mby5wZXJjZW50O1xuICAgICAgb25Qcm9ncmVzcyAmJiBvblByb2dyZXNzKGluZm8pO1xuICAgICAgZW1pdExpc3RVcGRhdGUoKTtcbiAgICB9OyAvLyDlvILmraXojrflj5YgZmlsZXNpemVcblxuXG4gICAgdXRpbC5nZXRGaWxlU2l6ZShhcGksIHBhcmFtcywgZnVuY3Rpb24gKGVyciwgc2l6ZSkge1xuICAgICAgLy8g5byA5aeL5aSE55CG5LiK5LygXG4gICAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2sodXRpbC5lcnJvcihlcnIpKTsgLy8g5aaC5p6c6I635Y+W5aSn5bCP5Ye66ZSZ77yM5LiN5Yqg5YWl6Zif5YiXXG4gICAgICAvLyDojrflj5blrozmlofku7blpKflsI/lho3miorku7vliqHliqDlhaXpmJ/liJdcblxuICAgICAgdGFza3NbaWRdID0gdGFzaztcbiAgICAgIHF1ZXVlLnB1c2godGFzayk7XG4gICAgICB0YXNrLnNpemUgPSBzaXplO1xuICAgICAgIWlnbm9yZUFkZEV2ZW50ICYmIGVtaXRMaXN0VXBkYXRlKCk7XG4gICAgICBzdGFydE5leHRUYXNrKCk7XG4gICAgICBjbGVhclF1ZXVlKCk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGlkO1xuICB9O1xuXG4gIGNvcy5faXNSdW5uaW5nVGFzayA9IGZ1bmN0aW9uIChpZCkge1xuICAgIHZhciB0YXNrID0gdGFza3NbaWRdO1xuICAgIHJldHVybiAhISh0YXNrICYmICh0YXNrLnN0YXRlID09PSAnY2hlY2tpbmcnIHx8IHRhc2suc3RhdGUgPT09ICd1cGxvYWRpbmcnKSk7XG4gIH07XG5cbiAgY29zLmdldFRhc2tMaXN0ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB1dGlsLm1hcChxdWV1ZSwgZm9ybWF0VGFzayk7XG4gIH07XG5cbiAgY29zLmNhbmNlbFRhc2sgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICBraWxsVGFzayhpZCwgJ2NhbmNlbGVkJyk7XG4gIH07XG5cbiAgY29zLnBhdXNlVGFzayA9IGZ1bmN0aW9uIChpZCkge1xuICAgIGtpbGxUYXNrKGlkLCAncGF1c2VkJyk7XG4gIH07XG5cbiAgY29zLnJlc3RhcnRUYXNrID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgdmFyIHRhc2sgPSB0YXNrc1tpZF07XG5cbiAgICBpZiAodGFzayAmJiAodGFzay5zdGF0ZSA9PT0gJ3BhdXNlZCcgfHwgdGFzay5zdGF0ZSA9PT0gJ2Vycm9yJykpIHtcbiAgICAgIHRhc2suc3RhdGUgPSAnd2FpdGluZyc7XG4gICAgICBlbWl0TGlzdFVwZGF0ZSgpO1xuICAgICAgbmV4dFVwbG9hZEluZGV4ID0gTWF0aC5taW4obmV4dFVwbG9hZEluZGV4LCB0YXNrLmluZGV4KTtcbiAgICAgIHN0YXJ0TmV4dFRhc2soKTtcbiAgICB9XG4gIH07XG5cbiAgY29zLmlzVXBsb2FkUnVubmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdXBsb2FkaW5nRmlsZUNvdW50IHx8IG5leHRVcGxvYWRJbmRleCA8IHF1ZXVlLmxlbmd0aDtcbiAgfTtcbn07XG5cbm1vZHVsZS5leHBvcnRzLnRyYW5zZmVyVG9UYXNrTWV0aG9kID0gdHJhbnNmZXJUb1Rhc2tNZXRob2Q7XG5tb2R1bGUuZXhwb3J0cy5pbml0ID0gaW5pdFRhc2s7IiwidmFyIF9jbGFzc0NhbGxDaGVjayA9IHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrXCIpO1xuXG52YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3NcIik7XG5cbnZhciBfdHlwZW9mID0gcmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mXCIpO1xuXG52YXIgcGtnID0gcmVxdWlyZSgnLi4vcGFja2FnZS5qc29uJyk7XG5cbnZhciBCZWFjb25BY3Rpb24gPSByZXF1aXJlKCcuLi9saWIvYmVhY29uLm1pbicpO1xuXG52YXIgYmVhY29uID0gbnVsbDtcblxudmFyIGdldEJlYWNvbiA9IGZ1bmN0aW9uIGdldEJlYWNvbihkZWxheSkge1xuICBpZiAoIWJlYWNvbikge1xuICAgIGJlYWNvbiA9IG5ldyBCZWFjb25BY3Rpb24oe1xuICAgICAgYXBwa2V5OiBcIjBBTkQwVkVWQjI0VUJHRFVcIixcbiAgICAgIHZlcnNpb25Db2RlOiBwa2cudmVyc2lvbixcbiAgICAgIGNoYW5uZWxJRDogJ2pzX3NkaycsXG4gICAgICAvL+a4oOmBkyzpgInloatcbiAgICAgIG9wZW5pZDogJ29wZW5pZCcsXG4gICAgICAvLyDnlKjmiLdpZCwg6YCJ5aGrXG4gICAgICB1bmlvbmlkOiAndW5pZCcsXG4gICAgICAvL+eUqOaIt3VuaW9uaWQgLCDnsbvkvLxpZGZ2LOmAieWhq1xuICAgICAgc3RyaWN0TW9kZTogZmFsc2UsXG4gICAgICAvL+S4peiLm+aooeW8j+W8gOWFsywg5omT5byA5Lil6Iub5qih5byP5Lya5Li75Yqo5oqb5Ye65byC5bi4LCDkuIrnur/or7fliqHlv4XlhbPpl60hISFcbiAgICAgIGRlbGF5OiBkZWxheSxcbiAgICAgIC8vIOaZrumAmuS6i+S7tuW7tui/n+S4iuaKpeaXtumXtCjljZXkvY3mr6vnp5IpLCDpu5jorqQxMDAwKDHnp5IpLOmAieWhq1xuICAgICAgc2Vzc2lvbkR1cmF0aW9uOiA2MCAqIDEwMDAgLy8gc2Vzc2lvbuWPmOabtOeahOaXtumXtOmXtOmalCwg5LiA5Liq55So5oi35oyB57utMzDliIbpkp8o6buY6K6k5YC8KeayoeacieS7u+S9leS4iuaKpeWImeeul+WPpuS4gOasoSBzZXNzaW9uLOavj+WPmOabtOS4gOasoXNlc3Npb27kuIrmiqXkuIDmrKHlkK/liqjkuovku7YocnFkX2FwcGxhdW5jaGVkKSzkvb/nlKjmr6vnp5IobXMpLOacgOWwj+WAvDMw56eSLOmAieWhq1xuXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gYmVhY29uO1xufTtcblxudmFyIHV0aWxzID0ge1xuICAvLyDnlJ/miJB1aWQg5q+P5Liq6ZO+6Lev5a+55bqU5ZSv5LiA5LiA5p2hdWlkXG4gIGdldFVpZDogZnVuY3Rpb24gZ2V0VWlkKCkge1xuICAgIHZhciBTNCA9IGZ1bmN0aW9uIFM0KCkge1xuICAgICAgcmV0dXJuICgoMSArIE1hdGgucmFuZG9tKCkpICogMHgxMDAwMCB8IDApLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSk7XG4gICAgfTtcblxuICAgIHJldHVybiBTNCgpICsgUzQoKSArIFwiLVwiICsgUzQoKSArIFwiLVwiICsgUzQoKSArIFwiLVwiICsgUzQoKSArIFwiLVwiICsgUzQoKSArIFM0KCkgKyBTNCgpO1xuICB9LFxuICAvLyDojrflj5bnvZHnu5znsbvlnotcbiAgZ2V0TmV0VHlwZTogZnVuY3Rpb24gZ2V0TmV0VHlwZSgpIHtcbiAgICBpZiAoKHR5cGVvZiBuYXZpZ2F0b3IgPT09IFwidW5kZWZpbmVkXCIgPyBcInVuZGVmaW5lZFwiIDogX3R5cGVvZihuYXZpZ2F0b3IpKSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIHZhciBjb25uZWN0aW9uID0gbmF2aWdhdG9yLmNvbm5lY3Rpb24gfHwgbmF2aWdhdG9yLm1vekNvbm5lY3Rpb24gfHwgbmF2aWdhdG9yLndlYmtpdENvbm5lY3Rpb247XG4gICAgICByZXR1cm4gKGNvbm5lY3Rpb24gPT09IG51bGwgfHwgY29ubmVjdGlvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29ubmVjdGlvbi50eXBlKSB8fCAoY29ubmVjdGlvbiA9PT0gbnVsbCB8fCBjb25uZWN0aW9uID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25uZWN0aW9uLmVmZmVjdGl2ZVR5cGUpIHx8ICd1bmtub3duJztcbiAgICB9XG5cbiAgICByZXR1cm4gJ3Vua25vd24nO1xuICB9LFxuICAvLyDojrflj5ZwY+err+aTjeS9nOezu+e7n+exu+Wei1xuICBnZXRPc1R5cGU6IGZ1bmN0aW9uIGdldE9zVHlwZSgpIHtcbiAgICBpZiAoKHR5cGVvZiBuYXZpZ2F0b3IgPT09IFwidW5kZWZpbmVkXCIgPyBcInVuZGVmaW5lZFwiIDogX3R5cGVvZihuYXZpZ2F0b3IpKSAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHJldHVybiAndW5rbm93biBvcyc7XG4gICAgfVxuXG4gICAgdmFyIGFnZW50ID0gbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpO1xuICAgIHZhciBpc01hYyA9IC9tYWNpbnRvc2h8bWFjIG9zIHgvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpO1xuXG4gICAgaWYgKGFnZW50LmluZGV4T2YoXCJ3aW4zMlwiKSA+PSAwIHx8IGFnZW50LmluZGV4T2YoXCJ3b3czMlwiKSA+PSAwKSB7XG4gICAgICByZXR1cm4gJ3dpbjMyJztcbiAgICB9XG5cbiAgICBpZiAoYWdlbnQuaW5kZXhPZihcIndpbjY0XCIpID49IDAgfHwgYWdlbnQuaW5kZXhPZihcIndvdzY0XCIpID49IDApIHtcbiAgICAgIHJldHVybiAnd2luNjQnO1xuICAgIH1cblxuICAgIGlmIChpc01hYykge1xuICAgICAgcmV0dXJuICdtYWMnO1xuICAgIH1cblxuICAgIHJldHVybiAndW5rbm93biBvcyc7XG4gIH0sXG4gIGlzTW9iaWxlOiBmdW5jdGlvbiBpc01vYmlsZSgpIHtcbiAgICB2YXIgZXhwID0gLyhwaG9uZXxwYWR8cG9kfGlQaG9uZXxpUG9kfGlvc3xpUGFkfEFuZHJvaWR8TW9iaWxlfEJsYWNrQmVycnl8SUVNb2JpbGV8TVFRQnJvd3NlcnxKVUN8RmVubmVjfHdPU0Jyb3dzZXJ8QnJvd3Nlck5HfFdlYk9TfFN5bWJpYW58V2luZG93cyBQaG9uZSkvaTtcblxuICAgIGlmICgodHlwZW9mIG5hdmlnYXRvciA9PT0gXCJ1bmRlZmluZWRcIiA/IFwidW5kZWZpbmVkXCIgOiBfdHlwZW9mKG5hdmlnYXRvcikpID09PSAnb2JqZWN0JyAmJiBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKGV4cCkpIHtcbiAgICAgIHJldHVybiB0cnVlOyAvLyDnp7vliqjnq69cbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7IC8vIFBD56uvXG4gIH0sXG4gIGlzQW5kcm9pZDogZnVuY3Rpb24gaXNBbmRyb2lkKCkge1xuICAgIHZhciBleHAgPSAvKEFuZHJvaWR8QWRyfExpbnV4KS9pO1xuXG4gICAgaWYgKCh0eXBlb2YgbmF2aWdhdG9yID09PSBcInVuZGVmaW5lZFwiID8gXCJ1bmRlZmluZWRcIiA6IF90eXBlb2YobmF2aWdhdG9yKSkgPT09ICdvYmplY3QnICYmIG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goZXhwKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBpc0lPUzogZnVuY3Rpb24gaXNJT1MoKSB7XG4gICAgdmFyIGV4cCA9IC8oaVBob25lfGlQb2R8aVBhZHxpT1MpL2k7XG5cbiAgICBpZiAoKHR5cGVvZiBuYXZpZ2F0b3IgPT09IFwidW5kZWZpbmVkXCIgPyBcInVuZGVmaW5lZFwiIDogX3R5cGVvZihuYXZpZ2F0b3IpKSA9PT0gJ29iamVjdCcgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaChleHApKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG4gIGlzT3RoZXJNb2JpbGU6IGZ1bmN0aW9uIGlzT3RoZXJNb2JpbGUoKSB7XG4gICAgcmV0dXJuIGlzTW9iaWxlICYmICFpc0FuZHJvaWQgJiYgIWlzSU9TO1xuICB9LFxuICAvLyDojrflj5bmtY/op4jlmajnsbvlnotcbiAgZ2V0RGV2aWNlTmFtZTogZnVuY3Rpb24gZ2V0RGV2aWNlTmFtZSgpIHtcbiAgICBpZiAoKHR5cGVvZiBuYXZpZ2F0b3IgPT09IFwidW5kZWZpbmVkXCIgPyBcInVuZGVmaW5lZFwiIDogX3R5cGVvZihuYXZpZ2F0b3IpKSAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHJldHVybiAndW5rbm93biBkZXZpY2UnO1xuICAgIH1cblxuICAgIHZhciBleHBsb3JlciA9IG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKTsgLy8g6IW+6K6v5Lya6K6u5YaF572u5rWP6KeI5ZmoXG5cbiAgICBpZiAoZXhwbG9yZXIuaW5jbHVkZXMoJ2FwcC90ZW5jZW50X3dlbWVldCcpKSB7XG4gICAgICByZXR1cm4gJ3RlbmNlbnRfd2VtZWV0JztcbiAgICB9IC8vIOmBqOa4uOa1j+iniOWZqFxuXG5cbiAgICBpZiAoZXhwbG9yZXIuaW5kZXhPZignbWF4dGhvbicpID49IDApIHtcbiAgICAgIHZhciBtYXRjaCA9IGV4cGxvcmVyLm1hdGNoKC9tYXh0aG9uXFwvKFtcXGQuXSspLyk7XG4gICAgICB2YXIgdmVyID0gbWF0Y2ggJiYgbWF0Y2hbMV0gfHwgJyc7XG4gICAgICByZXR1cm4gXCJcXHU1MEIyXFx1NkUzOFxcdTZENEZcXHU4OUM4XFx1NTY2OCBcIi5jb25jYXQodmVyKS50cmltKCk7XG4gICAgfSAvLyBRUea1j+iniOWZqFxuXG5cbiAgICBpZiAoZXhwbG9yZXIuaW5kZXhPZigncXFicm93c2VyJykgPj0gMCkge1xuICAgICAgdmFyIF9tYXRjaCA9IGV4cGxvcmVyLm1hdGNoKC9xcWJyb3dzZXJcXC8oW1xcZC5dKykvKTtcblxuICAgICAgdmFyIF92ZXIgPSBfbWF0Y2ggJiYgX21hdGNoWzFdIHx8ICcnO1xuXG4gICAgICByZXR1cm4gXCJRUVxcdTZENEZcXHU4OUM4XFx1NTY2OCBcIi5jb25jYXQoX3ZlcikudHJpbSgpO1xuICAgIH0gLy8g5pCc54uX5rWP6KeI5ZmoXG5cblxuICAgIGlmIChleHBsb3Jlci5pbmRleE9mKCdzZSAyLngnKSA+PSAwKSB7XG4gICAgICByZXR1cm4gJ+aQnOeLl+a1j+iniOWZqCc7XG4gICAgfSAvLyDlvq7kv6HmtY/op4jlmahcblxuXG4gICAgaWYgKGV4cGxvcmVyLmluZGV4T2YoJ3d4d29yaycpID49IDApIHtcbiAgICAgIHJldHVybiAn5b6u5L+h5YaF572u5rWP6KeI5ZmoJztcbiAgICB9IC8vIGllXG5cblxuICAgIGlmIChleHBsb3Jlci5pbmRleE9mKCdtc2llJykgPj0gMCkge1xuICAgICAgdmFyIF9tYXRjaDIgPSBleHBsb3Jlci5tYXRjaCgvbXNpZSAoW1xcZC5dKykvKTtcblxuICAgICAgdmFyIF92ZXIyID0gX21hdGNoMiAmJiBfbWF0Y2gyWzFdIHx8ICcnO1xuXG4gICAgICByZXR1cm4gXCJJRSBcIi5jb25jYXQoX3ZlcjIpLnRyaW0oKTtcbiAgICB9IC8vIGZpcmVmb3hcblxuXG4gICAgaWYgKGV4cGxvcmVyLmluZGV4T2YoJ2ZpcmVmb3gnKSA+PSAwKSB7XG4gICAgICB2YXIgX21hdGNoMyA9IGV4cGxvcmVyLm1hdGNoKC9maXJlZm94XFwvKFtcXGQuXSspLyk7XG5cbiAgICAgIHZhciBfdmVyMyA9IF9tYXRjaDMgJiYgX21hdGNoM1sxXSB8fCAnJztcblxuICAgICAgcmV0dXJuIFwiRmlyZWZveCBcIi5jb25jYXQoX3ZlcjMpLnRyaW0oKTtcbiAgICB9IC8vIENocm9tZVxuXG5cbiAgICBpZiAoZXhwbG9yZXIuaW5kZXhPZignY2hyb21lJykgPj0gMCkge1xuICAgICAgdmFyIF9tYXRjaDQgPSBleHBsb3Jlci5tYXRjaCgvY2hyb21lXFwvKFtcXGQuXSspLyk7XG5cbiAgICAgIHZhciBfdmVyNCA9IF9tYXRjaDQgJiYgX21hdGNoNFsxXSB8fCAnJztcblxuICAgICAgcmV0dXJuIFwiQ2hyb21lIFwiLmNvbmNhdChfdmVyNCkudHJpbSgpO1xuICAgIH0gLy8gT3BlcmFcblxuXG4gICAgaWYgKGV4cGxvcmVyLmluZGV4T2YoJ29wZXJhJykgPj0gMCkge1xuICAgICAgdmFyIF9tYXRjaDUgPSBleHBsb3Jlci5tYXRjaCgvb3BlcmEuKFtcXGQuXSspLyk7XG5cbiAgICAgIHZhciBfdmVyNSA9IF9tYXRjaDUgJiYgX21hdGNoNVsxXSB8fCAnJztcblxuICAgICAgcmV0dXJuIFwiT3BlcmEgXCIuY29uY2F0KF92ZXI1KS50cmltKCk7XG4gICAgfSAvLyBTYWZhcmlcblxuXG4gICAgaWYgKGV4cGxvcmVyLmluZGV4T2YoJ3NhZmFyaScpID49IDApIHtcbiAgICAgIHZhciBfbWF0Y2g2ID0gZXhwbG9yZXIubWF0Y2goL3ZlcnNpb25cXC8oW1xcZC5dKykvKTtcblxuICAgICAgdmFyIF92ZXI2ID0gX21hdGNoNiAmJiBfbWF0Y2g2WzFdIHx8ICcnO1xuXG4gICAgICByZXR1cm4gXCJTYWZhcmkgXCIuY29uY2F0KF92ZXI2KS50cmltKCk7XG4gICAgfVxuXG4gICAgaWYgKGV4cGxvcmVyLmluZGV4T2YoJ2VkZ2UnKSA+PSAwKSB7XG4gICAgICB2YXIgX21hdGNoNyA9IGV4cGxvcmVyLm1hdGNoKC9lZGdlXFwvKFtcXGQuXSspLyk7XG5cbiAgICAgIHZhciBfdmVyNyA9IF9tYXRjaDcgJiYgX21hdGNoN1sxXSB8fCAnJztcblxuICAgICAgcmV0dXJuIFwiZWRnZSBcIi5jb25jYXQoX3ZlcjcpLnRyaW0oKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZXhwbG9yZXIuc3Vic3RyKDAsIDIwMCk7XG4gIH1cbn07XG52YXIgY29uc3RhbnQgPSB7XG4gIGlzTW9iaWxlOiB1dGlscy5pc01vYmlsZSgpLFxuICBpc0Jyb3dzZXI6ICF1dGlscy5pc01vYmlsZSgpLFxuICBtb2JpbGVPc1R5cGU6IHV0aWxzLmlzQW5kcm9pZCgpID8gJ2FuZHJvaWQnIDogdXRpbHMuaXNJT1MgPyAnaW9zJyA6ICdvdGhlcl9tb2JpbGUnLFxuICBwY09zVHlwZTogdXRpbHMuZ2V0T3NUeXBlKClcbn07IC8vIOiuvuWkh+S/oeaBr++8jOWPquWPluS4gOasoeWAvFxuXG52YXIgZGV2aWNlSW5mbyA9IHtcbiAgLy8g4oaT5LiK5oql6aG5XG4gIGRldmljZVR5cGU6IGNvbnN0YW50LmlzTW9iaWxlID8gJ21vYmlsZScgOiBjb25zdGFudC5pc0Jyb3dzZXIgPyAnYnJvd3NlcicgOiAndW5rbm93bicsXG4gIGRldmljZVBsYXRmb3JtOiBjb25zdGFudC5pc01vYmlsZSA/IGNvbnN0YW50Lm1vYmlsZU9zVHlwZSA6IGNvbnN0YW50LnBjT3NUeXBlLFxuICBkZXZpY2VOYW1lOiB1dGlscy5nZXREZXZpY2VOYW1lKCkgLy/mtY/op4jlmajlkI3np7BcblxufTsgLy8g5YiG5Z2X5LiK5Lyg5Y6f5a2Q5pa55rOVXG5cbnZhciBzbGljZVVwbG9hZE1ldGhvZHMgPSBbJ211bHRpcGFydEluaXQnLCAnbXVsdGlwYXJ0VXBsb2FkJywgJ211bHRpcGFydENvbXBsZXRlJywgJ211bHRpcGFydExpc3QnLCAnbXVsdGlwYXJ0TGlzdFBhcnQnLCAnbXVsdGlwYXJ0QWJvcnQnXTtcbnZhciB1cGxvYWRBcGkgPSBbJ3B1dE9iamVjdCcsICdwb3N0T2JqZWN0JywgJ2FwcGVuZE9iamVjdCcsICdzbGljZVVwbG9hZEZpbGUnLCAndXBsb2FkRmlsZScsICd1cGxvYWRGaWxlcyddLmNvbmNhdChzbGljZVVwbG9hZE1ldGhvZHMpO1xudmFyIGRvd25sb2FkQXBpID0gWydnZXRPYmplY3QnXTtcblxuZnVuY3Rpb24gZ2V0RXZlbnRDb2RlKGFwaU5hbWUpIHtcbiAgaWYgKHVwbG9hZEFwaS5pbmNsdWRlcyhhcGlOYW1lKSkge1xuICAgIHJldHVybiAnY29zX3VwbG9hZCc7XG4gIH1cblxuICBpZiAoZG93bmxvYWRBcGkuaW5jbHVkZXMoYXBpTmFtZSkpIHtcbiAgICByZXR1cm4gJ2Nvc19kb3dubG9hZCc7XG4gIH1cblxuICByZXR1cm4gJ2Jhc2Vfc2VydmljZSc7XG59IC8vIOS4iuaKpeWPguaVsOmpvOWzsOaUueS4i+WIkue6v1xuXG5cbmZ1bmN0aW9uIGNhbWVsMnVuZGVybGluZShrZXkpIHtcbiAgcmV0dXJuIGtleS5yZXBsYWNlKC8oW0EtWl0pL2csIFwiXyQxXCIpLnRvTG93ZXJDYXNlKCk7XG59XG5cbmZ1bmN0aW9uIGZvcm1hdFBhcmFtcyhwYXJhbXMpIHtcbiAgdmFyIGZvcm1hdHRlZFBhcmFtcyA9IHt9O1xuICB2YXIgYWxsUmVwb3J0ZXJLZXlzID0gWyd0cmFjZVBsYXRmb3JtJywgJ2Nvc3Nka1ZlcnNpb24nLCAncmVnaW9uJywgJ25ldHdvcmtUeXBlJywgJ2hvc3QnLCAnYWNjZWxlcmF0ZScsICdyZXF1ZXN0UGF0aCcsICdzaXplJywgJ2h0dHBNZDUnLCAnaHR0cFNpZ24nLCAnaHR0cEZ1bGwnLCAnbmFtZScsICdyZXN1bHQnLCAndG9va1RpbWUnLCAnZXJyb3JOb2RlJywgJ2Vycm9yQ29kZScsICdlcnJvck1lc3NhZ2UnLCAnZXJyb3JSZXF1ZXN0SWQnLCAnZXJyb3JTdGF0dXNDb2RlJywgJ2Vycm9yU2VydmljZU5hbWUnLCAnZXJyb3JUeXBlJywgJ3RyYWNlSWQnLCAnYnVja2V0JywgJ2FwcGlkJywgJ3BhcnROdW1iZXInLCAncmV0cnlUaW1lcycsICdyZXFVcmwnLCAnY3VzdG9tSWQnLCAnZnVsbEVycm9yJywgJ2RldmljZVR5cGUnLCAnZGV2aWNlUGxhdGZvcm0nLCAnZGV2aWNlTmFtZSddO1xuICB2YXIgc3VjY2Vzc0tleXMgPSBbJ3RyYWNlUGxhdGZvcm0nLCAnY29zc2RrVmVyc2lvbicsICdyZWdpb24nLCAnYnVja2V0JywgJ2FwcGlkJywgJ25ldHdvcmtUeXBlJywgJ2hvc3QnLCAnYWNjZWxlcmF0ZScsICdyZXF1ZXN0UGF0aCcsICdwYXJ0TnVtYmVyJywgJ3NpemUnLCAnbmFtZScsICdyZXN1bHQnLCAndG9va1RpbWUnLCAnZXJyb3JSZXF1ZXN0SWQnLCAncmV0cnlUaW1lcycsICdyZXFVcmwnLCAnY3VzdG9tSWQnLCAnZGV2aWNlVHlwZScsICdkZXZpY2VQbGF0Zm9ybScsICdkZXZpY2VOYW1lJ107IC8vIOmcgOimgeS4iuaKpeeahOWPguaVsOWtl+autVxuXG4gIHZhciByZXBvcnRlcktleXMgPSBwYXJhbXMucmVzdWx0ID09PSAnU3VjY2VzcycgPyBzdWNjZXNzS2V5cyA6IGFsbFJlcG9ydGVyS2V5cztcblxuICBmb3IgKHZhciBrZXkgaW4gcGFyYW1zKSB7XG4gICAgaWYgKCFyZXBvcnRlcktleXMuaW5jbHVkZXMoa2V5KSkgY29udGludWU7XG4gICAgdmFyIGZvcm1hdHRlZEtleSA9IGNhbWVsMnVuZGVybGluZShrZXkpO1xuICAgIGZvcm1hdHRlZFBhcmFtc1tmb3JtYXR0ZWRLZXldID0gcGFyYW1zW2tleV07XG4gIH1cblxuICByZXR1cm4gZm9ybWF0dGVkUGFyYW1zO1xufSAvLyDpk77ot6/ov73ouKrlmahcblxuXG52YXIgVHJhY2tlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGZ1bmN0aW9uIFRyYWNrZXIob3B0KSB7XG4gICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFRyYWNrZXIpO1xuXG4gICAgdmFyIHBhcmVudCA9IG9wdC5wYXJlbnQsXG4gICAgICAgIHRyYWNlSWQgPSBvcHQudHJhY2VJZCxcbiAgICAgICAgYnVja2V0ID0gb3B0LmJ1Y2tldCxcbiAgICAgICAgcmVnaW9uID0gb3B0LnJlZ2lvbixcbiAgICAgICAgYXBpTmFtZSA9IG9wdC5hcGlOYW1lLFxuICAgICAgICBmaWxlS2V5ID0gb3B0LmZpbGVLZXksXG4gICAgICAgIGZpbGVTaXplID0gb3B0LmZpbGVTaXplLFxuICAgICAgICBhY2NlbGVyYXRlID0gb3B0LmFjY2VsZXJhdGUsXG4gICAgICAgIGN1c3RvbUlkID0gb3B0LmN1c3RvbUlkLFxuICAgICAgICBkZWxheSA9IG9wdC5kZWxheSxcbiAgICAgICAgZGVlcFRyYWNrZXIgPSBvcHQuZGVlcFRyYWNrZXI7XG4gICAgdmFyIGFwcGlkID0gYnVja2V0ICYmIGJ1Y2tldC5zdWJzdHIoYnVja2V0Lmxhc3RJbmRleE9mKCctJykgKyAxKSB8fCAnJztcbiAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcbiAgICB0aGlzLmRlZXBUcmFja2VyID0gZGVlcFRyYWNrZXI7IC8vIOS4iuaKpeeUqOWIsOeahOWtl+autVxuXG4gICAgdGhpcy5wYXJhbXMgPSB7XG4gICAgICAvLyDpgJrnlKjlrZfmrrVcbiAgICAgIGNvc3Nka1ZlcnNpb246IHBrZy52ZXJzaW9uLFxuICAgICAgcmVnaW9uOiByZWdpb24sXG4gICAgICBuZXR3b3JrVHlwZTogJycsXG4gICAgICBob3N0OiAnJyxcbiAgICAgIGFjY2VsZXJhdGU6IGFjY2VsZXJhdGUgPyAnWScgOiAnTicsXG4gICAgICByZXF1ZXN0UGF0aDogZmlsZUtleSB8fCAnJyxcbiAgICAgIHNpemU6IGZpbGVTaXplIHx8IC0xLFxuICAgICAgaHR0cE1kNTogMCxcbiAgICAgIC8vIE1ENeiAl+aXtlxuICAgICAgaHR0cFNpZ246IDAsXG4gICAgICAvLyDorqHnrpfnrb7lkI3ogJfml7ZcbiAgICAgIGh0dHBGdWxsOiAwLFxuICAgICAgLy8gaHR0cOivt+axguiAl+aXtlxuICAgICAgbmFtZTogYXBpTmFtZSB8fCAnJyxcbiAgICAgIHJlc3VsdDogJycsXG4gICAgICAvLyBzZGsgYXBp6LCD55So57uT5p6cU3VjY2Vzc+OAgUZhaWxcbiAgICAgIHRvb2tUaW1lOiAwLFxuICAgICAgLy8g5oC76ICX5pe2XG4gICAgICBlcnJvck5vZGU6ICcnLFxuICAgICAgZXJyb3JDb2RlOiAnJyxcbiAgICAgIGVycm9yTWVzc2FnZTogJycsXG4gICAgICBlcnJvclJlcXVlc3RJZDogJycsXG4gICAgICBlcnJvclN0YXR1c0NvZGU6IDAsXG4gICAgICBlcnJvclNlcnZpY2VOYW1lOiAnJyxcbiAgICAgIC8vIGpz6KGl5YWF5a2X5q61XG4gICAgICB0cmFjZVBsYXRmb3JtOiAnY29zLWpzLXNkay12NScsXG4gICAgICAvLyDkuIrmiqXlubPlj7A9anNcbiAgICAgIHRyYWNlSWQ6IHRyYWNlSWQgfHwgdXRpbHMuZ2V0VWlkKCksXG4gICAgICAvLyDmr4/mnaHkuIrmiqXllK/kuIDmoIfor4ZcbiAgICAgIGJ1Y2tldDogYnVja2V0LFxuICAgICAgYXBwaWQ6IGFwcGlkLFxuICAgICAgcGFydE51bWJlcjogMCxcbiAgICAgIC8vIOWIhuWdl+S4iuS8oOe8luWPt1xuICAgICAgcmV0cnlUaW1lczogMCxcbiAgICAgIC8vIHNka+WGhemDqOWPkei1t+eahOivt+axgumHjeivlVxuICAgICAgcmVxVXJsOiAnJyxcbiAgICAgIC8vIOivt+axgnVybFxuICAgICAgY3VzdG9tSWQ6IGN1c3RvbUlkIHx8ICcnLFxuICAgICAgLy8g5Lia5YqhaWRcbiAgICAgIGRldmljZVR5cGU6IGRldmljZUluZm8uZGV2aWNlVHlwZSxcbiAgICAgIC8vIOiuvuWkh+exu+WeiyDnp7vliqjnq6/mtY/op4jlmajjgIF3ZWLmtY/op4jlmahcbiAgICAgIGRldmljZVBsYXRmb3JtOiBkZXZpY2VJbmZvLmRldmljZVBsYXRmb3JtLFxuICAgICAgZGV2aWNlTmFtZTogZGV2aWNlSW5mby5kZXZpY2VOYW1lLFxuICAgICAgbWQ1U3RhcnRUaW1lOiAwLFxuICAgICAgLy8gbWQ16K6h566X5byA5aeL5pe26Ze0XG4gICAgICBtZDVFbmRUaW1lOiAwLFxuICAgICAgLy8gbWQ16K6h566X57uT5p2f5pe26Ze0XG4gICAgICBzaWduU3RhcnRUaW1lOiAwLFxuICAgICAgLy8g6K6h566X562+5ZCN5byA5aeL5pe26Ze0XG4gICAgICBzaWduRW5kVGltZTogMCxcbiAgICAgIC8vIOiuoeeul+etvuWQjee7k+adn+aXtumXtFxuICAgICAgaHR0cFN0YXJ0VGltZTogMCxcbiAgICAgIC8vIOWPkei1t+e9kee7nOivt+axguW8gOWni+aXtumXtFxuICAgICAgaHR0cEVuZFRpbWU6IDAsXG4gICAgICAvLyDnvZHot6/or7fmsYLnu5PmnZ/ml7bpl7RcbiAgICAgIHN0YXJ0VGltZTogbmV3IERhdGUoKS5nZXRUaW1lKCksXG4gICAgICAvLyBzZGsgYXBp6LCD55So6LW35aeL5pe26Ze077yM5LiN5piv57qv572R57uc6ICX5pe2XG4gICAgICBlbmRUaW1lOiAwIC8vICBzZGsgYXBp6LCD55So57uT5p2f5pe26Ze077yM5LiN5piv57qv572R57uc6ICX5pe2XG5cbiAgICB9O1xuICAgIHRoaXMuYmVhY29uID0gZ2V0QmVhY29uKGRlbGF5KTtcbiAgfSAvLyDmoLzlvI/ljJZzZGvlm57osINcblxuXG4gIF9jcmVhdGVDbGFzcyhUcmFja2VyLCBbe1xuICAgIGtleTogXCJmb3JtYXRSZXN1bHRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZm9ybWF0UmVzdWx0KGVyciwgZGF0YSkge1xuICAgICAgdmFyIF9lcnIkZXJyb3IsIF9lcnIkZXJyb3IyLCBfZXJyJGVycm9yMywgX2VyciRlcnJvcjQsIF9lcnIkZXJyb3I1LCBfZXJyJGVycm9yNjtcblxuICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgdmFyIHRvb2tUaW1lID0gbm93IC0gdGhpcy5wYXJhbXMuc3RhcnRUaW1lO1xuICAgICAgdmFyIG5ldHdvcmtUeXBlID0gdXRpbHMuZ2V0TmV0VHlwZSgpO1xuICAgICAgdmFyIGVycm9yQ29kZSA9IGVyciA/IChlcnIgPT09IG51bGwgfHwgZXJyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnIuY29kZSkgfHwgKGVyciA9PT0gbnVsbCB8fCBlcnIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfZXJyJGVycm9yID0gZXJyLmVycm9yKSA9PT0gbnVsbCB8fCBfZXJyJGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZXJyJGVycm9yLmNvZGUpIHx8IChlcnIgPT09IG51bGwgfHwgZXJyID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2VyciRlcnJvcjIgPSBlcnIuZXJyb3IpID09PSBudWxsIHx8IF9lcnIkZXJyb3IyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZXJyJGVycm9yMi5Db2RlKSA6ICcnO1xuICAgICAgdmFyIGVycm9yTWVzc2FnZSA9IGVyciA/IChlcnIgPT09IG51bGwgfHwgZXJyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnIubWVzc2FnZSkgfHwgKGVyciA9PT0gbnVsbCB8fCBlcnIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfZXJyJGVycm9yMyA9IGVyci5lcnJvcikgPT09IG51bGwgfHwgX2VyciRlcnJvcjMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lcnIkZXJyb3IzLm1lc3NhZ2UpIHx8IChlcnIgPT09IG51bGwgfHwgZXJyID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2VyciRlcnJvcjQgPSBlcnIuZXJyb3IpID09PSBudWxsIHx8IF9lcnIkZXJyb3I0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZXJyJGVycm9yNC5NZXNzYWdlKSA6ICcnO1xuICAgICAgdmFyIGVycm9yU2VydmljZU5hbWUgPSBlcnIgPyAoZXJyID09PSBudWxsIHx8IGVyciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyLnJlc291cmNlKSB8fCAoZXJyID09PSBudWxsIHx8IGVyciA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9lcnIkZXJyb3I1ID0gZXJyLmVycm9yKSA9PT0gbnVsbCB8fCBfZXJyJGVycm9yNSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2VyciRlcnJvcjUucmVzb3VyY2UpIHx8IChlcnIgPT09IG51bGwgfHwgZXJyID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2VyciRlcnJvcjYgPSBlcnIuZXJyb3IpID09PSBudWxsIHx8IF9lcnIkZXJyb3I2ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZXJyJGVycm9yNi5SZXNvdXJjZSkgOiAnJztcbiAgICAgIHZhciBlcnJvclN0YXR1c0NvZGUgPSBlcnIgPyBlcnIgPT09IG51bGwgfHwgZXJyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnIuc3RhdHVzQ29kZSA6IGRhdGEuc3RhdHVzQ29kZTtcbiAgICAgIHZhciByZXF1ZXN0SWQgPSBlcnIgPyAoZXJyID09PSBudWxsIHx8IGVyciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyLmhlYWRlcnMpICYmIChlcnIgPT09IG51bGwgfHwgZXJyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnIuaGVhZGVyc1sneC1jb3MtcmVxdWVzdC1pZCddKSA6IChkYXRhID09PSBudWxsIHx8IGRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGEuaGVhZGVycykgJiYgKGRhdGEgPT09IG51bGwgfHwgZGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YS5oZWFkZXJzWyd4LWNvcy1yZXF1ZXN0LWlkJ10pO1xuICAgICAgdmFyIGVycm9yVHlwZSA9IGVyciA/IHJlcXVlc3RJZCA/ICdTZXJ2ZXInIDogJ0NsaWVudCcgOiAnJztcbiAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5wYXJhbXMsIHtcbiAgICAgICAgdG9va1RpbWU6IHRvb2tUaW1lLFxuICAgICAgICBuZXR3b3JrVHlwZTogbmV0d29ya1R5cGUsXG4gICAgICAgIGh0dHBNZDU6IHRoaXMucGFyYW1zLm1kNUVuZFRpbWUgLSB0aGlzLnBhcmFtcy5tZDVTdGFydFRpbWUsXG4gICAgICAgIGh0dHBTaWduOiB0aGlzLnBhcmFtcy5zaWduRW5kVGltZSAtIHRoaXMucGFyYW1zLnNpZ25TdGFydFRpbWUsXG4gICAgICAgIGh0dHBGdWxsOiB0aGlzLnBhcmFtcy5odHRwRW5kVGltZSAtIHRoaXMucGFyYW1zLmh0dHBTdGFydFRpbWUsXG4gICAgICAgIHJlc3VsdDogZXJyID8gJ0ZhaWwnIDogJ1N1Y2Nlc3MnLFxuICAgICAgICBlcnJvclR5cGU6IGVycm9yVHlwZSxcbiAgICAgICAgZXJyb3JDb2RlOiBlcnJvckNvZGUsXG4gICAgICAgIGVycm9yU3RhdHVzQ29kZTogZXJyb3JTdGF0dXNDb2RlLFxuICAgICAgICBlcnJvck1lc3NhZ2U6IGVycm9yTWVzc2FnZSxcbiAgICAgICAgZXJyb3JTZXJ2aWNlTmFtZTogZXJyb3JTZXJ2aWNlTmFtZSxcbiAgICAgICAgZXJyb3JSZXF1ZXN0SWQ6IHJlcXVlc3RJZFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChlcnIgJiYgKCFlcnJvckNvZGUgfHwgIWVycm9yTWVzc2FnZSkpIHtcbiAgICAgICAgLy8g5pqC5a2Y5YWo6YePZXJy5LiA5q615pe26Ze0IOinguWvn+aYr+WQpuaJgOaciWVycuagvOW8j+mDveWPr+iiq+ino+aekFxuICAgICAgICB0aGlzLnBhcmFtcy5mdWxsRXJyb3IgPSBlcnIgPyBKU09OLnN0cmluZ2lmeShlcnIpIDogJyc7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLnBhcmFtcy5uYW1lID09PSAnZ2V0T2JqZWN0Jykge1xuICAgICAgICB0aGlzLnBhcmFtcy5zaXplID0gZGF0YSA/IGRhdGEuaGVhZGVycyAmJiBkYXRhLmhlYWRlcnNbJ2NvbnRlbnQtbGVuZ3RoJ10gOiAtMTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMucGFyYW1zLnJlcVVybCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHZhciBleGVjUmVzID0gL15odHRwKHMpPzpcXC9cXC8oLio/KVxcLy8uZXhlYyh0aGlzLnBhcmFtcy5yZXFVcmwpO1xuICAgICAgICAgIHRoaXMucGFyYW1zLmhvc3QgPSBleGVjUmVzWzJdO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgdGhpcy5wYXJhbXMuaG9zdCA9IHRoaXMucGFyYW1zLnJlcVVybDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLnNlbmRFdmVudHMoKTtcbiAgICB9IC8vIOiuvue9ruW9k+WJjemTvui3r+eahOWPguaVsFxuXG4gIH0sIHtcbiAgICBrZXk6IFwic2V0UGFyYW1zXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNldFBhcmFtcyhwYXJhbXMpIHtcbiAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5wYXJhbXMsIHBhcmFtcyk7XG4gICAgfSAvLyDkvb/nlKjnga/loZTlu7bml7bkuIrmiqVcblxuICB9LCB7XG4gICAga2V5OiBcInNlbmRFdmVudHNcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gc2VuZEV2ZW50cygpIHtcbiAgICAgIC8vIERlZXBUcmFja2Vy5qih5byP5LiL5omN5Lya5LiK5oql5YiG5Z2X5LiK5Lyg5YaF6YOo57uG6IqCXG4gICAgICBpZiAoc2xpY2VVcGxvYWRNZXRob2RzLmluY2x1ZGVzKHRoaXMucGFyYW1zLm5hbWUpICYmICF0aGlzLmRlZXBUcmFja2VyKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdmFyIGV2ZW50Q29kZSA9IGdldEV2ZW50Q29kZSh0aGlzLnBhcmFtcy5uYW1lKTtcbiAgICAgIHZhciBmb3JtYXR0ZWRQYXJhbXMgPSBmb3JtYXRQYXJhbXModGhpcy5wYXJhbXMpO1xuXG4gICAgICBpZiAodGhpcy5wYXJhbXMuZGVsYXkgPT09IDApIHtcbiAgICAgICAgLy8g5a6e5pe25LiK5oqlXG4gICAgICAgIHRoaXMuYmVhY29uLm9uRGlyZWN0VXNlckFjdGlvbihldmVudENvZGUsIGZvcm1hdHRlZFBhcmFtcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyDlkajmnJ/mgKfkuIrmiqVcbiAgICAgICAgdGhpcy5iZWFjb24ub25Vc2VyQWN0aW9uKGV2ZW50Q29kZSwgZm9ybWF0dGVkUGFyYW1zKTtcbiAgICAgIH0gLy8g5LiK5oql57uT5p2f5Y2z6ZSA5q+BXG5cblxuICAgICAgdGhpcy5kZXN0cm95KCk7XG4gICAgfSAvLyDnlJ/miJDlrZDlrp7kvovvvIzkuI7niLbmiYDlsZ7kuIDkuKrpk77ot6/vvIzlj6/nlKjkuo7liIblnZfkuIrkvKDlhoXpg6jmtYHnqIvkuIrmiqXljZXkuKrliIblnZfmk43kvZxcblxuICB9LCB7XG4gICAga2V5OiBcImdlbmVyYXRlU3ViVHJhY2tlclwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZW5lcmF0ZVN1YlRyYWNrZXIoc3ViUGFyYW1zKSB7XG4gICAgICBPYmplY3QuYXNzaWduKHN1YlBhcmFtcywge1xuICAgICAgICBwYXJlbnQ6IHRoaXMsXG4gICAgICAgIGRlZXBUcmFja2VyOiB0aGlzLmRlZXBUcmFja2VyLFxuICAgICAgICB0cmFjZUlkOiB0aGlzLnBhcmFtcy50cmFjZUlkLFxuICAgICAgICBidWNrZXQ6IHRoaXMucGFyYW1zLmJ1Y2tldCxcbiAgICAgICAgcmVnaW9uOiB0aGlzLnBhcmFtcy5yZWdpb24sXG4gICAgICAgIGZpbGVLZXk6IHRoaXMucGFyYW1zLnJlcXVlc3RQYXRoLFxuICAgICAgICBjdXN0b21JZDogdGhpcy5wYXJhbXMuY3VzdG9tSWQsXG4gICAgICAgIGRlbGF5OiB0aGlzLnBhcmFtcy5kZWxheVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gbmV3IFRyYWNrZXIoc3ViUGFyYW1zKTtcbiAgICB9IC8vIOmTvui3r+e7k+adn+WQjumUgOavgeWunuS+i1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZGVzdHJveVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkge1xuICAgICAgdGhpcy5iZWFjb24gPSBudWxsO1xuICAgICAgdGhpcy5wYXJhbXMgPSB7fTtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gVHJhY2tlcjtcbn0oKTtcblxubW9kdWxlLmV4cG9ydHMgPSBUcmFja2VyOyIsIid1c2Ugc3RyaWN0JztcblxudmFyIF90eXBlb2YgPSByZXF1aXJlKFwiQGJhYmVsL3J1bnRpbWUvaGVscGVycy90eXBlb2ZcIik7XG5cbnZhciBtZDUgPSByZXF1aXJlKCcuLi9saWIvbWQ1Jyk7XG5cbnZhciBDcnlwdG9KUyA9IHJlcXVpcmUoJy4uL2xpYi9jcnlwdG8nKTtcblxudmFyIHhtbDJqc29uID0gcmVxdWlyZSgnLi4vbGliL3htbDJqc29uJyk7XG5cbnZhciBqc29uMnhtbCA9IHJlcXVpcmUoJy4uL2xpYi9qc29uMnhtbCcpO1xuXG52YXIgVHJhY2tlciA9IHJlcXVpcmUoJy4vdHJhY2tlcicpO1xuXG5mdW5jdGlvbiBjYW1TYWZlVXJsRW5jb2RlKHN0cikge1xuICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KHN0cikucmVwbGFjZSgvIS9nLCAnJTIxJykucmVwbGFjZSgvJy9nLCAnJTI3JykucmVwbGFjZSgvXFwoL2csICclMjgnKS5yZXBsYWNlKC9cXCkvZywgJyUyOScpLnJlcGxhY2UoL1xcKi9nLCAnJTJBJyk7XG59XG5cbmZ1bmN0aW9uIGdldE9iamVjdEtleXMob2JqLCBmb3JLZXkpIHtcbiAgdmFyIGxpc3QgPSBbXTtcblxuICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7XG4gICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICBsaXN0LnB1c2goZm9yS2V5ID8gY2FtU2FmZVVybEVuY29kZShrZXkpLnRvTG93ZXJDYXNlKCkgOiBrZXkpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBsaXN0LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICBhID0gYS50b0xvd2VyQ2FzZSgpO1xuICAgIGIgPSBiLnRvTG93ZXJDYXNlKCk7XG4gICAgcmV0dXJuIGEgPT09IGIgPyAwIDogYSA+IGIgPyAxIDogLTE7XG4gIH0pO1xufVxuXG47XG4vKipcclxuICogb2Jq6L2s5Li6c3RyaW5nXHJcbiAqIEBwYXJhbSAge09iamVjdH0gIG9iaiAgICAgICAgICAgICAgICDpnIDopoHovaznmoTlr7nosaHvvIzlv4XpobtcclxuICogQHBhcmFtICB7Qm9vbGVhbn0gbG93ZXJDYXNlS2V5ICAgICAgIGtleeaYr+WQpui9rOS4uuWwj+WGme+8jOm7mOiupGZhbHNl77yM6Z2e5b+F6aG7XHJcbiAqIEByZXR1cm4ge1N0cmluZ30gIGRhdGEgICAgICAgICAgICAgICDov5Tlm57lrZfnrKbkuLJcclxuICovXG5cbnZhciBvYmoyc3RyID0gZnVuY3Rpb24gb2JqMnN0cihvYmosIGxvd2VyQ2FzZUtleSkge1xuICB2YXIgaSwga2V5LCB2YWw7XG4gIHZhciBsaXN0ID0gW107XG4gIHZhciBrZXlMaXN0ID0gZ2V0T2JqZWN0S2V5cyhvYmopO1xuXG4gIGZvciAoaSA9IDA7IGkgPCBrZXlMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAga2V5ID0ga2V5TGlzdFtpXTtcbiAgICB2YWwgPSBvYmpba2V5XSA9PT0gdW5kZWZpbmVkIHx8IG9ialtrZXldID09PSBudWxsID8gJycgOiAnJyArIG9ialtrZXldO1xuICAgIGtleSA9IGxvd2VyQ2FzZUtleSA/IGNhbVNhZmVVcmxFbmNvZGUoa2V5KS50b0xvd2VyQ2FzZSgpIDogY2FtU2FmZVVybEVuY29kZShrZXkpO1xuICAgIHZhbCA9IGNhbVNhZmVVcmxFbmNvZGUodmFsKSB8fCAnJztcbiAgICBsaXN0LnB1c2goa2V5ICsgJz0nICsgdmFsKTtcbiAgfVxuXG4gIHJldHVybiBsaXN0LmpvaW4oJyYnKTtcbn07IC8vIOWPr+S7peetvuWFpeetvuWQjeeahGhlYWRlcnNcblxuXG52YXIgc2lnbkhlYWRlcnMgPSBbJ2NvbnRlbnQtZGlzcG9zaXRpb24nLCAnY29udGVudC1lbmNvZGluZycsICdjb250ZW50LWxlbmd0aCcsICdjb250ZW50LW1kNScsICdleHBlY3QnLCAnaG9zdCcsICdpZi1tYXRjaCcsICdpZi1tb2RpZmllZC1zaW5jZScsICdpZi1ub25lLW1hdGNoJywgJ2lmLXVubW9kaWZpZWQtc2luY2UnLCAnb3JpZ2luJywgJ3JhbmdlJywgJ3Jlc3BvbnNlLWNhY2hlLWNvbnRyb2wnLCAncmVzcG9uc2UtY29udGVudC1kaXNwb3NpdGlvbicsICdyZXNwb25zZS1jb250ZW50LWVuY29kaW5nJywgJ3Jlc3BvbnNlLWNvbnRlbnQtbGFuZ3VhZ2UnLCAncmVzcG9uc2UtY29udGVudC10eXBlJywgJ3Jlc3BvbnNlLWV4cGlyZXMnLCAndHJhbnNmZXItZW5jb2RpbmcnLCAndmVyc2lvbmlkJ107XG5cbnZhciBnZXRTaWduSGVhZGVyT2JqID0gZnVuY3Rpb24gZ2V0U2lnbkhlYWRlck9iaihoZWFkZXJzKSB7XG4gIHZhciBzaWduSGVhZGVyT2JqID0ge307XG5cbiAgZm9yICh2YXIgaSBpbiBoZWFkZXJzKSB7XG4gICAgdmFyIGtleSA9IGkudG9Mb3dlckNhc2UoKTtcblxuICAgIGlmIChrZXkuaW5kZXhPZigneC1jb3MtJykgPiAtMSB8fCBzaWduSGVhZGVycy5pbmRleE9mKGtleSkgPiAtMSkge1xuICAgICAgc2lnbkhlYWRlck9ialtpXSA9IGhlYWRlcnNbaV07XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHNpZ25IZWFkZXJPYmo7XG59OyAvL+a1i+ivleeUqOeahGtleeWQjumdouWPr+S7peWOu+aOiVxuXG5cbnZhciBnZXRBdXRoID0gZnVuY3Rpb24gZ2V0QXV0aChvcHQpIHtcbiAgb3B0ID0gb3B0IHx8IHt9O1xuICB2YXIgU2VjcmV0SWQgPSBvcHQuU2VjcmV0SWQ7XG4gIHZhciBTZWNyZXRLZXkgPSBvcHQuU2VjcmV0S2V5O1xuICB2YXIgS2V5VGltZSA9IG9wdC5LZXlUaW1lO1xuICB2YXIgbWV0aG9kID0gKG9wdC5tZXRob2QgfHwgb3B0Lk1ldGhvZCB8fCAnZ2V0JykudG9Mb3dlckNhc2UoKTtcbiAgdmFyIHF1ZXJ5UGFyYW1zID0gY2xvbmUob3B0LlF1ZXJ5IHx8IG9wdC5wYXJhbXMgfHwge30pO1xuICB2YXIgaGVhZGVycyA9IGdldFNpZ25IZWFkZXJPYmooY2xvbmUob3B0LkhlYWRlcnMgfHwgb3B0LmhlYWRlcnMgfHwge30pKTtcbiAgdmFyIEtleSA9IG9wdC5LZXkgfHwgJyc7XG4gIHZhciBwYXRobmFtZTtcblxuICBpZiAob3B0LlVzZVJhd0tleSkge1xuICAgIHBhdGhuYW1lID0gb3B0LlBhdGhuYW1lIHx8IG9wdC5wYXRobmFtZSB8fCAnLycgKyBLZXk7XG4gIH0gZWxzZSB7XG4gICAgcGF0aG5hbWUgPSBvcHQuUGF0aG5hbWUgfHwgb3B0LnBhdGhuYW1lIHx8IEtleTtcbiAgICBwYXRobmFtZS5pbmRleE9mKCcvJykgIT09IDAgJiYgKHBhdGhuYW1lID0gJy8nICsgcGF0aG5hbWUpO1xuICB9IC8vIEZvcmNlU2lnbkhvc3TmmI7noa7kvKDlhaVmYWxzZeaJjeS4jeWKoOWFpWhvc3Tnrb7lkI1cblxuXG4gIHZhciBmb3JjZVNpZ25Ib3N0ID0gb3B0LkZvcmNlU2lnbkhvc3QgPT09IGZhbHNlID8gZmFsc2UgOiB0cnVlOyAvLyDlpoLmnpzmnInkvKDlhaXlrZjlgqjmobbkuJTpnIDopoHlvLrliLbnrb7lkI3vvIzpgqPkuYjnrb7lkI3pu5jorqTliqAgSG9zdCDlj4LkuI7orqHnrpfvvIzpgb/lhY3ot6jmobborr/pl65cblxuICBpZiAoIWhlYWRlcnMuSG9zdCAmJiAhaGVhZGVycy5ob3N0ICYmIG9wdC5CdWNrZXQgJiYgb3B0LlJlZ2lvbiAmJiBmb3JjZVNpZ25Ib3N0KSBoZWFkZXJzLkhvc3QgPSBvcHQuQnVja2V0ICsgJy5jb3MuJyArIG9wdC5SZWdpb24gKyAnLm15cWNsb3VkLmNvbSc7XG4gIGlmICghU2VjcmV0SWQpIHRocm93IG5ldyBFcnJvcignbWlzc2luZyBwYXJhbSBTZWNyZXRJZCcpO1xuICBpZiAoIVNlY3JldEtleSkgdGhyb3cgbmV3IEVycm9yKCdtaXNzaW5nIHBhcmFtIFNlY3JldEtleScpOyAvLyDnrb7lkI3mnInmlYjotbfmraLml7bpl7RcblxuICB2YXIgbm93ID0gTWF0aC5yb3VuZChnZXRTa2V3VGltZShvcHQuU3lzdGVtQ2xvY2tPZmZzZXQpIC8gMTAwMCkgLSAxO1xuICB2YXIgZXhwID0gbm93O1xuICB2YXIgRXhwaXJlcyA9IG9wdC5FeHBpcmVzIHx8IG9wdC5leHBpcmVzO1xuXG4gIGlmIChFeHBpcmVzID09PSB1bmRlZmluZWQpIHtcbiAgICBleHAgKz0gOTAwOyAvLyDnrb7lkI3ov4fmnJ/ml7bpl7TkuLrlvZPliY0gKyA5MDBzXG4gIH0gZWxzZSB7XG4gICAgZXhwICs9IEV4cGlyZXMgKiAxIHx8IDA7XG4gIH0gLy8g6KaB55So5Yiw55qEIEF1dGhvcml6YXRpb24g5Y+C5pWw5YiX6KGoXG5cblxuICB2YXIgcVNpZ25BbGdvcml0aG0gPSAnc2hhMSc7XG4gIHZhciBxQWsgPSBTZWNyZXRJZDtcbiAgdmFyIHFTaWduVGltZSA9IEtleVRpbWUgfHwgbm93ICsgJzsnICsgZXhwO1xuICB2YXIgcUtleVRpbWUgPSBLZXlUaW1lIHx8IG5vdyArICc7JyArIGV4cDtcbiAgdmFyIHFIZWFkZXJMaXN0ID0gZ2V0T2JqZWN0S2V5cyhoZWFkZXJzLCB0cnVlKS5qb2luKCc7JykudG9Mb3dlckNhc2UoKTtcbiAgdmFyIHFVcmxQYXJhbUxpc3QgPSBnZXRPYmplY3RLZXlzKHF1ZXJ5UGFyYW1zLCB0cnVlKS5qb2luKCc7JykudG9Mb3dlckNhc2UoKTsgLy8g562+5ZCN566X5rOV6K+05piO5paH5qGj77yaaHR0cHM6Ly93d3cucWNsb3VkLmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83Nzc4XG4gIC8vIOatpemqpOS4gO+8muiuoeeulyBTaWduS2V5XG5cbiAgdmFyIHNpZ25LZXkgPSBDcnlwdG9KUy5IbWFjU0hBMShxS2V5VGltZSwgU2VjcmV0S2V5KS50b1N0cmluZygpOyAvLyDmraXpqqTkuozvvJrmnoTmiJAgRm9ybWF0U3RyaW5nXG5cbiAgdmFyIGZvcm1hdFN0cmluZyA9IFttZXRob2QsIHBhdGhuYW1lLCB1dGlsLm9iajJzdHIocXVlcnlQYXJhbXMsIHRydWUpLCB1dGlsLm9iajJzdHIoaGVhZGVycywgdHJ1ZSksICcnXS5qb2luKCdcXG4nKTsgLy8g5q2l6aqk5LiJ77ya6K6h566XIFN0cmluZ1RvU2lnblxuXG4gIHZhciBzdHJpbmdUb1NpZ24gPSBbJ3NoYTEnLCBxU2lnblRpbWUsIENyeXB0b0pTLlNIQTEoZm9ybWF0U3RyaW5nKS50b1N0cmluZygpLCAnJ10uam9pbignXFxuJyk7IC8vIOatpemqpOWbm++8muiuoeeulyBTaWduYXR1cmVcblxuICB2YXIgcVNpZ25hdHVyZSA9IENyeXB0b0pTLkhtYWNTSEExKHN0cmluZ1RvU2lnbiwgc2lnbktleSkudG9TdHJpbmcoKTsgLy8g5q2l6aqk5LqU77ya5p6E6YCgIEF1dGhvcml6YXRpb25cblxuICB2YXIgYXV0aG9yaXphdGlvbiA9IFsncS1zaWduLWFsZ29yaXRobT0nICsgcVNpZ25BbGdvcml0aG0sICdxLWFrPScgKyBxQWssICdxLXNpZ24tdGltZT0nICsgcVNpZ25UaW1lLCAncS1rZXktdGltZT0nICsgcUtleVRpbWUsICdxLWhlYWRlci1saXN0PScgKyBxSGVhZGVyTGlzdCwgJ3EtdXJsLXBhcmFtLWxpc3Q9JyArIHFVcmxQYXJhbUxpc3QsICdxLXNpZ25hdHVyZT0nICsgcVNpZ25hdHVyZV0uam9pbignJicpO1xuICByZXR1cm4gYXV0aG9yaXphdGlvbjtcbn07XG5cbnZhciByZWFkSW50QkUgPSBmdW5jdGlvbiByZWFkSW50QkUoY2h1bmssIHNpemUsIG9mZnNldCkge1xuICB2YXIgYnl0ZXMgPSBzaXplIC8gODtcbiAgdmFyIGJ1ZiA9IGNodW5rLnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgYnl0ZXMpO1xuICBuZXcgVWludDhBcnJheShidWYpLnJldmVyc2UoKTtcbiAgcmV0dXJuIG5ldyB7XG4gICAgODogVWludDhBcnJheSxcbiAgICAxNjogVWludDE2QXJyYXksXG4gICAgMzI6IFVpbnQzMkFycmF5XG4gIH1bc2l6ZV0oYnVmKVswXTtcbn07XG5cbnZhciBidWYyc3RyID0gZnVuY3Rpb24gYnVmMnN0cihjaHVuaywgc3RhcnQsIGVuZCwgaXNVdGY4KSB7XG4gIHZhciBidWYgPSBjaHVuay5zbGljZShzdGFydCwgZW5kKTtcbiAgdmFyIHN0ciA9ICcnO1xuICBuZXcgVWludDhBcnJheShidWYpLmZvckVhY2goZnVuY3Rpb24gKGNoYXJDb2RlKSB7XG4gICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2hhckNvZGUpO1xuICB9KTtcbiAgaWYgKGlzVXRmOCkgc3RyID0gZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZShzdHIpKTtcbiAgcmV0dXJuIHN0cjtcbn07XG5cbnZhciBwYXJzZVNlbGVjdFBheWxvYWQgPSBmdW5jdGlvbiBwYXJzZVNlbGVjdFBheWxvYWQoY2h1bmspIHtcbiAgdmFyIGhlYWRlciA9IHt9O1xuICB2YXIgYm9keSA9IGJ1ZjJzdHIoY2h1bmspO1xuICB2YXIgcmVzdWx0ID0ge1xuICAgIHJlY29yZHM6IFtdXG4gIH07XG5cbiAgd2hpbGUgKGNodW5rLmJ5dGVMZW5ndGgpIHtcbiAgICB2YXIgdG90YWxMZW5ndGggPSByZWFkSW50QkUoY2h1bmssIDMyLCAwKTtcbiAgICB2YXIgaGVhZGVyTGVuZ3RoID0gcmVhZEludEJFKGNodW5rLCAzMiwgNCk7XG4gICAgdmFyIHBheWxvYWRSZXN0TGVuZ3RoID0gdG90YWxMZW5ndGggLSBoZWFkZXJMZW5ndGggLSAxNjtcbiAgICB2YXIgb2Zmc2V0ID0gMDtcbiAgICB2YXIgY29udGVudDtcbiAgICBjaHVuayA9IGNodW5rLnNsaWNlKDEyKTsgLy8g6I635Y+WIE1lc3NhZ2Ug55qEIGhlYWRlciDkv6Hmga9cblxuICAgIHdoaWxlIChvZmZzZXQgPCBoZWFkZXJMZW5ndGgpIHtcbiAgICAgIHZhciBoZWFkZXJOYW1lTGVuZ3RoID0gcmVhZEludEJFKGNodW5rLCA4LCBvZmZzZXQpO1xuICAgICAgdmFyIGhlYWRlck5hbWUgPSBidWYyc3RyKGNodW5rLCBvZmZzZXQgKyAxLCBvZmZzZXQgKyAxICsgaGVhZGVyTmFtZUxlbmd0aCk7XG4gICAgICB2YXIgaGVhZGVyVmFsdWVMZW5ndGggPSByZWFkSW50QkUoY2h1bmssIDE2LCBvZmZzZXQgKyBoZWFkZXJOYW1lTGVuZ3RoICsgMik7XG4gICAgICB2YXIgaGVhZGVyVmFsdWUgPSBidWYyc3RyKGNodW5rLCBvZmZzZXQgKyBoZWFkZXJOYW1lTGVuZ3RoICsgNCwgb2Zmc2V0ICsgaGVhZGVyTmFtZUxlbmd0aCArIDQgKyBoZWFkZXJWYWx1ZUxlbmd0aCk7XG4gICAgICBoZWFkZXJbaGVhZGVyTmFtZV0gPSBoZWFkZXJWYWx1ZTtcbiAgICAgIG9mZnNldCArPSBoZWFkZXJOYW1lTGVuZ3RoICsgNCArIGhlYWRlclZhbHVlTGVuZ3RoO1xuICAgIH1cblxuICAgIGlmIChoZWFkZXJbJzpldmVudC10eXBlJ10gPT09ICdSZWNvcmRzJykge1xuICAgICAgY29udGVudCA9IGJ1ZjJzdHIoY2h1bmssIG9mZnNldCwgb2Zmc2V0ICsgcGF5bG9hZFJlc3RMZW5ndGgsIHRydWUpO1xuICAgICAgcmVzdWx0LnJlY29yZHMucHVzaChjb250ZW50KTtcbiAgICB9IGVsc2UgaWYgKGhlYWRlclsnOmV2ZW50LXR5cGUnXSA9PT0gJ1N0YXRzJykge1xuICAgICAgY29udGVudCA9IGJ1ZjJzdHIoY2h1bmssIG9mZnNldCwgb2Zmc2V0ICsgcGF5bG9hZFJlc3RMZW5ndGgsIHRydWUpO1xuICAgICAgcmVzdWx0LnN0YXRzID0gdXRpbC54bWwyanNvbihjb250ZW50KS5TdGF0cztcbiAgICB9IGVsc2UgaWYgKGhlYWRlclsnOmV2ZW50LXR5cGUnXSA9PT0gJ2Vycm9yJykge1xuICAgICAgdmFyIGVyckNvZGUgPSBoZWFkZXJbJzplcnJvci1jb2RlJ107XG4gICAgICB2YXIgZXJyTWVzc2FnZSA9IGhlYWRlclsnOmVycm9yLW1lc3NhZ2UnXTtcbiAgICAgIHZhciBlcnIgPSBuZXcgRXJyb3IoZXJyTWVzc2FnZSk7XG4gICAgICBlcnIubWVzc2FnZSA9IGVyck1lc3NhZ2U7XG4gICAgICBlcnIubmFtZSA9IGVyci5jb2RlID0gZXJyQ29kZTtcbiAgICAgIHJlc3VsdC5lcnJvciA9IGVycjtcbiAgICB9IGVsc2UgaWYgKFsnUHJvZ3Jlc3MnLCAnQ29udGludWF0aW9uJywgJ0VuZCddLmluY2x1ZGVzKGhlYWRlclsnOmV2ZW50LXR5cGUnXSkpIHsvLyBkbyBub3RoaW5nXG4gICAgfVxuXG4gICAgY2h1bmsgPSBjaHVuay5zbGljZShvZmZzZXQgKyBwYXlsb2FkUmVzdExlbmd0aCArIDQpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBwYXlsb2FkOiByZXN1bHQucmVjb3Jkcy5qb2luKCcnKSxcbiAgICBib2R5OiBib2R5XG4gIH07XG59O1xuXG52YXIgZ2V0U291cmNlUGFyYW1zID0gZnVuY3Rpb24gZ2V0U291cmNlUGFyYW1zKHNvdXJjZSkge1xuICB2YXIgcGFyc2VyID0gdGhpcy5vcHRpb25zLkNvcHlTb3VyY2VQYXJzZXI7XG4gIGlmIChwYXJzZXIpIHJldHVybiBwYXJzZXIoc291cmNlKTtcbiAgdmFyIG0gPSBzb3VyY2UubWF0Y2goL14oW14uXSstXFxkKylcXC5jb3ModjZ8LWNkYyk/XFwuKFteLl0rKVxcLm15cWNsb3VkXFwuY29tXFwvKC4rKSQvKTtcbiAgaWYgKCFtKSByZXR1cm4gbnVsbDtcbiAgcmV0dXJuIHtcbiAgICBCdWNrZXQ6IG1bMV0sXG4gICAgUmVnaW9uOiBtWzNdLFxuICAgIEtleTogbVs0XVxuICB9O1xufTtcblxudmFyIG5vb3AgPSBmdW5jdGlvbiBub29wKCkge307IC8vIOa4hemZpOWvueixoemHjOWAvOS4uueahCB1bmRlZmluZWQg5oiWIG51bGwg55qE5bGe5oCnXG5cblxudmFyIGNsZWFyS2V5ID0gZnVuY3Rpb24gY2xlYXJLZXkob2JqKSB7XG4gIHZhciByZXRPYmogPSB7fTtcblxuICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7XG4gICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIG9ialtrZXldICE9PSB1bmRlZmluZWQgJiYgb2JqW2tleV0gIT09IG51bGwpIHtcbiAgICAgIHJldE9ialtrZXldID0gb2JqW2tleV07XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJldE9iajtcbn07XG5cbnZhciByZWFkQXNCaW5hcnlTdHJpbmcgPSBmdW5jdGlvbiByZWFkQXNCaW5hcnlTdHJpbmcoYmxvYiwgY2FsbGJhY2spIHtcbiAgdmFyIHJlYWRGdW47XG4gIHZhciBmciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cbiAgaWYgKEZpbGVSZWFkZXIucHJvdG90eXBlLnJlYWRBc0JpbmFyeVN0cmluZykge1xuICAgIHJlYWRGdW4gPSBGaWxlUmVhZGVyLnByb3RvdHlwZS5yZWFkQXNCaW5hcnlTdHJpbmc7XG5cbiAgICBmci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBjYWxsYmFjayh0aGlzLnJlc3VsdCk7XG4gICAgfTtcbiAgfSBlbHNlIGlmIChGaWxlUmVhZGVyLnByb3RvdHlwZS5yZWFkQXNBcnJheUJ1ZmZlcikge1xuICAgIC8vIOWcqCBpZTExIOa3u+WKoCByZWFkQXNCaW5hcnlTdHJpbmcg5YW85a65XG4gICAgcmVhZEZ1biA9IGZ1bmN0aW9uIHJlYWRGdW4oZmlsZURhdGEpIHtcbiAgICAgIHZhciBiaW5hcnkgPSBcIlwiO1xuICAgICAgdmFyIHB0ID0gdGhpcztcbiAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXG4gICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkocmVhZGVyLnJlc3VsdCk7XG4gICAgICAgIHZhciBsZW5ndGggPSBieXRlcy5ieXRlTGVuZ3RoO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBiaW5hcnkgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShieXRlc1tpXSk7XG4gICAgICAgIH1cblxuICAgICAgICBjYWxsYmFjayhiaW5hcnkpO1xuICAgICAgfTtcblxuICAgICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGZpbGVEYXRhKTtcbiAgICB9O1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0ZpbGVSZWFkZXIgbm90IHN1cHBvcnQgcmVhZEFzQmluYXJ5U3RyaW5nJyk7XG4gIH1cblxuICByZWFkRnVuLmNhbGwoZnIsIGJsb2IpO1xufTtcblxudmFyIGZpbGVTbGljZU5lZWRDb3B5ID0gZnVuY3Rpb24gKCkge1xuICB2YXIgY29tcGFyZVZlcnNpb24gPSBmdW5jdGlvbiBjb21wYXJlVmVyc2lvbihhLCBiKSB7XG4gICAgYSA9IGEuc3BsaXQoJy4nKTtcbiAgICBiID0gYi5zcGxpdCgnLicpO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoYVtpXSAhPT0gYltpXSkge1xuICAgICAgICByZXR1cm4gcGFyc2VJbnQoYVtpXSkgPiBwYXJzZUludChiW2ldKSA/IDEgOiAtMTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gMDtcbiAgfTtcblxuICB2YXIgY2hlY2sgPSBmdW5jdGlvbiBjaGVjayh1YSkge1xuICAgIGlmICghdWEpIHJldHVybiBmYWxzZTtcbiAgICB2YXIgQ2hyb21lVmVyc2lvbiA9ICh1YS5tYXRjaCgvQ2hyb21lXFwvKFsuXFxkXSspLykgfHwgW10pWzFdO1xuICAgIHZhciBRQkNvcmVWZXJzaW9uID0gKHVhLm1hdGNoKC9RQkNvcmVcXC8oWy5cXGRdKykvKSB8fCBbXSlbMV07XG4gICAgdmFyIFFRQnJvd3NlclZlcnNpb24gPSAodWEubWF0Y2goL1FRQnJvd3NlclxcLyhbLlxcZF0rKS8pIHx8IFtdKVsxXTtcbiAgICB2YXIgbmVlZCA9IENocm9tZVZlcnNpb24gJiYgY29tcGFyZVZlcnNpb24oQ2hyb21lVmVyc2lvbiwgJzUzLjAuMjc4NS4xMTYnKSA8IDAgJiYgUUJDb3JlVmVyc2lvbiAmJiBjb21wYXJlVmVyc2lvbihRQkNvcmVWZXJzaW9uLCAnMy41My45OTEuNDAwJykgPCAwICYmIFFRQnJvd3NlclZlcnNpb24gJiYgY29tcGFyZVZlcnNpb24oUVFCcm93c2VyVmVyc2lvbiwgJzkuMC4yNTI0LjQwMCcpIDw9IDAgfHwgZmFsc2U7XG4gICAgcmV0dXJuIG5lZWQ7XG4gIH07XG5cbiAgcmV0dXJuIGNoZWNrKHR5cGVvZiBuYXZpZ2F0b3IgIT09ICd1bmRlZmluZWQnICYmIG5hdmlnYXRvci51c2VyQWdlbnQpO1xufSgpOyAvLyDojrflj5bmlofku7bliIbniYdcblxuXG52YXIgZmlsZVNsaWNlID0gZnVuY3Rpb24gZmlsZVNsaWNlKGZpbGUsIHN0YXJ0LCBlbmQsIGlzVXNlVG9VcGxvYWQsIGNhbGxiYWNrKSB7XG4gIHZhciBibG9iO1xuXG4gIGlmIChmaWxlLnNsaWNlKSB7XG4gICAgYmxvYiA9IGZpbGUuc2xpY2Uoc3RhcnQsIGVuZCk7XG4gIH0gZWxzZSBpZiAoZmlsZS5tb3pTbGljZSkge1xuICAgIGJsb2IgPSBmaWxlLm1velNsaWNlKHN0YXJ0LCBlbmQpO1xuICB9IGVsc2UgaWYgKGZpbGUud2Via2l0U2xpY2UpIHtcbiAgICBibG9iID0gZmlsZS53ZWJraXRTbGljZShzdGFydCwgZW5kKTtcbiAgfVxuXG4gIGlmIChpc1VzZVRvVXBsb2FkICYmIGZpbGVTbGljZU5lZWRDb3B5KSB7XG4gICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cbiAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIGJsb2IgPSBudWxsO1xuICAgICAgY2FsbGJhY2sobmV3IEJsb2IoW3JlYWRlci5yZXN1bHRdKSk7XG4gICAgfTtcblxuICAgIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihibG9iKTtcbiAgfSBlbHNlIHtcbiAgICBjYWxsYmFjayhibG9iKTtcbiAgfVxufTsgLy8g6I635Y+W5paH5Lu25YaF5a6555qEIE1ENVxuXG5cbnZhciBnZXRCb2R5TWQ1ID0gZnVuY3Rpb24gZ2V0Qm9keU1kNShVcGxvYWRDaGVja0NvbnRlbnRNZDUsIEJvZHksIGNhbGxiYWNrLCBvblByb2dyZXNzKSB7XG4gIGNhbGxiYWNrID0gY2FsbGJhY2sgfHwgbm9vcDtcblxuICBpZiAoVXBsb2FkQ2hlY2tDb250ZW50TWQ1KSB7XG4gICAgaWYgKHR5cGVvZiBCb2R5ID09PSAnc3RyaW5nJykge1xuICAgICAgY2FsbGJhY2sodXRpbC5tZDUoQm9keSwgdHJ1ZSkpO1xuICAgIH0gZWxzZSBpZiAoQmxvYiAmJiBCb2R5IGluc3RhbmNlb2YgQmxvYikge1xuICAgICAgdXRpbC5nZXRGaWxlTWQ1KEJvZHksIGZ1bmN0aW9uIChlcnIsIG1kNSkge1xuICAgICAgICBjYWxsYmFjayhtZDUpO1xuICAgICAgfSwgb25Qcm9ncmVzcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGNhbGxiYWNrKCk7XG4gIH1cbn07IC8vIOiOt+WPluaWh+S7tiBtZDUg5YC8XG5cblxudmFyIG1kNUNodW5rU2l6ZSA9IDEwMjQgKiAxMDI0O1xuXG52YXIgZ2V0RmlsZU1kNSA9IGZ1bmN0aW9uIGdldEZpbGVNZDUoYmxvYiwgY2FsbGJhY2ssIG9uUHJvZ3Jlc3MpIHtcbiAgdmFyIHNpemUgPSBibG9iLnNpemU7XG4gIHZhciBsb2FkZWQgPSAwO1xuICB2YXIgbWQ1Y3R4ID0gbWQ1LmdldEN0eCgpO1xuXG4gIHZhciBuZXh0ID0gZnVuY3Rpb24gbmV4dChzdGFydCkge1xuICAgIGlmIChzdGFydCA+PSBzaXplKSB7XG4gICAgICB2YXIgaGFzaCA9IG1kNWN0eC5kaWdlc3QoJ2hleCcpO1xuICAgICAgY2FsbGJhY2sobnVsbCwgaGFzaCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGVuZCA9IE1hdGgubWluKHNpemUsIHN0YXJ0ICsgbWQ1Q2h1bmtTaXplKTtcbiAgICB1dGlsLmZpbGVTbGljZShibG9iLCBzdGFydCwgZW5kLCBmYWxzZSwgZnVuY3Rpb24gKGNodW5rKSB7XG4gICAgICByZWFkQXNCaW5hcnlTdHJpbmcoY2h1bmssIGZ1bmN0aW9uIChjb250ZW50KSB7XG4gICAgICAgIGNodW5rID0gbnVsbDtcbiAgICAgICAgbWQ1Y3R4ID0gbWQ1Y3R4LnVwZGF0ZShjb250ZW50LCB0cnVlKTtcbiAgICAgICAgbG9hZGVkICs9IGNvbnRlbnQubGVuZ3RoO1xuICAgICAgICBjb250ZW50ID0gbnVsbDtcbiAgICAgICAgaWYgKG9uUHJvZ3Jlc3MpIG9uUHJvZ3Jlc3Moe1xuICAgICAgICAgIGxvYWRlZDogbG9hZGVkLFxuICAgICAgICAgIHRvdGFsOiBzaXplLFxuICAgICAgICAgIHBlcmNlbnQ6IE1hdGgucm91bmQobG9hZGVkIC8gc2l6ZSAqIDEwMDAwKSAvIDEwMDAwXG4gICAgICAgIH0pO1xuICAgICAgICBuZXh0KHN0YXJ0ICsgbWQ1Q2h1bmtTaXplKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIG5leHQoMCk7XG59O1xuXG5mdW5jdGlvbiBjbG9uZShvYmopIHtcbiAgcmV0dXJuIG1hcChvYmosIGZ1bmN0aW9uICh2KSB7XG4gICAgcmV0dXJuIF90eXBlb2YodikgPT09ICdvYmplY3QnICYmIHYgIT09IG51bGwgPyBjbG9uZSh2KSA6IHY7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBhdHRyKG9iaiwgbmFtZSwgZGVmYXVsdFZhbHVlKSB7XG4gIHJldHVybiBvYmogJiYgbmFtZSBpbiBvYmogPyBvYmpbbmFtZV0gOiBkZWZhdWx0VmFsdWU7XG59XG5cbmZ1bmN0aW9uIGV4dGVuZCh0YXJnZXQsIHNvdXJjZSkge1xuICBlYWNoKHNvdXJjZSwgZnVuY3Rpb24gKHZhbCwga2V5KSB7XG4gICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTtcbiAgfSk7XG4gIHJldHVybiB0YXJnZXQ7XG59XG5cbmZ1bmN0aW9uIGlzQXJyYXkoYXJyKSB7XG4gIHJldHVybiBhcnIgaW5zdGFuY2VvZiBBcnJheTtcbn1cblxuZnVuY3Rpb24gaXNJbkFycmF5KGFyciwgaXRlbSkge1xuICB2YXIgZmxhZyA9IGZhbHNlO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKGl0ZW0gPT09IGFycltpXSkge1xuICAgICAgZmxhZyA9IHRydWU7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZmxhZztcbn1cblxuZnVuY3Rpb24gbWFrZUFycmF5KGFycikge1xuICByZXR1cm4gaXNBcnJheShhcnIpID8gYXJyIDogW2Fycl07XG59XG5cbmZ1bmN0aW9uIGVhY2gob2JqLCBmbikge1xuICBmb3IgKHZhciBpIGluIG9iaikge1xuICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoaSkpIHtcbiAgICAgIGZuKG9ialtpXSwgaSk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIG1hcChvYmosIGZuKSB7XG4gIHZhciBvID0gaXNBcnJheShvYmopID8gW10gOiB7fTtcblxuICBmb3IgKHZhciBpIGluIG9iaikge1xuICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoaSkpIHtcbiAgICAgIG9baV0gPSBmbihvYmpbaV0sIGkpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBvO1xufVxuXG5mdW5jdGlvbiBmaWx0ZXIob2JqLCBmbikge1xuICB2YXIgaWFBcnIgPSBpc0FycmF5KG9iaik7XG4gIHZhciBvID0gaWFBcnIgPyBbXSA6IHt9O1xuXG4gIGZvciAodmFyIGkgaW4gb2JqKSB7XG4gICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShpKSkge1xuICAgICAgaWYgKGZuKG9ialtpXSwgaSkpIHtcbiAgICAgICAgaWYgKGlhQXJyKSB7XG4gICAgICAgICAgby5wdXNoKG9ialtpXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgb1tpXSA9IG9ialtpXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBvO1xufVxuXG52YXIgYmluYXJ5QmFzZTY0ID0gZnVuY3Rpb24gYmluYXJ5QmFzZTY0KHN0cikge1xuICB2YXIgaSxcbiAgICAgIGxlbixcbiAgICAgIGNoYXIsXG4gICAgICByZXMgPSAnJztcblxuICBmb3IgKGkgPSAwLCBsZW4gPSBzdHIubGVuZ3RoIC8gMjsgaSA8IGxlbjsgaSsrKSB7XG4gICAgY2hhciA9IHBhcnNlSW50KHN0cltpICogMl0gKyBzdHJbaSAqIDIgKyAxXSwgMTYpO1xuICAgIHJlcyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoYXIpO1xuICB9XG5cbiAgcmV0dXJuIGJ0b2EocmVzKTtcbn07XG5cbnZhciB1dWlkID0gZnVuY3Rpb24gdXVpZCgpIHtcbiAgdmFyIFM0ID0gZnVuY3Rpb24gUzQoKSB7XG4gICAgcmV0dXJuICgoMSArIE1hdGgucmFuZG9tKCkpICogMHgxMDAwMCB8IDApLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSk7XG4gIH07XG5cbiAgcmV0dXJuIFM0KCkgKyBTNCgpICsgXCItXCIgKyBTNCgpICsgXCItXCIgKyBTNCgpICsgXCItXCIgKyBTNCgpICsgXCItXCIgKyBTNCgpICsgUzQoKSArIFM0KCk7XG59O1xuXG52YXIgaGFzTWlzc2luZ1BhcmFtcyA9IGZ1bmN0aW9uIGhhc01pc3NpbmdQYXJhbXMoYXBpTmFtZSwgcGFyYW1zKSB7XG4gIHZhciBCdWNrZXQgPSBwYXJhbXMuQnVja2V0O1xuICB2YXIgUmVnaW9uID0gcGFyYW1zLlJlZ2lvbjtcbiAgdmFyIEtleSA9IHBhcmFtcy5LZXk7XG4gIHZhciBEb21haW4gPSB0aGlzLm9wdGlvbnMuRG9tYWluO1xuICB2YXIgY2hlY2tCdWNrZXQgPSAhRG9tYWluIHx8IHR5cGVvZiBEb21haW4gPT09ICdzdHJpbmcnICYmIERvbWFpbi5pbmRleE9mKCd7QnVja2V0fScpID4gLTE7XG4gIHZhciBjaGVja1JlZ2lvbiA9ICFEb21haW4gfHwgdHlwZW9mIERvbWFpbiA9PT0gJ3N0cmluZycgJiYgRG9tYWluLmluZGV4T2YoJ3tSZWdpb259JykgPiAtMTtcblxuICBpZiAoYXBpTmFtZS5pbmRleE9mKCdCdWNrZXQnKSA+IC0xIHx8IGFwaU5hbWUgPT09ICdkZWxldGVNdWx0aXBsZU9iamVjdCcgfHwgYXBpTmFtZSA9PT0gJ211bHRpcGFydExpc3QnIHx8IGFwaU5hbWUgPT09ICdsaXN0T2JqZWN0VmVyc2lvbnMnKSB7XG4gICAgaWYgKGNoZWNrQnVja2V0ICYmICFCdWNrZXQpIHJldHVybiAnQnVja2V0JztcbiAgICBpZiAoY2hlY2tSZWdpb24gJiYgIVJlZ2lvbikgcmV0dXJuICdSZWdpb24nO1xuICB9IGVsc2UgaWYgKGFwaU5hbWUuaW5kZXhPZignT2JqZWN0JykgPiAtMSB8fCBhcGlOYW1lLmluZGV4T2YoJ211bHRpcGFydCcpID4gLTEgfHwgYXBpTmFtZSA9PT0gJ3NsaWNlVXBsb2FkRmlsZScgfHwgYXBpTmFtZSA9PT0gJ2Fib3J0VXBsb2FkVGFzaycpIHtcbiAgICBpZiAoY2hlY2tCdWNrZXQgJiYgIUJ1Y2tldCkgcmV0dXJuICdCdWNrZXQnO1xuICAgIGlmIChjaGVja1JlZ2lvbiAmJiAhUmVnaW9uKSByZXR1cm4gJ1JlZ2lvbic7XG4gICAgaWYgKCFLZXkpIHJldHVybiAnS2V5JztcbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn07XG5cbnZhciBmb3JtYXRQYXJhbXMgPSBmdW5jdGlvbiBmb3JtYXRQYXJhbXMoYXBpTmFtZSwgcGFyYW1zKSB7XG4gIC8vIOWkjeWItuWPguaVsOWvueixoVxuICBwYXJhbXMgPSBleHRlbmQoe30sIHBhcmFtcyk7IC8vIOe7n+S4gOWkhOeQhiBIZWFkZXJzXG5cbiAgaWYgKGFwaU5hbWUgIT09ICdnZXRBdXRoJyAmJiBhcGlOYW1lICE9PSAnZ2V0VjRBdXRoJyAmJiBhcGlOYW1lICE9PSAnZ2V0T2JqZWN0VXJsJykge1xuICAgIHZhciBIZWFkZXJzID0gcGFyYW1zLkhlYWRlcnMgfHwge307XG5cbiAgICBpZiAocGFyYW1zICYmIF90eXBlb2YocGFyYW1zKSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZvciAodmFyIGtleSBpbiBwYXJhbXMpIHtcbiAgICAgICAgICBpZiAocGFyYW1zLmhhc093blByb3BlcnR5KGtleSkgJiYga2V5LmluZGV4T2YoJ3gtY29zLScpID4gLTEpIHtcbiAgICAgICAgICAgIEhlYWRlcnNba2V5XSA9IHBhcmFtc1trZXldO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSkoKTtcblxuICAgICAgdmFyIGhlYWRlck1hcCA9IHtcbiAgICAgICAgLy8gcGFyYW1zIGhlYWRlcnNcbiAgICAgICAgJ3gtY29zLW1mYSc6ICdNRkEnLFxuICAgICAgICAnQ29udGVudC1NRDUnOiAnQ29udGVudE1ENScsXG4gICAgICAgICdDb250ZW50LUxlbmd0aCc6ICdDb250ZW50TGVuZ3RoJyxcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdDb250ZW50VHlwZScsXG4gICAgICAgICdFeHBlY3QnOiAnRXhwZWN0JyxcbiAgICAgICAgJ0V4cGlyZXMnOiAnRXhwaXJlcycsXG4gICAgICAgICdDYWNoZS1Db250cm9sJzogJ0NhY2hlQ29udHJvbCcsXG4gICAgICAgICdDb250ZW50LURpc3Bvc2l0aW9uJzogJ0NvbnRlbnREaXNwb3NpdGlvbicsXG4gICAgICAgICdDb250ZW50LUVuY29kaW5nJzogJ0NvbnRlbnRFbmNvZGluZycsXG4gICAgICAgICdSYW5nZSc6ICdSYW5nZScsXG4gICAgICAgICdJZi1Nb2RpZmllZC1TaW5jZSc6ICdJZk1vZGlmaWVkU2luY2UnLFxuICAgICAgICAnSWYtVW5tb2RpZmllZC1TaW5jZSc6ICdJZlVubW9kaWZpZWRTaW5jZScsXG4gICAgICAgICdJZi1NYXRjaCc6ICdJZk1hdGNoJyxcbiAgICAgICAgJ0lmLU5vbmUtTWF0Y2gnOiAnSWZOb25lTWF0Y2gnLFxuICAgICAgICAneC1jb3MtY29weS1zb3VyY2UnOiAnQ29weVNvdXJjZScsXG4gICAgICAgICd4LWNvcy1jb3B5LXNvdXJjZS1SYW5nZSc6ICdDb3B5U291cmNlUmFuZ2UnLFxuICAgICAgICAneC1jb3MtbWV0YWRhdGEtZGlyZWN0aXZlJzogJ01ldGFkYXRhRGlyZWN0aXZlJyxcbiAgICAgICAgJ3gtY29zLWNvcHktc291cmNlLUlmLU1vZGlmaWVkLVNpbmNlJzogJ0NvcHlTb3VyY2VJZk1vZGlmaWVkU2luY2UnLFxuICAgICAgICAneC1jb3MtY29weS1zb3VyY2UtSWYtVW5tb2RpZmllZC1TaW5jZSc6ICdDb3B5U291cmNlSWZVbm1vZGlmaWVkU2luY2UnLFxuICAgICAgICAneC1jb3MtY29weS1zb3VyY2UtSWYtTWF0Y2gnOiAnQ29weVNvdXJjZUlmTWF0Y2gnLFxuICAgICAgICAneC1jb3MtY29weS1zb3VyY2UtSWYtTm9uZS1NYXRjaCc6ICdDb3B5U291cmNlSWZOb25lTWF0Y2gnLFxuICAgICAgICAneC1jb3MtYWNsJzogJ0FDTCcsXG4gICAgICAgICd4LWNvcy1ncmFudC1yZWFkJzogJ0dyYW50UmVhZCcsXG4gICAgICAgICd4LWNvcy1ncmFudC13cml0ZSc6ICdHcmFudFdyaXRlJyxcbiAgICAgICAgJ3gtY29zLWdyYW50LWZ1bGwtY29udHJvbCc6ICdHcmFudEZ1bGxDb250cm9sJyxcbiAgICAgICAgJ3gtY29zLWdyYW50LXJlYWQtYWNwJzogJ0dyYW50UmVhZEFjcCcsXG4gICAgICAgICd4LWNvcy1ncmFudC13cml0ZS1hY3AnOiAnR3JhbnRXcml0ZUFjcCcsXG4gICAgICAgICd4LWNvcy1zdG9yYWdlLWNsYXNzJzogJ1N0b3JhZ2VDbGFzcycsXG4gICAgICAgICd4LWNvcy10cmFmZmljLWxpbWl0JzogJ1RyYWZmaWNMaW1pdCcsXG4gICAgICAgICd4LWNvcy1taW1lLWxpbWl0JzogJ01pbWVMaW1pdCcsXG4gICAgICAgIC8vIFNTRS1DXG4gICAgICAgICd4LWNvcy1zZXJ2ZXItc2lkZS1lbmNyeXB0aW9uLWN1c3RvbWVyLWFsZ29yaXRobSc6ICdTU0VDdXN0b21lckFsZ29yaXRobScsXG4gICAgICAgICd4LWNvcy1zZXJ2ZXItc2lkZS1lbmNyeXB0aW9uLWN1c3RvbWVyLWtleSc6ICdTU0VDdXN0b21lcktleScsXG4gICAgICAgICd4LWNvcy1zZXJ2ZXItc2lkZS1lbmNyeXB0aW9uLWN1c3RvbWVyLWtleS1NRDUnOiAnU1NFQ3VzdG9tZXJLZXlNRDUnLFxuICAgICAgICAvLyBTU0UtQ09T44CBU1NFLUtNU1xuICAgICAgICAneC1jb3Mtc2VydmVyLXNpZGUtZW5jcnlwdGlvbic6ICdTZXJ2ZXJTaWRlRW5jcnlwdGlvbicsXG4gICAgICAgICd4LWNvcy1zZXJ2ZXItc2lkZS1lbmNyeXB0aW9uLWNvcy1rbXMta2V5LWlkJzogJ1NTRUtNU0tleUlkJyxcbiAgICAgICAgJ3gtY29zLXNlcnZlci1zaWRlLWVuY3J5cHRpb24tY29udGV4dCc6ICdTU0VDb250ZXh0J1xuICAgICAgfTtcbiAgICAgIHV0aWwuZWFjaChoZWFkZXJNYXAsIGZ1bmN0aW9uIChwYXJhbUtleSwgaGVhZGVyS2V5KSB7XG4gICAgICAgIGlmIChwYXJhbXNbcGFyYW1LZXldICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBIZWFkZXJzW2hlYWRlcktleV0gPSBwYXJhbXNbcGFyYW1LZXldO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHBhcmFtcy5IZWFkZXJzID0gY2xlYXJLZXkoSGVhZGVycyk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHBhcmFtcztcbn07XG5cbnZhciBhcGlXcmFwcGVyID0gZnVuY3Rpb24gYXBpV3JhcHBlcihhcGlOYW1lLCBhcGlGbikge1xuICByZXR1cm4gZnVuY3Rpb24gKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7IC8vIOWkhOeQhuWPguaVsFxuXG4gICAgaWYgKHR5cGVvZiBwYXJhbXMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGNhbGxiYWNrID0gcGFyYW1zO1xuICAgICAgcGFyYW1zID0ge307XG4gICAgfSAvLyDmlbTnkIblj4LmlbDmoLzlvI9cblxuXG4gICAgcGFyYW1zID0gZm9ybWF0UGFyYW1zKGFwaU5hbWUsIHBhcmFtcyk7IC8vIHRyYWNrZXLkvKDpgJJcblxuICAgIHZhciB0cmFja2VyO1xuXG4gICAgaWYgKHNlbGYub3B0aW9ucy5FbmFibGVUcmFja2VyKSB7XG4gICAgICBpZiAocGFyYW1zLmNhbGxlZEJ5U2RrID09PSAnc2xpY2VVcGxvYWRGaWxlJykge1xuICAgICAgICAvLyDliIblnZfkuIrkvKDlhoXpg6jmlrnms5Xkvb/nlKhzbGljZVVwbG9hZEZpbGXnmoTlrZDpk77ot69cbiAgICAgICAgdHJhY2tlciA9IHBhcmFtcy50cmFja2VyICYmIHBhcmFtcy50cmFja2VyLmdlbmVyYXRlU3ViVHJhY2tlcih7XG4gICAgICAgICAgYXBpTmFtZTogYXBpTmFtZVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAoWyd1cGxvYWRGaWxlJywgJ3VwbG9hZEZpbGVzJ10uaW5jbHVkZXMoYXBpTmFtZSkpIHtcbiAgICAgICAgLy8gdXBsb2FkRmlsZeOAgXVwbG9hZEZpbGVz5pa55rOV5Zyo5YaF6YOo5aSE55CG77yM5q2k5aSE5LiN5aSE55CGXG4gICAgICAgIHRyYWNrZXIgPSBudWxsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGZpbGVTaXplID0gLTE7XG5cbiAgICAgICAgaWYgKHBhcmFtcy5Cb2R5KSB7XG4gICAgICAgICAgZmlsZVNpemUgPSB0eXBlb2YgcGFyYW1zLkJvZHkgPT09ICdzdHJpbmcnID8gcGFyYW1zLkJvZHkubGVuZ3RoIDogcGFyYW1zLkJvZHkuc2l6ZSB8fCBwYXJhbXMuQm9keS5ieXRlTGVuZ3RoIHx8IC0xO1xuICAgICAgICB9XG5cbiAgICAgICAgdHJhY2tlciA9IG5ldyBUcmFja2VyKHtcbiAgICAgICAgICBidWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgICAgICAgcmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgICAgICAgIGFwaU5hbWU6IGFwaU5hbWUsXG4gICAgICAgICAgZmlsZUtleTogcGFyYW1zLktleSxcbiAgICAgICAgICBmaWxlU2l6ZTogZmlsZVNpemUsXG4gICAgICAgICAgZGVlcFRyYWNrZXI6IHNlbGYub3B0aW9ucy5EZWVwVHJhY2tlcixcbiAgICAgICAgICBjdXN0b21JZDogc2VsZi5vcHRpb25zLkN1c3RvbUlkLFxuICAgICAgICAgIGRlbGF5OiBzZWxmLm9wdGlvbnMuVHJhY2tlckRlbGF5XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHBhcmFtcy50cmFja2VyID0gdHJhY2tlcjsgLy8g5Luj55CG5Zue6LCD5Ye95pWwXG5cbiAgICB2YXIgZm9ybWF0UmVzdWx0ID0gZnVuY3Rpb24gZm9ybWF0UmVzdWx0KHJlc3VsdCkge1xuICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQuaGVhZGVycykge1xuICAgICAgICByZXN1bHQuaGVhZGVyc1sneC1jb3MtcmVxdWVzdC1pZCddICYmIChyZXN1bHQuUmVxdWVzdElkID0gcmVzdWx0LmhlYWRlcnNbJ3gtY29zLXJlcXVlc3QtaWQnXSk7XG4gICAgICAgIHJlc3VsdC5oZWFkZXJzWyd4LWNpLXJlcXVlc3QtaWQnXSAmJiAocmVzdWx0LlJlcXVlc3RJZCA9IHJlc3VsdC5oZWFkZXJzWyd4LWNpLXJlcXVlc3QtaWQnXSk7XG4gICAgICAgIHJlc3VsdC5oZWFkZXJzWyd4LWNvcy12ZXJzaW9uLWlkJ10gJiYgKHJlc3VsdC5WZXJzaW9uSWQgPSByZXN1bHQuaGVhZGVyc1sneC1jb3MtdmVyc2lvbi1pZCddKTtcbiAgICAgICAgcmVzdWx0LmhlYWRlcnNbJ3gtY29zLWRlbGV0ZS1tYXJrZXInXSAmJiAocmVzdWx0LkRlbGV0ZU1hcmtlciA9IHJlc3VsdC5oZWFkZXJzWyd4LWNvcy1kZWxldGUtbWFya2VyJ10pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG5cbiAgICB2YXIgX2NhbGxiYWNrID0gZnVuY3Rpb24gX2NhbGxiYWNrKGVyciwgZGF0YSkge1xuICAgICAgLy8g5qC85byP5YyW5LiK5oql5Y+C5pWw5bm25LiK5oqlXG4gICAgICB0cmFja2VyICYmIHRyYWNrZXIuZm9ybWF0UmVzdWx0KGVyciwgZGF0YSk7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhmb3JtYXRSZXN1bHQoZXJyKSwgZm9ybWF0UmVzdWx0KGRhdGEpKTtcbiAgICB9O1xuXG4gICAgdmFyIGNoZWNrUGFyYW1zID0gZnVuY3Rpb24gY2hlY2tQYXJhbXMoKSB7XG4gICAgICBpZiAoYXBpTmFtZSAhPT0gJ2dldFNlcnZpY2UnICYmIGFwaU5hbWUgIT09ICdhYm9ydFVwbG9hZFRhc2snKSB7XG4gICAgICAgIC8vIOWIpOaWreWPguaVsOaYr+WQpuWujOaVtFxuICAgICAgICB2YXIgbWlzc2luZ1Jlc3VsdCA9IGhhc01pc3NpbmdQYXJhbXMuY2FsbChzZWxmLCBhcGlOYW1lLCBwYXJhbXMpO1xuXG4gICAgICAgIGlmIChtaXNzaW5nUmVzdWx0KSB7XG4gICAgICAgICAgcmV0dXJuICdtaXNzaW5nIHBhcmFtICcgKyBtaXNzaW5nUmVzdWx0O1xuICAgICAgICB9IC8vIOWIpOaWrSByZWdpb24g5qC85byPXG5cblxuICAgICAgICBpZiAocGFyYW1zLlJlZ2lvbikge1xuICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuQ29tcGF0aWJpbGl0eU1vZGUpIHtcbiAgICAgICAgICAgIGlmICghL14oW2EtelxcZC0uXSspJC8udGVzdChwYXJhbXMuUmVnaW9uKSkge1xuICAgICAgICAgICAgICByZXR1cm4gJ1JlZ2lvbiBmb3JtYXQgZXJyb3IuJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHBhcmFtcy5SZWdpb24uaW5kZXhPZignY29zLicpID4gLTEpIHtcbiAgICAgICAgICAgICAgcmV0dXJuICdwYXJhbSBSZWdpb24gc2hvdWxkIG5vdCBiZSBzdGFydCB3aXRoIFwiY29zLlwiJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIS9eKFthLXpcXGQtXSspJC8udGVzdChwYXJhbXMuUmVnaW9uKSkge1xuICAgICAgICAgICAgICByZXR1cm4gJ1JlZ2lvbiBmb3JtYXQgZXJyb3IuJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IC8vIOWIpOaWrSByZWdpb24g5qC85byPXG5cblxuICAgICAgICAgIGlmICghc2VsZi5vcHRpb25zLkNvbXBhdGliaWxpdHlNb2RlICYmIHBhcmFtcy5SZWdpb24uaW5kZXhPZignLScpID09PSAtMSAmJiBwYXJhbXMuUmVnaW9uICE9PSAneWZiJyAmJiBwYXJhbXMuUmVnaW9uICE9PSAnZGVmYXVsdCcgJiYgcGFyYW1zLlJlZ2lvbiAhPT0gJ2FjY2VsZXJhdGUnKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ3dhcm5pbmc6IHBhcmFtIFJlZ2lvbiBmb3JtYXQgZXJyb3IsIGZpbmQgaGVscCBoZXJlOiBodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2LzYyMjQnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gLy8g5YW85a655LiN5bimIEFwcElkIOeahCBCdWNrZXRcblxuXG4gICAgICAgIGlmIChwYXJhbXMuQnVja2V0KSB7XG4gICAgICAgICAgaWYgKCEvXihbYS16XFxkLV0rKS0oXFxkKykkLy50ZXN0KHBhcmFtcy5CdWNrZXQpKSB7XG4gICAgICAgICAgICBpZiAocGFyYW1zLkFwcElkKSB7XG4gICAgICAgICAgICAgIHBhcmFtcy5CdWNrZXQgPSBwYXJhbXMuQnVja2V0ICsgJy0nICsgcGFyYW1zLkFwcElkO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChzZWxmLm9wdGlvbnMuQXBwSWQpIHtcbiAgICAgICAgICAgICAgcGFyYW1zLkJ1Y2tldCA9IHBhcmFtcy5CdWNrZXQgKyAnLScgKyBzZWxmLm9wdGlvbnMuQXBwSWQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gJ0J1Y2tldCBzaG91bGQgZm9ybWF0IGFzIFwidGVzdC0xMjUwMDAwMDAwXCIuJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAocGFyYW1zLkFwcElkKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ3dhcm5pbmc6IEFwcElkIGhhcyBiZWVuIGRlcHJlY2F0ZWQsIFBsZWFzZSBwdXQgaXQgYXQgdGhlIGVuZCBvZiBwYXJhbWV0ZXIgQnVja2V0KEUuZyBCdWNrZXQ6XCJ0ZXN0LTEyNTAwMDAwMDBcIiApLicpO1xuICAgICAgICAgICAgZGVsZXRlIHBhcmFtcy5BcHBJZDtcbiAgICAgICAgICB9XG4gICAgICAgIH0gLy8g5aaC5p6cIEtleSDmmK8gLyDlvIDlpLTvvIzlvLrliLbljrvmjonnrKzkuIDkuKogL1xuXG5cbiAgICAgICAgaWYgKCFzZWxmLm9wdGlvbnMuVXNlUmF3S2V5ICYmIHBhcmFtcy5LZXkgJiYgcGFyYW1zLktleS5zdWJzdHIoMCwgMSkgPT09ICcvJykge1xuICAgICAgICAgIHBhcmFtcy5LZXkgPSBwYXJhbXMuS2V5LnN1YnN0cigxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgZXJyTXNnID0gY2hlY2tQYXJhbXMoKTtcbiAgICB2YXIgaXNTeW5jID0gYXBpTmFtZSA9PT0gJ2dldEF1dGgnIHx8IGFwaU5hbWUgPT09ICdnZXRPYmplY3RVcmwnO1xuXG4gICAgaWYgKHR5cGVvZiBQcm9taXNlID09PSAnZnVuY3Rpb24nICYmICFpc1N5bmMgJiYgIWNhbGxiYWNrKSB7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uIGNhbGxiYWNrKGVyciwgZGF0YSkge1xuICAgICAgICAgIGVyciA/IHJlamVjdChlcnIpIDogcmVzb2x2ZShkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoZXJyTXNnKSByZXR1cm4gX2NhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKGVyck1zZykpKTtcbiAgICAgICAgYXBpRm4uY2FsbChzZWxmLCBwYXJhbXMsIF9jYWxsYmFjayk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGVyck1zZykgcmV0dXJuIF9jYWxsYmFjayh1dGlsLmVycm9yKG5ldyBFcnJvcihlcnJNc2cpKSk7XG4gICAgICB2YXIgcmVzID0gYXBpRm4uY2FsbChzZWxmLCBwYXJhbXMsIF9jYWxsYmFjayk7XG4gICAgICBpZiAoaXNTeW5jKSByZXR1cm4gcmVzO1xuICAgIH1cbiAgfTtcbn07XG5cbnZhciB0aHJvdHRsZU9uUHJvZ3Jlc3MgPSBmdW5jdGlvbiB0aHJvdHRsZU9uUHJvZ3Jlc3ModG90YWwsIG9uUHJvZ3Jlc3MpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgc2l6ZTAgPSAwO1xuICB2YXIgc2l6ZTEgPSAwO1xuICB2YXIgdGltZTAgPSBEYXRlLm5vdygpO1xuICB2YXIgdGltZTE7XG4gIHZhciB0aW1lcjtcblxuICBmdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgdGltZXIgPSAwO1xuXG4gICAgaWYgKG9uUHJvZ3Jlc3MgJiYgdHlwZW9mIG9uUHJvZ3Jlc3MgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHRpbWUxID0gRGF0ZS5ub3coKTtcbiAgICAgIHZhciBzcGVlZCA9IE1hdGgubWF4KDAsIE1hdGgucm91bmQoKHNpemUxIC0gc2l6ZTApIC8gKCh0aW1lMSAtIHRpbWUwKSAvIDEwMDApICogMTAwKSAvIDEwMCkgfHwgMDtcbiAgICAgIHZhciBwZXJjZW50O1xuXG4gICAgICBpZiAoc2l6ZTEgPT09IDAgJiYgdG90YWwgPT09IDApIHtcbiAgICAgICAgcGVyY2VudCA9IDE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwZXJjZW50ID0gTWF0aC5mbG9vcihzaXplMSAvIHRvdGFsICogMTAwKSAvIDEwMCB8fCAwO1xuICAgICAgfVxuXG4gICAgICB0aW1lMCA9IHRpbWUxO1xuICAgICAgc2l6ZTAgPSBzaXplMTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgb25Qcm9ncmVzcyh7XG4gICAgICAgICAgbG9hZGVkOiBzaXplMSxcbiAgICAgICAgICB0b3RhbDogdG90YWwsXG4gICAgICAgICAgc3BlZWQ6IHNwZWVkLFxuICAgICAgICAgIHBlcmNlbnQ6IHBlcmNlbnRcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlKSB7fVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBmdW5jdGlvbiAoaW5mbywgaW1tZWRpYXRlbHkpIHtcbiAgICBpZiAoaW5mbykge1xuICAgICAgc2l6ZTEgPSBpbmZvLmxvYWRlZDtcbiAgICAgIHRvdGFsID0gaW5mby50b3RhbDtcbiAgICB9XG5cbiAgICBpZiAoaW1tZWRpYXRlbHkpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgICB1cGRhdGUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRpbWVyKSByZXR1cm47XG4gICAgICB0aW1lciA9IHNldFRpbWVvdXQodXBkYXRlLCBzZWxmLm9wdGlvbnMuUHJvZ3Jlc3NJbnRlcnZhbCk7XG4gICAgfVxuICB9O1xufTtcblxudmFyIGdldEZpbGVTaXplID0gZnVuY3Rpb24gZ2V0RmlsZVNpemUoYXBpLCBwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBzaXplO1xuXG4gIGlmICh0eXBlb2YgcGFyYW1zLkJvZHkgPT09ICdzdHJpbmcnKSB7XG4gICAgcGFyYW1zLkJvZHkgPSBuZXcgQmxvYihbcGFyYW1zLkJvZHldLCB7XG4gICAgICB0eXBlOiAndGV4dC9wbGFpbidcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChwYXJhbXMuQm9keSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7XG4gICAgcGFyYW1zLkJvZHkgPSBuZXcgQmxvYihbcGFyYW1zLkJvZHldKTtcbiAgfVxuXG4gIGlmIChwYXJhbXMuQm9keSAmJiAocGFyYW1zLkJvZHkgaW5zdGFuY2VvZiBCbG9iIHx8IHBhcmFtcy5Cb2R5LnRvU3RyaW5nKCkgPT09ICdbb2JqZWN0IEZpbGVdJyB8fCBwYXJhbXMuQm9keS50b1N0cmluZygpID09PSAnW29iamVjdCBCbG9iXScpKSB7XG4gICAgc2l6ZSA9IHBhcmFtcy5Cb2R5LnNpemU7XG4gIH0gZWxzZSB7XG4gICAgY2FsbGJhY2sodXRpbC5lcnJvcihuZXcgRXJyb3IoJ3BhcmFtcyBib2R5IGZvcm1hdCBlcnJvciwgT25seSBhbGxvdyBGaWxlfEJsb2J8U3RyaW5nLicpKSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcGFyYW1zLkNvbnRlbnRMZW5ndGggPSBzaXplO1xuICBjYWxsYmFjayhudWxsLCBzaXplKTtcbn07IC8vIOiOt+WPluiwg+ato+eahOaXtumXtOaIs1xuXG5cbnZhciBnZXRTa2V3VGltZSA9IGZ1bmN0aW9uIGdldFNrZXdUaW1lKG9mZnNldCkge1xuICByZXR1cm4gRGF0ZS5ub3coKSArIChvZmZzZXQgfHwgMCk7XG59O1xuXG52YXIgZXJyb3IgPSBmdW5jdGlvbiBlcnJvcihlcnIsIG9wdCkge1xuICB2YXIgc291cmNlRXJyID0gZXJyO1xuICBlcnIubWVzc2FnZSA9IGVyci5tZXNzYWdlIHx8IG51bGw7XG5cbiAgaWYgKHR5cGVvZiBvcHQgPT09ICdzdHJpbmcnKSB7XG4gICAgZXJyLmVycm9yID0gb3B0O1xuICAgIGVyci5tZXNzYWdlID0gb3B0O1xuICB9IGVsc2UgaWYgKF90eXBlb2Yob3B0KSA9PT0gJ29iamVjdCcgJiYgb3B0ICE9PSBudWxsKSB7XG4gICAgZXh0ZW5kKGVyciwgb3B0KTtcbiAgICBpZiAob3B0LmNvZGUgfHwgb3B0Lm5hbWUpIGVyci5jb2RlID0gb3B0LmNvZGUgfHwgb3B0Lm5hbWU7XG4gICAgaWYgKG9wdC5tZXNzYWdlKSBlcnIubWVzc2FnZSA9IG9wdC5tZXNzYWdlO1xuICAgIGlmIChvcHQuc3RhY2spIGVyci5zdGFjayA9IG9wdC5zdGFjaztcbiAgfVxuXG4gIGlmICh0eXBlb2YgT2JqZWN0LmRlZmluZVByb3BlcnR5ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGVyciwgJ25hbWUnLCB7XG4gICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGVyciwgJ21lc3NhZ2UnLCB7XG4gICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gIH1cblxuICBlcnIubmFtZSA9IG9wdCAmJiBvcHQubmFtZSB8fCBlcnIubmFtZSB8fCBlcnIuY29kZSB8fCAnRXJyb3InO1xuICBpZiAoIWVyci5jb2RlKSBlcnIuY29kZSA9IGVyci5uYW1lO1xuICBpZiAoIWVyci5lcnJvcikgZXJyLmVycm9yID0gY2xvbmUoc291cmNlRXJyKTsgLy8g5YW85a656ICB55qE6ZSZ6K+v5qC85byPXG5cbiAgcmV0dXJuIGVycjtcbn07XG5cbnZhciBpc1dlYldvcmtlciA9IGZ1bmN0aW9uIGlzV2ViV29ya2VyKCkge1xuICAvLyDmnInpmZDliKTmlq0gd29ya2VyIOeOr+Wig+eahCBjb25zdHJ1Y3RvciBuYW1lIOWFtuasoeeUqCB3b3JrZXIg54us5pyJ55qEIEZpbGVSZWFkZXJTeW5jIOWFnOW6lSDor6bnu4blj4LogIMgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL1dlYl9Xb3JrZXJzX0FQSS9Vc2luZ193ZWJfd29ya2Vyc1xuICByZXR1cm4gKHR5cGVvZiBnbG9iYWxUaGlzID09PSBcInVuZGVmaW5lZFwiID8gXCJ1bmRlZmluZWRcIiA6IF90eXBlb2YoZ2xvYmFsVGhpcykpID09PSAnb2JqZWN0JyAmJiAoZ2xvYmFsVGhpcy5jb25zdHJ1Y3Rvci5uYW1lID09PSAnRGVkaWNhdGVkV29ya2VyR2xvYmFsU2NvcGUnIHx8IGdsb2JhbFRoaXMuRmlsZVJlYWRlclN5bmMpO1xufTtcblxudmFyIGlzTm9kZSA9IGZ1bmN0aW9uIGlzTm9kZSgpIHtcbiAgLy8g5b6X5YWc5bqVIHdlYiB3b3JrZXIg546v5aKD5LitIHdlYnBhY2sg55So5LqGIHByb2Nlc3Mg5o+S5Lu25LmL57G755qE5oOF5Ya1XG4gIHJldHVybiAodHlwZW9mIHdpbmRvdyA9PT0gXCJ1bmRlZmluZWRcIiA/IFwidW5kZWZpbmVkXCIgOiBfdHlwZW9mKHdpbmRvdykpICE9PSAnb2JqZWN0JyAmJiAodHlwZW9mIHByb2Nlc3MgPT09IFwidW5kZWZpbmVkXCIgPyBcInVuZGVmaW5lZFwiIDogX3R5cGVvZihwcm9jZXNzKSkgPT09ICdvYmplY3QnICYmIHR5cGVvZiByZXF1aXJlID09PSAnZnVuY3Rpb24nICYmICFpc1dlYldvcmtlcigpO1xufTtcblxudmFyIGlzQ0lIb3N0ID0gZnVuY3Rpb24gaXNDSUhvc3QodXJsKSB7XG4gIHJldHVybiAvXmh0dHBzPzpcXC9cXC8oW14vXStcXC4pP2NpXFwuW14vXSsvLnRlc3QodXJsKTtcbn07XG5cbnZhciB1dGlsID0ge1xuICBub29wOiBub29wLFxuICBmb3JtYXRQYXJhbXM6IGZvcm1hdFBhcmFtcyxcbiAgYXBpV3JhcHBlcjogYXBpV3JhcHBlcixcbiAgeG1sMmpzb246IHhtbDJqc29uLFxuICBqc29uMnhtbDoganNvbjJ4bWwsXG4gIG1kNTogbWQ1LFxuICBjbGVhcktleTogY2xlYXJLZXksXG4gIGZpbGVTbGljZTogZmlsZVNsaWNlLFxuICBnZXRCb2R5TWQ1OiBnZXRCb2R5TWQ1LFxuICBnZXRGaWxlTWQ1OiBnZXRGaWxlTWQ1LFxuICBiaW5hcnlCYXNlNjQ6IGJpbmFyeUJhc2U2NCxcbiAgZXh0ZW5kOiBleHRlbmQsXG4gIGlzQXJyYXk6IGlzQXJyYXksXG4gIGlzSW5BcnJheTogaXNJbkFycmF5LFxuICBtYWtlQXJyYXk6IG1ha2VBcnJheSxcbiAgZWFjaDogZWFjaCxcbiAgbWFwOiBtYXAsXG4gIGZpbHRlcjogZmlsdGVyLFxuICBjbG9uZTogY2xvbmUsXG4gIGF0dHI6IGF0dHIsXG4gIHV1aWQ6IHV1aWQsXG4gIGNhbVNhZmVVcmxFbmNvZGU6IGNhbVNhZmVVcmxFbmNvZGUsXG4gIHRocm90dGxlT25Qcm9ncmVzczogdGhyb3R0bGVPblByb2dyZXNzLFxuICBnZXRGaWxlU2l6ZTogZ2V0RmlsZVNpemUsXG4gIGdldFNrZXdUaW1lOiBnZXRTa2V3VGltZSxcbiAgZXJyb3I6IGVycm9yLFxuICBvYmoyc3RyOiBvYmoyc3RyLFxuICBnZXRBdXRoOiBnZXRBdXRoLFxuICBwYXJzZVNlbGVjdFBheWxvYWQ6IHBhcnNlU2VsZWN0UGF5bG9hZCxcbiAgZ2V0U291cmNlUGFyYW1zOiBnZXRTb3VyY2VQYXJhbXMsXG4gIGlzQnJvd3NlcjogdHJ1ZSxcbiAgaXNOb2RlOiBpc05vZGUsXG4gIGlzQ0lIb3N0OiBpc0NJSG9zdFxufTtcbm1vZHVsZS5leHBvcnRzID0gdXRpbDsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7QUNsRkE7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7QUN6akVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7OztBQy9aQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDaktBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7OztBQ2hxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQzVJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUN4S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7O0FDVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7O0FDektBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7QUNqVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7OztBQzcvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7QUNoUkE7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7OztBQ0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7OztBQ3pvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7OztBQ3ZMQTtBQUNBOzs7Ozs7Ozs7Ozs7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7O0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNsNENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDN0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7O0FDL2hJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ3ZHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDMUhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNsU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7QUM5YkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBIiwic291cmNlUm9vdCI6IiJ9